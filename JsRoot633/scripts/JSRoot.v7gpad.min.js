var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,g,k){e!=Array.prototype&&e!=Object.prototype&&(e[g]=k.value)};$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(e,g,k,l){if(g){k=$jscomp.global;e=e.split(".");for(l=0;l<e.length-1;l++){var p=e[l];p in k||(k[p]={});k=k[p]}e=e[e.length-1];l=k[e];g=g(l);g!=l&&null!=g&&$jscomp.defineProperty(k,e,{configurable:!0,writable:!0,value:g})}};$jscomp.polyfill("Number.isFinite",function(e){return e?e:function(e){return"number"!==typeof e?!1:!isNaN(e)&&Infinity!==e&&-Infinity!==e}},"es6","es3");
$jscomp.arrayIteratorImpl=function(e){var g=0;return function(){return g<e.length?{done:!1,value:e[g++]}:{done:!0}}};$jscomp.arrayIterator=function(e){return{next:$jscomp.arrayIteratorImpl(e)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(e,g){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:g})};
$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function e(k){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(k||"")+"_"+g++,k)}var g=0;return e}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.asyncIterator;e||(e=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(e){$jscomp.initSymbolIterator();e={next:e};e[$jscomp.global.Symbol.iterator]=function(){return this};return e};
$jscomp.iteratorFromArray=function(e,g){$jscomp.initSymbolIterator();e instanceof String&&(e+="");var k=0,l={next:function(){if(k<e.length){var p=k++;return{value:g(p,e[p]),done:!1}}l.next=function(){return{done:!0,value:void 0}};return l.next()}};l[Symbol.iterator]=function(){return l};return l};$jscomp.polyfill("Array.prototype.values",function(e){return e?e:function(){return $jscomp.iteratorFromArray(this,function(e,k){return k})}},"es8","es3");
$jscomp.polyfill("Math.log10",function(e){return e?e:function(e){return Math.log(e)/Math.LN10}},"es6","es3");$jscomp.makeIterator=function(e){var g="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return g?g.call(e):$jscomp.arrayIterator(e)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(e){function g(){this.batch_=null}function k(e){return e instanceof p?e:new p(function(g,q){g(e)})}if(e&&!$jscomp.FORCE_POLYFILL_PROMISE)return e;g.prototype.asyncExecute=function(e){if(null==this.batch_){this.batch_=[];var g=this;this.asyncExecuteFunction(function(){g.executeBatch_()})}this.batch_.push(e)};var l=$jscomp.global.setTimeout;g.prototype.asyncExecuteFunction=function(e){l(e,0)};g.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var e=
this.batch_;this.batch_=[];for(var g=0;g<e.length;++g){var k=e[g];e[g]=null;try{k()}catch(A){this.asyncThrow_(A)}}}this.batch_=null};g.prototype.asyncThrow_=function(e){this.asyncExecuteFunction(function(){throw e;})};var p=function(e){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var g=this.createResolveAndReject_();try{e(g.resolve,g.reject)}catch(w){g.reject(w)}};p.prototype.createResolveAndReject_=function(){function e(e){return function(q){k||(k=!0,e.call(g,q))}}var g=this,k=!1;
return{resolve:e(this.resolveTo_),reject:e(this.reject_)}};p.prototype.resolveTo_=function(e){if(e===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof p)this.settleSameAsPromise_(e);else{a:switch(typeof e){case "object":var g=null!=e;break a;case "function":g=!0;break a;default:g=!1}g?this.resolveToNonPromiseObj_(e):this.fulfill_(e)}};p.prototype.resolveToNonPromiseObj_=function(e){var g=void 0;try{g=e.then}catch(w){this.reject_(w);return}"function"==typeof g?
this.settleSameAsThenable_(g,e):this.fulfill_(e)};p.prototype.reject_=function(e){this.settle_(2,e)};p.prototype.fulfill_=function(e){this.settle_(1,e)};p.prototype.settle_=function(e,g){if(0!=this.state_)throw Error("Cannot settle("+e+", "+g+"): Promise already settled in state"+this.state_);this.state_=e;this.result_=g;this.executeOnSettledCallbacks_()};p.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var e=0;e<this.onSettledCallbacks_.length;++e)m.asyncExecute(this.onSettledCallbacks_[e]);
this.onSettledCallbacks_=null}};var m=new g;p.prototype.settleSameAsPromise_=function(e){var g=this.createResolveAndReject_();e.callWhenSettled_(g.resolve,g.reject)};p.prototype.settleSameAsThenable_=function(e,g){var k=this.createResolveAndReject_();try{e.call(g,k.resolve,k.reject)}catch(A){k.reject(A)}};p.prototype.then=function(e,g){function k(e,g){return"function"==typeof e?function(g){try{l(e(g))}catch(D){m(D)}}:g}var l,m,q=new p(function(e,g){l=e;m=g});this.callWhenSettled_(k(e,l),k(g,m));return q};
p.prototype.catch=function(e){return this.then(void 0,e)};p.prototype.callWhenSettled_=function(e,g){function k(){switch(l.state_){case 1:e(l.result_);break;case 2:g(l.result_);break;default:throw Error("Unexpected state: "+l.state_);}}var l=this;null==this.onSettledCallbacks_?m.asyncExecute(k):this.onSettledCallbacks_.push(k)};p.resolve=k;p.reject=function(e){return new p(function(g,k){k(e)})};p.race=function(e){return new p(function(g,l){for(var m=$jscomp.makeIterator(e),q=m.next();!q.done;q=m.next())k(q.value).callWhenSettled_(g,
l)})};p.all=function(e){var g=$jscomp.makeIterator(e),l=g.next();return l.done?k([]):new p(function(e,m){function q(g){return function(k){p[g]=k;w--;0==w&&e(p)}}var p=[],w=0;do p.push(void 0),w++,k(l.value).callWhenSettled_(q(p.length-1),m),l=g.next();while(!l.done)})};return p},"es6","es3");$jscomp.findInternal=function(e,g,k){e instanceof String&&(e=String(e));for(var l=e.length,p=0;p<l;p++){var m=e[p];if(g.call(k,m,p,e))return{i:p,v:m}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(e){return e?e:function(e,k){return $jscomp.findInternal(this,e,k).v}},"es6","es3");$jscomp.polyfill("Array.prototype.findIndex",function(e){return e?e:function(e,k){return $jscomp.findInternal(this,e,k).i}},"es6","es3");$jscomp.polyfill("Number.isInteger",function(e){return e?e:function(e){return Number.isFinite(e)?e===Math.floor(e):!1}},"es6","es3");
JSROOT.define(["d3","painter"],function(e,g){function k(a,b,c,d){var f=d?b.getObject():b;this.axis=c;JSROOT.AxisBasePainter.call(this,a,f);d?(this.embedded=!0,this.csstype=b.csstype,this.cssprefix=d,this.rstyle=b.rstyle):(this.csstype="axis",this.cssprefix="axis_")}function l(a,b){JSROOT.ObjectPainter.call(this,a,b);this.csstype="frame";this.mode3d=!1;this.ymin=this.ymax=this.xmin=this.xmax=0;this.axes_drawn=!1;this.keys_handler=null;this.projection=0;this.v7_frame=!0}function p(a,b,c){var d=new l(a,
b);"3d"==c&&(d.mode3d=!0);return g.ensureRCanvas(d,!1).then(function(){d.redraw();return d})}function m(a,b,c){JSROOT.ObjectPainter.call(this,a,b);this.csstype="pad";this.pad=b;this.iscan=c;this.this_pad_name="";this.iscan||null===b||(this.this_pad_name=b.fObjectID?"pad"+b.fObjectID:"ppp"+JSROOT._.id_counter++);this.painters=[];this.has_canvas=!0}function q(a,b){m.call(this,a,b,!0);this._websocket=null;this.tooltip_allowed=JSROOT.settings.Tooltip;this.v7canvas=!0}function G(a,b){var c=!b;c&&(b=JSROOT.create("ROOT::Experimental::TCanvas"));
var d=new q(a,b);d.normal_canvas=!c;d.createCanvasSvg(0);g.selectActivePad({pp:d,active:!1});return d.drawPrimitives().then(function(){d.addPadButtons();d.showPadButtons();return d})}function w(a,b,c,d){JSROOT.ObjectPainter.call(this,a,b,c);this.csstype=d||"pave"}function A(a){var b=this,c=this.getFramePainter();if(!c)return console.log("no frame painter - no title");var d=c.getFrameRect(),f=d.x;c=d.y;var h=d.width;d=this.getPadPainter().getPadHeight();var r=this.getObject(),e=this.v7EvalLength("margin",
d,.02),n=h,g=this.v7EvalLength("height",d,.05);h=this.v7EvalFont("text",{size:.07,color:"black",align:22});this.createG();"drag"==a?(n=parseInt(this.draw_g.attr("width")),g=parseInt(this.draw_g.attr("height")),a={},this.v7AttrChange(a,"margin",(c-parseInt(this.draw_g.attr("y"))-g)/d),this.v7AttrChange(a,"height",g/d),this.v7SendAttrChanges(a,!1)):this.draw_g.attr("transform","translate("+f+","+Math.round(c-e-g)+")").attr("x",f).attr("y",Math.round(c-e-g)).attr("width",n).attr("height",g);a={x:n/2,
y:g/2,text:r.fText,latex:1};this.startTextDrawing(h,"font");this.drawText(a);this.finishTextDrawing();JSROOT.batch_mode||JSROOT.require(["interactive"]).then(function(a){return a.addDragHandler(b,{minwidth:20,minheight:20,no_change_x:!0,redraw:b.redraw.bind(b,"drag")})})}function C(a,b){JSROOT.ObjectPainter.call(this,a,b);this.csstype="palette"}function I(){var a=this.getObject(),b=this.getCanvSvg(),c=b.select(".canvas_defs"),d="custom_font_"+a.fFamily+a.fWeight+a.fStyle;c.empty()&&(c=b.insert("svg:defs",
":first-child").attr("class","canvas_defs"));b=c.select("."+d);b.empty()&&(b=c.append("style").attr("type","text/css").attr("class",d));b.text('@font-face { font-family: "'+a.fFamily+'"; font-weight: '+(a.fWeight?a.fWeight:"normal")+"; font-style: "+(a.fStyle?a.fStyle:"normal")+"; src: "+a.fSrc+"; }");a.fDefault&&(this.getPadPainter()._dfltRFont=a);return!0}JSROOT.v7={};JSROOT.ObjectPainter.prototype.v7EvalAttr=function(a,b){function c(a){if(void 0===b)return a;var c=typeof b,d=typeof a;return c==
d?a:"boolean"==c?"string"==d?""!=a&&"0"!=a&&"no"!=a&&"off"!=a:!!a:"number"==c&&"string"==d?parseFloat(a):a}var d=this.getObject();if(!d)return b;this.cssprefix&&(a=this.cssprefix+a);if(d.fAttr&&d.fAttr.m){var f=d.fAttr.m[a];if(f)return c(f.v)}if(this.rstyle&&this.rstyle.fBlocks){f=this.rstyle.fBlocks;for(var h=0;h<f.length;++h){var r=f[h];if((this.csstype&&r.selector==this.csstype||d.fId&&r.selector=="#"+d.fId||d.fCssClass&&r.selector=="."+d.fCssClass)&&r.map&&r.map.m&&(r=r.map.m[a.toLowerCase()]))return c(r.v)}}return b};
JSROOT.ObjectPainter.prototype.v7SetAttr=function(a,b){var c=this.getObject();this.cssprefix&&(a=this.cssprefix+a);c&&c.fAttr&&c.fAttr.m&&(c.fAttr.m[a]={v:b})};JSROOT.ObjectPainter.prototype.v7EvalLength=function(a,b,c){0>=b&&(b=1);a=this.v7EvalAttr(a);if(void 0===a)return Math.round(c*b);if("number"==typeof a)return Math.round(a*b);if(null===a)return 0;for(var d=0,f=0,h=a,r=0,e=0;0<h.length;){for(;e<h.length&&(" "==h[e]||"\t"==h[e]);)++e;if(e>=h.length)break;if("-"==h[e]||"+"==h[e]){if(r)return console.log("Fail to parse RPadLength "+
a),c;r="-"==h[e]?-1:1;e++}else{0<e&&(h=h.substr(e),e=0);for(;e<h.length&&("0"<=h[e]&&"9">=h[e]||"."==h[e]);)e++;var n=parseFloat(h.substr(0,e));if(!Number.isFinite(n))return console.log("Fail to parse RPadLength "+a),Math.round(c*b);h=h.substr(e);e=0;r||(r=1);0<h.length&&"%"==h[0]?(h=h.substr(1),d+=r*n*.01):1<h.length&&"p"==h[0]&&"x"==h[1]?(h=h.substr(2),f+=r*n):d+=r*n;r=0}}return Math.round(d*b+f)};JSROOT.ObjectPainter.prototype.v7EvalColor=function(a,b){var c=this.v7EvalAttr(a,"");if(!c||"string"!=
typeof c)return b;if("auto"==c){var d=this.getPadPainter();d&&void 0!==d._auto_color_cnt?(c=d.getHistPalette(),b=d._auto_color_cnt++,d=d._num_primitives-1,2>d&&(d=2),c=c?c.getColorOrdinal(b%d/d):"blue",this._auto_colors||(this._auto_colors={}),this._auto_colors[a]=c):this._auto_colors&&this._auto_colors[a]?c=this._auto_colors[a]:(console.error("Autocolor "+a+" not defined yet - please check code"),c="")}else"["==c[0]&&(a=parseFloat(c.substr(1,c.length-2)),c="black",Number.isFinite(a)&&(b=(b=this.getPadPainter())?
b.getHistPalette():null)&&(c=b.getColorOrdinal(a)));return c};JSROOT.ObjectPainter.prototype.v7EvalFont=function(a,b,c){b?"number"==typeof b&&(b={size:b}):b={};var d=this.getPadPainter(),f=d._dfltRFont||{fFamily:"Arial",fStyle:"",fWeight:""},h=this.v7EvalAttr(a+"_size",b.size||12),e=this.v7EvalAttr(a+"_angle",0),v=this.v7EvalAttr(a+"_align",b.align||"none");b=this.v7EvalColor(a+"_color",b.color||"none");var n=this.v7EvalAttr(a+"_font_family",f.fFamily||"Arial"),g=this.v7EvalAttr(a+"_font_style",f.fStyle||
"");a=this.v7EvalAttr(a+"_font_weight",f.fWeight||"");"string"==typeof h&&(h=parseFloat(h));if(!Number.isFinite(h)||0>=h)h=12;c||(c=d.getPadHeight()||100);c=new JSROOT.FontHandler(null,h,c,n,g,a);e&&c.setAngle(360-e);"none"!==v&&c.setAlign(v);"none"!==b&&c.setColor(b);return c};JSROOT.ObjectPainter.prototype.createv7AttFill=function(a){a&&"string"==typeof a||(a="fill_");var b=this.v7EvalColor(a+"color","");a=this.v7EvalAttr(a+"style",0);this.createAttFill({pattern:a,color:b,color_as_svg:!0})};JSROOT.ObjectPainter.prototype.createv7AttLine=
function(a){a&&"string"==typeof a||(a="line_");var b=this.v7EvalColor(a+"color","black"),c=this.v7EvalAttr(a+"width",1),d=this.v7EvalAttr(a+"style",1),f=this.v7EvalAttr(a+"pattern");this.createAttLine({color:b,width:c,style:d,pattern:f});"border_"==a&&this.lineatt.setBorder(this.v7EvalAttr(a+"rx",0),this.v7EvalAttr(a+"ry",0))};JSROOT.ObjectPainter.prototype.createv7AttMarker=function(a){a&&"string"==typeof a||(a="marker_");var b=this.v7EvalColor(a+"color","black"),c=this.v7EvalAttr(a+"size",.01);
a=this.v7EvalAttr(a+"style",1);var d=1;1>c&&(d=(d=this.getPadPainter())?d.getPadHeight():100);this.createAttMarker({color:b,size:c,style:a,refsize:d})};JSROOT.ObjectPainter.prototype.v7AttrChange=function(a,b,c,d){if(!this.snapid)return!1;a._typename||(a._typename="ROOT::Experimental::RChangeAttrRequest",a.ids=[],a.names=[],a.values=[],a.update=!0);this.cssprefix&&(b=this.cssprefix+b);a.ids.push(this.snapid);a.names.push(b);if(null===c||void 0===c)d||(d="none"),"none"!==d&&console.error("Trying to set "+
d+" for none value");if(!d)switch(typeof c){case "number":d="double";break;case "boolean":d="boolean"}b={_typename:"ROOT::Experimental::RAttrMap::"};switch(d){case "none":b._typename+="NoValue_t";break;case "boolean":b._typename+="BoolValue_t";b.v=c?!0:!1;break;case "int":b._typename+="IntValue_t";b.v=parseInt(c);break;case "double":b._typename+="DoubleValue_t";b.v=parseFloat(c);break;default:b._typename+="StringValue_t",b.v="string"==typeof c?c:JSON.stringify(c)}a.values.push(b);return!0};JSROOT.ObjectPainter.prototype.v7SendAttrChanges=
function(a,b){var c=this.getCanvPainter();c&&a&&a._typename&&(void 0!==b&&(a.update=b?!0:!1),c.v7SubmitRequest("",a))};JSROOT.ObjectPainter.prototype.v7SubmitRequest=function(a,b,c){var d=this.getCanvPainter();return d&&d.submitDrawableRequest?this.snapid?d.submitDrawableRequest(a,b,this,c):(this._pending_request={_kind:a,_req:b,_method:c},b):null};JSROOT.ObjectPainter.prototype.assignSnapId=function(a){(this.snapid=a)&&this._pending_request&&(a=this._pending_request,this.v7SubmitRequest(a._kind,
a._req,a._method),delete this._pending_request)};JSROOT.v7.CommMode={kNormal:1,kLessTraffic:2,kOffline:3};JSROOT.ObjectPainter.prototype.v7CommMode=function(){var a=this.getCanvPainter();return a&&a.submitDrawableRequest&&a._websocket?JSROOT.v7.CommMode.kNormal:JSROOT.v7.CommMode.kOffline};k.prototype=Object.create(JSROOT.AxisBasePainter.prototype);k.prototype.getAxisType=function(){return"RAttrAxis"};k.prototype.configureZAxis=function(a,b){this.name=a;this.kind="normal";this.log=!1;if(a=this.v7EvalAttr("log",
0))this.log=!0,this.logbase=10,.1>Math.abs(a-Math.exp(1))?this.logbase=Math.exp(1):1.9<a&&(this.logbase=Math.round(a));b.logz=this.log};k.prototype.configureAxis=function(a,b,c,d,f,h,r,v,n){var t=this;n||(n={});this.name=a;this.full_min=b;this.full_max=c;this.kind="normal";this.vertical=h;this.log=!1;a=this.v7EvalAttr("log",0);b=this.v7EvalAttr("symlog",0);this.reverse=n.reverse||!1;this.v7EvalAttr("time")?(this.kind="time",this.timeoffset=0,n=this.v7EvalAttr("timeOffset"),void 0!==n&&(n=parseFloat(n),
Number.isFinite(n)&&(this.timeoffset=1E3*n))):this.axis&&this.axis.fLabelsIndex?(this.kind="labels",delete this.own_labels):this.kind=n.labels?"labels":"normal";if("time"==this.kind)this.func=e.scaleTime().domain([this.convertDate(d),this.convertDate(f)]);else if(b&&0<b)this.symlog=b,this.func=e.scaleSymlog().constant(b).domain([d,f]);else if(a){0>=f&&(f=1);if(0>=d||d>=f)d=1E-4*f;this.log=!0;this.logbase=10;.1>Math.abs(a-Math.exp(1))?this.logbase=Math.exp(1):1.9<a&&(this.logbase=Math.round(a));this.func=
e.scaleLog().base(this.logbase).domain([d,f])}else this.func=e.scaleLinear().domain([d,f]);this.scale_min=d;this.scale_max=f;this.gr_range=v||1E3;d=r?r:[0,this.gr_range];this.axis_shift=d[1]-this.gr_range;this.reverse?this.func.range([d[1],d[0]]):this.func.range(d);this.gr="time"==this.kind?function(a){return t.func(t.convertDate(a))}:this.log?function(a){return a<t.scale_min?t.vertical?t.func.range()[0]+5:-5:t.func(a)}:this.func;delete this.format;d=this.v7EvalAttr("ndiv",508);this.nticks=d%100;
this.nticks2=(d%1E4-this.nticks)/100;this.nticks3=Math.floor(d/1E4);20<this.nticks&&(this.nticks=20);r=Math.abs(this.gr_range)||100;if("time"==this.kind){8<this.nticks&&(this.nticks=8);d=this.scale_max-this.scale_min;f=this.v7EvalAttr("timeFormat","");r=g.chooseTimeFormat(d/r,!1);if(!f||d<.1*(this.full_max-this.full_min))f=g.chooseTimeFormat(d/this.nticks,!0);this.tfunc1=this.tfunc2=e.timeFormat(f);r!==f&&(this.tfunc2=e.timeFormat(r));this.format=this.formatTime}else this.log?(1<this.nticks2&&(this.nticks*=
this.nticks2,this.nticks2=1),this.noexp=this.v7EvalAttr("noexp",!1),300>this.scale_max&&.3<this.scale_min&&10==this.logbase&&(this.noexp=!0),this.moreloglabels=this.v7EvalAttr("moreloglbls",!1),this.format=this.formatLog):"labels"==this.kind?(this.nticks=50,d=this.scale_max-this.scale_min,this.nticks>d&&(this.nticks=Math.round(d)),this.nticks2=1,this.format=this.formatLabels):(this.ndig=this.order=0,this.format=this.formatNormal)};k.prototype.getScaleMin=function(){return this.func?this.func.domain()[0]:
0};k.prototype.getScaleMax=function(){return this.func?this.func.domain()[1]:0};k.prototype.formatLabels=function(a){a=Math.round(a);if(this.axis&&this.axis.fLabelsIndex){if(0>a||a>=this.axis.fNBinsNoOver)return null;for(var b=0;b<this.axis.fLabelsIndex.length;++b){var c=this.axis.fLabelsIndex[b];if(c.second===a)return c.first}}else if((b=this.getObject().fLabels)&&0<=a&&a<b.length)return b[a];return null};k.prototype.createTicks=function(a,b,c,d){c&&this.nticks&&"normal"==this.kind&&(this.noticksopt=
!0);c={nminor:0,nmiddle:0,nmajor:0,func:this.func};c.minor=c.middle=c.major=this.produceTicks(this.nticks);if(a)return d=c.major,c=1E-5*(this.scale_max-this.scale_min),d[0]>this.scale_min+c&&d.unshift(this.scale_min),d[d.length-1]<this.scale_max-c&&d.push(this.scale_max),d;1<this.nticks2&&(!this.log||10===this.logbase)&&((c.minor=c.middle=this.produceTicks(c.major.length,this.nticks2),a=Math.abs(this.func.range()[1]-this.func.range()[0]),c.middle.length<=c.major.length||c.middle.length>a/3.5)?c.minor=
c.middle=c.major:1<this.nticks3&&!this.log&&(c.minor=this.produceTicks(c.middle.length,this.nticks3),c.minor.length<=c.middle.length||c.minor.length>a/1.7)&&(c.minor=c.middle));c.reset=function(){this.nminor=this.nmiddle=this.nmajor=0};c.next=function(a){if(this.nminor>=this.minor.length)return!1;this.tick=this.minor[this.nminor++];this.grpos=this.func(this.tick);a&&(this.grpos=Math.round(this.grpos));this.kind=3;this.nmiddle<this.middle.length&&1>Math.abs(this.grpos-this.func(this.middle[this.nmiddle]))&&
(this.nmiddle++,this.kind=2);this.nmajor<this.major.length&&1>Math.abs(this.grpos-this.func(this.major[this.nmajor]))&&(this.nmajor++,this.kind=1);return!0};c.last_major=function(){return 1!==this.kind?!1:this.nmajor==this.major.length};c.next_major_grpos=function(){return this.nmajor>=this.major.length?null:this.func(this.major[this.nmajor])};this.ndig=this.order=0;if("normal"==this.kind&&!this.log&&0<c.major.length){var f=a=0,h=!1;if(!b){b=Math.max(Math.abs(c.major[0]),Math.abs(c.major[c.major.length-
1]));var e=Math.min(Math.abs(c.major[0]),Math.abs(c.major[c.major.length-1])),v=0<b?3*Math.round(Math.log10(b)/3):0,n=0<e?3*Math.round(Math.log10(e)/3):0;h=2E4>b;if(b||e)a=Math.max(v,n)+3,f=Math.min(v,n)-3}b=0;e=this.ndig;for(v=1E10;f<=a;f+=3)if(!h||3!==f){this.order=f;this.ndig=0;n=[];for(var g=0,k=0;g<c.major.length;){var F=this.format(c.major[g],!0);if(0>n.indexOf(F))n.push(F),k+=F.length,g++;else{if(11<++this.ndig)break;n=[];k=g=0}}!f&&4>this.ndig&&(k-=2*c.major.length+3);k<v&&(v=k,b=this.order,
e=this.ndig)}this.order=b;this.ndig=e;d&&(this.order&&console.warn("Axis painter - integer labels are configured, but axis order "+this.order+" is preferable"),this.ndig&&console.warn("Axis painter - integer labels are configured, but "+this.ndig+" decimal digits are required"),this.order=this.ndig=0)}return c};k.prototype.isCenteredLabels=function(){return"labels"===this.kind?!0:"log"===this.kind?!1:this.v7EvalAttr("labels_center",!1)};k.prototype.processLabelsMove=function(a,b){if(this.optionUnlab||
!this.axis_g)return!1;var c=this.axis_g.select(".axis_labels");if(!c||1!=c.size())return!1;if("start"==a){var d=c.node().getBBox();c.append("rect").classed("zoom",!0).attr("x",d.x).attr("y",d.y).attr("width",d.width).attr("height",d.height).style("cursor","move");this.drag_pos0=this.vertical?b[0]:b[1];return!0}d=c.property("fix_offset");this.vertical?(d+=Math.round(b[0]-this.drag_pos0),c.attr("transform","translate("+d+",0)")):(d+=Math.round(b[1]-this.drag_pos0),c.attr("transform","translate(0,"+
d+")"));d||c.attr("transform",null);"stop"==a&&(c.select("rect.zoom").remove(),delete this.drag_pos0,d!=c.property("fix_offset")&&(c.property("fix_offset",d),b=c.property("side")||1,this.labelsOffset=d/(this.vertical?-b:b),this.changeAxisAttr(1,"labels_offset",this.labelsOffset/this.scaling_size)));return!0};k.prototype.addTitleDrag=function(a,b){var c=this;if(JSROOT.settings.MoveResize&&!JSROOT.batch_mode){var d=null,f,h,r,v,g,t,k=e.drag().subject(Object);k.on("start",function(b){b.sourceEvent.preventDefault();
b.sourceEvent.stopPropagation();b=a.node().getBBox();var e=c.vertical?b.height:b.width;r=f=a.property("shift_x");v=h=a.property("shift_y");t="center"==c.titlePos?1:"left"==c.titlePos?0:2;g=[0,c.gr_range/2,c.gr_range];e=c.vertical?-e:e;var n=c.isReverseAxis()?2:0;"middle"==c.title_align?(g[n]+=e/2,g[2-n]-=e/2):"begin"==c.title_align^c.isTitleRotated()?(g[1]-=e/2,g[2-n]-=e):(g[n]+=e,g[1]+=e/2);g[t]=c.vertical?h:f;d=a.append("rect").classed("zoom",!0).attr("x",b.x).attr("y",b.y).attr("width",b.width).attr("height",
b.height).style("cursor","move")}).on("drag",function(b){if(d){b.sourceEvent.preventDefault();b.sourceEvent.stopPropagation();f+=b.dx;h+=b.dy;var e;var n=c.vertical?h:f;b=0;for(e=1;3>e;++e)Math.abs(n-g[e])<Math.abs(n-g[b])&&(b=e);c.vertical?(n=f,e=g[b]):(n=g[b],e=h);r=n;v=e;t=b;a.attr("transform","translate("+Math.round(r)+","+Math.round(v)+")")}}).on("end",function(f){d&&(f.sourceEvent.preventDefault(),f.sourceEvent.stopPropagation(),f=a.property("basepos")||0,a.property("shift_x",r).property("shift_y",
v),c.titleOffset=(c.vertical?f-r:v-f)*b,c.titlePos=1==t?"center":0==t?"left":"right",c.changeAxisAttr(0,"title_position",c.titlePos,"title_offset",c.titleOffset/c.scaling_size),d.remove(),d=null)});a.style("cursor","move").call(k)}};k.prototype.isInsideGrRange=function(a,b,c){b||(b=0);void 0===c&&(c=b);return 0>this.gr_range?a>=this.gr_range-c&&a<=b:a>=-b&&a<=this.gr_range+c};k.prototype.getGrRange=function(a){a||(a=0);return 0>this.gr_range?this.gr_range-a:this.gr_range+a};k.prototype.isReverseAxis=
function(){return!this.vertical!==0<this.getGrRange()};k.prototype.drawMainLine=function(a){var b="";if(this.endingSize&&this.endingStyle){b=0<this.gr_range?-this.endingSize:this.endingSize;var c=Math.round(.7*b);b=Math.round(b);b=this.vertical?"l"+c+","+b+"M0,"+this.gr_range+"l"+-c+","+b:"l"+b+","+c+"M"+this.gr_range+",0l"+b+","+-c}a.append("svg:path").attr("d","M0,0"+(this.vertical?"v":"h")+this.gr_range+b).call(this.lineatt.func).style("fill",b?"none":null)};k.prototype.drawTicks=function(a,b,
c){c&&(this.ticks=[]);this.handle.reset();var d="",f=0,h=0,e=0;"both"==this.ticksSide&&(f=b=1);for(;this.handle.next(!0);){var g=Math.round(this.ticksSize/4);3>this.handle.kind&&(g=Math.round(this.ticksSize/2));var n=this.handle.grpos-this.axis_shift;if(!this.startingSize&&!this.endingSize||this.isInsideGrRange(n,-Math.abs(this.startingSize),-Math.abs(this.endingSize))){if(1==this.handle.kind){if("labels"==this.kind||null!==this.format(this.handle.tick,!0))g=this.ticksSize;c&&this.ticks.push(n)}if(0<
f)var t=-g;else 0>b?(t=-g,g=0):t=0;d=0==d.length?this.vertical?"M"+g+","+n:"M"+n+","+-g:d+(this.vertical?"m"+(g-e)+","+(n-h):"m"+(n-h)+","+(e-g));d+=this.vertical?"h"+(t-g):"v"+(g-t);h=n;e=t}}d&&a.append("svg:path").attr("d",d).style("stroke",this.ticksColor||this.lineatt.color).style("stroke-width",this.ticksWidth&&1!=this.ticksWidth?this.ticksWidth:null);a=Math.round(.25*this.ticksSize);c=Math.round(1.25*this.ticksSize);return{"-1":0<b||f?c:a,1:0>b||f?c:a}};k.prototype.drawLabels=function(a,b,c){function d(a){l=
Math.max(l,this.result_width);z=Math.max(z,this.result_height);var c=this.result_width;if(c&&(!a.vertical&&!r||a.vertical&&r)&&!a.log){var d=.45*this.gap_before+.45*this.gap_after;this.gap_before?this.gap_after||(d=.9*this.gap_before):d=.9*this.gap_after;g=Math.min(g,d/c)}.01<g&&.8>g&&!a.vertical&&!r&&5<n&&0<b&&(t=!0);c=g*(t?3:1);.01<c&&1>c&&a.scaleTextDrawing(1/c,k)}var f=this,h=this.isCenteredLabels(),r=!1,g=1,n=0,t=!1,k=a.append("svg:g").attr("class","axis_labels").property("side",b);a=this.handle.lbl_pos||
this.handle.major;var l=0,z=0;this.labelsFont=this.v7EvalFont("labels",{size:.03});this.labelsFont.roundAngle(180);this.labelsFont.angle&&(this.labelsFont.angle=270,r=!0);var m=0,p=Math.round((this.vertical?-b:b)*this.labelsOffset),q=Math.round((this.vertical?-b:b)*c[b]);p&&k.attr("transform",this.vertical?"translate("+p+",0)":"translate(0,"+p+")");k.property("fix_offset",p);this.startTextDrawing(this.labelsFont,"font",k);for(var y=0;y<a.length;++y){var w=this.format(a[y],!0);if(null!==w){var x=Math.round(this.func(a[y])),
u={text:w,latex:1,draw_g:k};u.gap_before=0<y?Math.abs(Math.round(x-this.func(a[y-1]))):0;u.gap_after=y<a.length-1?Math.abs(Math.round(this.func(a[y+1])-x)):0;if(h){var E=u.gap_after||u.gap_before;x=Math.round(x-(this.vertical?.5*E:-.5*E));if(!this.isInsideGrRange(x,5))continue}n=Math.max(n,w.length);x-=this.axis_shift;if(!this.startingSize&&!this.endingSize||this.isInsideGrRange(x,-Math.abs(this.startingSize),-Math.abs(this.endingSize)))this.vertical?(u.x=q,u.y=x,u.align=r?0>b?23:20:0>b?12:32):(u.x=
x,u.y=q,u.align=r?0>b?12:32:0>b?20:23),u.post_process=d,this.drawText(u),m&&x!=m&&(this.vertical&&!r||!this.vertical&&r)&&(g=Math.min(g,.9*Math.abs(x-m)/this.labelsFont.size)),m=x}}this.order&&this.drawText({x:this.vertical?5*b:this.getGrRange(5),y:this.has_obstacle?q:this.vertical?this.getGrRange(3):-3*b,align:this.vertical?0>b?30:10:this.has_obstacle^0>b?13:10,latex:1,text:"#times"+this.formatExp(10,this.order),draw_g:k});return this.finishTextDrawing(k).then(function(){t&&k.selectAll("text").each(function(){var a=
e.select(this),b=a.attr("transform");a.attr("transform",b+" rotate(25)").style("text-anchor","start")});c[b]=f.vertical?c[b]+(Math.round(r?1.2*z:l+.4*f.labelsFont.size)-b*p):c[b]+(Math.round(Math.max(r?l+.4*f.labelsFont.size:1.2*z,1.2*f.labelsFont.size,t?l*Math.sin(25/180*Math.PI)+z*(Math.cos(25/180*Math.PI)+.2):0))+p);return c})};k.prototype.addZoomingRect=function(a,b,c){!JSROOT.settings.Zooming||this.disable_zooming||JSROOT.batch_mode||(c=Math.max(c[b],10),b=this.vertical?"v"+this.gr_range+"h"+
-b*c+"v"+-this.gr_range:"h"+this.gr_range+"v"+b*c+"h"+-this.gr_range,a.append("svg:path").attr("d","M0,0"+b+"z").attr("class","axis_zoom").style("opacity","0").style("cursor","crosshair"))};k.prototype.isTitleRotated=function(){return this.titleFont&&this.titleFont.angle!=(this.vertical?270:0)};k.prototype.drawTitle=function(a,b,c){if(!this.fTitle)return Promise.resolve(!0);a=a.append("svg:g").attr("class","axis_title");var d=this.v7EvalAttr("title_position","right"),f="center"==d,h="left"==d;this.titleFont=
this.v7EvalFont("title",{size:.03},this.getPadPainter().getPadHeight());this.titleFont.roundAngle(180,this.vertical?270:0);this.titleOffset=this.v7EvalLength("title_offset",this.scaling_size,0);this.titlePos=d;var e=this.isTitleRotated();this.startTextDrawing(this.titleFont,"font",a);this.title_align=f?"middle":h^(this.isReverseAxis()||e)?"begin":"end";this.vertical?(c=Math.round(-b*c[b]),d=c+Math.round(-b*this.titleOffset),f=Math.round(f?this.gr_range/2:h?0:this.gr_range),this.drawText({align:[this.title_align,
0>b^e?"top":"bottom"],text:this.fTitle,draw_g:a})):(d=Math.round(f?this.gr_range/2:h?0:this.gr_range),c=Math.round(b*c[b]),f=c+Math.round(b*this.titleOffset),this.drawText({align:[this.title_align,0<b^e?"top":"bottom"],text:this.fTitle,draw_g:a}));a.attr("transform","translate("+d+","+f+")").property("basepos",c).property("shift_x",d).property("shift_y",f);this.addTitleDrag(a,b);return this.finishTextDrawing(a)};k.prototype.extractDrawAttributes=function(){this.createv7AttLine("line_");this.endingStyle=
this.v7EvalAttr("ending_style","");this.endingSize=Math.round(this.v7EvalLength("ending_size",this.scaling_size,this.endingStyle?.02:0));this.startingSize=Math.round(this.v7EvalLength("starting_size",this.scaling_size,0));this.ticksSize=this.v7EvalLength("ticks_size",this.scaling_size,.02);this.ticksSide=this.v7EvalAttr("ticks_side","normal");this.ticksColor=this.v7EvalColor("ticks_color","");this.ticksWidth=this.v7EvalAttr("ticks_width",1);this.labelsOffset=this.v7EvalLength("labels_offset",this.scaling_size,
0);this.optionUnlab=this.v7EvalAttr("labels_hide",!1);this.fTitle=this.v7EvalAttr("title_value","");this.max_tick_size&&this.ticksSize>this.max_tick_size&&(this.ticksSize=this.max_tick_size)};k.prototype.drawAxis=function(a,b,c){var d=this,f=a,h=this.getPadPainter().getPadRect();void 0===c&&(c=1);this.standalone||(f=a.select("."+this.name+"_container"),f.empty()?f=a.append("svg:g").attr("class",this.name+"_container"):f.selectAll("*").remove());f.attr("transform",b||null);this.scaling_size=this.vertical?
h.width:h.height;this.extractDrawAttributes();this.axis_g=f;this.side=c;"invert"==this.ticksSide&&(c=-c);this.standalone&&this.drawMainLine(f);this.handle=this.createTicks(!1,!1,!1,!1);a=this.drawTicks(f,c,!0);return(this.optionUnlab?Promise.resolve(a):this.drawLabels(f,c,a)).then(function(a){d.addZoomingRect(f,d.standalone?c:d.side,a);return d.drawTitle(f,c,a)})};k.prototype.setAfterDrawHandler=function(a){this._afterDrawAgain=a};k.prototype.drawAxisAgain=function(){var a=this;if(this.axis_g&&this.side){this.axis_g.selectAll("*").remove();
this.extractDrawAttributes();var b=this.side;"invert"==this.ticksSide&&(b=-b);this.standalone&&this.drawMainLine(this.axis_g);var c=this.drawTicks(this.axis_g,b,!1);return(this.optionUnlab?Promise.resolve(c):this.drawLabels(this.axis_g,b,c)).then(function(c){a.addZoomingRect(a.axis_g,a.standalone?b:a.side,c);return a.drawTitle(a.axis_g,b,c)}).then(function(){"function"==typeof a._afterDrawAgain&&a._afterDrawAgain()})}};k.prototype.drawAxisOtherPlace=function(a,b,c,d){var f=this,h=a.select("."+this.name+
"_container2");h.empty()?h=a.append("svg:g").attr("class",this.name+"_container2"):h.selectAll("*").remove();h.attr("transform",b||null);"invert"==this.ticksSide&&(c=-c);a=this.drawTicks(h,c,!1);return(this.optionUnlab||d?Promise.resolve(a):this.drawLabels(h,c,a)).then(function(a){f.addZoomingRect(h,c,a);return!0})};k.prototype.zoomStandalone=function(a,b){this.changeAxisAttr(1,"zoomMin",a,"zoomMax",b)};k.prototype.redraw=function(){var a=this,b=this.getObject(),c=this.getPadPainter(),d=c.getCoordinate(b.fPos),
f=c.getPadLength(b.fVertical,b.fLength),h=this.v7EvalAttr("reverse",!1),r=b.fLabels.length,v=0<r?0:this.v7EvalAttr("min",0),n=0<r?r:this.v7EvalAttr("max",100);b.fVertical&&(f-=c.getPadHeight());c=this.v7EvalAttr("zoomMin");var k=this.v7EvalAttr("zoomMax");c===k&&(c=v,k=n);this.configureAxis("axis",v,n,c,k,b.fVertical,void 0,f,{reverse:h,labels:0<r});this.createG();this.standalone=!0;b=this.drawAxis(this.draw_g,"translate("+d.x+","+d.y+")");return JSROOT.batch_mode?b:b.then(function(){return JSROOT.require("interactive")}).then(function(b){if(JSROOT.settings.ContextMenu)a.draw_g.on("contextmenu",
function(b){b.stopPropagation();b.preventDefault();g.createMenu(b,a).then(function(b){b.add("header:RAxisDrawable");b.add("Unzoom",function(){return a.zoomStandalone()});a.fillAxisContextMenu(b,"");b.show()})});a.draw_g.attr("x",d.x).attr("y",d.y).attr("width",a.vertical?10:f).attr("height",a.vertical?f:10);b.addDragHandler(a,{only_move:!0,redraw:a.positionChanged.bind(a)});a.draw_g.on("dblclick",function(){return a.zoomStandalone()});if(JSROOT.settings.ZoomWheel)a.draw_g.on("wheel",function(b){b.stopPropagation();
b.preventDefault();var c=e.pointer(b,a.draw_g.node());b=a.analyzeWheelEvent(b,a.vertical?1-c[1]/f:c[0]/f);b.changed&&a.zoomStandalone(b.min,b.max)})})};k.prototype.positionChanged=function(){var a=parseInt(this.draw_g.attr("x")),b=parseInt(this.draw_g.attr("y")),c=this.getObject(),d=this.getPadPainter().getPadRect();a/=d.width;b=1-b/d.height;c.fPos.fHoriz.fArr=[a];c.fPos.fVert.fArr=[b];this.submitCanvExec("SetPos({"+a.toFixed(4)+","+b.toFixed(4)+"})")};k.prototype.changeAxisAttr=function(a){for(var b=
{},c=1;c<arguments.length-1;)this.v7AttrChange(b,arguments[c],arguments[c+1]),this.v7SetAttr(arguments[c],arguments[c+1]),c+=2;this.v7SendAttrChanges(b,!1);1===a?this.standalone?this.redraw():this.drawAxisAgain():a&&this.redrawPad()};k.prototype.changeAxisLog=function(a){"labels"!=this.kind&&"time"!=this.kind&&("toggle"===a&&(a=this.log?0:10),a=parseFloat(a),Number.isFinite(a)&&this.changeAxisAttr(2,"log",a,"symlog",0))};k.prototype.fillAxisContextMenu=function(a,b){var c=this;b&&a.add("Unzoom",function(){return c.getFramePainter().unzoom(b)});
a.add("sub:Log scale",function(){return c.changeAxisLog("toggle")});a.addchk(!this.log&&!this.symlog,"linear",0,function(a){return c.changeAxisLog(a)});a.addchk(this.log&&!this.symlog&&10==this.logbase,"log10",function(){return c.changeAxisLog(10)});a.addchk(this.log&&!this.symlog&&2==this.logbase,"log2",function(){return c.changeAxisLog(2)});a.addchk(this.log&&!this.symlog&&.1>Math.abs(this.logbase-Math.exp(1)),"ln",function(){return c.changeAxisLog(Math.exp(1))});a.addchk(!this.log&&this.symlog,
"symlog",0,function(){return a.input("set symlog constant",c.symlog||10,"float").then(function(a){return c.changeAxisAttr(2,"symlog",a)})});a.add("endsub:");a.add("Divisions",function(){return a.input("Set axis devisions",c.v7EvalAttr("ndiv",508),"int").then(function(a){return c.changeAxisAttr(2,"ndiv",a)})});a.add("sub:Ticks");a.addRColorMenu("color",this.ticksColor,function(a){return c.changeAxisAttr(1,"ticks_color",a)});a.addSizeMenu("size",0,.05,.01,this.ticksSize/this.scaling_size,function(a){return c.changeAxisAttr(1,
"ticks_size",a)});a.addSelectMenu("side",["normal","invert","both"],this.ticksSide,function(a){return c.changeAxisAttr(1,"ticks_side",a)});a.add("endsub:");!this.optionUnlab&&this.labelsFont&&(a.add("sub:Labels"),a.addSizeMenu("offset",-.05,.05,.01,this.labelsOffset/this.scaling_size,function(a){return c.changeAxisAttr(1,"labels_offset",a)}),a.addRAttrTextItems(this.labelsFont,{noangle:1,noalign:1},function(a){return c.changeAxisAttr(1,"labels_"+a.name,a.value)}),a.addchk(this.labelsFont.angle,"rotate",
function(a){return c.changeAxisAttr(1,"labels_angle",a?180:0)}),a.add("endsub:"));a.add("sub:Title",function(){return a.input("Enter axis title",c.fTitle).then(function(a){return c.changeAxisAttr(1,"title_value",a)})});this.fTitle&&(a.addSizeMenu("offset",-.05,.05,.01,this.titleOffset/this.scaling_size,function(a){return c.changeAxisAttr(1,"title_offset",a)}),a.addSelectMenu("position",["left","center","right"],this.titlePos,function(a){return c.changeAxisAttr(1,"title_position",a)}),a.addchk(this.isTitleRotated(),
"rotate",function(a){return c.changeAxisAttr(1,"title_angle",a?180:0)}),a.addRAttrTextItems(this.titleFont,{noangle:1,noalign:1},function(a){return c.changeAxisAttr(1,"title_"+a.name,a.value)}));a.add("endsub:");return!0};var H=function(a,b){var c=new k(a,b);c.disable_zooming=!0;return g.ensureRCanvas(c,!1).then(function(){return c.redraw()}).then(function(){return c})},K=function(a,b){var c=Math.PI/180;a=a/2*c;b*=c;var d=Math.sqrt(2),f=2*d/Math.PI,h=Math.cos(b),e=Math.sqrt(1+h*Math.cos(a));return{x:h*
Math.sin(a)*2*d/e/f/c,y:Math.sin(b)*d/e/f/c}},L=function(a,b){return{x:a,y:Math.log(Math.tan((Math.PI/2+b/180*Math.PI)/2))}},D=function(a,b){return{x:a*Math.cos(b/180*Math.PI),y:b}},M=function(a,b){return{x:a*(2*Math.cos(2*b/180*Math.PI/3)-1),y:180*Math.sin(b/180*Math.PI/3)}};l.prototype=Object.create(JSROOT.ObjectPainter.prototype);l.prototype.getFramePainter=function(){return this};l.prototype.is_root6=function(){return!1};l.prototype.setFrameActive=function(a){this.enabledKeys=a&&JSROOT.settings.HandleKeys?
!0:!1;this.control&&(this.control.enableKeys=this.enabledKeys)};l.prototype.setLastEventPos=function(a){this.fLastEventPnt=a};l.prototype.getLastEventPos=function(){return this.fLastEventPnt};l.prototype.updateAttributes=function(a){if(void 0===this.fX1NDC||a&&!this.modified_NDC)a=this.getPadPainter().getPadRect(),this.fX1NDC=this.v7EvalLength("margins_left",a.width,JSROOT.settings.FrameNDC.fX1NDC)/a.width,this.fY1NDC=this.v7EvalLength("margins_bottom",a.height,JSROOT.settings.FrameNDC.fY1NDC)/a.height,
this.fX2NDC=1-this.v7EvalLength("margins_right",a.width,1-JSROOT.settings.FrameNDC.fX2NDC)/a.width,this.fY2NDC=1-this.v7EvalLength("margins_top",a.height,1-JSROOT.settings.FrameNDC.fY2NDC)/a.height;this.fillatt||this.createv7AttFill();this.createv7AttLine("border_")};l.prototype.getProjectionFunc=function(){switch(this.projection){case 1:return K;case 2:return L;case 3:return D;case 4:return M}};l.prototype.recalculateRange=function(a){this.projection=a||0;2==this.projection&&(-90>=this.scale_ymin||
90<=this.scale_ymax)&&(console.warn("Mercator Projection","Latitude out of range",this.scale_ymin,this.scale_ymax),this.projection=0);var b=this.getProjectionFunc();if(b)for(a=[b(this.scale_xmin,this.scale_ymin),b(this.scale_xmin,this.scale_ymax),b(this.scale_xmax,this.scale_ymax),b(this.scale_xmax,this.scale_ymin)],0>this.scale_xmin&&0<this.scale_xmax&&(a.push(b(0,this.scale_ymin)),a.push(b(0,this.scale_ymax))),0>this.scale_ymin&&0<this.scale_ymax&&(a.push(b(this.scale_xmin,0)),a.push(b(this.scale_xmax,
0))),this.original_xmin=this.scale_xmin,this.original_xmax=this.scale_xmax,this.original_ymin=this.scale_ymin,this.original_ymax=this.scale_ymax,this.scale_xmin=this.scale_xmax=a[0].x,this.scale_ymin=this.scale_ymax=a[0].y,b=1;b<a.length;++b)this.scale_xmin=Math.min(this.scale_xmin,a[b].x),this.scale_xmax=Math.max(this.scale_xmax,a[b].x),this.scale_ymin=Math.min(this.scale_ymin,a[b].y),this.scale_ymax=Math.max(this.scale_ymax,a[b].y)};l.prototype.drawGrids=function(){var a=this.getFrameSvg().select(".grid_layer");
a.selectAll(".xgrid").remove();a.selectAll(".ygrid").remove();var b=this.getFrameHeight(),c=this.getFrameWidth(),d=this.v7EvalAttr("gridX",!1),f=this.v7EvalAttr("gridY",!1),h=JSROOT.gStyle.fGridStyle,e=0<JSROOT.gStyle.fGridColor?this.getColor(JSROOT.gStyle.fGridColor):"black";if(0>h||h>=g.root_line_styles.length)h=11;this.x_handle&&(this.x_handle.draw_grid=d);if(this.x_handle&&this.x_handle.draw_grid){d="";for(var v=0;v<this.x_handle.ticks.length;++v)d=this.swap_xy?d+("M0,"+(b+this.x_handle.ticks[v])+
"h"+c):d+("M"+this.x_handle.ticks[v]+",0v"+b);0<d.length&&a.append("svg:path").attr("class","xgrid").attr("d",d).style("stroke",e).style("stroke-width",JSROOT.gStyle.fGridWidth).style("stroke-dasharray",g.root_line_styles[h])}this.y_handle&&(this.y_handle.draw_grid=f);if(this.y_handle&&this.y_handle.draw_grid){f="";for(d=0;d<this.y_handle.ticks.length;++d)f=this.swap_xy?f+("M"+this.y_handle.ticks[d]+",0v"+b):f+("M0,"+(b+this.y_handle.ticks[d])+"h"+c);0<f.length&&a.append("svg:path").attr("class",
"ygrid").attr("d",f).style("stroke",e).style("stroke-width",JSROOT.gStyle.fGridWidth).style("stroke-dasharray",g.root_line_styles[h])}};l.prototype.axisAsText=function(a,b){var c=this[a+"_handle"];return c?c.axisAsText(b,JSROOT.settings[a.toUpperCase()+"ValuesFormat"]):b.toPrecision(4)};l.prototype._setAxisRange=function(a,b,c){var d=a+"min",f=a+"max";if(this[d]==this[f]){var h=this.v7EvalAttr(a+"_min"),e=this.v7EvalAttr(a+"_max");void 0!==h&&(b=h);void 0!==e&&(c=e);b<c&&(this[d]=b,this[f]=c);b="zoom_"+
a+"min";c="zoom_"+a+"max";this[b]!=this[c]||this.zoomChangedInteractive(a)||(h=this.v7EvalAttr(a+"_zoomMin"),e=this.v7EvalAttr(a+"_zoomMax"),void 0===h&&void 0===e)||(this[b]=void 0===h?this[d]:h,this[c]=void 0===e?this[f]:e)}};l.prototype.setAxesRanges=function(a,b,c,d,f,h,e,g,n){this.axes_drawn||(this.xaxis=a,this._setAxisRange("x",b,c),this.yaxis=d,this._setAxisRange("y",f,h),this.zaxis=e,this._setAxisRange("z",g,n))};l.prototype.setAxes2Ranges=function(a,b,c,d,f,h,e,g){a&&(this.x2axis=b,this._setAxisRange("x2",
c,d));f&&(this.y2axis=h,this._setAxisRange("y2",e,g))};l.prototype.createXY=function(a){if(!this.self_drawaxes){this.cleanXY();a||(a={});this.v6axes=!0;this.swap_xy=a.swap_xy||!1;this.reverse_x=a.reverse_x||!1;this.reverse_y=a.reverse_y||!1;this.logx=this.v7EvalAttr("x_log",0);this.logy=this.v7EvalAttr("y_log",0);var b=this.getFrameWidth(),c=this.getFrameHeight();this.scale_xmin=this.xmin;this.scale_xmax=this.xmax;this.scale_ymin=this.ymin;this.scale_ymax=this.ymax;a.extra_y_space&&(this.scale_ymax=
(this.swap_xy?this.logx:this.logy)&&0<this.scale_ymax?Math.exp(1.1*Math.log(this.scale_ymax)):this.scale_ymax+.1*(this.scale_ymax-this.scale_ymin));this.zoom_ymin!=this.zoom_ymax||a.zoom_ymin==a.zoom_ymax||this.zoomChangedInteractive("y")||(this.zoom_ymin=a.zoom_ymin,this.zoom_ymax=a.zoom_ymax);this.zoom_xmin!=this.zoom_xmax&&(this.scale_xmin=this.zoom_xmin,this.scale_xmax=this.zoom_xmax);this.zoom_ymin!=this.zoom_ymax&&(this.scale_ymin=this.zoom_ymin,this.scale_ymax=this.zoom_ymax);var d=this.xaxis,
f=this.yaxis;d&&"TAxis"==d._typename||(d=JSROOT.create("TAxis"));f&&"TAxis"==f._typename||(f=JSROOT.create("TAxis"));this.x_handle=new JSROOT.TAxisPainter(this.getDom(),d,!0);this.x_handle.setPadName(this.getPadName());this.x_handle.optionUnlab=this.v7EvalAttr("x_labels_hide",!1);this.x_handle.configureAxis("xaxis",this.xmin,this.xmax,this.scale_xmin,this.scale_xmax,this.swap_xy,this.swap_xy?[0,c]:[0,b],{reverse:this.reverse_x,log:this.swap_xy?this.logy:this.logx,symlog:this.swap_xy?a.symlog_y:a.symlog_x,
logcheckmin:this.swap_xy,logminfactor:1E-4});this.x_handle.assignFrameMembers(this,"x");this.y_handle=new JSROOT.TAxisPainter(this.getDom(),f,!0);this.y_handle.setPadName(this.getPadName());this.y_handle.optionUnlab=this.v7EvalAttr("y_labels_hide",!1);this.y_handle.configureAxis("yaxis",this.ymin,this.ymax,this.scale_ymin,this.scale_ymax,!this.swap_xy,this.swap_xy?[0,b]:[0,c],{reverse:this.reverse_y,log:this.swap_xy?this.logx:this.logy,symlog:this.swap_xy?a.symlog_x:a.symlog_y,logcheckmin:2>a.ndim||
this.swap_xy,log_min_nz:a.ymin_nz&&a.ymin_nz<.01*this.ymax?.3*a.ymin_nz:0,logminfactor:3E-4});this.y_handle.assignFrameMembers(this,"y")}};l.prototype.hasDrawnAxes=function(a,b){return a||b?!1:this.axes_drawn};l.prototype.drawAxes=function(){var a=this;if(this.axes_drawn||this.xmin==this.xmax||this.ymin==this.ymax)return Promise.resolve(this.axes_drawn);var b=this.v7EvalAttr("ticksX",1),c=this.v7EvalAttr("ticksY",1),d=1,f=1;this.v7EvalAttr("swapX",!1)&&(d=-1);this.v7EvalAttr("swapY",!1)&&(f=-1);var h=
this.getFrameWidth(),e=this.getFrameHeight();this.v6axes||(this.cleanupAxes(),this.swap_xy=!1,this.zoom_xmin!=this.zoom_xmax?(this.scale_xmin=this.zoom_xmin,this.scale_xmax=this.zoom_xmax):(this.scale_xmin=this.xmin,this.scale_xmax=this.xmax),this.zoom_ymin!=this.zoom_ymax?(this.scale_ymin=this.zoom_ymin,this.scale_ymax=this.zoom_ymax):(this.scale_ymin=this.ymin,this.scale_ymax=this.ymax),this.recalculateRange(0),this.x_handle=new k(this.getDom(),this,this.xaxis,"x_"),this.x_handle.setPadName(this.getPadName()),
this.x_handle.snapid=this.snapid,this.x_handle.draw_swapside=0>d,this.x_handle.draw_ticks=b,this.y_handle=new k(this.getDom(),this,this.yaxis,"y_"),this.y_handle.setPadName(this.getPadName()),this.y_handle.snapid=this.snapid,this.y_handle.draw_swapside=0>f,this.y_handle.draw_ticks=c,this.z_handle=new k(this.getDom(),this,this.zaxis,"z_"),this.z_handle.setPadName(this.getPadName()),this.z_handle.snapid=this.snapid,this.x_handle.configureAxis("xaxis",this.xmin,this.xmax,this.scale_xmin,this.scale_xmax,
!1,[0,h],h,{reverse:!1}),this.x_handle.assignFrameMembers(this,"x"),this.y_handle.configureAxis("yaxis",this.ymin,this.ymax,this.scale_ymin,this.scale_ymax,!0,[e,0],-e,{reverse:!1}),this.y_handle.assignFrameMembers(this,"y"),this.z_handle.configureZAxis("zaxis",this));var g=this.getFrameSvg().select(".axis_layer");this.x_handle.has_obstacle=!1;var n=this.swap_xy?this.y_handle:this.x_handle,t=this.swap_xy?this.x_handle:this.y_handle,l=this.getPadPainter();if(l&&l._fast_drawing)l=Promise.resolve(!0);
else if(this.v6axes){n.disable_ticks=0>=b;t.disable_ticks=0>=c;l=n.drawAxis(g,h,e,n.invert_side?void 0:"translate(0,"+e+")",1<b?-e:0,!1,void 0,!1);var m=t.drawAxis(g,h,e,t.invert_side?"translate("+h+",0)":void 0,1<c?h:0,!1,t.invert_side?0:this._frame_x,!1);l=Promise.all([l,m]).then(function(){return a.drawGrids()})}else l=0<b?n.drawAxis(g,0<d?"translate(0,"+e+")":"",d):!0,m=0<c?t.drawAxis(g,0<f?"translate(0,"+e+")":"translate("+h+","+e+")",f):!0,l=Promise.all([l,m]).then(function(){var a=[];1<b&&
a.push(n.drawAxisOtherPlace(g,0>d?"translate(0,"+e+")":"",-d,2==b));1<c&&a.push(t.drawAxisOtherPlace(g,0>f?"translate(0,"+e+")":"translate("+h+","+e+")",-f,2==c));return Promise.all(a)}).then(function(){return a.drawGrids()});return l.then(function(){return a.axes_drawn=!0})};l.prototype.drawAxes2=function(a,b){var c=this.getFrameWidth(),d=this.getFrameHeight(),f=this.getFrameSvg().select(".axis_layer"),h=!0,e=!0;a&&(this.zoom_x2min!=this.zoom_x2max?(this.scale_x2min=this.zoom_x2min,this.scale_x2max=
this.zoom_x2max):(this.scale_x2min=this.x2min,this.scale_x2max=this.x2max),this.x2_handle=new k(this.getDom(),this,this.x2axis,"x2_"),this.x2_handle.setPadName(this.getPadName()),this.x2_handle.snapid=this.snapid,this.x2_handle.configureAxis("x2axis",this.x2min,this.x2max,this.scale_x2min,this.scale_x2max,!1,[0,c],c,{reverse:!1}),this.x2_handle.assignFrameMembers(this,"x2"),h=this.x2_handle.drawAxis(f,"",-1));b&&(this.zoom_y2min!=this.zoom_y2max?(this.scale_y2min=this.zoom_y2min,this.scale_y2max=
this.zoom_y2max):(this.scale_y2min=this.y2min,this.scale_y2max=this.y2max),this.y2_handle=new k(this.getDom(),this,this.y2axis,"y2_"),this.y2_handle.setPadName(this.getPadName()),this.y2_handle.snapid=this.snapid,this.y2_handle.configureAxis("y2axis",this.y2min,this.y2max,this.scale_y2min,this.scale_y2max,!0,[d,0],-d,{reverse:!1}),this.y2_handle.assignFrameMembers(this,"y2"),e=this.y2_handle.drawAxis(f,"translate("+c+","+d+")",-1));return Promise.all([h,e])};l.prototype.getGrFuncs=function(a,b){a=
a&&this.grx2;b=b&&this.gry2;return a||b?{use_x2:a,grx:a?this.grx2:this.grx,x_handle:a?this.x2_handle:this.x_handle,logx:a?this.x2_handle.log:this.x_handle.log,scale_xmin:a?this.scale_x2min:this.scale_xmin,scale_xmax:a?this.scale_x2max:this.scale_xmax,use_y2:b,gry:b?this.gry2:this.gry,y_handle:b?this.y2_handle:this.y_handle,logy:b?this.y2_handle.log:this.y_handle.log,scale_ymin:b?this.scale_y2min:this.scale_ymin,scale_ymax:b?this.scale_y2max:this.scale_ymax,swap_xy:this.swap_xy,fp:this,revertAxis:function(a,
b){"x"==a&&this.use_x2&&(a="x2");"y"==a&&this.use_y2&&(a="y2");return this.fp.revertAxis(a,b)},axisAsText:function(a,b){"x"==a&&this.use_x2&&(a="x2");"y"==a&&this.use_y2&&(a="y2");return this.fp.axisAsText(a,b)}}:this};l.prototype.sizeChanged=function(){var a={};this.v7AttrChange(a,"margins_left",this.fX1NDC);this.v7AttrChange(a,"margins_bottom",this.fY1NDC);this.v7AttrChange(a,"margins_right",1-this.fX2NDC);this.v7AttrChange(a,"margins_top",1-this.fY2NDC);this.v7SendAttrChanges(a,!1);this.redrawPad()};
l.prototype.cleanXY=function(){var a=this,b=function(b,d){a[b]&&(a[b].cleanup(),delete a[b]);delete a[d]};b("x_handle","grx");b("y_handle","gry");b("z_handle","grz");b("x2_handle","grx2");b("y2_handle","gry2");delete this.v6axes};l.prototype.cleanupAxes=function(){this.cleanXY();this.draw_g&&(this.draw_g.select(".grid_layer").selectAll("*").remove(),this.draw_g.select(".axis_layer").selectAll("*").remove());this.axes_drawn=!1};l.prototype.cleanFrameDrawings=function(){var a=this;"function"===typeof this.create3DScene&&
this.create3DScene(-1);this.cleanupAxes();var b=function(b){a[b+"min"]=a[b+"max"]=0;a["zoom_"+b+"min"]=a["zoom_"+b+"max"]=0;a["scale_"+b+"min"]=a["scale_"+b+"max"]=0};b("x");b("y");b("z");b("x2");b("y2");this.draw_g&&(this.draw_g.select(".main_layer").selectAll("*").remove(),this.draw_g.select(".upper_layer").selectAll("*").remove())};l.prototype.cleanup=function(){this.cleanFrameDrawings();this.draw_g&&(this.draw_g.selectAll("*").remove(),this.draw_g.on("mousedown",null).on("dblclick",null).on("wheel",
null).on("contextmenu",null).property("interactive_set",null));this.keys_handler&&(window.removeEventListener("keydown",this.keys_handler,!1),this.keys_handler=null);delete this.enabledKeys;delete this.self_drawaxes;delete this.xaxis;delete this.yaxis;delete this.zaxis;delete this.x2axis;delete this.y2axis;delete this.draw_g;delete this._click_handler;delete this._dblclick_handler;var a=this.getPadPainter();a&&a.frame_painter_ref===this&&delete a.frame_painter_ref;JSROOT.ObjectPainter.prototype.cleanup.call(this)};
l.prototype.redraw=function(){var a=this,b=this.getPadPainter();b&&(b.frame_painter_ref=this);this.updateAttributes();var c=b?b.getPadRect():{width:10,height:10},d=Math.round(c.width*this.fX1NDC),f=Math.round(c.width*(this.fX2NDC-this.fX1NDC)),h=Math.round(c.height*(1-this.fY2NDC));c=Math.round(c.height*(this.fY2NDC-this.fY1NDC));var e=!1,g=!1;b&&b.options&&(b.options.RotateFrame&&(e=!0),b.options.FixFrame&&(g=!0));if(e){b="rotate(-90,"+d+","+h+") translate("+(d-c)+","+h+")";var n=f;f=c;c=n}else b=
"translate("+d+","+h+")";this._frame_x=d;this._frame_y=h;this._frame_width=f;this._frame_height=c;this._frame_rotate=e;this._frame_fixpos=g;if(!this.mode3d){this.draw_g=this.getLayerSvg("primitives_layer").select(".root_frame");this.draw_g.empty()?(this.draw_g=this.getLayerSvg("primitives_layer").append("svg:g").attr("class","root_frame"),this.draw_g.append("svg:title").text(""),d=this.draw_g.append("svg:rect"),this.draw_g.append("svg:g").attr("class","grid_layer"),h=this.draw_g.append("svg:svg").attr("class",
"main_layer").attr("x",0).attr("y",0).attr("overflow","hidden"),this.draw_g.append("svg:g").attr("class","axis_layer"),this.draw_g.append("svg:g").attr("class","upper_layer")):(d=this.draw_g.select("rect"),h=this.draw_g.select(".main_layer"));this.axes_drawn=!1;this.draw_g.attr("transform",b);d.attr("x",0).attr("y",0).attr("width",f).attr("height",c).attr("rx",this.lineatt.rx||null).attr("ry",this.lineatt.ry||null).call(this.fillatt.func).call(this.lineatt.func);h.attr("width",f).attr("height",c).attr("viewBox",
"0 0 "+f+" "+c);f=Promise.resolve(!0);this.v7EvalAttr("drawAxes")&&(this.self_drawaxes=!0,this.setAxesRanges(),f=this.drawAxes().then(function(){return a.addInteractivity()}));if(JSROOT.batch_mode)return f;d.attr("pointer-events","visibleFill");return f.then(function(){return JSROOT.require(["interactive"])}).then(function(b){b.FrameInteractive.assign(a);a.addBasicInteractivity()})}};l.prototype.getFrameWidth=function(){return this._frame_width||0};l.prototype.getFrameHeight=function(){return this._frame_height||
0};l.prototype.getFrameRect=function(){return{x:this._frame_x||0,y:this._frame_y||0,width:this.getFrameWidth(),height:this.getFrameHeight(),transform:this.draw_g?this.draw_g.attr("transform"):"",hint_delta_x:0,hint_delta_y:0}};l.prototype.getHistPalette=function(){return this.getPadPainter().getHistPalette()};l.prototype.configureUserClickHandler=function(a){this._click_handler=a&&"function"==typeof a?a:null};l.prototype.configureUserDblclickHandler=function(a){this._dblclick_handler=a&&"function"==
typeof a?a:null};l.prototype.zoom=function(a,b,c,d,f,h){var e=this;if(this.projection)return Promise.resolve(!1);"x"===a?(a=b,b=c,c=void 0):"y"===a?(d=c,c=b,a=b=void 0):"z"===a&&(f=b,h=c,a=b=c=void 0);var g=a!==b,n=c!==d,k=f!==h,l=!1,m=!1,z=!1;if(g){var p=0;a<=this.xmin&&(a=this.xmin,p++);b>=this.xmax&&(b=this.xmax,p++);2===p&&(g=!1,l=!0)}else l=a===b&&0===a;n?(p=0,c<=this.ymin&&(c=this.ymin,p++),d>=this.ymax&&(d=this.ymax,p++),2===p&&(n=!1,m=!0)):m=c===d&&0===c;k?(p=0,f<=this.zmin&&(f=this.zmin,
p++),h>=this.zmax&&(h=this.zmax,p++),2===p&&(k=!1,z=!0)):z=f===h&&0===f;var q=!1,w="",y="",A="",x=!1,u={_typename:"ROOT::Experimental::RFrame::RUserRanges",values:[0,0,0,0,0,0],flags:[!1,!1,!1,!1,!1,!1]},E=function(r,v){if(v||"function"==typeof r.canZoomInside)x=!0,g&&(v||r.canZoomInside("x",a,b))&&(e.zoom_xmin=a,e.zoom_xmax=b,q=!0,w="0",g=!1,u.values[0]=a,u.values[1]=b,u.flags[0]=u.flags[1]=!0),n&&(v||r.canZoomInside("y",c,d))&&(e.zoom_ymin=c,e.zoom_ymax=d,q=!0,y="1",n=!1,u.values[2]=c,u.values[3]=
d,u.flags[2]=u.flags[3]=!0),k&&(v||r.canZoomInside("z",f,h))&&(e.zoom_zmin=f,e.zoom_zmax=h,q=!0,A="2",k=!1,u.values[4]=f,u.values[5]=h,u.flags[4]=u.flags[5]=!0)};(g||n||k)&&this.forEachPainter(function(a){return E(a)});!x&&this.self_drawaxes&&E(null,!0);if(l||m||z)l&&(this.zoom_xmin!==this.zoom_xmax&&(q=!0,w="0"),this.zoom_xmin=this.zoom_xmax=0,u.values[0]=u.values[1]=-1),m&&(this.zoom_ymin!==this.zoom_ymax&&(q=!0,y="1"),this.zoom_ymin=this.zoom_ymax=0,u.values[2]=u.values[3]=-1),z&&(this.zoom_zmin!==
this.zoom_zmax&&(q=!0,A="2"),this.zoom_zmin=this.zoom_zmax=0,u.values[4]=u.values[5]=-1);if(!q)return Promise.resolve(!1);this.v7CommMode()==JSROOT.v7.CommMode.kNormal&&this.v7SubmitRequest("zoom",{_typename:"ROOT::Experimental::RFrame::RZoomRequest",ranges:u});return this.interactiveRedraw("pad","zoom"+w+y+A).then(function(){return!0})};l.prototype.zoomSingle=function(a,b,c){var d=this,f=["x","y","z","x2","y2"].indexOf(a);if(this.projection||!this[a+"_handle"]||0>f)return Promise.resolve(!1);var h=
b!==c,e=!1;if(h){var g=0;b<=this[a+"min"]&&(b=this[a+"min"],g++);c>=this[a+"max"]&&(c=this[a+"max"],g++);2===g&&(h=!1,e=!0)}else e=b===c&&0===b;var n=!1,k=!1,l={_typename:"ROOT::Experimental::RFrame::RUserRanges",values:[0,0,0,0,0,0,0,0,0,0],flags:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1]},m=function(e,g){if(g||"function"==typeof e.canZoomInside)k=!0,h&&(g||e.canZoomInside(a[0],b,c))&&(d["zoom_"+a+"min"]=b,d["zoom_"+a+"max"]=c,n=!0,h=!1,l.values[2*f]=b,l.values[2*f+1]=c,l.flags[2*f]=l.flags[2*f+1]=!0)};h&&
this.forEachPainter(function(a){return m(a)});!k&&this.self_drawaxes&&m(null,!0);e&&(this["zoom_"+a+"min"]!==this["zoom_"+a+"max"]&&(n=!0),this["zoom_"+a+"min"]=this["zoom_"+a+"max"]=0,l.values[2*f]=l.values[2*f+1]=-1);if(!n)return Promise.resolve(!1);this.v7CommMode()==JSROOT.v7.CommMode.kNormal&&this.v7SubmitRequest("zoom",{_typename:"ROOT::Experimental::RFrame::RZoomRequest",ranges:l});return this.interactiveRedraw("pad","zoom"+f).then(function(){return!0})};l.prototype.isAxisZoomed=function(a){return this["zoom_"+
a+"min"]!==this["zoom_"+a+"max"]};l.prototype.unzoom=function(a,b,c){var d=this;if("all"==a)return this.unzoom("x2").then(function(){return d.unzoom("y2")}).then(function(){return d.unzoom("xyz")});if("x2"==a||"y2"==a)return this.zoomSingle(a,0,0).then(function(b){b&&d.zoomChangedInteractive(a,"unzoom");return b});"undefined"===typeof a?a=b=c=!0:"string"===typeof a&&(c=0<=a.indexOf("z"),b=0<=a.indexOf("y"),a=0<=a.indexOf("x"));return this.zoom(a?0:void 0,a?0:void 0,b?0:void 0,b?0:void 0,c?0:void 0,
c?0:void 0).then(function(f){f&&a&&d.zoomChangedInteractive("x","unzoom");f&&b&&d.zoomChangedInteractive("y","unzoom");f&&c&&d.zoomChangedInteractive("z","unzoom");return f})};l.prototype.zoomChangedInteractive=function(a,b){if("reset"==a)this.zoom_changed_x=this.zoom_changed_y=this.zoom_changed_z=void 0;else{if(!a||"any"==a)return this.zoom_changed_x||this.zoom_changed_y||this.zoom_changed_z;if("x"===a||"y"===a||"z"===a){a="zoom_changed_"+a;if(void 0===b)return this[a];"unzoom"===b?this[a]?delete this[a]:
this[a]=!0:b&&(this[a]=!0)}}};l.prototype.fillObjectOfflineMenu=function(a,b){var c=this;"x"!=b&&"y"!=b||a.add("Unzoom",function(){return c.unzoom(b)})};l.prototype.changeFrameAttr=function(a,b){var c={};this.v7AttrChange(c,a,b);this.v7SetAttr(a,b);this.v7SendAttrChanges(c,!1);this.redrawPad()};l.prototype.fillContextMenu=function(a,b){var c=this;if("x"==b||"y"==b||"x2"==b||"y2"==b){var d=this[b+"_handle"];if(!d)return!1;a.add("header: "+b.toUpperCase()+" axis");return d.fillAxisContextMenu(a,b)}(b=
0==a.size())?a.add("header:Frame"):a.add("separator");this.zoom_xmin!==this.zoom_xmax&&a.add("Unzoom X",function(){return c.unzoom("x")});this.zoom_ymin!==this.zoom_ymax&&a.add("Unzoom Y",function(){return c.unzoom("y")});this.zoom_zmin!==this.zoom_zmax&&a.add("Unzoom Z",function(){return c.unzoom("z")});this.zoom_x2min!==this.zoom_x2max&&a.add("Unzoom X2",function(){return c.unzoom("x2")});this.zoom_y2min!==this.zoom_y2max&&a.add("Unzoom Y2",function(){return c.unzoom("y2")});a.add("Unzoom all",
function(){return c.unzoom("all")});a.add("separator");a.addchk(this.isTooltipAllowed(),"Show tooltips",function(){return c.setTooltipAllowed("toggle")});this.x_handle&&a.addchk(this.x_handle.draw_grid,"Grid x",function(a){return c.changeFrameAttr("gridX",a)});this.y_handle&&a.addchk(this.y_handle.draw_grid,"Grid y",function(a){return c.changeFrameAttr("gridY",a)});this.x_handle&&!this.x2_handle&&a.addchk(this.x_handle.draw_swapside,"Swap x",function(a){return c.changeFrameAttr("swapX",a)});this.y_handle&&
!this.y2_handle&&a.addchk(this.y_handle.draw_swapside,"Swap y",function(a){return c.changeFrameAttr("swapY",a)});this.x_handle&&!this.x2_handle&&(a.add("sub:Ticks x"),a.addchk(0==this.x_handle.draw_ticks,"off",function(){return c.changeFrameAttr("ticksX",0)}),a.addchk(1==this.x_handle.draw_ticks,"normal",function(){return c.changeFrameAttr("ticksX",1)}),a.addchk(2==this.x_handle.draw_ticks,"ticks on both sides",function(){return c.changeFrameAttr("ticksX",2)}),a.addchk(3==this.x_handle.draw_ticks,
"labels on both sides",function(){return c.changeFrameAttr("ticksX",3)}),a.add("endsub:"));this.y_handle&&!this.y2_handle&&(a.add("sub:Ticks y"),a.addchk(0==this.y_handle.draw_ticks,"off",function(){return c.changeFrameAttr("ticksY",0)}),a.addchk(1==this.y_handle.draw_ticks,"normal",function(){return c.changeFrameAttr("ticksY",1)}),a.addchk(2==this.y_handle.draw_ticks,"ticks on both sides",function(){return c.changeFrameAttr("ticksY",2)}),a.addchk(3==this.y_handle.draw_ticks,"labels on both sides",
function(){return c.changeFrameAttr("ticksY",3)}),a.add("endsub:"));a.addAttributesMenu(this,b?"":"Frame ");a.add("separator");a.add("Save as frame.png",function(){return c.getPadPainter().saveAs("png","frame","frame.png")});a.add("Save as frame.svg",function(){return c.getPadPainter().saveAs("svg","frame","frame.svg")});return!0};l.prototype.revertAxis=function(a,b){return(a=this[a+"_handle"])?a.revertPoint(b):0};l.prototype.showAxisStatus=function(a,b){b=e.pointer(b,this.getFrameSvg().node());var c=
"x"==a?0:1;this.swap_xy&&(c=1-c);c=this.revertAxis(a,b[c]);this.showObjectStatus(a,"axis",a+" : "+this.axisAsText(a,c),Math.round(b[0])+","+Math.round(b[1]))};l.prototype.addKeysHandler=function(){var a=this;JSROOT.batch_mode||JSROOT.require(["interactive"]).then(function(b){b.FrameInteractive.assign(a);a.addKeysHandler()})};l.prototype.addInteractivity=function(a){var b=this;return JSROOT.batch_mode||!JSROOT.settings.Zooming&&!JSROOT.settings.ContextMenu?Promise.resolve(!0):JSROOT.require(["interactive"]).then(function(c){c.FrameInteractive.assign(b);
return b.addInteractivity(a)})};l.prototype.setRootPadRange=function(){};l.prototype.toggleAxisLog=function(a){(a=this[a+"_handle"])&&a.changeAxisLog("toggle")};m.prototype=Object.create(JSROOT.ObjectPainter.prototype);m.prototype.isRoot6=function(){return!1};m.prototype.svg_this_pad=function(){return this.getPadSvg(this.this_pad_name)};m.prototype.getMainPainter=function(){return this.main_painter_ref||null};m.prototype.setMainPainter=function(a,b){if(!this.main_painter_ref||b)this.main_painter_ref=
a};m.prototype.cleanup=function(){this._doing_draw&&console.error("pad drawing is not completed when cleanup is called");this.painters.forEach(function(a){return a.cleanup()});var a=this.svg_this_pad();a.empty()||(a.property("pad_painter",null),this.iscan||a.remove());delete this.main_painter_ref;delete this.frame_painter_ref;delete this.pads_cache;delete this._pad_x;delete this._pad_y;delete this._pad_width;delete this._pad_height;delete this._doing_draw;delete this._dfltRFont;this.painters=[];this.pad_frame=
this.draw_object=this.pad=null;this.this_pad_name=void 0;this.has_canvas=!1;g.selectActivePad({pp:this,active:!1});JSROOT.ObjectPainter.prototype.cleanup.call(this)};m.prototype.getFramePainter=function(){return this.frame_painter_ref};m.prototype.getPadWidth=function(){return this._pad_width||0};m.prototype.getPadHeight=function(){return this._pad_height||0};m.prototype.getPadRect=function(){return{x:this._pad_x||0,y:this._pad_y||0,width:this.getPadWidth(),height:this.getPadHeight()}};m.prototype.getRootPad=
function(a){return void 0!==a&&a?null:this.pad};m.prototype.cleanPrimitives=function(a){if(a&&"function"===typeof a)for(var b=this.painters.length-1;0<=b;--b)a(this.painters[b])&&(this.painters[b].cleanup(),this.painters.splice(b,1))};m.prototype.findPainterFor=function(a,b,c){return this.painters.find(function(d){if(d=d.getObject()){if(a&&d===a)return!0;if(b||c)if(!b||d.fName===b)if(!c||d._typename===c)return!0}})};m.prototype.getHistPalette=function(){var a=this.findPainterFor(void 0,void 0,"ROOT::Experimental::RPaletteDrawable");
if(a)return a.getHistPalette();this.fDfltPalette||(this.fDfltPalette={_typename:"ROOT::Experimental::RPalette",fColors:[{fOrdinal:0,fColor:{fColor:"rgb(53, 42, 135)"}},{fOrdinal:.125,fColor:{fColor:"rgb(15, 92, 221)"}},{fOrdinal:.25,fColor:{fColor:"rgb(20, 129, 214)"}},{fOrdinal:.375,fColor:{fColor:"rgb(6, 164, 202)"}},{fOrdinal:.5,fColor:{fColor:"rgb(46, 183, 164)"}},{fOrdinal:.625,fColor:{fColor:"rgb(135, 191, 119)"}},{fOrdinal:.75,fColor:{fColor:"rgb(209, 187, 89)"}},{fOrdinal:.875,fColor:{fColor:"rgb(254, 200, 50)"}},
{fOrdinal:1,fColor:{fColor:"rgb(249, 251, 14)"}}],fInterpolate:!0,fNormalized:!0},JSROOT.addMethods(this.fDfltPalette,"ROOT::Experimental::RPalette"));return this.fDfltPalette};m.prototype.forEachPainterInPad=function(a,b){b||(b="all");"objects"!=b&&a(this);for(var c=0;c<this.painters.length;++c){var d=this.painters[c];"function"===typeof d.forEachPainterInPad?"objects"!=b&&d.forEachPainterInPad(a,b):"pads"!=b&&a(d)}};m.prototype.forEachPainter=m.prototype.forEachPainterInPad;m.prototype.registerForPadEvents=
function(a){this.pad_events_receiver=a};m.prototype.producePadEvent=function(a,b,c,d,f){"select"==a&&"function"==typeof this.selectActivePad&&this.selectActivePad(b,c,d);this.pad_events_receiver&&this.pad_events_receiver({what:a,padpainter:b,painter:c,position:d,place:f})};m.prototype.selectObjectPainter=function(a,b,c){var d=this.iscan||!this.has_canvas,f=d?this:this.getCanvPainter();void 0===a&&(a=this);b&&!d&&(b=g.getAbsPosInCanvas(this.svg_this_pad(),b));g.selectActivePad({pp:this,active:!0});
f.producePadEvent("select",this,a,b,c)};m.prototype.createCanvasSvg=function(a,b){var c=this,d=null,f=null,h=null,e;if(0<a){if(this._fixed_size)return 1<a;f=this.getCanvSvg();if(f.empty())return!1;d=f.property("height_factor");h=this.testMainResize(a,null,d);if(!h.changed)return!1;JSROOT.batch_mode||(e=this.getLayerSvg("btns_layer",this.this_pad_name))}else{a=this.selectDom();"static"==a.style("position")&&a.style("position","relative");f=a.append("svg").attr("class","jsroot root_canvas").property("pad_painter",
this).property("current_pad","").property("redraw_by_resize",!1);this.setTopPainter();f.append("svg:title").text("ROOT canvas");d=f.append("svg:path").attr("class","canvas_fillrect");if(!JSROOT.batch_mode)d.style("pointer-events","visibleFill").on("dblclick",function(a){return c.enlargePad(a)}).on("click",function(){return c.selectObjectPainter(c,null)}).on("mouseenter",function(){return c.showObjectStatus()});f.append("svg:g").attr("class","primitives_layer");f.append("svg:g").attr("class","info_layer");
JSROOT.batch_mode||(e=f.append("svg:g").attr("class","btns_layer").property("leftside","left"==JSROOT.settings.ToolBarSide).property("vertical",JSROOT.settings.ToolBarVert));if(JSROOT.settings.ContextMenu&&!JSROOT.batch_mode)f.select(".canvas_fillrect").on("contextmenu",function(a){return c.padContextMenu(a)});d=.66;this.pad&&this.pad.fWinSize[0]&&this.pad.fWinSize[1]&&(d=this.pad.fWinSize[1]/this.pad.fWinSize[0],.1>d||10<d)&&(d=.66);this._fixed_size?(a.style("overflow","auto"),h={width:this.pad.fWinSize[0],
height:this.pad.fWinSize[1]},h.width&&h.height||(h=g.getElementRect(a))):h=this.testMainResize(2,b,d)}this.createAttFill({pattern:1001,color:0});5>=h.width||5>=h.height?(f.style("display","none"),console.warn("Hide canvas while geometry too small w=",h.width," h=",h.height),h.width=200,h.height=100):f.style("display",null);this._fixed_size?f.attr("x",0).attr("y",0).attr("width",h.width).attr("height",h.height).style("position","absolute"):f.attr("x",0).attr("y",0).style("width","100%").style("height",
"100%").style("position","absolute").style("left",0).style("top",0).style("right",0).style("bottom",0);f.attr("viewBox","0 0 "+h.width+" "+h.height).attr("preserveAspectRatio","none").property("height_factor",d).property("draw_x",0).property("draw_y",0).property("draw_width",h.width).property("draw_height",h.height);this._pad_y=this._pad_x=0;this._pad_width=h.width;this._pad_height=h.height;f.select(".canvas_fillrect").attr("d","M0,0H"+h.width+"V"+h.height+"H0Z").call(this.fillatt.func);this._fast_drawing=
JSROOT.settings.SmallPad&&(h.width<JSROOT.settings.SmallPad.width||h.height<JSROOT.settings.SmallPad.height);this.alignButtons&&e&&this.alignButtons(e,h.width,h.height);return!0};m.prototype.enlargePad=function(a){a&&(a.preventDefault(),a.stopPropagation());a=this.getCanvSvg();var b=a.property("pad_enlarged");if(!this.iscan&&this.has_canvas&&(b||this.hasObjectsToDraw()||this.painters))b?b===this.pad?(this.enlargeMain(!1),a.property("pad_enlarged",null)):console.error("missmatch with pad double click events"):
(this.enlargeMain(!0,!0),a.property("pad_enlarged",this.pad));else{if(this._fixed_size||!this.enlargeMain("toggle"))return;"off"==this.enlargeMain("state")&&a.property("pad_enlarged",null)}a=this._fast_drawing;this.checkResize(!0);this._fast_drawing!=a&&this.showPadButtons()};m.prototype.createPadSvg=function(a){var b=this;if(!this.has_canvas)return this.createCanvasSvg(a?2:0),!0;var c=this.getPadSvg(this.pad_name),d=this.getCanvSvg(),f=c.property("draw_width"),e=c.property("draw_height"),g=d.property("pad_enlarged"),
k=!0;d=f;var n=e,l=0,m=0,p=null,z=null,q=null;this.pad&&this.pad.fPos&&this.pad.fSize&&(l=Math.round(f*this.pad.fPos.fHoriz.fArr[0]),m=Math.round(e*this.pad.fPos.fVert.fArr[0]),d=Math.round(f*this.pad.fSize.fHoriz.fArr[0]),n=Math.round(e*this.pad.fSize.fVert.fArr[0]));g&&(k=!1,g===this.pad?k=!0:this.forEachPainterInPad(function(a){a.getObject()==g&&(k=!0)},"pads"),k&&(d=f,n=e,l=m=0));if(a)p=this.svg_this_pad(),z=p.select(".root_pad_border"),JSROOT.batch_mode||(q=this.getLayerSvg("btns_layer",this.this_pad_name));
else{p=c.select(".primitives_layer").append("svg:svg").classed("__root_pad_"+this.this_pad_name,!0).attr("pad",this.this_pad_name).property("pad_painter",this);z=p.append("svg:path").attr("class","root_pad_border");p.append("svg:g").attr("class","primitives_layer");JSROOT.batch_mode||(q=p.append("svg:g").attr("class","btns_layer").property("leftside","left"!=JSROOT.settings.ToolBarSide).property("vertical",JSROOT.settings.ToolBarVert));if(JSROOT.settings.ContextMenu)z.on("contextmenu",function(a){return b.padContextMenu(a)});
if(!JSROOT.batch_mode)z.attr("pointer-events","visibleFill").on("dblclick",function(a){return b.enlargePad(a)}).on("click",function(){return b.selectObjectPainter(b,null)}).on("mouseenter",function(){return b.showObjectStatus()})}this.createAttFill({attr:this.pad});this.createAttLine({attr:this.pad,color0:0==this.pad.fBorderMode?"none":""});p.attr("display",k?null:"none").attr("viewBox","0 0 "+d+" "+n).attr("preserveAspectRatio","none").attr("x",l).attr("y",m).attr("width",d).attr("height",n).property("draw_x",
l).property("draw_y",m).property("draw_width",d).property("draw_height",n);this._pad_x=l;this._pad_y=m;this._pad_width=d;this._pad_height=n;z.attr("d","M0,0H"+d+"V"+n+"H0Z").call(this.fillatt.func).call(this.lineatt.func);this._fast_drawing=JSROOT.settings.SmallPad&&(d<JSROOT.settings.SmallPad.width||n<JSROOT.settings.SmallPad.height);p.property("can3d")===JSROOT.constants.Embed3D.Overlay&&this.selectDom().select(".draw3d_"+this.this_pad_name).style("display",k?"":"none");this.alignButtons&&q&&this.alignButtons(q,
d,n);return k};m.prototype.hasObjectsToDraw=function(){var a=this.pad?this.pad.fPrimitives:null;return a&&a.find(function(a){return"ROOT::Experimental::RPadDisplayItem"!=a._typename})?!0:!1};m.prototype.syncDraw=function(a){var b={kind:a||"redraw"};if(void 0===this._doing_draw)return this._doing_draw=[b],Promise.resolve(!0);if(!0!==b.kind&&0<this._doing_draw.findIndex(function(a,d){return 0<d&&a.kind==b.kind}))return!1;this._doing_draw.push(b);return new Promise(function(a){b.func=a})};m.prototype.confirmDraw=
function(){if(void 0===this._doing_draw)return console.warn("failure, should not happen");this._doing_draw.shift();if(0==this._doing_draw.length)delete this._doing_draw;else{var a=this._doing_draw[0];a.func&&(a.func(),delete a.func)}};m.prototype.drawPrimitives=function(a){var b=this;if(void 0===a)return this.iscan&&(this._start_tm=(new Date).getTime()),this._num_primitives=this.pad&&this.pad.fPrimitives?this.pad.fPrimitives.length:0,this.syncDraw(!0).then(function(){return b.drawPrimitives(0)});
if(!this.pad||a>=this._num_primitives){this.confirmDraw();if(this._start_tm){var c=(new Date).getTime()-this._start_tm;3E3<c&&console.log("Canvas drawing took "+(.001*c).toFixed(2)+"s");delete this._start_tm}return Promise.resolve()}return JSROOT.draw(this.getDom(),this.pad.fPrimitives[a],"").then(function(c){c&&"object"==typeof c&&(c._primitive=!0);return b.drawPrimitives(a+1)})};m.prototype.processPadTooltipEvent=function(a){var b=[],c=[];null!==this.painters&&this.painters.forEach(function(a){"function"==
typeof a.processTooltipEvent&&b.push(a)});a&&(a.nproc=b.length);b.forEach(function(b){var d=b.processTooltipEvent(a);d||(d={user_info:null});c.push(d);a&&a.painters&&(d.painter=b)});return c};m.prototype.fillContextMenu=function(a){var b=this;this.iscan?a.add("header: RCanvas"):a.add("header: RPad");a.addchk(this.isTooltipAllowed(),"Show tooltips",function(){return b.setTooltipAllowed("toggle")});this._websocket||a.addAttributesMenu(this);a.add("separator");"function"==typeof this.hasMenuBar&&"function"==
typeof this.actiavteMenuBar&&a.addchk(this.hasMenuBar(),"Menu bar",function(a){return b.actiavteMenuBar(a)});"function"==typeof this.hasEventStatus&&"function"==typeof this.activateStatusBar&&a.addchk(this.hasEventStatus(),"Event status",function(){return b.activateStatusBar("toggle")});(this.enlargeMain()||this.has_canvas&&this.hasObjectsToDraw())&&a.addchk("on"==this.enlargeMain("state"),"Enlarge "+(this.iscan?"canvas":"pad"),function(){return b.enlargePad()});var c=this.this_pad_name;c||(c=this.iscan?
"canvas":"pad");a.add("Save as "+c+".png",c+".png",function(){return b.saveAs("png",!1)});a.add("Save as "+c+".svg",c+".svg",function(){return b.saveAs("svg",!1)});return!0};m.prototype.padContextMenu=function(a){var b=this;if(a.stopPropagation){var c=e.pointer(a,this.svg_this_pad().node());if(c&&2==c.length&&0<=c[0]&&10>c[0]&&0<=c[1]&&10>c[1])return;a.stopPropagation();a.preventDefault();(c=this.getFramePainter())&&c.setLastEventPos()}g.createMenu(a,this).then(function(a){b.fillContextMenu(a);return b.fillObjectExecMenu(a)}).then(function(a){return a.show()})};
m.prototype.redrawPad=function(a){var b=this,c=this.syncDraw(a);if(!1===c)return console.log("Prevent RPad redrawing"),Promise.resolve(!1);var d=!0,f=function(c){for(;c<b.painters.length;){var e=b.painters[c++],h=0;if(d||e.this_pad_name)h=e.redraw(a);if(g.isPromise(h))return h.then(function(){return f(c)})}return Promise.resolve(!0)};return c.then(function(){b.iscan?b.createCanvasSvg(2):d=b.createPadSvg(!0);return f(0)}).then(function(){if(g.getActivePad()===b){var a=b.getCanvPainter();a&&a.producePadEvent("padredraw",
b)}b.confirmDraw();return!0})};m.prototype.redraw=function(a){return this.redrawPad(a)};m.prototype.needRedrawByResize=function(){var a=this.svg_this_pad();if(!a.empty()&&a.property("can3d")===JSROOT.constants.Embed3D.Overlay)return!0;for(a=0;a<this.painters.length;++a)if("function"===typeof this.painters[a].needRedrawByResize&&this.painters[a].needRedrawByResize())return!0;return!1};m.prototype.checkCanvasResize=function(a,b){var c=this;if(!this.iscan&&this.has_canvas)return!1;var d=this.syncDraw("canvas_resize");
if(!1===d)return!1;if(!0===a||!1===a)b=a,a=null;a&&"object"===typeof a&&a.force&&(b=!0);b||(b=this.needRedrawByResize());var f=!1,e=function(a){if(!f||a>=c.painters.length)return c.confirmDraw(),f;var d=c.painters[a].redraw(b?"redraw":"resize");g.isPromise(d)||(d=Promise.resolve());return d.then(function(){return e(a+1)})};return d.then(function(){f=c.createCanvasSvg(b?2:1,a);return e(0)})};m.prototype.updateObject=function(a){if(!a)return!1;this.pad.fStyle=a.fStyle;this.pad.fAttr=a.fAttr;this.iscan?
(this.pad.fTitle=a.fTitle,this.pad.fWinSize=a.fWinSize):(this.pad.fPos=a.fPos,this.pad.fSize=a.fSize);return!0};m.prototype.addObjectPainter=function(a,b,c){a&&b&&b[c]&&void 0===a.snapid&&(0>this.painters.indexOf(a)&&this.painters.push(a),a.assignSnapId(b[c].fObjectID),a.rstyle||(a.rstyle=b[c].fStyle||this.rstyle))};m.prototype.extractTObjectProp=function(a){var b=this;if(a.fColIndex&&a.fColValue)for(var c=this.root_colors||g.root_colors,d=0;d<a.fColIndex.length;++d)c[a.fColIndex[d]]=a.fColValue[d];
var f=new JSROOT.ObjectPainter,e=a.fObject;f.assignObject(a);f.csstype=a.fCssType;f.rstyle=a.fStyle;a.fOption=f.v7EvalAttr("options","");a=function(a,c){(c=f.v7EvalColor(c,""))&&(e[a]=g.addColor(c,b.root_colors))};void 0!==e.fLineColor&&void 0!==e.fLineWidth&&void 0!==e.fLineStyle&&(a("fLineColor","line_color"),e.fLineWidth=f.v7EvalAttr("line_width",e.fLineWidth),e.fLineStyle=f.v7EvalAttr("line_style",e.fLineStyle));void 0!==e.fFillColor&&void 0!==e.fFillStyle&&(a("fFillColor","fill_color"),e.fFillStyle=
f.v7EvalAttr("fill_style",e.fFillStyle));void 0!==e.fMarkerColor&&void 0!==e.fMarkerStyle&&void 0!==e.fMarkerSize&&(a("fMarkerColor","marker_color"),e.fMarkerStyle=f.v7EvalAttr("marker_style",e.fMarkerStyle),e.fMarkerSize=f.v7EvalAttr("marker_size",e.fMarkerSize));void 0!==e.fTextColor&&void 0!==e.fTextAlign&&void 0!==e.fTextAngle&&void 0!==e.fTextSize&&(a("fTextColor","text_color"),e.fTextAlign=f.v7EvalAttr("text_align",e.fTextAlign),e.fTextAngle=f.v7EvalAttr("text_angle",e.fTextAngle),e.fTextSize=
f.v7EvalAttr("text_size",e.fTextSize))};m.prototype.drawNextSnap=function(a,b){var c=this;void 0===b&&(b=-1,this._snaps_map={},this._num_primitives=a?a.length:0,this._auto_color_cnt=0);delete this.next_rstyle;++b;if(!a||b>=a.length)return delete this._snaps_map,delete this._auto_color_cnt,Promise.resolve(this);var d=a[b],e=d.fObjectID,h=this._snaps_map[e],k=null;h?h++:h=1;this._snaps_map[e]=h;if(d.fDummy)return this.drawNextSnap(a,b);for(var l=0;l<this.painters.length;++l)if(this.painters[l].snapid===
e&&0===--h){k=this.painters[l];break}if(k){if("ROOT::Experimental::RPadDisplayItem"==d._typename)return k.redrawPadSnap(d).then(function(d){c.addObjectPainter(d,a,b);return c.drawNextSnap(a,b)});"ROOT::Experimental::TObjectDisplayItem"===d._typename&&this.extractTObjectProp(d);var n;k.updateObject(d.fDrawable||d.fObject||d,d.fOption||"")&&(n=k.redraw());g.isPromise(n)||(n=Promise.resolve(!0));return n.then(function(){return c.drawNextSnap(a,b)})}if("ROOT::Experimental::RPadDisplayItem"==d._typename){var t=
new m(this.getDom(),d,!1);t.decodeOptions("");t.addToPadPrimitives(this.this_pad_name);t.assignSnapId(d.fObjectID);t.rstyle=d.fStyle;t.createPadSvg();d.fPrimitives&&0<d.fPrimitives.length&&t.addPadButtons();var p=t.selectCurrentPad(t.this_pad_name);return t.drawNextSnap(d.fPrimitives).then(function(){t.selectCurrentPad(p);return c.drawNextSnap(a,b)})}this.next_rstyle=a[b].fStyle||this.rstyle;if("ROOT::Experimental::TObjectDisplayItem"===d._typename){if(5==d.fKind)return JSROOT.extend(JSROOT.gStyle,
d.fObject),this.drawNextSnap(a,b);if(4==d.fKind){e=[];d=d.fObject.arr;for(h=0;h<d.length;++h)k=d[h].fString,l=k.indexOf("="),0<l&&(e[parseInt(k.substr(0,l))]=k.substr(l+1));this.root_colors=e;return this.drawNextSnap(a,b)}if(6==d.fKind){d=d.fObject.arr;e=[];for(h=0;h<d.length;++h)e[h]=d[h].fString;this.custom_palette=new JSROOT.ColorPalette(e);return this.drawNextSnap(a,b)}if(!this.getFramePainter())return JSROOT.draw(this.getDom(),{_typename:"TFrame",$dummy:!0},"").then(function(){return c.drawNextSnap(a,
b-1)});this.extractTObjectProp(d)}return JSROOT.draw(this.getDom(),d.fDrawable||d.fObject||d,d.fOption||"").then(function(d){c.addObjectPainter(d,a,b);return c.drawNextSnap(a,b)})};m.prototype.findSnap=function(a,b){function c(c){return c&&"string"==typeof c?c==a?!0:b&&c.length>a.length&&c.indexOf(a)==c.length-a.length:!1}if(c(this.snapid))return this;if(!this.painters)return null;for(var d=0;d<this.painters.length;++d){var e=this.painters[d];b||"function"!==typeof e.findSnap?c(e.snapid)||(e=null):
e=e.findSnap(a);if(e)return e}return null};m.prototype.redrawPadSnap=function(a){var b=this;if(!a||!a.fPrimitives)return Promise.resolve(this);this.iscan&&this._websocket&&a.fTitle&&!this.embed_canvas&&"undefined"!==typeof document&&(document.title=a.fTitle);if(void 0===this.snapid){this.assignSnapId(a.fObjectID);this.pad=this.draw_object=a;this.batch_mode&&this.iscan&&(this._fixed_size=!0);if(JSROOT.BrowserLayout&&!this.batch_mode&&!this.use_openui&&!this.brlayout){var c=this.selectDom().attr("id");
c&&"string"==typeof c&&(this.brlayout=new JSROOT.BrowserLayout(c,null,this),this.brlayout.create(c,!0),this.setDom(this.brlayout.drawing_divid()),g.registerForResize(this.brlayout))}this.createCanvasSvg(0);this.addPadButtons(!0);return this.drawNextSnap(a.fPrimitives)}this.updateObject(a);this.iscan?this.createCanvasSvg(2):this.createPadSvg(!0);var d=!1;c=!1;for(var e={},h=0;h<this.painters.length;e={$jscomp$loop$prop$sub$19:e.$jscomp$loop$prop$sub$19},++h)e.$jscomp$loop$prop$sub$19=this.painters[h],
void 0!==e.$jscomp$loop$prop$sub$19.snapid&&(a.fPrimitives.forEach(function(a){return function(b){a.$jscomp$loop$prop$sub$19&&b.fObjectID===a.$jscomp$loop$prop$sub$19.snapid&&(a.$jscomp$loop$prop$sub$19=null,d=!0)}}(e)),e.$jscomp$loop$prop$sub$19&&(this.painters.splice(h--,1),e.$jscomp$loop$prop$sub$19.cleanup(),c=!0));c&&delete this.pads_cache;if(!d){(c=this.getFramePainter())&&c.is_root6()&&(c=null);for(e=0;e<this.painters.length;++e)c!==this.painters[e]&&this.painters[e].cleanup();this.painters=
[];delete this.main_painter_ref;c&&(this.painters.push(c),c.cleanFrameDrawings(),c.redraw());this.removePadButtons&&this.removePadButtons();this.addPadButtons(!0)}var k=this.selectCurrentPad(this.this_pad_name);return this.drawNextSnap(a.fPrimitives).then(function(){b.selectCurrentPad(k);if(g.getActivePad()===b){var a=b.getCanvPainter();a&&a.producePadEvent("padredraw",b)}return b})};m.prototype.createImage=function(a){return"pdf"==a?Promise.resolve(btoa("dummy PDF file")):"png"==a||"jpeg"==a||"svg"==
a?this.produceImage(!0,a).then(function(b){if(!b||"svg"==a)return b;var c=b.indexOf("base64,");return 0<c?b.substr(c+7):""}):Promise.resolve("")};m.prototype.itemContextMenu=function(a){var b=this,c=this.svg_this_pad().node().getBoundingClientRect(),d={clientX:c.left+10,clientY:c.top+10};if("pad"==a)return setTimeout(function(){return b.padContextMenu(d)},50);var e=null;switch(a){case "xaxis":case "yaxis":case "zaxis":e=this.getMainPainter();var h=a[0];break;case "frame":e=this.getFramePainter();
break;default:a=parseInt(a),Number.isInteger(a)&&(e=this.painters[a])}e&&"function"===typeof e.fillContextMenu&&g.createMenu(d,e).then(function(a){e.fillContextMenu(a,h)&&setTimeout(function(){return a.show()},50)})};m.prototype.saveAs=function(a,b,c){c||(c=this.this_pad_name,0===c.length&&(c=this.iscan?"canvas":"pad"),c+="."+a);this.produceImage(b,a).then(function(b){var d=document.createElement("a");d.download=c;d.href="svg"!=a?b:"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(b);document.body.appendChild(d);
d.addEventListener("click",function(){return d.parentNode.removeChild(d)});d.click()})};m.prototype.produceImage=function(a,b){function c(a){a=encodeURIComponent(a);a=a.replace(/%([0-9A-F]{2})/g,function(a,b){a=String.fromCharCode("0x"+b);return"%"===a?"%25":a});return decodeURIComponent(a)}function d(){for(var a=0;a<l.length;++a){var b=l[a];b.img&&b.img.remove();var c=b.prnt.select(".primitives_layer");b.foreign&&b.prnt.node().insertBefore(b.foreign.node(),c.node());b.frame_node&&c.node().insertBefore(b.frame_node,
b.frame_next);b.btns_node&&b.btns_prnt.insertBefore(b.btns_node,b.btns_next)}}var e=this,h="frame"===a,k=h?this.getFrameSvg():a?this.getCanvSvg():this.svg_this_pad();if(k.empty())return Promise.resolve("");a=a&&!h?this.getCanvPainter():this;var l=[];h||a.forEachPainterInPad(function(a){var b={prnt:a.svg_this_pad()};l.push(b);var c=a.getLayerSvg("btns_layer",e.this_pad_name);b.btns_node=c.node();b.btns_node&&(b.btns_prnt=b.btns_node.parentNode,b.btns_next=b.btns_node.nextSibling,c.remove());var d=
a.getFramePainter();if(d&&"function"===typeof d.render3D&&"function"==typeof d.access3dKind){var f=d.access3dKind();if(f===JSROOT.constants.Embed3D.Overlay||f===JSROOT.constants.Embed3D.Embed){a=d.getSizeFor3d(JSROOT.constants.Embed3D.Embed);c=d.renderer.domElement;d.render3D(0);var h=c.toDataURL("image/png");f===JSROOT.constants.Embed3D.Embed&&(b.foreign=b.prnt.select("."+a.clname),b.foreign.remove());d=d.getFrameSvg();b.frame_node=d.node();b.frame_node&&(b.frame_next=b.frame_node.nextSibling,d.remove());
b.img=b.prnt.insert("image",".primitives_layer").attr("x",a.x).attr("y",a.y).attr("width",c.width).attr("height",c.height).attr("href",h)}}},"pads");a=k.property("draw_width");var n=k.property("draw_height");h&&(h=this.getFramePainter(),a=h.getFrameWidth(),n=h.getFrameHeight());var m='<svg width="'+a+'" height="'+n+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">'+k.node().innerHTML+"</svg>";g.processSvgWorkarounds&&(m=g.processSvgWorkarounds(m));m=g.compressSVG(m);
if("svg"==b)return d(),Promise.resolve(m);var p=new Image;return new Promise(function(a){p.onload=function(){var c=document.createElement("canvas");c.width=p.width;c.height=p.height;c.getContext("2d").drawImage(p,0,0);d();a(c.toDataURL("image/"+b))};p.onerror=function(b){console.log("IMAGE ERROR",b);d();a(null)};p.src="data:image/svg+xml;base64,"+window.btoa(c('<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'+
m))})};m.prototype.clickPadButton=function(a,b){var c=this;if("CanvasSnapShot"==a)return this.saveAs("png",!0);if("enlargePad"==a)return this.enlargePad();if("PadSnapShot"==a)return this.saveAs("png",!1);if("PadContextMenus"==a)b&&(b.preventDefault(),b.stopPropagation()),g.closeMenu&&g.closeMenu()||g.createMenu(b,this).then(function(a){a.add("header:Menus");c.iscan?a.add("Canvas","pad",c.itemContextMenu):a.add("Pad","pad",c.itemContextMenu);c.getFramePainter()&&a.add("Frame","frame",c.itemContextMenu);
var b=c.getMainPainter();b&&(a.add("X axis","xaxis",c.itemContextMenu),a.add("Y axis","yaxis",c.itemContextMenu),"function"===typeof b.getDimension&&1<b.getDimension()&&a.add("Z axis","zaxis",c.itemContextMenu));if(c.painters&&0<c.painters.length){a.add("separator");b=[];for(var d=0;d<c.painters.length;++d){var e=c.painters[d];if((e=e?e.getObject():null)&&!(0<=b.indexOf(e))){var f="_typename"in e?e._typename+"::":"";"fName"in e&&(f+=e.fName);0==f.length&&(f="item"+d);a.add(f,d,c.itemContextMenu)}}}a.show()});
else{b=!1;for(var d=0;d<this.painters.length;++d){var e=this.painters[d];"function"==typeof e.clickPadButton&&e.clickPadButton(a);b||"function"!=typeof e.clickButton||(b=e.clickButton(a))}}};m.prototype.addPadButton=function(a,b,c,d){if(JSROOT.settings.ToolBar&&!JSROOT.batch_mode&&!this.batch_mode){this._buttons||(this._buttons=[]);for(var e=0;e<this._buttons.length;++e)if(this._buttons[e].funcname==c)return;this._buttons.push({btn:a,tooltip:b,funcname:c,keyname:d});!this.iscan&&this.has_canvas&&
0!=c.indexOf("Pad")&&"enlargePad"!==c&&(d=this.getCanvPainter())&&d!==this&&d.addPadButton(a,b,c)}};m.prototype.addPadButtons=function(a){this.addPadButton("camera","Create PNG",this.iscan?"CanvasSnapShot":"PadSnapShot","Ctrl PrintScreen");JSROOT.settings.ContextMenu&&this.addPadButton("question","Access context menus","PadContextMenus");(!this.iscan&&this.has_canvas&&this.hasObjectsToDraw()||this.enlargeMain("verify"))&&this.addPadButton("circle","Enlarge canvas","enlargePad");a&&this.brlayout&&
(this.addPadButton("diamand","Toggle Ged","ToggleGed"),this.addPadButton("three_circles","Toggle Status","ToggleStatus"))};m.prototype.showPadButtons=function(){var a=this;this._buttons&&JSROOT.require(["interactive"]).then(function(b){b.PadButtonsHandler.assign(a);a.showPadButtons()})};m.prototype.getPadLength=function(a,b,c){var d=this,e=a?-1:1,h,g,k=function(){h||(h=c?c.getFrameRect():d.getPadRect());return h};if(c){var l=2<b.fArr.length?b.fArr[2]:void 0,m=a?"gry":"grx";void 0!==l&&c[m]&&(g=c[m](l))}void 0===
g&&(g=a?k().height:0);l=0<b.fArr.length?b.fArr[0]:0;g+=e*(1<b.fArr.length?b.fArr[1]:0);l&&(g+=e*(a?k().height:k().width)*l);return Math.round(g)};m.prototype.getCoordinate=function(a,b){return{x:this.getPadLength(!1,a.fHoriz,b),y:this.getPadLength(!0,a.fVert,b)}};m.prototype.decodeOptions=function(a){var b=this.getObject();if(b){a=new JSROOT.DrawOptions(a);a.check("WEBSOCKET")&&this.openWebsocket&&this.openWebsocket();this.options||(this.options={});JSROOT.extend(this.options,{GlobalColors:!0,LocalColors:!1,
IgnorePalette:!1,RotateFrame:!1,FixFrame:!1});if(a.check("NOCOLORS")||a.check("NOCOL"))this.options.GlobalColors=this.options.LocalColors=!1;if(a.check("LCOLORS")||a.check("LCOL"))this.options.GlobalColors=!1,this.options.LocalColors=!0;if(a.check("NOPALETTE")||a.check("NOPAL"))this.options.IgnorePalette=!0;a.check("ROTATE")&&(this.options.RotateFrame=!0);a.check("FIXFRAME")&&(this.options.FixFrame=!0);a.check("WHITE")&&(b.fFillColor=0);a.check("LOGX")&&(b.fLogx=1);a.check("LOGY")&&(b.fLogy=1);a.check("LOGZ")&&
(b.fLogz=1);a.check("LOG")&&(b.fLogx=b.fLogy=b.fLogz=1);a.check("GRIDX")&&(b.fGridx=1);a.check("GRIDY")&&(b.fGridy=1);a.check("GRID")&&(b.fGridx=b.fGridy=1);a.check("TICKX")&&(b.fTickx=1);a.check("TICKY")&&(b.fTicky=1);a.check("TICK")&&(b.fTickx=b.fTicky=1)}};q.prototype=Object.create(m.prototype);q.prototype.cleanup=function(){delete this._websocket;delete this._submreq;this._changed_layout&&this.setLayoutKind("simple");delete this._changed_layout;m.prototype.cleanup.call(this)};q.prototype.getLayoutKind=
function(){var a=this.selectDom("origin");return(a.empty()?"":a.property("layout"))||"simple"};q.prototype.setLayoutKind=function(a,b){var c=this.selectDom("origin");c.empty()||(a||(a="simple"),c.property("layout",a),c.property("layout_selector","simple"!=a&&b?b:null),this._changed_layout="simple"!==a)};q.prototype.changeLayout=function(a,b){var c=this;if(this.getLayoutKind()==a)return Promise.resolve(!0);for(var d=this.selectDom("origin"),f=d.select(".side_panel"),h=this.selectDom(),g=[];h.node().firstChild;)g.push(h.node().removeChild(h.node().firstChild));
f.empty()||JSROOT.cleanup(f.node());this.setLayoutKind("simple");d.html("");if("simple"==a){h=d;for(var k=0;k<g.length;++k)h.node().appendChild(g[k]);this.setLayoutKind(a);JSROOT.resize(h.node());return Promise.resolve(!0)}return JSROOT.require("jq2d").then(function(){var k=new JSROOT.GridDisplay(d.node(),a);void 0==b&&(b=0==a.indexOf("vert")?0:1);h=e.select(k.getGridFrame(b));f=e.select(k.getGridFrame(1-b));h.classed("central_panel",!0).style("position","relative");f.classed("side_panel",!0).style("position",
"relative");for(k=0;k<g.length;++k)h.node().appendChild(g[k]);c.setLayoutKind(a,".central_panel");d.property("mdi",null);JSROOT.resize(h.node());return!0})};q.prototype.toggleProjection=function(a){delete this.proj_painter;a&&(this.proj_painter=1);if(this.showUI5ProjectionArea)return this.showUI5ProjectionArea(a);var b="simple";switch(a){case "X":case "bottom":b="vert2_31";var c=0;break;case "Y":case "left":b="horiz2_13";c=1;break;case "top":b="vert2_13";c=1;break;case "right":b="horiz2_31",c=0}return this.changeLayout(b,
c)};q.prototype.drawProjection=function(){};q.prototype.drawInSidePanel=function(a,b){var c=this.selectDom("origin").select(".side_panel");return c.empty()?Promise.resolve(null):JSROOT.draw(c.node(),a,b)};q.prototype.testUI5=function(){if(!this.use_openui)return!1;console.warn("full ui5 should be used - not loaded yet? Please check!!");return!0};q.prototype.showMessage=function(a){this.testUI5()||g.showProgress(a,7E3)};q.prototype.saveCanvasAsFile=function(a){var b=this,c=a.indexOf(".");this.createImage(a.substr(c+
1)).then(function(c){console.log("save",a,c.length);b.sendWebsocket("SAVE:"+a+":"+c)})};q.prototype.sendSaveCommand=function(a){this.sendWebsocket("PRODUCE:"+a)};q.prototype.sendWebsocket=function(a,b){this._websocket&&this._websocket.send(a,b)};q.prototype.closeWebsocket=function(a){this._websocket&&(this._websocket.close(a),this._websocket.cleanup(),delete this._websocket)};q.prototype.openWebsocket=function(a){this.closeWebsocket();this._websocket=new JSROOT.WebWindowHandle(a);this._websocket.setReceiver(this);
this._websocket.connect()};q.prototype.useWebsocket=function(a){this.closeWebsocket();this._websocket=a;this._websocket.setReceiver(this);this._websocket.connect()};q.prototype.onWebsocketOpened=function(){};q.prototype.onWebsocketClosed=function(){this.embed_canvas||g.closeCurrentWindow()};q.prototype.onWebsocketMsg=function(a,b){var c=this;console.log("GET_MSG "+b.substr(0,30));if("CLOSE"==b)this.onWebsocketClosed(),this.closeWebsocket(!0);else if("SNAP:"==b.substr(0,5)){b=b.substr(5);var d=b.indexOf(":"),
e=b.substr(0,d),h=JSROOT.parse(b.substr(d+1));this.syncDraw(!0).then(function(){return c.redrawPadSnap(h)}).then(function(){a.send("SNAPDONE:"+e);c.confirmDraw()})}else if("JSON"==b.substr(0,4))b=JSROOT.parse(b.substr(4)),this.redrawObject(b);else if("REPL_REQ:"==b.substr(0,9))this.processDrawableReply(b.substr(9));else if("CMD:"==b.substr(0,4)){b=b.substr(4);var g=b.indexOf(":");d=b.substr(0,g);b=b.substr(g+1);var k="REPLY:"+d+":";if("SVG"==b||"PNG"==b||"JPEG"==b)this.createImage(b.toLowerCase()).then(function(b){return a.send(k+
b)});else if(0==b.indexOf("ADDPANEL:"))if(b=b.substr(9),this.showUI5Panel){d=new JSROOT.WebWindowHandle(a.kind);d.setReceiver({cpainter:this,onWebsocketOpened:function(){},onWebsocketMsg:function(b,c){c=0==c.indexOf("SHOWPANEL:")?c.substr(10):"";this.cpainter.showUI5Panel(c,b).then(function(b){return a.send(k+(b?"true":"false"))})},onWebsocketClosed:function(){a.send(k+"false")},onWebsocketError:function(){a.send(k+"false")}});g=a.href;if(0==b.indexOf("../")){var l=g.lastIndexOf("/",g.length-2);g=
g.substr(0,l)+b.substr(2)}else g+=b;d.connect(g)}else a.send(k+"false");else console.log("Unrecognized command "+b),a.send(k)}else"DXPROJ:"==b.substr(0,7)||"DYPROJ:"==b.substr(0,7)?(d=b[1],b=JSROOT.parse(b.substr(7)),this.drawProjection(d,b)):"SHOW:"==b.substr(0,5)?(b=b.substr(5),d="1"==b[b.length-1],this.showSection(b.substr(0,b.length-2),d)):console.log("unrecognized msg len:"+b.length+" msg:"+b.substr(0,20))};q.prototype.submitDrawableRequest=function(a,b,c,d){if(!(this._websocket&&b&&b._typename&&
c.snapid)||"string"!=typeof c.snapid)return null;if(a&&d){c._requests||(c._requests={});var e=c._requests[a];if(e){var h=(new Date).getTime();if(!e._tm||5E3>h-e._tm)return e._nextreq=b,!1;delete c._requests[a]}c._requests[a]=b}b.id=c.snapid;d?(this._nextreqid||(this._nextreqid=1),b.reqid=this._nextreqid++):b.reqid=0;e=JSON.stringify(b);b.reqid&&(b._kind=a,b._painter=c,b._method=d,b._tm=(new Date).getTime(),this._submreq||(this._submreq={}),this._submreq[b.reqid]=b);this.sendWebsocket("REQ:"+e);return b};
q.prototype.submitMenuRequest=function(a,b,c){var d=this;return new Promise(function(e){d.submitDrawableRequest("",{_typename:"ROOT::Experimental::RDrawableMenuRequest",menukind:b||"",menureqid:c},a,e)})};q.prototype.submitExec=function(a,b,c){console.log("SubmitExec",b,a.snapid,c);if(this._websocket){if(c)if("x"==c||"y"==c||"z"==c)b=c+"axis#"+b;else return console.log("not recoginzed subelem "+c+" in SubmitExec");this.submitDrawableRequest("",{_typename:"ROOT::Experimental::RDrawableExecRequest",
exec:b},a)}};q.prototype.processDrawableReply=function(a){a=JSROOT.parse(a);if(!a||!a.reqid||!this._submreq)return!1;var b=this._submreq[a.reqid];if(!b)return!1;delete this._submreq[a.reqid];b._painter&&b._kind&&b._painter._requests&&b._painter._requests[b._kind]===b&&delete b._painter._requests[b._kind];b._method&&b._method(a,b);b._nextreq&&!b._painter._requests[b._kind]&&this.submitDrawableRequest(b._kind,b._nextreq,b._painter,b._method)};q.prototype.showSection=function(a,b){switch(a){case "ToolTips":this.setTooltipAllowed(b)}return Promise.resolve(!0)};
q.prototype.processChanges=function(a,b,c){if(this._websocket&&this._websocket.canSend(2)&&"string"===typeof a)switch(b||(b=this),a){case "sbits":console.log("Status bits in RCanvas are changed - that to do?");break;case "frame":case "zoom":console.log("Frame moved or zoom is changed - that to do?");break;case "pave_moved":console.log("TPave is moved inside RCanvas - that to do?");break;default:"exec:"==a.substr(0,5)&&b&&b.snapid?this.submitExec(b,a.substr(5),c):console.log("UNPROCESSED CHANGES",
a)}};q.prototype.clickPadButton=function(a,b){if("ToggleGed"==a)return this.activateGed(this,null,"toggle");if("ToggleStatus"==a)return this.activateStatusBar("toggle");m.prototype.clickPadButton.call(this,a,b)};q.prototype.hasEventStatus=function(){return this.testUI5()?!1:this.brlayout?this.brlayout.hasStatus():!1};q.prototype.activateStatusBar=function(a){this.testUI5()||(this.brlayout&&this.brlayout.createStatusLine(23,a),this.processChanges("sbits",this))};q.prototype.hasGed=function(){return this.testUI5()?
!1:this.brlayout?this.brlayout.hasContent():!1};q.prototype.removeGed=function(){this.testUI5()||(this.registerForPadEvents(null),this.ged_view&&(this.ged_view.getController().cleanupGed(),this.ged_view.destroy(),delete this.ged_view),this.brlayout&&this.brlayout.deleteContent(),this.processChanges("sbits",this))};q.prototype.activateGed=function(a,b,c){var d=this;if(this.testUI5()||!this.brlayout)return Promise.resolve(!1);if(this.brlayout.hasContent())return"toggle"===c||!1===c?this.removeGed():
(b=a?a.getPadPainter():null)&&b.selectObjectPainter(a),Promise.resolve(!0);if(!1===c)return Promise.resolve(!1);var f=this.brlayout.createBrowserBtns();JSROOT.require("interactive").then(function(a){a.ToolbarIcons.createSVG(f,a.ToolbarIcons.diamand,15,"toggle fix-pos mode").style("margin","3px").on("click",function(){return d.brlayout.toggleKind("fix")});a.ToolbarIcons.createSVG(f,a.ToolbarIcons.circle,15,"toggle float mode").style("margin","3px").on("click",function(){return d.brlayout.toggleKind("float")});
a.ToolbarIcons.createSVG(f,a.ToolbarIcons.cross,15,"delete GED").style("margin","3px").on("click",function(){return d.removeGed()})});this.brlayout.setBrowserContent("<div class='jsroot_browser_hierarchy' id='ged_placeholder'>Loading GED ...</div>");this.brlayout.setBrowserTitle("GED");this.brlayout.toggleBrowserKind(b||"float");return new Promise(function(b){JSROOT.require("openui5").then(function(){e.select("#ged_placeholder").text("");sap.ui.define(["sap/ui/model/json/JSONModel","sap/ui/core/mvc/XMLView"],
function(c,e){var f=new c({handle:null});e.create({viewName:"rootui5.canv.view.Ged"}).then(function(c){c.setModel(f);c.placeAt("ged_placeholder");d.ged_view=c;d.registerForPadEvents(c.getController().padEventsReceiver.bind(c.getController()));(c=a?a.getPadPainter():null)&&c.selectObjectPainter(a);d.processChanges("sbits",d);b(!0)})})})})};q.prototype.produceJSON=function(){console.error("RCanvasPainter.produceJSON not yet implemented");return""};w.prototype=Object.create(JSROOT.ObjectPainter.prototype);
w.prototype.drawContent=function(){return Promise.resolve(this)};w.prototype.drawPave=function(){var a=this,b=this.getPadPainter().getPadRect(),c=this.getFramePainter();this.onFrame=c&&this.v7EvalAttr("onFrame",!0);this.corner=this.v7EvalAttr("corner",2);var d=this.v7EvalAttr("visible",!0),e=this.v7EvalLength("offsetX",b.width,.02),g=this.v7EvalLength("offsetY",b.height,.02),k=this.v7EvalLength("width",b.width,.3),l=this.v7EvalLength("height",b.height,.3);this.createG();this.draw_g.classed("most_upper_primitives",
!0);if(!d)return Promise.resolve(this);this.createv7AttLine("border_");this.createv7AttFill();var n=d=0;b=this.onFrame?c.getFrameRect():b;switch(this.corner){case 1:d=b.x+e;n=b.y+g;break;case 3:d=b.x+e;n=b.y+b.height-g-l;break;case 4:d=b.x+b.width-e-k;n=b.y+b.height-g-l;break;default:d=b.x+b.width-e-k,n=b.y+g}this.draw_g.attr("transform","translate("+d+","+n+")").attr("x",d).attr("y",n).attr("width",k).attr("height",l);this.draw_g.append("svg:rect").attr("x",0).attr("width",k).attr("y",0).attr("height",
l).call(this.lineatt.func).call(this.fillatt.func);this.pave_width=k;this.pave_height=l;return this.drawContent().then(function(){return JSROOT.batch_mode?a:JSROOT.require(["interactive"]).then(function(b){if(JSROOT.settings.ContextMenu&&a.paveContextMenu)a.draw_g.on("contextmenu",function(b){return a.paveContextMenu(b)});b.addDragHandler(a,{minwidth:20,minheight:20,redraw:a.sizeChanged.bind(a)});return a})})};w.prototype.sizeChanged=function(){this.pave_width=parseInt(this.draw_g.attr("width"));
this.pave_height=parseInt(this.draw_g.attr("height"));var a=parseInt(this.draw_g.attr("x")),b=parseInt(this.draw_g.attr("y")),c=this.getPadPainter().getPadRect(),d=this.onFrame?this.getFramePainter().getFrameRect():c,e={};switch(this.corner){case 1:a-=d.x;b-=d.y;break;case 3:a-=d.x;b=d.y+d.height-b-this.pave_height;break;case 4:a=d.x+d.width-a-this.pave_width;b=d.y+d.height-b-this.pave_height;break;default:a=d.x+d.width-a-this.pave_width,b-=d.y}this.v7AttrChange(e,"offsetX",a/c.width);this.v7AttrChange(e,
"offsetY",b/c.height);this.v7AttrChange(e,"width",this.pave_width/c.width);this.v7AttrChange(e,"height",this.pave_height/c.height);this.v7SendAttrChanges(e,!1);this.draw_g.select("rect").attr("width",this.pave_width).attr("height",this.pave_height);this.drawContent()};w.prototype.redraw=function(){this.drawPave()};var J=function(a,b,c){var d=new w(a,b,c);return g.ensureRCanvas(d,!1).then(function(){return d.drawPave()})};JSROOT.v7.extractRColor=function(a){return a.fColor||"black"};JSROOT.registerMethods("ROOT::Experimental::RPalette",
{getColor:function(a){return this.palette[a]},getContourIndex:function(a){var b=this.fContour,c=0,d=b.length-1;if(a<b[0])return-1;if(a>=b[d])return d-1;if(this.fCustomContour){for(;c<d-1;){var e=Math.round((c+d)/2);b[e]>a?d=e:c=e}return c}return Math.floor((a-b[0])/(b[d-1]-b[0])*(d-1))},getContourColor:function(a){a=this.getContourIndex(a);return 0>a?"":this.getColor(a)},getContour:function(){return this.fContour&&1<this.fContour.length?this.fContour:null},deleteContour:function(){delete this.fContour},
calcColor:function(a,b,c){var d=c.fOrdinal-b.fOrdinal,f=c.fOrdinal-a;a-=b.fOrdinal;if(!this.fInterpolate||0>=d)return f<a?c.fColor:b.fColor;b=e.rgb(JSROOT.v7.extractRColor(b.fColor));c=e.rgb(JSROOT.v7.extractRColor(c.fColor));return e.rgb(Math.round((b.r*f+c.r*a)/d),Math.round((b.g*f+c.g*a)/d),Math.round((b.b*f+c.b*a)/d)).toString()},createPaletteColors:function(a){for(var b=[],c=0;b.length<a;){var d=b.length/(a-1),e=this.fColors[c];if(1E-4>Math.abs(e.fOrdinal-d)||c==this.fColors.length-1)b.push(JSROOT.v7.extractRColor(e.fColor));
else{var g=this.fColors[c+1];g.fOrdinal<=d?c++:b.push(this.calcColor(d,e,g))}}return b},getColorOrdinal:function(a){if(!this.fColors)return"black";"number"!=typeof a||0>a?a=0:1<a&&(a=1);for(var b,c=this.fColors[0],d=0;d<this.fColors.length-1;++d){b=c;if(1E-4>Math.abs(b.fOrdinal-a))return JSROOT.v7.extractRColor(b.fColor);c=this.fColors[d+1];if(c.fOrdinal>a)return this.calcColor(a,b,c)}return JSROOT.v7.extractRColor(c.fColor)},setFullRange:function(a,b){this.full_min=a;this.full_max=b},createContour:function(a,
b,c,d,e){this.fContour=[];delete this.fCustomContour;this.colzmin=c;this.colzmax=d;if(a){0>=this.colzmax&&(this.colzmax=1);0>=this.colzmin&&(this.colzmin=void 0===e||0>=e?1E-4*this.colzmax:3>e||100<e?.3*e:1);this.colzmin>=this.colzmax&&(this.colzmin=1E-4*this.colzmax);a=Math.log(this.colzmin)/Math.log(10);c=(Math.log(this.colzmax)/Math.log(10)-a)/b;this.fContour.push(this.colzmin);for(d=1;d<b;d++)this.fContour.push(Math.exp((a+c*d)*Math.log(10)));this.fContour.push(this.colzmax);this.fCustomContour=
!0}else for(this.colzmin===this.colzmax&&0!==this.colzmin&&(this.colzmax+=.01*Math.abs(this.colzmax),this.colzmin-=.01*Math.abs(this.colzmin)),a=(this.colzmax-this.colzmin)/b,c=0;c<=b;c++)this.fContour.push(this.colzmin+a*c);this.palette&&this.palette.length==b||(this.palette=this.createPaletteColors(b))}});C.prototype=Object.create(JSROOT.ObjectPainter.prototype);C.prototype.getHistPalette=function(){var a=this.getObject();(a=a?a.fPalette:null)&&!a.getColor&&JSROOT.addMethods(a,"ROOT::Experimental::RPalette");
return a};C.prototype.drawPalette=function(a){var b=this,c=this.getHistPalette(),d=c.getContour(),f=this.getFramePainter();if(!d)return console.log("no contour - no palette");if(!f)return console.log("no frame painter - no palette");var h=c.full_min,k=c.full_max,l=d[0],n=d[d.length-1],m=f.getFrameRect(),p=m.x,q=m.y,w=m.width,A=m.height;m=this.getPadPainter().getPadWidth();var C=this.v7EvalAttr("visible",!0);if(a){var B=parseInt(this.draw_g.attr("width"));var y=parseInt(this.draw_g.attr("height"));
q={};this.v7AttrChange(q,"margin",(parseInt(this.draw_g.attr("x"))-p-w)/m);this.v7AttrChange(q,"size",B/m);this.v7SendAttrChanges(q,!1)}else{var D=this.v7EvalLength("margin",m,.02);p=Math.round(p+w+D);B=this.v7EvalLength("width",m,.05);y=A;this.draw_g.attr("transform","translate("+p+","+q+")").attr("x",p).attr("y",q).attr("width",B).attr("height",y)}this.draw_g.selectAll("rect").remove();if(C){var x=this.draw_g.select(".colbtns");x.empty()?x=this.draw_g.append("svg:g").attr("class","colbtns"):x.selectAll().remove();
x.append("svg:rect").attr("x",0).attr("width",B).attr("y",0).attr("height",y).style("stroke","black").attr("fill","none");if(void 0===h||void 0===k)h=l,k=n;f.z_handle.configureAxis("zaxis",h,k,l,n,!0,[y,0],-y,{reverse:!1});for(h=0;h<d.length-1;++h)if(k=f.z_handle.gr(d[h]),l=f.z_handle.gr(d[h+1]),n=c.getContourColor((d[h]+d[h+1])/2),k=x.append("svg:rect").attr("x",0).attr("y",Math.round(l)).attr("width",B).attr("height",Math.round(k)-Math.round(l)).style("fill",n).style("stroke",n).property("fill0",
n).property("fill1",e.rgb(n).darker(.5).toString()),this.isTooltipAllowed()&&k.on("mouseover",function(){e.select(this).transition().duration(100).style("fill",e.select(this).property("fill1"))}).on("mouseout",function(){e.select(this).transition().duration(100).style("fill",e.select(this).property("fill0"))}).append("svg:title").text(d[h].toFixed(2)+" - "+d[h+1].toFixed(2)),JSROOT.settings.Zooming)k.on("dblclick",function(){return f.unzoom("z")});f.z_handle.max_tick_size=Math.round(.3*B);c=f.z_handle.drawAxis(this.draw_g,
"translate("+B+","+y+")",-1);JSROOT.batch_mode||c.then(function(){return JSROOT.require(["interactive"])}).then(function(c){if(JSROOT.settings.ContextMenu)b.draw_g.on("contextmenu",function(a){a.stopPropagation();a.preventDefault();g.createMenu(a,b).then(function(a){a.add("header:Palette");f.z_handle.fillAxisContextMenu(a,"z");a.show()})});a||c.addDragHandler(b,{minwidth:20,minheight:20,no_change_y:!0,redraw:b.drawPalette.bind(b,!0)});if(JSROOT.settings.Zooming){var d=!1,h=0,k=0,l,m,n,p,q=function(a){if(d){a.preventDefault();
p=e.pointer(a,b.draw_g.node());if(n)return f.z_handle.processLabelsMove("move",p);k=Math.min(Math.max(p[1],0),y);a=Math.abs(k-h);!m&&1<a&&(l.style("display",null),m=!0);l.attr("y",Math.min(h,k)).attr("height",a)}},r=function(a){if(d)if(a.preventDefault(),e.select(window).on("mousemove.colzoomRect",null).on("mouseup.colzoomRect",null),l.remove(),l=null,d=!1,n)f.z_handle.processLabelsMove("stop",p);else{var c=f.z_handle.func;a=c.invert(h);c=c.invert(k);b.getFramePainter().zoom("z",Math.min(a,c),Math.max(a,
c))}},t=function(a){d||(d=!0,a.preventDefault(),a.stopPropagation(),p=e.pointer(a,b.draw_g.node()),h=k=p[1],n=m=!1,l=x.append("svg:rect").attr("class","zoom").attr("id","colzoomRect").attr("x","0").attr("width",B).attr("y",h).attr("height",1).style("display","none"),e.select(window).on("mousemove.colzoomRect",q).on("mouseup.colzoomRect",r,!0),setTimeout(function(){!m&&d&&(n=f.z_handle.processLabelsMove("start",p))},500))};c=function(){b.draw_g.selectAll(".axis_zoom, .axis_labels").on("mousedown",
t).on("dblclick",function(){return f.unzoom("z")});if(JSROOT.settings.ZoomWheel)b.draw_g.on("wheel",function(a){a.stopPropagation();a.preventDefault();var c=1-e.pointer(a,b.draw_g.node())[1]/y;a=f.z_handle.analyzeWheelEvent(a,c);a.changed&&f.zoom("z",a.min,a.max)})};f.z_handle.setAfterDrawHandler(c);c()}})}};g.addDrawFunc({name:"ROOT::Experimental::RHist1Drawable",icon:"img_histo1d",prereq:"v7hist",func:"JSROOT.v7.drawHist1",opt:""});g.addDrawFunc({name:"ROOT::Experimental::RHist2Drawable",icon:"img_histo2d",
prereq:"v7hist",func:"JSROOT.v7.drawHist2",opt:""});g.addDrawFunc({name:"ROOT::Experimental::RHist3Drawable",icon:"img_histo3d",prereq:"v7hist3d",func:"JSROOT.v7.drawHist3",opt:""});g.addDrawFunc({name:"ROOT::Experimental::RHistDisplayItem",icon:"img_histo1d",prereq:"v7hist",func:"JSROOT.v7.drawHistDisplayItem",opt:""});g.addDrawFunc({name:"ROOT::Experimental::RText",icon:"img_text",prereq:"v7more",func:"JSROOT.v7.drawText",opt:"",direct:"v7",csstype:"text"});g.addDrawFunc({name:"ROOT::Experimental::RFrameTitle",
icon:"img_text",func:A,opt:"",direct:"v7",csstype:"title"});g.addDrawFunc({name:"ROOT::Experimental::RPaletteDrawable",icon:"img_text",func:function(a,b){var c=new C(a,b);return g.ensureRCanvas(c,!1).then(function(){c.createG();return c})},opt:""});g.addDrawFunc({name:"ROOT::Experimental::RDisplayHistStat",icon:"img_pavetext",prereq:"v7hist",func:"JSROOT.v7.drawHistStats",opt:""});g.addDrawFunc({name:"ROOT::Experimental::RLine",icon:"img_graph",prereq:"v7more",func:"JSROOT.v7.drawLine",opt:"",direct:"v7",
csstype:"line"});g.addDrawFunc({name:"ROOT::Experimental::RBox",icon:"img_graph",prereq:"v7more",func:"JSROOT.v7.drawBox",opt:"",direct:"v7",csstype:"box"});g.addDrawFunc({name:"ROOT::Experimental::RMarker",icon:"img_graph",prereq:"v7more",func:"JSROOT.v7.drawMarker",opt:"",direct:"v7",csstype:"marker"});g.addDrawFunc({name:"ROOT::Experimental::RPave",icon:"img_pavetext",func:J,opt:""});g.addDrawFunc({name:"ROOT::Experimental::RLegend",icon:"img_graph",prereq:"v7more",func:"JSROOT.v7.drawLegend",
opt:""});g.addDrawFunc({name:"ROOT::Experimental::RPaveText",icon:"img_pavetext",prereq:"v7more",func:"JSROOT.v7.drawPaveText",opt:""});g.addDrawFunc({name:"ROOT::Experimental::RFrame",icon:"img_frame",func:p,opt:""});g.addDrawFunc({name:"ROOT::Experimental::RFont",icon:"img_text",func:I,opt:"",direct:"v7",csstype:"font"});g.addDrawFunc({name:"ROOT::Experimental::RAxisDrawable",icon:"img_frame",func:H,opt:""});JSROOT.v7.RAxisPainter=k;JSROOT.v7.RFramePainter=l;JSROOT.v7.RPalettePainter=C;JSROOT.v7.RPadPainter=
m;JSROOT.v7.RCanvasPainter=q;JSROOT.v7.RPavePainter=w;JSROOT.v7.drawRAxis=H;JSROOT.v7.drawRFrame=p;JSROOT.v7.drawRFont=I;JSROOT.v7.drawPad=function(a,b,c){var d=new m(a,b,!1);d.decodeOptions(c);d.getCanvSvg().empty()?(d.has_canvas=!1,d.this_pad_name="",d.setTopPainter()):d.addToPadPrimitives(d.pad_name);d.createPadSvg();!d.matchObjectType("TPad")||d.has_canvas&&!d.hasObjectsToDraw()||d.addPadButtons();var e=d.has_canvas?d.selectCurrentPad(d.this_pad_name):void 0;g.selectActivePad({pp:d,active:!1});
return d.drawPrimitives().then(function(){d.showPadButtons();d.selectCurrentPad(e);return d})};JSROOT.v7.drawRCanvas=G;JSROOT.v7.drawPadSnapshot=function(a,b){var c=new q(a,null);c.normal_canvas=!1;c.batch_mode=JSROOT.batch_mode;return c.syncDraw(!0).then(function(){return c.redrawPadSnap(b)}).then(function(){c.confirmDraw();c.showPadButtons();return c})};JSROOT.v7.drawPave=J;JSROOT.v7.drawRFrameTitle=A;g.ensureRCanvas=function(a,b){return a?(a.getCanvSvg().empty()?G(a.getDom(),null):Promise.resolve(!0)).then(function(){if(!1!==
b&&a.getFrameSvg().select(".main_layer").empty())return p(a.getDom(),null,"string"===typeof b?b:"")}).then(function(){a.addToPadPrimitives();return a}):Promise.reject("Painter not provided in ensureRCanvas")};return JSROOT});
