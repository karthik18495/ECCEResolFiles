var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(h){var p=0;return function(){return p<h.length?{done:!1,value:h[p++]}:{done:!0}}};$jscomp.arrayIterator=function(h){return{next:$jscomp.arrayIteratorImpl(h)}};$jscomp.makeIterator=function(h){var p="undefined"!=typeof Symbol&&Symbol.iterator&&h[Symbol.iterator];return p?p.call(h):$jscomp.arrayIterator(h)};
$jscomp.getGlobal=function(h){return"undefined"!=typeof window&&window===h?h:"undefined"!=typeof global&&null!=global?global:h};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(h,p,A){h!=Array.prototype&&h!=Object.prototype&&(h[p]=A.value)};
$jscomp.polyfill=function(h,p,A,H){if(p){A=$jscomp.global;h=h.split(".");for(H=0;H<h.length-1;H++){var B=h[H];B in A||(A[B]={});A=A[B]}h=h[h.length-1];H=A[h];p=p(H);p!=H&&null!=p&&$jscomp.defineProperty(A,h,{configurable:!0,writable:!0,value:p})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(h){function p(){this.batch_=null}function A(h){return h instanceof B?h:new B(function(p,G){p(h)})}if(h&&!$jscomp.FORCE_POLYFILL_PROMISE)return h;p.prototype.asyncExecute=function(h){if(null==this.batch_){this.batch_=[];var p=this;this.asyncExecuteFunction(function(){p.executeBatch_()})}this.batch_.push(h)};var H=$jscomp.global.setTimeout;p.prototype.asyncExecuteFunction=function(h){H(h,0)};p.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var h=
this.batch_;this.batch_=[];for(var p=0;p<h.length;++p){var y=h[p];h[p]=null;try{y()}catch(I){this.asyncThrow_(I)}}}this.batch_=null};p.prototype.asyncThrow_=function(h){this.asyncExecuteFunction(function(){throw h;})};var B=function(h){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var p=this.createResolveAndReject_();try{h(p.resolve,p.reject)}catch(Q){p.reject(Q)}};B.prototype.createResolveAndReject_=function(){function h(h){return function(G){y||(y=!0,h.call(p,G))}}var p=this,y=!1;
return{resolve:h(this.resolveTo_),reject:h(this.reject_)}};B.prototype.resolveTo_=function(h){if(h===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(h instanceof B)this.settleSameAsPromise_(h);else{a:switch(typeof h){case "object":var p=null!=h;break a;case "function":p=!0;break a;default:p=!1}p?this.resolveToNonPromiseObj_(h):this.fulfill_(h)}};B.prototype.resolveToNonPromiseObj_=function(h){var p=void 0;try{p=h.then}catch(Q){this.reject_(Q);return}"function"==typeof p?
this.settleSameAsThenable_(p,h):this.fulfill_(h)};B.prototype.reject_=function(h){this.settle_(2,h)};B.prototype.fulfill_=function(h){this.settle_(1,h)};B.prototype.settle_=function(h,p){if(0!=this.state_)throw Error("Cannot settle("+h+", "+p+"): Promise already settled in state"+this.state_);this.state_=h;this.result_=p;this.executeOnSettledCallbacks_()};B.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var h=0;h<this.onSettledCallbacks_.length;++h)y.asyncExecute(this.onSettledCallbacks_[h]);
this.onSettledCallbacks_=null}};var y=new p;B.prototype.settleSameAsPromise_=function(h){var p=this.createResolveAndReject_();h.callWhenSettled_(p.resolve,p.reject)};B.prototype.settleSameAsThenable_=function(h,p){var y=this.createResolveAndReject_();try{h.call(p,y.resolve,y.reject)}catch(I){y.reject(I)}};B.prototype.then=function(h,p){function y(h,p){return"function"==typeof h?function(p){try{A(h(p))}catch(a){E(a)}}:p}var A,E,G=new B(function(h,p){A=h;E=p});this.callWhenSettled_(y(h,A),y(p,E));return G};
B.prototype.catch=function(h){return this.then(void 0,h)};B.prototype.callWhenSettled_=function(h,p){function A(){switch(E.state_){case 1:h(E.result_);break;case 2:p(E.result_);break;default:throw Error("Unexpected state: "+E.state_);}}var E=this;null==this.onSettledCallbacks_?y.asyncExecute(A):this.onSettledCallbacks_.push(A)};B.resolve=A;B.reject=function(h){return new B(function(p,y){y(h)})};B.race=function(h){return new B(function(p,y){for(var E=$jscomp.makeIterator(h),B=E.next();!B.done;B=E.next())A(B.value).callWhenSettled_(p,
y)})};B.all=function(h){var p=$jscomp.makeIterator(h),y=p.next();return y.done?A([]):new B(function(h,E){function B(p){return function(a){G[p]=a;H--;0==H&&h(G)}}var G=[],H=0;do G.push(void 0),H++,A(y.value).callWhenSettled_(B(G.length-1),E),y=p.next();while(!y.done)})};return B},"es6","es3");$jscomp.polyfill("Math.log10",function(h){return h?h:function(h){return Math.log(h)/Math.LN10}},"es6","es3");
$jscomp.polyfill("Number.isFinite",function(h){return h?h:function(h){return"number"!==typeof h?!1:!isNaN(h)&&Infinity!==h&&-Infinity!==h}},"es6","es3");$jscomp.polyfill("Number.isInteger",function(h){return h?h:function(h){return Number.isFinite(h)?h===Math.floor(h):!1}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(h,p){this.$jscomp$symbol$id_=h;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:p})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function h(A){if(this instanceof h)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(A||"")+"_"+p++,A)}var p=0;return h}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var h=$jscomp.global.Symbol.iterator;h||(h=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[h]&&$jscomp.defineProperty(Array.prototype,h,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var h=$jscomp.global.Symbol.asyncIterator;h||(h=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(h){$jscomp.initSymbolIterator();h={next:h};h[$jscomp.global.Symbol.iterator]=function(){return this};return h};
$jscomp.iteratorFromArray=function(h,p){$jscomp.initSymbolIterator();h instanceof String&&(h+="");var A=0,H={next:function(){if(A<h.length){var B=A++;return{value:p(B,h[B]),done:!1}}H.next=function(){return{done:!0,value:void 0}};return H.next()}};H[Symbol.iterator]=function(){return H};return H};$jscomp.polyfill("Array.prototype.entries",function(h){return h?h:function(){return $jscomp.iteratorFromArray(this,function(h,A){return[h,A]})}},"es6","es3");
JSROOT.define(["d3","painter","gpad"],function(h,p){function A(a,d){JSROOT.ObjectPainter.call(this,a,d);this.UseContextMenu=this.Enabled=!0;this.UseTextColor=!1}function H(){this.reset()}function B(a,d){this.arr=[];this.colzmin=a;this.colzmax=d;this.below_min_indx=-1;this.exact_min_indx=0}function y(a,d){JSROOT.ObjectPainter.call(this,a,d);this.draw_content=!0;this.nbinsy=this.nbinsx=0;this.accept_drops=!0;this.mode3d=!1;this.hist_painter_id=JSROOT._.id_counter++}function G(a,d){y.call(this,a,d)}
function E(a,d){y.call(this,a,d);this.fPalette=null;this.wheel_zoomy=!0}function Q(a,d,b){var c=0,f=0,e=0;d||(c=a.fSave.length,f=Math.round(a.fSave[c-2]),e=Math.round(a.fSave[c-1]),c!==(f+1)*(e+1)+6&&(c=0));if(6<c){d=(a.fSave[c-5]-a.fSave[c-6])/f/2;var g=(a.fSave[c-3]-a.fSave[c-4])/e/2;b||(b=JSROOT.createHistogram("TH2F",f+1,e+1));b.fXaxis.fXmin=a.fSave[c-6]-d;b.fXaxis.fXmax=a.fSave[c-5]+d;b.fYaxis.fXmin=a.fSave[c-4]-g;b.fYaxis.fXmax=a.fSave[c-3]+g;for(d=c=0;d<=e;++d)for(g=0;g<=f;++g)b.setBinContent(b.getBin(g+
1,d+1),a.fSave[c++])}else for(f=Math.max(a.fNpx,2),e=Math.max(a.fNpy,2),b||(b=JSROOT.createHistogram("TH2F",f,e)),b.fXaxis.fXmin=a.fXmin,b.fXaxis.fXmax=a.fXmax,b.fYaxis.fXmin=a.fYmin,b.fYaxis.fXmax=a.fYmax,c=0;c<e;++c)for(d=0;d<f;++d){g=a.fXmin+(d+.5)*(a.fXmax-a.fXmin)/f;var k=a.fYmin+(c+.5)*(a.fYmax-a.fYmin)/e;b.setBinContent(b.getBin(d+1,c+1),a.evalPar(g,k))}b.fName="Func";b.fTitle=a.fTitle;b.fMinimum=a.fMinimum;b.fMaximum=a.fMaximum;b.fLineColor=a.fLineColor;b.fLineStyle=a.fLineStyle;b.fLineWidth=
a.fLineWidth;b.fFillColor=a.fFillColor;b.fFillStyle=a.fFillStyle;b.fMarkerColor=a.fMarkerColor;b.fMarkerStyle=a.fMarkerStyle;b.fMarkerSize=a.fMarkerSize;b.fBits|=J.kNoStats;return b}function I(a,d,b){JSROOT.ObjectPainter.call(this,a,d,b);this.firstpainter=null;this.painters=[]}var ba=function(){for(var a=function(a,b,c){0>c&&(c+=1);1<c&&--c;return c<1/6?a+6*(b-a)*c:.5>c?b:c<2/3?a+(b-a)*(2/3-c)*6:a},d=function(b,c,d){d=.5>c?c*(1+d):c+d-c*d;var e=2*c-d;c=a(e,d,b+1/3);var f=a(e,d,b);b=a(e,d,b-1/3);return"rgb("+
Math.round(255*c)+","+Math.round(255*f)+","+Math.round(255*b)+")"},b=[],c=0;50>c;++c)b.push(d((280-5.6*(c+1))/360,.5,1));return new JSROOT.ColorPalette(b)},da=function(a){a=a||JSROOT.settings.Palette;if(0<a&&10>a){var d=[];for(a=0;50>a;++a){var b=Math.round((a+2)/60*255);d.push("rgb("+b+","+b+","+b+")")}return new JSROOT.ColorPalette(d)}if(51>a)return ba();113<a&&(a=57);d=[0,.125,.25,.375,.5,.625,.75,.875,1];switch(a){case 51:var c=[[0,9,13,17,24,32,27,25,29],[0,0,0,2,37,74,113,160,221],[28,42,59,
78,98,129,154,184,221]];break;case 52:c=[[0,32,64,96,128,160,192,224,255],[0,32,64,96,128,160,192,224,255],[0,32,64,96,128,160,192,224,255]];break;case 53:c=[[0,45,99,156,212,230,237,234,242],[0,0,0,45,101,168,238,238,243],[0,1,1,3,9,8,11,95,230]];break;case 54:c=[[0,22,44,68,93,124,160,192,237],[0,16,41,67,93,125,162,194,241],[97,100,99,99,93,68,44,26,74]];break;case 55:c=[[0,5,15,35,102,196,208,199,110],[0,48,124,192,206,226,97,16,0],[99,142,198,201,90,22,13,8,2]];break;case 56:c=[[242,234,237,
230,212,156,99,45,0],[243,238,238,168,101,45,0,0,0],[230,95,11,8,9,3,1,1,0]];break;case 57:c=[[53.091,15.096,19.89,5.916,45.951,135.1755,208.743,253.878,248.982],[42.432,91.7745,128.5455,163.6845,183.039,191.046,186.864,200.481,250.716],[134.9715,221.442,213.8175,201.807,163.8375,118.881,89.2245,50.184,13.7445]];break;case 58:c=[[0,24,2,54,176,236,202,194,255],[0,29,92,129,117,120,176,236,255],[0,68,80,34,57,172,252,245,255]];break;case 59:c=[[13,23,25,63,76,104,137,161,206],[95,67,37,21,0,12,35,
52,79],[4,3,2,6,11,22,49,98,208]];break;case 60:c=[[0,61,89,122,143,160,185,204,231],[0,0,0,0,14,37,72,132,235],[0,140,224,144,4,5,6,9,13]];break;case 61:c=[[14,7,2,0,5,11,55,131,229],[105,56,26,1,42,74,131,171,229],[2,21,35,60,92,113,160,185,229]];break;case 62:c=[[0,0,0,70,148,231,235,237,244],[0,0,0,0,0,69,67,216,244],[0,102,228,231,177,124,137,20,244]];break;case 63:c=[[50,56,63,68,93,121,165,192,241],[66,81,91,96,111,128,155,189,241],[97,91,75,65,77,103,143,167,217]];break;case 64:c=[[145,166,
167,156,131,114,101,112,132],[158,178,179,181,163,154,144,152,159],[190,199,201,192,176,169,160,166,190]];break;case 65:c=[[93,91,99,108,130,125,132,155,174],[126,124,128,129,131,121,119,153,173],[103,94,87,85,80,85,107,120,146]];break;case 66:c=[[24,40,69,90,104,114,120,132,103],[29,52,94,127,150,162,159,151,101],[29,52,96,132,162,181,184,186,131]];break;case 67:c=[[46,38,61,92,113,121,132,150,191],[46,36,40,69,110,135,131,92,34],[46,80,74,70,81,105,165,211,225]];break;case 68:c=[[0,4,12,30,52,101,
142,190,237],[0,40,86,121,140,172,187,213,240],[0,9,14,18,21,23,27,35,101]];break;case 69:c=[[198,206,206,211,198,181,161,171,244],[103,133,150,172,178,174,163,175,244],[49,54,55,66,91,130,184,224,244]];break;case 70:c=[[243,243,240,240,241,239,186,151,129],[0,46,99,149,194,220,183,166,147],[6,8,36,91,169,235,246,240,233]];break;case 71:c=[[22,19,19,25,35,53,88,139,210],[0,32,69,108,135,159,183,198,215],[77,96,110,116,110,100,90,78,70]];break;case 72:c=[[68,116,165,182,189,180,145,111,71],[37,82,
135,178,204,225,221,202,147],[16,55,105,147,196,226,232,224,178]];break;case 73:c=[[61,99,136,181,213,225,198,136,24],[149,140,96,83,132,178,190,135,22],[214,203,168,135,110,100,111,113,22]];break;case 74:c=[[76,120,156,183,197,180,162,154,140],[34,35,42,69,102,137,164,188,197],[64,69,78,105,142,177,205,217,198]];break;case 75:c=[[37,102,157,188,196,214,223,235,251],[37,29,25,37,67,91,132,185,251],[37,32,33,45,66,98,137,187,251]];break;case 76:c=[[79,100,119,137,153,172,192,205,250],[63,79,93,103,
115,135,167,196,250],[51,59,66,61,62,70,110,160,250]];break;case 77:c=[[43,44,50,66,125,172,178,155,157],[63,63,85,101,138,163,122,51,39],[121,101,58,44,47,55,57,44,43]];break;case 78:c=[[0,41,62,79,90,87,99,140,228],[0,57,81,93,85,70,71,125,228],[95,91,91,82,60,43,44,112,228]];break;case 79:c=[[49,59,72,88,114,141,176,205,222],[78,72,66,57,59,75,106,142,173],[78,55,46,40,39,39,40,41,47]];break;case 80:c=[[243,222,201,185,165,158,166,187,219],[94,108,132,135,125,96,68,51,61],[7,9,12,19,45,89,118,
146,118]];break;case 81:c=[[19,44,74,105,137,166,194,206,220],[19,28,40,55,82,110,159,181,220],[19,42,68,96,129,157,188,203,220]];break;case 82:c=[[33,44,70,99,140,165,199,211,216],[38,50,76,105,140,165,191,189,167],[55,67,97,124,140,166,163,129,52]];break;case 83:c=[[0,33,73,124,136,152,159,171,223],[0,43,92,124,134,126,121,144,223],[0,43,68,76,73,64,72,114,223]];break;case 84:c=[[5,18,45,124,193,223,205,128,49],[48,134,207,230,193,113,28,0,7],[6,15,41,121,193,226,208,130,49]];break;case 85:c=[[180,
106,104,135,164,188,189,165,144],[72,126,154,184,198,207,205,190,179],[41,120,158,188,194,181,145,100,62]];break;case 86:c=[[57,72,94,117,136,154,174,192,215],[0,33,68,109,140,171,192,196,209],[116,137,173,201,200,201,203,190,187]];break;case 87:c=[[31,71,123,160,210,222,214,199,183],[40,117,171,211,231,220,190,132,65],[234,214,228,222,210,160,105,60,34]];break;case 88:c=[[123,108,109,126,154,172,188,196,218],[184,138,130,133,154,175,188,196,218],[208,130,109,99,110,122,150,171,218]];break;case 89:c=
[[105,106,122,143,159,172,176,181,207],[252,197,194,187,174,162,153,136,125],[146,133,144,155,163,167,166,162,174]];break;case 90:c=[[171,141,145,152,154,159,163,158,177],[236,143,100,63,53,55,44,31,6],[59,48,46,44,42,54,82,112,179]];break;case 91:c=[[180,190,209,223,204,228,205,152,91],[93,125,147,172,181,224,233,198,158],[236,218,160,133,114,132,162,220,218]];break;case 92:c=[[225,183,162,135,115,111,119,145,211],[205,177,166,135,124,117,117,132,172],[186,165,155,135,126,130,150,178,226]];break;
case 93:c=[[39,43,59,63,80,116,153,177,223],[39,43,59,74,91,114,139,165,223],[39,50,59,70,85,115,151,176,223]];break;case 94:c=[[0,38,60,76,84,89,101,128,204],[0,10,15,23,35,57,83,123,199],[0,11,22,40,63,86,97,94,85]];break;case 95:c=[[94,112,141,165,167,140,91,49,27],[27,46,88,135,166,161,135,97,58],[42,52,81,106,139,158,155,137,116]];break;case 96:c=[[30,49,79,117,135,151,146,138,147],[63,60,72,90,94,94,68,46,16],[18,28,41,56,62,63,50,36,21]];break;case 97:c=[[0,30,63,101,143,152,169,187,230],[0,
14,28,42,58,61,67,74,91],[39,26,21,18,15,14,14,13,13]];break;case 98:c=[[149,140,164,179,182,181,131,87,61],[62,70,107,136,144,138,117,87,74],[40,38,45,49,49,49,38,32,34]];break;case 99:c=[[99,112,148,165,179,182,183,183,208],[39,40,57,79,104,127,148,161,198],[15,16,18,33,51,79,103,129,177]];break;case 100:c=[[99,116,154,174,200,196,201,201,230],[0,0,8,32,58,83,119,136,173],[5,6,7,9,9,14,17,19,24]];break;case 101:c=[[82,106,126,141,155,163,142,107,66],[62,44,69,107,135,152,149,132,119],[39,25,31,
60,73,68,49,72,188]];break;case 102:c=[[18,29,44,72,116,158,184,208,221],[27,46,71,105,146,177,189,190,183],[39,55,80,108,130,133,124,100,76]];break;case 103:c=[[0,48,119,173,212,224,228,228,245],[0,13,30,47,79,127,167,205,245],[0,68,75,43,16,22,55,128,245]];break;case 104:c=[[34,70,129,187,225,226,216,193,179],[48,91,147,194,226,229,196,110,12],[234,212,216,224,206,110,53,40,29]];break;case 105:c=[[30,55,103,147,174,203,188,151,105],[0,65,138,182,187,175,121,53,9],[191,202,212,208,171,140,97,57,
30]];break;case 106:c=[[112,97,113,125,138,159,178,188,225],[16,17,24,37,56,81,110,136,189],[38,35,46,59,78,103,130,152,201]];break;case 107:c=[[18,72,5,23,29,201,200,98,29],[0,0,43,167,211,117,0,0,0],[51,203,177,26,10,9,8,3,0]];break;case 108:c=[[19,42,64,88,118,147,175,187,205],[19,55,89,125,154,169,161,129,70],[19,32,47,70,100,128,145,130,75]];break;case 109:c=[[33,31,42,68,86,111,141,172,227],[255,175,145,106,88,55,15,0,0],[255,205,202,203,208,205,203,206,231]];break;case 110:c=[[0,25,50,79,110,
145,181,201,254],[0,16,30,46,63,82,101,124,179],[0,12,21,29,39,49,61,74,103]];break;case 111:c=[[0,13,30,44,72,120,156,200,247],[0,36,84,117,141,153,151,158,247],[0,94,100,82,56,66,76,131,247]];break;case 112:c=[[26,51,43,33,28,35,74,144,246],[9,24,55,87,118,150,180,200,222],[30,96,112,114,112,101,72,35,0]];break;case 113:c=[[0,5,65,97,124,156,189,224,255],[32,54,77,100,123,148,175,203,234],[77,110,107,111,120,119,111,94,70]];break;default:return ba()}a=c[0];b=c[1];c=c[2];for(var f=[],e=1;e<d.length;e++)for(var g=
Math.round(Math.floor(255*d[e])-Math.floor(255*d[e-1])),k=0;k<g;k++)f.push("rgb("+(Math.round(a[e-1]+k*(a[e]-a[e-1])/g)+","+Math.round(b[e-1]+k*(b[e]-b[e-1])/g)+","+Math.round(c[e-1]+k*(c[e]-c[e-1])/g))+")");return new JSROOT.ColorPalette(f)};A.prototype=Object.create(JSROOT.ObjectPainter.prototype);A.prototype.drawPave=function(a){var d=this;this.UseTextColor=!1;var b=Promise.resolve(this);if(!this.Enabled)return this.removeG(),b;var c=this.getObject(),f=c.fOption.toUpperCase();if(0===c.fInit){this.stored=
JSROOT.extend({},c);c.fInit=1;var e=this.getPadPainter().getRootPad(!0);if("TPaletteAxis"!=c._typename||c.fX1||c.fX2||c.fY1||c.fY2)0<=f.indexOf("NDC")?(c.fX1NDC=c.fX1,c.fX2NDC=c.fX2,c.fY1NDC=c.fY1,c.fY2NDC=c.fY2):e?(e.fLogx&&(0<c.fX1&&(c.fX1=Math.log10(c.fX1)),0<c.fX2&&(c.fX2=Math.log10(c.fX2))),e.fLogy&&(0<c.fY1&&(c.fY1=Math.log10(c.fY1)),0<c.fY2&&(c.fY2=Math.log10(c.fY2))),c.fX1NDC=(c.fX1-e.fX1)/(e.fX2-e.fX1),c.fY1NDC=(c.fY1-e.fY1)/(e.fY2-e.fY1),c.fX2NDC=(c.fX2-e.fX1)/(e.fX2-e.fX1),c.fY2NDC=(c.fY2-
e.fY1)/(e.fY2-e.fY1)):(c.fX1NDC=c.fY1NDC=.1,c.fX2NDC=c.fY2NDC=.9);else{var g=this.getFramePainter();g?(c.fX1NDC=g.fX2NDC+.01,c.fX2NDC=Math.min(.96,g.fX2NDC+.06),c.fY1NDC=g.fY1NDC,c.fY2NDC=g.fY2NDC):(c.fX2NDC=.8,c.fX1NDC=.9,c.fY1NDC=.1,c.fY2NDC=.9)}c.fX1NDC==c.fX2NDC&&c.fY1NDC==c.fY2NDC&&"TLegend"==c._typename&&(c.fX1NDC=Math.max(e?e.fLeftMargin:0,c.fX2NDC-.3),c.fX2NDC=Math.min(c.fX1NDC+.3,e?1-e.fRightMargin:1),g=Math.max(c.fPrimitives?.05*c.fPrimitives.arr.length:0,.2),c.fY2NDC=Math.min(e?1-e.fTopMargin:
1,c.fY1NDC+g),c.fY1NDC=Math.max(c.fY2NDC-g,e?e.fBottomMargin:0))}e=this.getPadPainter().getPadRect();var k=Math.round(c.fX1NDC*e.width),t=Math.round((1-c.fY2NDC)*e.height),n=Math.round((c.fX2NDC-c.fX1NDC)*e.width),l=Math.round((c.fY2NDC-c.fY1NDC)*e.height);g=c.fBorderSize;e=0<=f.indexOf("L")?-1:0<=f.indexOf("R")?1:0;f=0<=f.indexOf("T")?-1:0<=f.indexOf("B")?1:0;this.createG();this.draw_g.attr("transform","translate("+k+","+t+")");this.createAttLine({attr:c,width:0<g?c.fLineWidth:0});this.createAttFill({attr:c});
if("TDiamond"==c._typename){b=Math.round(l/2);var z=Math.round(n/2),u="l"+z+",-"+b+"l"+z+","+b+"l-"+z+","+b+"z";1<g&&0<c.fShadowColor&&(e||f)&&!this.fillatt.empty()&&this.draw_g.append("svg:path").attr("d","M0,"+(b+g)+u).style("fill",this.getColor(c.fShadowColor)).style("stroke",this.getColor(c.fShadowColor)).style("stroke-width","1px");this.draw_g.append("svg:path").attr("d","M0,"+b+u).call(this.fillatt.func).call(this.lineatt.func);e=this.draw_g.append("svg:g").attr("transform","translate("+Math.round(n/
4)+","+Math.round(l/4)+")");return this.drawPaveText(z,b,a,e)}1<g&&0<c.fShadowColor&&!c.fNpaves&&(e||f)&&(z="",u=this.getColor(c.fShadowColor),z=this.fillatt.empty()?0>e&&0>f?"M0,0v"+(l-g)+"h-"+g+"v-"+l+"h"+n+"v"+g:"M0,"+l+"v-"+(l-g)+"h-"+g+"v"+l+"h"+n+"v-"+g:"M"+e*g+","+f*g+"v"+l+"h"+n+"v-"+l,this.draw_g.append("svg:path").attr("d",z+"z").style("fill",u).style("stroke",u).style("stroke-width","1px"));if(c.fNpaves)for(g=c.fNpaves-1;0<g;--g)this.draw_g.append("svg:path").attr("d","M"+4*e*g+","+4*f*
g+"h"+n+"v"+l+"h-"+n+"z").call(this.fillatt.func).call(this.lineatt.func);var m=this.draw_g.append("svg:path").attr("d","M0,0H"+n+"V"+l+"H0Z").call(this.fillatt.func).call(this.lineatt.func);"function"==typeof this.paveDrawFunc&&(b=this.paveDrawFunc(n,l,a));return JSROOT.batch_mode||"TPave"==c._typename?b:b.then(function(){return JSROOT.require(["interactive"])}).then(function(a){m.style("pointer-events","visibleFill").on("mouseenter",function(){return d.showObjectStatus()});d.draw_g.attr("x",k).attr("y",
t).attr("width",n).attr("height",l);a.addDragHandler(d,{obj:c,minwidth:10,minheight:20,canselect:!0,redraw:function(){d.interactiveRedraw(!1,"pave_moved");d.drawPave()},ctxmenu:JSROOT.browser.touches&&JSROOT.settings.ContextMenu&&d.UseContextMenu});if(d.UseContextMenu&&JSROOT.settings.ContextMenu)d.draw_g.on("contextmenu",function(a){return d.paveContextMenu(a)});"TPaletteAxis"==c._typename&&d.interactivePaletteAxis(n,l);return d})};A.prototype.fillWebObjectOptions=function(a){if(!a){if(!this.snapid)return null;
a={_typename:"TWebObjectOptions",snapid:this.snapid.toString(),opt:this.getDrawOpt(),fcust:"",fopt:[]}}var d=this.getObject();d&&d.fInit&&(a.fcust="pave",a.fopt=[d.fX1NDC,d.fY1NDC,d.fX2NDC,d.fY2NDC]);return a};A.prototype.drawPaveLabel=function(a,d){this.UseTextColor=!0;var b=this.getObject();this.startTextDrawing(b.fTextFont,d/1.2);this.drawText({align:b.fTextAlign,width:a,height:d,text:b.fLabel,color:this.getColor(b.fTextColor)});return this.finishTextDrawing()};A.prototype.drawPaveStats=function(a,
d){this.isStats()&&this.fillStatistic();for(var b=this.getObject(),c=[],f=this.getColor(b.fTextColor),e=0,g=0,k=0,t=0;t<b.fLines.arr.length;++t){var n=b.fLines.arr[t];"TText"!=n._typename&&"TLatex"!=n._typename||c.push(n.fTitle)}t=c.length;for(n=0;n<t;++n){var l=c[n];0<n&&(k=Math.max(k,l.length));0==n||0>l.indexOf("|")||(0===e&&(e=n),l=l.split("|"),l.length>g&&(g=l.length))}n=d/t;l=!1;var z=b.fMargin*a;this.startTextDrawing(b.fTextFont,d/(1.2*t));this.UseTextColor=!0;if(1==t)this.drawText({align:b.fTextAlign,
width:a,height:d,text:c[0],color:f,latex:1});else for(var u=0;u<t;++u){var m=u*n;this.UseTextColor=!0;if(e&&u>=e)for(var r=c[u].split("|"),q=0;q<r.length;++q)this.drawText({align:"middle",x:a*q/g,y:m,latex:0,width:a/g,height:n,text:r[q],color:f});else if(0>c[u].indexOf("="))0==u&&(l=!0,r=Math.max(k,Math.round((a-2*z)/n/.65)),c[u].length>r+5&&(c[u]=c[u].substr(0,r+2)+"...")),this.drawText({align:0==u?"middle":"start",x:z,y:m,width:a-2*z,height:n,text:c[u],color:f});else{q=c[u].split("=");r=[];for(var v=
0;2>v;++v)r.push({align:0==v?"start":"end",x:z,y:m,width:a-2*z,height:n,text:q[v],color:f,_expected_width:a-2*z,_args:r,post_process:function(a){this._args[0].ready&&this._args[1].ready&&a.scaleTextDrawing(1.05*(this._args[0].result_width+this._args[1].result_width)/this._expected_width,a.draw_g)}});for(m=0;2>m;++m)this.drawText(r[m])}}c="";0<b.fBorderSize&&l&&(c+="M0,"+Math.round(n)+"h"+a);if(0<e&&1<g){for(b=e;b<t;++b)c+="M0,"+Math.round(b*n)+"h"+a;for(b=0;b<g-1;++b)c+="M"+Math.round(a/g*(b+1))+
","+Math.round(e*n)+"V"+d}c&&this.draw_g.append("svg:path").attr("d",c).call(this.lineatt.func);this.draw_g.classed("most_upper_primitives",!0);return this.finishTextDrawing()};A.prototype.drawPaveText=function(a,d,b,c){var f=this;b=this.getObject();var e=this.getColor(b.fTextColor),g=0,k=[],t=this.getPadPainter(),n=t.getPadHeight(),l=!1,z=0<b.fLabel.length,u=[];c||(c=this.draw_g);for(var m=0;m<b.fLines.arr.length;++m){var r=b.fLines.arr[m];if("TText"==r._typename||"TLatex"==r._typename)if(g++,0<
r.fX||0<r.fY)l=!0}t=1==g&&t&&t._fast_drawing;for(r=m=0;r<b.fLines.arr.length;++r){var q=b.fLines.arr[r],v=0<g?Math.round((1-(m-.5)/g)*d):0;switch(q._typename){case "TText":case "TLatex":m++;if(l){var w=q.fX,h=q.fY;w=0<w&&1>w?Math.round(w*a):b.fMargin*a;h=0<h&&1>h?Math.round((1-h)*d):v;v=q.fTextColor?this.getColor(q.fTextColor):"";v||(v=e,this.UseTextColor=!0);var x=c.append("svg:g");this.startTextDrawing(b.fTextFont,(q.fTextSize||b.fTextSize)*n,x);this.drawText({align:q.fTextAlign||b.fTextAlign,x:w,
y:h,text:q.fTitle,color:v,latex:"TText"==q._typename?0:1,draw_g:x,fast:t});u.push(this.finishTextDrawing(x))}else k.push(q);break;case "TLine":case "TBox":w=q.fX1;h=q.fX2;x=q.fY1;var p=q.fY2;0!==w&&(w=Math.round(w*a));h=h?Math.round(h*a):a;x=x?Math.round((1-x)*d):v;p=p?Math.round((1-p)*d):v;"TLine"==q._typename?(q=new JSROOT.TAttLineHandler(q),c.append("svg:path").attr("d","M"+w+","+x+"L"+h+","+p).call(q.func)):(q=this.createAttFill(q),c.append("svg:path").attr("d","M"+w+","+x+"H"+h+"V"+p+"H"+w+"Z").call(q.func))}}if(!l){l=
d/g;m=b.fMargin*a;r=0;1==g&&0<b.fTextSize&&(r=Math.round(b.fTextSize*n),3>r&&(r=3));this.startTextDrawing(b.fTextFont,d/(1.2*g),c,r);for(r=0;r<g;++r)q=null,v=k[r],1==g?q={x:0,y:0,width:a,height:d}:(q={x:m,y:r*l,width:a-2*m,height:l},v.fTextColor&&(q.color=this.getColor(v.fTextColor)),v.fTextSize&&(q.font_size=Math.round(v.fTextSize*n))),q.align=b.fTextAlign,q.draw_g=c,q.latex="TText"==v._typename?0:1,q.text=v.fTitle,q.fast=t,q.color||(this.UseTextColor=!0,q.color=e),this.drawText(q);u.push(this.finishTextDrawing(c))}z&&
(g=Math.round(.25*a),k=Math.round(.02*-d),a=Math.round(.5*a),d=Math.round(.04*d),c=c.append("svg:g"),c.append("svg:path").attr("d","M"+g+","+k+"h"+a+"v"+d+"h-"+a+"z").call(this.fillatt.func).call(this.lineatt.func),this.startTextDrawing(b.fTextFont,d/1.5,c),this.drawText({align:22,x:g,y:k,width:a,height:d,text:b.fLabel,color:e,draw_g:c}),u.push(this.finishTextDrawing(c)),this.UseTextColor=!0);return Promise.all(u).then(function(){return f})};A.prototype.format=function(a,d){d||(d="stat");var b=this.getObject();
switch(d){case "stat":d=b.fStatFormat||JSROOT.gStyle.fStatFormat;break;case "fit":d=b.fFitFormat||JSROOT.gStyle.fFitFormat;break;case "entries":if(1E9>Math.abs(a)&&Math.round(a)==a)return a.toFixed(0);d="14.7g";break;case "last":d=this.lastformat}a=p.floatToString(a,d||"6.4g",!0);this.lastformat=a[1];return a[0]};A.prototype.drawPaveLegend=function(a,d){var b=this.getObject(),c=b.fPrimitives.arr.length,f=b.fNColumns,e=c;if(2>f)f=1;else for(;(e-1)*f>=c;)e--;var g=function(a){return!a.fObject&&!a.fOption&&
(!a.fLabel||" "==a.fLabel)};if(1==f)for(var k=0;k<c;++k)g(b.fPrimitives.arr[k])&&e--;1>e&&(e=1);k=this.getColor(b.fTextColor);var t=Math.round(a/f);a=Math.round(.03*a/f);var n=Math.round(.03*d);d=(d-2*n)/e;var l=.9*d,z=0;e=this.getPadPainter();var u=e.getPadHeight(),m=!1,r=-1;b.fTextSize&&2<u*b.fTextSize&&u*b.fTextSize<l&&(l=z=Math.round(u*b.fTextSize));this.startTextDrawing(b.fTextFont,l,this.draw_g,z);for(l=0;l<c;++l)if(z=b.fPrimitives.arr[l],!g(z)){1==f?++r:r=l;u=z.fOption.toLowerCase();var q=
r%f,v=(r-q)/f;q*=t;var w=q+Math.round(b.fMargin*t),h=Math.round((q+w)/2),x=Math.round(v*d+n);v=Math.round((v+.5)*d+n);var p=z,y=z,R=z,F=z.fObject,C=null,D=!1,A=-1!=u.indexOf("f"),E=-1!=u.indexOf("l"),B=-1!=u.indexOf("e"),M=-1!=u.indexOf("p");null!==F&&"object"==typeof F&&("fLineColor"in F&&(R=F),"fFillColor"in F&&(p=F),"fMarkerColor"in F&&(y=F),C=e.findPainterFor(F));A&&(F=void 0,p=C&&C.fillatt?C.fillatt:this.createAttFill(p),0>u.indexOf("l")&&0>u.indexOf("e")&&0>u.indexOf("p")&&(F=C&&C.lineatt?C.lineatt:
new JSROOT.TAttLineHandler(R),F.empty()&&(F=null)),!p.empty()||F)&&(D=!0,p=this.draw_g.append("svg:path").attr("d","M"+(q+a)+","+Math.round(x+.1*d)+"v"+Math.round(.8*d)+"h"+(w-2*a-q)+"v"+-Math.round(.8*d)+"z").call(p.func),F&&p.call(F.func));if(E||B)R=C&&C.lineatt?C.lineatt:new JSROOT.TAttLineHandler(R),R.empty()||(D=!0,this.draw_g.append("svg:path").attr("d","M"+(q+a)+","+v+"H"+(w-a)).call(R.func),B&&this.draw_g.append("svg:path").attr("d","M"+h+","+Math.round(x+.1*d)+"V"+Math.round(x+.9*d)).call(R.func));
M&&(h=C&&C.markeratt?C.markeratt:new JSROOT.TAttMarkerHandler(y),h.empty()||(D=!0,this.draw_g.append("svg:path").attr("d",h.create((q+w)/2,v)).call(h.func)));!D&&C&&C.lineatt&&!C.lineatt.empty()&&this.draw_g.append("svg:path").attr("d","M"+(q+a)+","+Math.round(x+.1*d)+"v"+Math.round(.8*d)+"h"+(w-2*a-q)+"v"+-Math.round(.8*d)+"z").attr("fill","none").call(C.lineatt.func);0<u.length?m=!0:m||(w=q+a);z.fLabel&&this.drawText({align:b.fTextAlign,x:w,y:x,width:q+t-w-a,height:d,text:z.fLabel,color:k})}return this.finishTextDrawing()};
A.prototype.drawPaletteAxis=function(a,d,b){var c=this,f=this.getObject(),e=f.fAxis,g="string"==typeof b&&0<b.indexOf("can_move"),k="string"==typeof b&&0<b.indexOf("postpone"),t=parseInt(this.draw_g.attr("x")),n=parseInt(this.draw_g.attr("y")),l=this.getPadPainter().getPadWidth(),z=this.getPadPainter().getRootPad(!0),u=f.$main_painter||this.getMainPainter(),m=this.getFramePainter(),r=0,q=100,v=(b=u.fContour)?b.getLevels():null,w=u.fPalette;e.fTickSize=.6*a/l;b&&m?(r=Math.min(v[0],m.zmin),q=Math.max(v[v.length-
1],m.zmax)):void 0!==u.gmaxbin&&void 0!==u.gminbin?(r=u.gminbin,q=u.gmaxbin):void 0!==u.hmin&&void 0!==u.hmax&&(r=u.hmin,q=u.hmax);this.draw_g.selectAll("rect").style("fill","white");this.z_handle.configureAxis("zaxis",r,q,r,q,!0,[0,d],{log:z?z.fLogz:0});if(b&&w&&!k)for(e=0;e<v.length-1;++e){if(k=this.z_handle.gr(v[e]),z=this.z_handle.gr(v[e+1]),u=b.getPaletteColor(w,(v[e]+v[e+1])/2),k=this.draw_g.append("svg:rect").attr("x",0).attr("y",Math.round(z)).attr("width",a).attr("height",Math.round(k)-Math.round(z)).style("fill",
u).style("stroke",u).property("fill0",u).property("fill1",h.rgb(u).darker(.5).toString()),this.isTooltipAllowed()&&k.on("mouseover",function(){h.select(this).transition().duration(100).style("fill",h.select(this).property("fill1"))}).on("mouseout",function(){h.select(this).transition().duration(100).style("fill",h.select(this).property("fill0"))}).append("svg:title").text(v[e].toFixed(2)+" - "+v[e+1].toFixed(2)),JSROOT.settings.Zooming)k.on("dblclick",function(){return c.getFramePainter().unzoom("z")})}else this.draw_g.append("svg:rect").attr("x",
0).attr("y",0).attr("width",a).attr("height",d).style("fill","white");this.z_handle.max_tick_size=Math.round(.7*a);return this.z_handle.drawAxis(this.draw_g,a,d,"translate("+a+", 0)").then(function(){if(g&&"getBoundingClientRect"in c.draw_g.node()){var a=c.draw_g.node().getBoundingClientRect();a=t+parseInt(a.width)-Math.round(.995*l)+3;0<a&&(c.draw_g.attr("x",t-a).attr("y",n).attr("transform","translate("+(t-a)+", "+n+")"),f.fX1NDC-=a/l,f.fX2NDC-=a/l)}return c})};A.prototype.interactivePaletteAxis=
function(a,d){var b=this,c=!1,f=0,e=0,g=null,k=function(a){c&&(a.preventDefault(),a=h.pointer(a,b.draw_g.node()),e=Math.min(Math.max(a[1],0),d),g.attr("y",Math.min(f,e)).attr("height",Math.abs(e-f)))},t=function(a){if(c){a.preventDefault();h.select(window).on("mousemove.colzoomRect",null).on("mouseup.colzoomRect",null);g.remove();g=null;c=!1;var d=b.z_handle.gr;a=d.invert(f);d=d.invert(e);b.getFramePainter().zoom("z",Math.min(a,d),Math.max(a,d))}},n=function(d){c||(c=!0,d.preventDefault(),d.stopPropagation(),
f=e=h.pointer(d,b.draw_g.node())[1],g=b.draw_g.append("svg:rect").attr("class","zoom").attr("id","colzoomRect").attr("x","0").attr("width",a).attr("y",f).attr("height",1),h.select(window).on("mousemove.colzoomRect",k).on("mouseup.colzoomRect",t,!0))};if(JSROOT.settings.Zooming)this.draw_g.selectAll(".axis_zoom").on("mousedown",n).on("dblclick",function(){return b.getFramePainter().unzoom("z")});if(JSROOT.settings.ZoomWheel)this.draw_g.on("wheel",function(a){var c=1-h.pointer(a,b.draw_g.node())[1]/
d;a=b.z_handle.analyzeWheelEvent(a,c);a.changed&&b.getFramePainter().zoom("z",a.min,a.max)})};A.prototype.fillContextMenu=function(a){var d=this,b=this.getObject();a.add("header: "+b._typename+"::"+b.fName);if(this.isStats()){var c=function(c,d){var e=10>c?b.fOptStat:b.fOptFit;e=parseInt(parseInt(e)/parseInt(Math.pow(10,c%10)))%10;a.addchk(e,d,100*e+c,function(a){var c=10>a%100?b.fOptStat:b.fOptFit,d=parseInt(a/100);c-=(0<d?d:-1)*parseInt(Math.pow(10,a%10));10>a%100?(b.fOptStat=c,this.interactiveRedraw(!0,
"exec:SetOptStat("+c+")")):(b.fOptFit=c,this.interactiveRedraw(!0,"exec:SetOptFit("+c+")"))})};a.add("Default position",function(){b.fX2NDC=JSROOT.gStyle.fStatX;b.fX1NDC=b.fX2NDC-JSROOT.gStyle.fStatW;b.fY2NDC=JSROOT.gStyle.fStatY;b.fY1NDC=b.fY2NDC-JSROOT.gStyle.fStatH;b.fInit=1;this.interactiveRedraw(!0,"pave_moved")});a.add("SetStatFormat",function(){a.input("Enter StatFormat",b.fStatFormat).then(function(a){a&&(b.fStatFormat=a,d.interactiveRedraw(!0,'exec:SetStatFormat("'+a+'")'))})});a.add("SetFitFormat",
function(){a.input("Enter FitFormat",b.fFitFormat).then(function(a){a&&(b.fFitFormat=a,d.interactiveRedraw(!0,'exec:SetFitFormat("'+a+'")'))})});a.add("separator");a.add("sub:SetOptStat",function(){a.input("Enter OptStat",b.fOptStat,"int").then(function(a){b.fOptStat=a;d.interactiveRedraw(!0,"exec:SetOptStat("+a)})});c(0,"Histogram name");c(1,"Entries");c(2,"Mean");c(3,"Std Dev");c(4,"Underflow");c(5,"Overflow");c(6,"Integral");c(7,"Skewness");c(8,"Kurtosis");a.add("endsub:");a.add("sub:SetOptFit",
function(){a.input("Enter OptStat",b.fOptFit,"int").then(function(a){b.fOptFit=a;d.interactiveRedraw(!0,"exec:SetOptFit("+a+")")})});c(10,"Fit parameters");c(11,"Par errors");c(12,"Chi square / NDF");c(13,"Probability");a.add("endsub:");a.add("separator")}else"title"===b.fName&&a.add("Default position",function(){b.fX1NDC=.28;b.fY1NDC=.94;b.fX2NDC=.72;b.fY2NDC=.99;b.fInit=1;this.interactiveRedraw(!0,"pave_moved")});this.UseTextColor&&a.addTextAttributesMenu(this);a.addAttributesMenu(this);0<a.size()&&
a.add("Inspect",this.showInspector);return 0<a.size()};A.prototype.paveContextMenu=function(a){var d=this;if(this.z_handle){var b=this.getFramePainter();b&&b.showContextMenu&&b.showContextMenu("z",a)}else a.stopPropagation(),a.preventDefault(),p.createMenu(a,this).then(function(a){d.fillContextMenu(a);return d.fillObjectExecMenu(a,"title")}).then(function(a){return a.show()})};A.prototype.isStats=function(){return this.matchObjectType("TPaveStats")};A.prototype.clearPave=function(){this.getObject().Clear()};
A.prototype.addText=function(a){this.getObject().AddText(a)};A.prototype.fillFunctionStat=function(a,d){if(!d||!a)return!1;var b=d%10,c=Math.floor(d/10)%10,f=Math.floor(d/1E3)%10;0<Math.floor(d/100)%10&&this.addText("#chi^2 / ndf = "+this.format(a.fChisquare,"fit")+" / "+a.fNDF);0<f&&this.addText("Prob = "+("Math"in JSROOT?this.format(JSROOT.Math.Prob(a.fChisquare,a.fNDF)):"<not avail>"));if(0<b)for(d=0;d<a.GetNumPars();++d){b=a.GetParName(d);f=a.GetParValue(d);var e=a.GetParError(d);f=void 0===f?
"<not avail>":this.format(Number(f),"fit");void 0!==e&&(e=this.format(e,"last"),0===Number(e)&&0!=a.GetParError(d)&&(e=this.format(a.GetParError(d),"4.2g")));0<c&&e?this.addText(b+" = "+f+" #pm "+e):this.addText(b+" = "+f)}return!0};A.prototype.fillStatistic=function(){var a=this.getPadPainter();if(a&&a._fast_drawing)return!1;a=this.getObject();var d=a.$main_painter||this.getMainPainter();if("stats"!==a.fName||!d||"function"!==typeof d.fillStatistic)return!1;var b=parseInt(a.fOptStat),c=parseInt(a.fOptFit);
Number.isInteger(b)||(b=JSROOT.gStyle.fOptStat);Number.isInteger(c)||(c=JSROOT.gStyle.fOptFit);if(!d.fillStatistic(this,b,c))return!1;d=a.fLines.arr.length;b=d*JSROOT.gStyle.StatFontSize;if(0>=b||3===JSROOT.gStyle.StatFont%10)b=.25*d*JSROOT.gStyle.StatH,a.fY1NDC=a.fY2NDC-b;return!0};A.prototype.isDummyPos=function(a){return a?!a.fInit&&!a.fX1&&!a.fX2&&!a.fY1&&!a.fY2&&!a.fX1NDC&&!a.fX2NDC&&!a.fY1NDC&&!a.fY2NDC:!0};A.prototype.updateObject=function(a){if(!this.matchObjectType(a))return!1;var d=this.getObject();
d.modified_NDC||this.isDummyPos(a)||(this.stored&&!a.fInit&&this.stored.fX1==a.fX1&&this.stored.fX2==a.fX2&&this.stored.fY1==a.fY1&&this.stored.fY2==a.fY2?(this.stored.fX1NDC!=a.fX1NDC&&(d.fX1NDC=a.fX1NDC),this.stored.fX2NDC!=a.fX2NDC&&(d.fX2NDC=a.fX2NDC),this.stored.fY1NDC!=a.fY1NDC&&(d.fY1NDC=a.fY1NDC),this.stored.fY2NDC!=a.fY2NDC&&(d.fY2NDC=a.fY2NDC)):(d.fInit=a.fInit,d.fX1=a.fX1,d.fX2=a.fX2,d.fY1=a.fY1,d.fY2=a.fY2,d.fX1NDC=a.fX1NDC,d.fX2NDC=a.fX2NDC,d.fY1NDC=a.fY1NDC,d.fY2NDC=a.fY2NDC),this.stored=
JSROOT.extend({},a));d.fOption=a.fOption;d.fBorderSize=a.fBorderSize;switch(a._typename){case "TPaveText":return d.fLines=JSROOT.clone(a.fLines),!0;case "TPavesText":return d.fLines=JSROOT.clone(a.fLines),d.fNpaves=a.fNpaves,!0;case "TPaveLabel":return d.fLabel=a.fLabel,!0;case "TPaveStats":return d.fOptStat=a.fOptStat,d.fOptFit=a.fOptFit,!0;case "TLegend":var b=d.fPrimitives;d.fPrimitives=a.fPrimitives;d.fNColumns=a.fNColumns;if(b&&b.arr&&d.fPrimitives&&d.fPrimitives.arr&&b.arr.length==d.fPrimitives.arr.length)for(a=
0;a<b.arr.length;++a){var c=b.arr[a].fObject,f=d.fPrimitives.arr[a].fObject;c&&f&&c._typename==f._typename&&c.fName==f.fName&&(d.fPrimitives.arr[a].fObject=c)}return!0;case "TPaletteAxis":return d.fBorderSize=1,d.fShadowColor=0,!0}return!1};A.prototype.redraw=function(){return this.drawPave()};A.prototype.cleanup=function(){this.z_handle&&(this.z_handle.cleanup(),delete this.z_handle);JSROOT.ObjectPainter.prototype.cleanup.call(this)};var T=function(a,d,b){var c=new JSROOT.TPavePainter(a,d);return p.ensureTCanvas(c,
!1).then(function(){if("title"===d.fName&&"TPaveText"===d._typename){var f=c.getPadPainter().findPainterFor(null,"title");if(f&&f!==c)f.removeFromPadPrimitives(),f.cleanup();else if("postitle"==b||c.isDummyPos(d)){var e=JSROOT.gStyle;f=c.getFramePainter();if(e&&f){var g=e.fTitleX,k=e.fTitleY,t=e.fTitleW;(e=e.fTitleH)||(e=.7*(k-f.fY2NDC));t||(t=f.fX2NDC-f.fX1NDC);if(!Number.isFinite(e)||0>=e)e=.06;if(!Number.isFinite(t)||0>=t)t=.44;d.fX1NDC=g-t/2;d.fY1NDC=k-e;d.fX2NDC=g+t/2;d.fY2NDC=k;d.fInit=1}}}else"TPaletteAxis"===
d._typename&&(d.fBorderSize=1,d.fShadowColor=0,d.fAxis&&(d.fAxis.fChopt||(d.fAxis.fChopt="+"),d.fAxis.fNdiv||(d.fAxis.fNdiv=12),d.fAxis.fLabelOffset||(d.fAxis.fLabelOffset=.005)),c.z_handle=new JSROOT.TAxisPainter(a,d.fAxis,!0),c.z_handle.setPadName(c.getPadName()),c.UseContextMenu=!0);switch(d._typename){case "TPaveLabel":c.paveDrawFunc=c.drawPaveLabel;break;case "TPaveStats":c.paveDrawFunc=c.drawPaveStats;c.$secondary=!0;break;case "TPaveText":case "TPavesText":case "TDiamond":c.paveDrawFunc=c.drawPaveText;
break;case "TLegend":c.paveDrawFunc=c.drawPaveLegend;break;case "TPaletteAxis":c.paveDrawFunc=c.drawPaletteAxis}return c.drawPave(b)})};H.prototype.reset=function(){JSROOT.extend(this,{Axis:0,RevX:!1,RevY:!1,SymlogX:0,SymlogY:0,Bar:!1,BarStyle:0,Curve:!1,Hist:!0,Line:!1,Fill:!1,Error:!1,ErrorKind:-1,errorX:JSROOT.gStyle.fErrorX,Mark:!1,Same:!1,Scat:!1,ScatCoef:1,Func:!0,Arrow:!1,Box:!1,BoxStyle:0,Text:!1,TextAngle:0,TextKind:"",Char:0,Color:!1,Contour:0,Lego:0,Surf:0,Off:0,Tri:0,Proj:0,AxisPos:0,
Spec:!1,Pie:!1,List:!1,Zscale:!1,PadPalette:!1,Candle:"",GLBox:0,GLColor:!1,Project:"",System:p.Coord.kCARTESIAN,AutoColor:!1,NoStat:!1,ForceStat:!1,PadStats:!1,PadTitle:!1,AutoZoom:!1,HighRes:0,Zero:!0,Palette:0,BaseLine:!1,Optimize:JSROOT.settings.OptimizeDraw,Mode3D:!1,x3dscale:1,y3dscale:1,Render3D:JSROOT.constants.Render3D.Default,FrontBox:!0,BackBox:!0,_pmc:!1,_plc:!1,_pfc:!1,need_fillcol:!1,minimum:-1111,maximum:-1111,ymin:0,ymax:0})};H.prototype.decode=function(a,d,b,c,f){this.orginal=a;var e=
new JSROOT.DrawOptions(a);a="";if(1===d&&0<b.fSumw2.length)for(var g=0;g<b.fSumw2.length;++g)if(0<b.fSumw2[g]){this.Error=!0;this.Zero=this.Hist=!1;break}this.ndim=d||1;this.PadStats=e.check("USE_PAD_STATS");this.PadPalette=e.check("USE_PAD_PALETTE");this.PadTitle=e.check("USE_PAD_TITLE");e.check("PAL",!0)&&(this.Palette=e.partAsInt());e.check("MINIMUM:",!0)?(this.ominimum=!0,this.minimum=parseFloat(e.part)):(this.ominimum=!1,this.minimum=b.fMinimum);e.check("MAXIMUM:",!0)?(this.omaximum=!0,this.maximum=
parseFloat(e.part)):(this.omaximum=!1,this.maximum=b.fMaximum);e.check("HTITLE:",!0)&&(b.fTitle=decodeURIComponent(e.part.toLowerCase()));e.check("XTITLE:",!0)&&(b.fXaxis.fTitle=decodeURIComponent(e.part.toLowerCase()));e.check("YTITLE:",!0)&&(b.fYaxis.fTitle=decodeURIComponent(e.part.toLowerCase()));e.check("ZTITLE:",!0)&&(b.fZaxis.fTitle=decodeURIComponent(e.part.toLowerCase()));e.check("NOOPTIMIZE")&&(this.Optimize=0);e.check("OPTIMIZE")&&(this.Optimize=2);e.check("AUTOCOL")&&(this.AutoColor=!0);
e.check("AUTOZOOM")&&(this.AutoZoom=!0);e.check("OPTSTAT",!0)&&(this.optstat=e.partAsInt());e.check("OPTFIT",!0)&&(this.optfit=e.partAsInt());e.check("NOSTAT")&&(this.NoStat=!0);e.check("STAT")&&(this.ForceStat=!0);e.check("NOTOOLTIP")&&f&&f.setTooltipAllowed(!1);e.check("TOOLTIP")&&f&&f.setTooltipAllowed(!0);e.check("SYMLOGX",!0)&&(this.SymlogX=e.partAsInt(0,3));e.check("SYMLOGY",!0)&&(this.SymlogY=e.partAsInt(0,3));e.check("X3DSC",!0)&&(this.x3dscale=e.partAsInt(0,100)/100);e.check("Y3DSC",!0)&&
(this.y3dscale=e.partAsInt(0,100)/100);var k=g=!1;e.check("LOGXY")&&(g=k=!0);e.check("LOGX")&&(g=!0);e.check("LOGY")&&(k=!0);g&&c&&(c.fLogx=1,c.fUxmin=0,c.fUxmax=1,c.fX1=0,c.fX2=1);k&&c&&(c.fLogy=1,c.fUymin=0,c.fUymax=1,c.fY1=0,c.fY2=1);e.check("LOGZ")&&c&&(c.fLogz=1);e.check("GRIDXY")&&c&&(c.fGridx=c.fGridy=1);e.check("GRIDX")&&c&&(c.fGridx=1);e.check("GRIDY")&&c&&(c.fGridy=1);e.check("TICKXY")&&c&&(c.fTickx=c.fTicky=1);e.check("TICKX")&&c&&(c.fTickx=1);e.check("TICKY")&&c&&(c.fTicky=1);g=function(){if(0<
e.partAsInt(1))return e.partAsInt();for(var a=0;8>a;++a)if(p.getColor(a).toUpperCase()===e.part)return a;return-1};e.check("FILL_",!0)&&(k=g(),0<=k&&(this.histoFillColor=k));e.check("LINE_",!0)&&(k=g(),0<=k&&(this.histoLineColor=p.root_colors[k]));e.check("XAXIS_",!0)&&(k=g(),0<=k&&(b.fXaxis.fAxisColor=b.fXaxis.fLabelColor=b.fXaxis.fTitleColor=k));e.check("YAXIS_",!0)&&(g=g(),0<=g&&(b.fYaxis.fAxisColor=b.fYaxis.fLabelColor=b.fYaxis.fTitleColor=g));f=f?!!f.getMainPainter():!1;e.check("X+")&&(this.AxisPos=
10,this.second_x=f);e.check("Y+")&&(this.AxisPos+=1,this.second_y=f);e.check("SAMES")&&(this.ForceStat=this.Same=!0);e.check("SAME")&&(this.Func=this.Same=!0);e.check("SPEC")&&(this.Spec=!0);e.check("BASE0")||e.check("MIN0")?this.BaseLine=0:JSROOT.gStyle.fHistMinimumZero&&(this.BaseLine=0);e.check("PIE")&&(this.Pie=!0);e.check("CANDLE",!0)&&(this.Candle=e.part);e.check("GLBOX",!0)&&(this.GLBox=10+e.partAsInt());e.check("GLCOL")&&(this.GLColor=!0);e.check("GL");e.check("LEGO",!0)&&(this.Lego=1,0<=
e.part.indexOf("0")&&(this.Zero=!1),0<=e.part.indexOf("1")&&(this.Lego=11),0<=e.part.indexOf("2")&&(this.Lego=12),0<=e.part.indexOf("3")&&(this.Lego=13),0<=e.part.indexOf("4")&&(this.Lego=14),a=e.part,0<=e.part.indexOf("Z")&&(this.Zscale=!0));e.check("R3D_",!0)&&(this.Render3D=JSROOT.constants.Render3D.fromString(e.part.toLowerCase()));e.check("SURF",!0)&&(this.Surf=e.partAsInt(10,1),a=e.part,0<=e.part.indexOf("Z")&&(this.Zscale=!0));e.check("TF3",!0)&&(a=e.part);e.check("ISO",!0)&&(a=e.part);e.check("LIST")&&
(this.List=!0);e.check("CONT",!0)&&1<d&&(this.Contour=1,0<=e.part.indexOf("Z")&&(this.Zscale=!0),0<=e.part.indexOf("1")?this.Contour=11:0<=e.part.indexOf("2")?this.Contour=12:0<=e.part.indexOf("3")?this.Contour=13:0<=e.part.indexOf("4")&&(this.Contour=14));e.check("HBAR",!0)?this.BarStyle=20:e.check("BAR",!0)&&(this.BarStyle=10);0<this.BarStyle&&(this.Hist=!1,this.need_fillcol=!0,this.BarStyle+=e.partAsInt());e.check("ARR")&&(this.Arrow=!0);e.check("BOX",!0)&&(this.BoxStyle=10+e.partAsInt());this.Box=
0<this.BoxStyle;e.check("COL")&&(this.Color=!0);e.check("CHAR")&&(this.Char=1);e.check("FUNC")&&(this.Func=!0,this.Hist=!1);e.check("AXIS")&&(this.Axis=1);e.check("AXIG")&&(this.Axis=2);e.check("TEXT",!0)&&(this.Text=!0,this.Hist=!1,this.TextAngle=Math.min(e.partAsInt(),90),0<=e.part.indexOf("N")&&(this.TextKind="N"),0<=e.part.indexOf("E0")&&(this.TextLine=!0),0<=e.part.indexOf("E")&&(this.TextKind="E"));e.check("SCAT=",!0)&&(this.Scat=!0,this.ScatCoef=parseFloat(e.part),!Number.isFinite(this.ScatCoef)||
0>=this.ScatCoef)&&(this.ScatCoef=1);e.check("SCAT")&&(this.Scat=!0);e.check("POL")&&(this.System=p.Coord.kPOLAR);e.check("CYL")&&(this.System=p.Coord.kCYLINDRICAL);e.check("SPH")&&(this.System=p.Coord.kSPHERICAL);e.check("PSR")&&(this.System=p.Coord.kRAPIDITY);e.check("TRI",!0)&&(this.Color=!1,this.Tri=1,a=e.part,0<=e.part.indexOf("ERR")&&(this.Error=!0));e.check("AITOFF")&&(this.Proj=1);e.check("MERCATOR")&&(this.Proj=2);e.check("SINUSOIDAL")&&(this.Proj=3);e.check("PARABOLIC")&&(this.Proj=4);0<
this.Proj&&(this.Contour=14);e.check("PROJX",!0)&&(this.Project="X"+e.partAsInt(0,1));e.check("PROJY",!0)&&(this.Project="Y"+e.partAsInt(0,1));a&&(0<=a.indexOf("FB")&&(this.FrontBox=!1),0<=a.indexOf("BB")&&(this.BackBox=!1));3==d&&e.check("FB")&&(this.FrontBox=!1);3==d&&e.check("BB")&&(this.BackBox=!1);this._pfc=e.check("PFC");this._plc=e.check("PLC")||this.AutoColor;this._pmc=e.check("PMC");e.check("L")&&(this.Line=!0,this.Error=this.Hist=!1);e.check("F")&&(this.need_fillcol=this.Fill=!0);e.check("A")&&
(this.Axis=-1);if(e.check("RX")||c&&c.$RX)this.RevX=!0;if(e.check("RY")||c&&c.$RY)this.RevY=!0;f=function(a,d,f){var g=e.check(a);c&&c["$"+a]&&(g=!0,c["$"+a]=void 0);g&&b&&(b[d].TestBit(f)||b[d].InvertBit(f))};f("OTX","fXaxis",JSROOT.EAxisBits.kOppositeTitle);f("OTY","fYaxis",JSROOT.EAxisBits.kOppositeTitle);f("CTX","fXaxis",JSROOT.EAxisBits.kCenterTitle);f("CTY","fYaxis",JSROOT.EAxisBits.kCenterTitle);e.check("B1")&&(this.BarStyle=1,this.BaseLine=0,this.Hist=!1,this.need_fillcol=!0);e.check("B")&&
(this.BarStyle=1,this.Hist=!1,this.need_fillcol=!0);e.check("C")&&(this.Curve=!0,this.Hist=!1);e.check("][")&&(this.Off=1,this.Hist=!0);e.check("HIST")&&(this.Func=this.Hist=!0,this.Error=!1);this.Bar=0<this.BarStyle;delete this.MarkStyle;e.check("P0")&&(this.Mark=!0,this.Hist=!1,this.Zero=!0);e.check("P")&&(this.Mark=!0,this.Zero=this.Hist=!1);e.check("Z")&&(this.Zscale=!0);e.check("*")&&(this.Mark=!0,this.MarkStyle=3,this.Hist=!1);e.check("H")&&(this.Hist=!0);if(e.check("E",!0)&&(this.Error=!0,
1==d)){this.Hist=this.Zero=!1;Number.isInteger(parseInt(e.part[0]))&&(this.ErrorKind=parseInt(e.part[0]));if(3===this.ErrorKind||4===this.ErrorKind)this.need_fillcol=!0;0===this.ErrorKind&&(this.Zero=!0);0<=e.part.indexOf("X0")&&(this.errorX=0)}e.check("9")&&(this.HighRes=1);e.check("0")&&(this.Zero=!1);this.Color&&e.check("1")&&(this.Zero=!1);if(0<this.Lego||3==d||0<this.Surf||this.Error&&2==d)this.Mode3D=!0};H.prototype.asString=function(a,d){var b="";this.Mode3D?(this.Lego?(b="LEGO",this.Zero||
(b+="0"),10<this.Lego&&(b+=this.Lego-10),this.Zscale&&(b+="Z")):this.Surf&&(b="SURF"+(this.Surf-10),this.Zscale&&(b+="Z")),this.FrontBox||(b+="FB"),this.BackBox||(b+="BB"),1!==this.x3dscale&&(b+="_X3DSC"+Math.round(100*this.x3dscale)),1!==this.y3dscale&&(b+="_Y3DSC"+Math.round(100*this.y3dscale))):(this.Scat?b="SCAT":this.Color?(b="COL",this.Zero||(b+="0"),this.Zscale&&(b+="Z"),0>this.Axis&&(b+="A")):this.Contour?(b="CONT",10<this.Contour&&(b+=this.Contour-10),this.Zscale&&(b+="Z")):this.Bar?b=!1===
this.BaseLine?"B":"B1":this.Mark?b=this.Zero?"P0":"P":this.Error?(b="E",0<=this.ErrorKind&&(b+=this.ErrorKind)):this.Line&&(b+="L",this.Fill&&(b+="F")),this.Text&&(b+="TEXT",this.TextAngle&&(b+=this.TextAngle),b+=this.TextKind));if(a&&b)if(this.ForceStat||!0===this.StatEnabled)b+="_STAT";else if(this.NoStat||!1===this.StatEnabled)b+="_NOSTAT";a&&d&&b&&(d.fLogx&&(b+="_LOGX"),d.fLogy&&(b+="_LOGY"),d.fLogz&&(b+="_LOGZ"),d.fGridx&&(b+="_GRIDX"),d.fGridy&&(b+="_GRIDY"),d.fTickx&&(b+="_TICKX"),d.fTicky&&
(b+="_TICKY"));return b};B.prototype.getLevels=function(){return this.arr};B.prototype.createNormal=function(a,d,b){if(d){0>=this.colzmax&&(this.colzmax=1);0>=this.colzmin&&(this.colzmin=void 0===b||0>=b?1E-4*this.colzmax:3>b||100<b?.3*b:1);this.colzmin>=this.colzmax&&(this.colzmin=1E-4*this.colzmax);d=Math.log(this.colzmin)/Math.log(10);b=(Math.log(this.colzmax)/Math.log(10)-d)/a;this.arr.push(this.colzmin);for(var c=1;c<a;c++)this.arr.push(Math.exp((d+b*c)*Math.log(10)));this.arr.push(this.colzmax);
this.custom=!0}else for(this.colzmin===this.colzmax&&0!==this.colzmin&&(this.colzmax+=.01*Math.abs(this.colzmax),this.colzmin-=.01*Math.abs(this.colzmin)),d=(this.colzmax-this.colzmin)/a,b=0;b<=a;b++)this.arr.push(this.colzmin+d*b)};B.prototype.createCustom=function(a){this.custom=!0;for(var d=0;d<a.length;++d)this.arr.push(a[d]);this.colzmax>this.arr[this.arr.length-1]&&this.arr.push(this.colzmax)};B.prototype.configIndicies=function(a,d){this.below_min_indx=a;this.exact_min_indx=d};B.prototype.getContourIndex=
function(a){if(this.custom){var d=0,b=this.arr.length-1;if(a<this.arr[0])return-1;if(a>=this.arr[b])return b;for(;d<b-1;){var c=Math.round((d+b)/2);this.arr[c]>a?b=c:d=c}return d}return a<this.colzmin?this.below_min_indx:a===this.colzmin?this.exact_min_indx:Math.floor(.01+(a-this.colzmin)*(this.arr.length-1)/(this.colzmax-this.colzmin))};B.prototype.getPaletteColor=function(a,d){d=this.getContourIndex(d);if(0>d)return null;d=a.calcColorIndex(d,this.arr.length);return a.getColor(d)};B.prototype.getPaletteIndex=
function(a,d){d=this.getContourIndex(d);return 0>d?null:a.calcColorIndex(d,this.arr.length)};var J={kNoStats:JSROOT.BIT(9),kUserContour:JSROOT.BIT(10),kCanRebin:JSROOT.BIT(11),kLogX:JSROOT.BIT(15),kIsZoomed:JSROOT.BIT(16),kNoTitle:JSROOT.BIT(17),kIsAverage:JSROOT.BIT(18)};y.prototype=Object.create(JSROOT.ObjectPainter.prototype);y.prototype.getHisto=function(){return this.getObject()};y.prototype.getAxis=function(a){var d=this.getObject();if(d)switch(a){case "x":return d.fXaxis;case "y":return d.fYaxis;
case "z":return d.fZaxis}return null};y.prototype.isTProfile=function(){return this.matchObjectType("TProfile")};y.prototype.isTH1K=function(){return this.matchObjectType("TH1K")};y.prototype.isTH2Poly=function(){return this.matchObjectType(/^TH2Poly/)||this.matchObjectType(/^TProfile2Poly/)};y.prototype.clear3DScene=function(){var a=this.getFramePainter();a&&"function"===typeof a.create3DScene&&a.create3DScene(-1);this.mode3d=!1};y.prototype.cleanup=function(){this.clear3DScene();delete this.fPalette;
delete this.fContour;delete this.options;JSROOT.ObjectPainter.prototype.cleanup.call(this)};y.prototype.getDimension=function(){var a=this.getHisto();return a?a._typename.match(/^TH2/)||a._typename.match(/^TProfile2D/)?2:a._typename.match(/^TH3/)?3:this.isTH2Poly()?2:1:0};y.prototype.decodeOptions=function(a){var d=this.getHisto(),b=this.getDimension(),c=this.getPadPainter();c=c?c.getRootPad(!0):null;this.options?this.options.reset():this.options=new H;this.options.decode(a||d.fOption,b,d,c,this);
this.storeDrawOpt(a)};y.prototype.copyOptionsFrom=function(a){if(a!==this){var d=this.options;a=a.options;d.Mode3D=a.Mode3D;d.Zero=a.Zero;a.Mode3D?(d.Lego=a.Lego,d.Surf=a.Surf):(d.Color=a.Color,d.Contour=a.Contour)}};y.prototype.copyOptionsToOthers=function(){var a=this;this.forEachPainter(function(d){d!==a&&"function"==typeof d.copyOptionsFrom&&d.copyOptionsFrom(a)},"objects")};y.prototype.scanContent=function(){};y.prototype.checkPadRange=function(a){this.isMainPainter()&&(this.check_pad_range=
a?"pad_range":!0)};y.prototype.createAutoColor=function(a){if(!a){var d=this.getPadPainter().getRootPad(!0);a=d&&d.fPrimitves?d.fPrimitves.arr.length:5}var b=this._auto_color||0;this._auto_color=b+1;if(d=this.getHistPalette())return 2>a&&(a=2),b>=a&&(b=a-1),a=Math.round(b*(d.getLength()-3)/(a-1)),d=d.getColor(a),this.addColor(d);this._auto_color%=8;return b+2};y.prototype.createHistDrawAttributes=function(){var a=this.getHisto();if(this.options._pfc||this.options._plc||this.options._pmc){var d=this.getMainPainter();
d&&d.createAutoColor&&(d=d.createAutoColor(),this.options._pfc&&(a.fFillColor=d,delete this.fillatt),this.options._plc&&(a.fLineColor=d,delete this.lineatt),this.options._pmc&&(a.fMarkerColor=d,delete this.markeratt),this.options._pfc=this.options._plc=this.options._pmc=!1)}this.createAttFill({attr:a,color:this.options.histoFillColor,kind:1});this.createAttLine({attr:a,color0:this.options.histoLineColor})};y.prototype.setSnapId=function(a){var d=this;this.snapid=a;this.getPadPainter().forEachPainterInPad(function(b){if(b.child_painter_id===
d.hist_painter_id){var c=b.getObject();c&&c.fName&&(b.snapid=a+"#func_"+c.fName)}},"objects")};y.prototype.updateObject=function(a,d){var b=this.getHisto(),c=this.getFramePainter(),f=this.getPadPainter();if(a!==b){var e=function(a,b){a.fTitle=b.fTitle;a.fLabels=b.fLabels;a.fXmin=b.fXmin;a.fXmax=b.fXmax;a.fTimeDisplay=b.fTimeDisplay;a.fTimeFormat=b.fTimeFormat;a.fAxisColor=b.fAxisColor;a.fLabelColor=b.fLabelColor;a.fLabelFont=b.fLabelFont;a.fLabelOffset=b.fLabelOffset;a.fLabelSize=b.fLabelSize;a.fNdivisions=
b.fNdivisions;a.fTickLength=b.fTickLength;a.fTitleColor=b.fTitleColor;a.fTitleFont=b.fTitleFont;a.fTitleOffset=b.fTitleOffset;a.fTitleSize=b.fTitleSize};if(!this.matchObjectType(a))return!1;var g=f?f.findPainterFor(this.findStat()):null;b.TestBit(J.kNoStats)!=a.TestBit(J.kNoStats)&&(b.fBits=a.fBits,g&&(g.Enabled=!b.TestBit(J.kNoStats)));void 0!==this.snapid&&(b.fName=a.fName);b.fFillColor=a.fFillColor;b.fFillStyle=a.fFillStyle;b.fLineColor=a.fLineColor;b.fLineStyle=a.fLineStyle;b.fLineWidth=a.fLineWidth;
b.fEntries=a.fEntries;b.fTsumw=a.fTsumw;b.fTsumwx=a.fTsumwx;b.fTsumwx2=a.fTsumwx2;b.fXaxis.fNbins=a.fXaxis.fNbins;1<this.getDimension()&&(b.fTsumwy=a.fTsumwy,b.fTsumwy2=a.fTsumwy2,b.fTsumwxy=a.fTsumwxy,b.fYaxis.fNbins=a.fYaxis.fNbins,2<this.getDimension()&&(b.fTsumwz=a.fTsumwz,b.fTsumwz2=a.fTsumwz2,b.fTsumwxz=a.fTsumwxz,b.fTsumwyz=a.fTsumwyz,b.fZaxis.fNbins=a.fZaxis.fNbins));b.fArray=a.fArray;b.fNcells=a.fNcells;b.fTitle=a.fTitle;b.fMinimum=a.fMinimum;b.fMaximum=a.fMaximum;e(b.fXaxis,a.fXaxis);e(b.fYaxis,
a.fYaxis);e(b.fZaxis,a.fZaxis);this.snapid&&(e=function(a,b,d){c&&c.zoomChangedInteractive(d)||(a.fFirst=b.fFirst,a.fLast=b.fLast,a.fBits=b.fBits)},e(b.fXaxis,a.fXaxis,"x"),e(b.fYaxis,a.fYaxis,"y"),e(b.fZaxis,a.fZaxis,"z"));b.fSumw2=a.fSumw2;this.isTProfile()?b.fBinEntries=a.fBinEntries:this.isTH1K()?(b.fNIn=a.fNIn,b.fReady=!1):this.isTH2Poly()&&(b.fBins=a.fBins);if(this.options.Func){var k=[];e=[];var t=this.hist_painter_id;f&&f.forEachPainterInPad(function(a){a.child_painter_id===t&&k.push(a)},
"objects");if(a.fFunctions)for(var n=0;n<a.fFunctions.arr.length;++n){var l=a.fFunctions.arr[n];if(l&&l._typename&&this.needDrawFunc(b,l)){for(var z=null,u=-1,m=0;m<k.length;++m)if(k[m].matchObjectType(l._typename)&&k[m].getObject().fName===l.fName){z=k[m];u=m;break}!z&&l.fName&&(z=f?f.findPainterFor(null,l.fName,l._typename):null);z?(z.updateObject(l),0<=u&&k.splice(u,1)):e.push(l)}}g&&(g=k.indexOf(g),0<=g&&k.splice(g,1));f&&0<k.length&&f.cleanPrimitives(function(a){return 0<=k.indexOf(a)});if(f&&
0<e.length){g=[];var r=f.has_canvas?f.selectCurrentPad(f.this_pad_name):void 0;for(n=0;n<e.length;++n)g.push(JSROOT.draw(this.getDom(),e[n]));Promise.all(g).then(function(a){for(var b=0;b<a.length;++b)a[b]&&(a[b].child_painter_id=t);f.selectCurrentPad(r)})}}e=b.fOption!=a.fOption;b.fOption=a.fOption;(void 0!==d&&this.options.original!==d||e)&&this.decodeOptions(d||b.fOption)}this.options.ominimum||(this.options.minimum=b.fMinimum);this.options.omaximum||(this.options.maximum=b.fMaximum);!this.snapid&&
c&&c.zoomChangedInteractive()||this.checkPadRange();this.scanContent();return this.histogram_updated=!0};y.prototype.extractAxesProperties=function(a){function d(a){a.fXbins.length>=a.fNbins?(a.regular=!1,a.GetBinCoord=function(a){var b=Math.round(a);if(0>=b)return this.fXmin;if(b>this.fNbins)return this.fXmax;if(b==a)return this.fXbins[b];var c=a<b?b-1:b+1;return this.fXbins[b]*Math.abs(a-c)+this.fXbins[c]*Math.abs(a-b)},a.FindBin=function(a,b){for(var c=1;c<this.fXbins.length;++c)if(a<this.fXbins[c])return Math.floor(c-
1+b);return this.fNbins}):(a.regular=!0,a.binwidth=(a.fXmax-a.fXmin)/(a.fNbins||1),a.GetBinCoord=function(a){return this.fXmin+a*this.binwidth},a.FindBin=function(a,b){return Math.floor((a-this.fXmin)/this.binwidth+b)})}this.nbinsx=this.nbinsy=this.nbinsz=0;var b=this.getHisto();this.nbinsx=b.fXaxis.fNbins;this.xmin=b.fXaxis.fXmin;this.xmax=b.fXaxis.fXmax;d(b.fXaxis);this.ymin=b.fYaxis.fXmin;this.ymax=b.fYaxis.fXmax;1<a&&(this.nbinsy=b.fYaxis.fNbins,d(b.fYaxis));2<a&&(this.nbinsz=b.fZaxis.fNbins,
this.zmin=b.fZaxis.fXmin,this.zmax=b.fZaxis.fXmax,d(b.fZaxis))};y.prototype.drawAxes=function(){var a=this.getFramePainter();if(!a)return Promise.resolve(!1);var d=this.getHisto();this.ymin===this.ymax&&(this.ymax+=1);if(this.isMainPainter())return a.setAxesRanges(d.fXaxis,this.xmin,this.xmax,d.fYaxis,this.ymin,this.ymax,d.fZaxis,0,0),a.createXY({ndim:this.getDimension(),check_pad_range:this.check_pad_range,zoom_ymin:this.zoom_ymin,zoom_ymax:this.zoom_ymax,ymin_nz:this.ymin_nz,swap_xy:20<=this.options.BarStyle,
reverse_x:this.options.RevX,reverse_y:this.options.RevY,symlog_x:this.options.SymlogX,symlog_y:this.options.SymlogY,Proj:this.options.Proj,extra_y_space:this.options.Text&&0<this.options.BarStyle}),delete this.check_pad_range,this.options.Same?Promise.resolve(!1):a.drawAxes(!1,0>this.options.Axis,0>this.options.Axis,this.options.AxisPos,this.options.Zscale);var b={second_x:10<=this.options.AxisPos,second_y:1==this.options.AxisPos%10};if(!b.second_x&&!b.second_y||a.hasDrawnAxes(b.second_x,b.second_y))return Promise.resolve(!1);
a.setAxes2Ranges(b.second_x,d.fXaxis,this.xmin,this.xmax,b.second_y,d.fYaxis,this.ymin,this.ymax);a.createXY2(b);return a.drawAxes2(b.second_x,b.second_y)};y.prototype.toggleTitle=function(a){var d=this.getHisto();if(!this.isMainPainter()||!d)return!1;if("only-check"===a)return!d.TestBit(J.kNoTitle);d.InvertBit(J.kNoTitle);this.drawHistTitle()};y.prototype.drawHistTitle=function(){var a=this;if(!this.isMainPainter()||this.options.Same)return Promise.resolve(this);var d=this.getHisto(),b=JSROOT.gStyle,
c=this.getPadPainter(),f=c?c.findPainterFor(null,"title"):null,e=f?f.getObject():null,g=!d.TestBit(J.kNoTitle)&&0<b.fOptTitle;!e&&c&&"function"==typeof c.findInPrimitives&&(e=c.findInPrimitives("title","TPaveText"));if(e){if(e.Clear(),g&&e.AddText(d.fTitle),f)return f.redraw().then(function(){return a})}else if(g&&!f&&d.fTitle&&!this.options.PadTitle)return e=JSROOT.create("TPaveText"),e.fName="title",e.fTextFont=b.fTitleFont,e.fTextSize=b.fTitleFontSize,e.fTextColor=b.fTitleTextColor,e.fTextAlign=
b.fTitleAlign,e.fFillColor=b.fTitleColor,e.fFillStyle=b.fTitleStyle,e.fBorderSize=b.fTitleBorderSize,e.AddText(d.fTitle),T(this.getDom(),e,"postitle").then(function(b){b&&(b.$secondary=!0);return a});return Promise.resolve(this)};y.prototype.processTitleChange=function(a){var d=this.getHisto(),b=this.getPadPainter();b=b?b.findPainterFor(null,"title"):null;if(!d||!b)return null;if("check"===a)return!this.isMainPainter()||this.options.Same?null:d;b.clearPave();b.addText(d.fTitle);b.redraw();this.submitCanvExec('SetTitle("'+
d.fTitle+'")')};y.prototype.updateStatWebCanvas=function(){if(this.snapid){var a=this.findStat(),d=this.getPadPainter();(a=d?d.findPainterFor(a):null)&&!a.snapid&&a.redraw()}};y.prototype.findStat=function(){if(this.options.PadStats){var a=this.getPadPainter();return(a=a?a.findPainterFor(null,"stats","TPaveStats"):null)?a.getObject():null}return this.findFunction("TPaveStats","stats")};y.prototype.toggleStat=function(a){var d=this,b=this.findStat(),c=this.getPadPainter(),f=null;a||(a="");if(b)f=c?
c.findPainterFor(b):null;else{if(0<a.indexOf("-check"))return!1;b=this.createStat(!0)}if("only-check"==a)return f?f.Enabled:!1;if("fitpar-check"==a)return b?b.fOptFit:!1;if("fitpar-toggle"==a){if(!b)return!1;b.fOptFit=b.fOptFit?0:1111;f&&f.redraw();return!0}if(f)return f.Enabled=!f.Enabled,this.options.StatEnabled=f.Enabled,f.redraw(),f.Enabled;var e=this.selectCurrentPad(this.getPadName());JSROOT.draw(this.getDom(),b).then(function(){d.selectCurrentPad(e)});return!0};y.prototype.isIgnoreStatsFill=
function(){return!this.getObject()||!this.draw_content&&!this.create_stats&&!this.snapid||0<this.options.Axis};y.prototype.createStat=function(a){var d=this.getHisto();if(this.options.PadStats||!d||!a&&!this.options.ForceStat&&(this.options.NoStat||d.TestBit(J.kNoStats)||!JSROOT.settings.AutoStat||0<this.options.Axis||!this.isMainPainter()))return null;a=this.findStat();var b=JSROOT.gStyle,c=this.options.optstat,f=this.options.optfit;void 0!==c?(a&&(a.fOptStat=c),delete this.options.optstat):c=d.$custom_stat||
b.fOptStat;void 0!==f?(a&&(a.fOptFit=f),delete this.options.optfit):f=b.fOptFit;if(!a&&!c&&!f)return null;this.create_stats=!0;if(a)return a;a=JSROOT.create("TPaveStats");JSROOT.extend(a,{fName:"stats",fOptStat:c,fOptFit:f,fBorderSize:1});a.fX1NDC=b.fStatX-b.fStatW;a.fY1NDC=b.fStatY-b.fStatH;a.fX2NDC=b.fStatX;a.fY2NDC=b.fStatY;a.fFillColor=b.fStatColor;a.fFillStyle=b.fStatStyle;a.fTextAngle=0;a.fTextSize=b.fStatFontSize;a.fTextAlign=12;a.fTextColor=b.fStatTextColor;a.fTextFont=b.fStatFont;if(d._typename.match(/^TProfile/)||
d._typename.match(/^TH2/))a.fY1NDC=.67;a.AddText(d.fName);this.addFunction(a);return a};y.prototype.findFunction=function(a,d){var b=this.getHisto();b=b&&b.fFunctions?b.fFunctions.arr:null;if(!b)return null;for(var c=0;c<b.length;++c)if((!d||b[c].fName===d)&&b[c]._typename===a)return b[c];return null};y.prototype.addFunction=function(a,d){var b=this.getHisto();b&&a&&(b.fFunctions||(b.fFunctions=JSROOT.create("TList")),d?b.fFunctions.AddFirst(a):b.fFunctions.Add(a))};y.prototype.needDrawFunc=function(a,
d){return"TPaveText"===d._typename||"TPaveStats"===d._typename?!a.TestBit(J.kNoStats)&&!this.options.NoStat:"TF1"===d._typename?!d.TestBit(JSROOT.BIT(9)):"TPaletteAxis"!==d._typename};y.prototype.drawNextFunction=function(a){var d=this,b=this.getHisto();if(!this.options.Func||!b.fFunctions||a>=b.fFunctions.arr.length)return Promise.resolve(!0);var c=b.fFunctions.arr[a],f=b.fFunctions.opt[a],e=this.getPadPainter(),g=!1;e&&e.findPainterFor(c)||!c||(g=this.needDrawFunc(b,c));if(!g)return this.drawNextFunction(a+
1);c.$histo=b;return JSROOT.draw(this.getDom(),c,f).then(function(b){b&&"object"==typeof b&&(b.child_painter_id=d.hist_painter_id);return d.drawNextFunction(a+1)})};y.prototype.getSelectIndex=function(a,d,b){var c=this["nbins"+a]||0,f=this.getAxis(a);this.options.second_x&&"x"==a&&(a="x2");this.options.second_y&&"y"==a&&(a="y2");var e=this.getFramePainter(),g=e?e["zoom_"+a+"min"]:0;a=e?e["zoom_"+a+"max"]:0;g!==a&&f?(b="left"==d?f.FindBin(g,b||0):f.FindBin(a,(b||0)+.5),0>b?b=0:b>c&&(b=c)):b="left"==
d?0:c;f&&(f.fFirst===f.fLast||!f.TestBit(JSROOT.EAxisBits.kAxisRange)||1>=f.fFirst&&f.fLast>=c)&&(f=void 0);"left"==d?(0>b&&(b=0),f&&1<f.fFirst&&b<f.fFirst&&(b=f.fFirst-1)):(b>c&&(b=c),f&&f.fLast<=c&&b>f.fLast&&(b=f.fLast));return b};y.prototype.unzoomUserRange=function(a,d,b){var c=this,f=!1,e=this.getHisto();if(!e)return!1;var g=function(a){if(!a||!a.TestBit(JSROOT.EAxisBits.kAxisRange)||a.fFirst===a.fLast||1>=a.fFirst&&a.fLast>=a.fNbins)return!1;a.InvertBit(JSROOT.EAxisBits.kAxisRange);return!0},
k=function(a){if(c.getDimension()!==a||-1111===c.options.minimum&&-1111===c.options.maximum||!c.draw_content)return!1;c.options.minimum=c.options.maximum=-1111;c.scanContent(!0);return!0};a&&g(e.fXaxis)&&(f=!0);d&&(g(e.fYaxis)||k(1))&&(f=!0);b&&(g(e.fZaxis)||k(2))&&(f=!0);return f};y.prototype.addInteractivity=function(){var a=this.isMainPainter(),d=0<this.options.AxisPos,b=a||d?this.getFramePainter():null;return b?b.addInteractivity(!a&&d):Promise.resolve(!1)};y.prototype.changeUserRange=function(a,
d){var b=this,c=this.getHisto(),f=c?c["f"+d+"axis"]:null;f&&(c="[1,"+f.fNbins+"]",f.TestBit(JSROOT.EAxisBits.kAxisRange)&&(c="["+f.fFirst+","+f.fLast+"]"),a.input("Enter user range for axis "+d+" like [1,"+f.fNbins+"]",c).then(function(a){if(a&&(a=JSON.parse(a))&&2==a.length){var c=parseInt(a[0]);a=parseInt(a[1]);Number.isInteger(c)&&Number.isInteger(a)&&(f.fFirst=c,f.fLast=a,(f.fFirst<f.fLast&&1<=f.fFirst&&f.fLast<=f.fNbins)!=f.TestBit(JSROOT.EAxisBits.kAxisRange)&&f.InvertBit(JSROOT.EAxisBits.kAxisRange),
b.interactiveRedraw())}}))};y.prototype.changeValuesRange=function(a){var d=this;a.input("Enter min/max hist values or empty string to reset",-1111!=this.options.minimum&&-1111!=this.options.maximum?"["+this.options.minimum+","+this.options.maximum+"]":"["+this.gminbin+","+this.gmaxbin+"]").then(function(a){(a=a?JSON.parse(a):[])&&"object"==typeof a&&2==a.length&&Number.isFinite(a[0])&&Number.isFinite(a[1])?(d.options.minimum=a[0],d.options.maximum=a[1]):d.options.minimum=d.options.maximum=-1111;
d.interactiveRedraw()})};y.prototype.fillContextMenu=function(a){var d=this,b=this.getHisto(),c=this.getFramePainter();if(b){a.add("header:"+b._typename+"::"+b.fName);0>=this.options.Axis&&a.addchk(this.toggleStat("only-check"),"Show statbox",function(){return d.toggleStat()});this.draw_content&&(1==this.getDimension()?a.add("User range X",function(){return d.changeUserRange(a,"X")}):(a.add("sub:User ranges"),a.add("X",function(){return d.changeUserRange(a,"X")}),a.add("Y",function(){return d.changeUserRange(a,
"Y")}),2<this.getDimension()?a.add("Z",function(){return d.changeUserRange(a,"Z")}):a.add("Values",function(){return d.changeValuesRange(a)}),a.add("endsub:")),"function"==typeof this.fillHistContextMenu&&this.fillHistContextMenu(a));if(this.options.Mode3D){0<a.size()&&a.add("separator");var f=this.getMainPainter()||this;a.addchk(f.isTooltipAllowed(),"Show tooltips",function(){f.setTooltipAllowed("toggle")});a.addchk(c.enable_highlight,"Highlight bins",function(){c.enable_highlight=!c.enable_highlight;
!c.enable_highlight&&c.highlightBin3D&&c.mode3d&&c.highlightBin3D(null)});c&&c.render3D&&(a.addchk(f.options.FrontBox,"Front box",function(){f.options.FrontBox=!f.options.FrontBox;c.render3D()}),a.addchk(f.options.BackBox,"Back box",function(){f.options.BackBox=!f.options.BackBox;c.render3D()}));this.draw_content&&(a.addchk(!this.options.Zero,"Suppress zeros",function(){this.options.Zero=!this.options.Zero;this.interactiveRedraw("pad")}),12==this.options.Lego||14==this.options.Lego)&&(a.addchk(this.options.Zscale,
"Z scale",function(){return d.toggleColz()}),this.fillPaletteMenu&&this.fillPaletteMenu(a));f.control&&"function"===typeof f.control.reset&&a.add("Reset camera",function(){f.control.reset()})}a.addAttributesMenu(this);this.histogram_updated&&c.zoomChangedInteractive()&&a.add("Let update zoom",function(){c.zoomChangedInteractive("reset")});return!0}};y.prototype.clickButton=function(a){var d=this.getFramePainter();if(!this.isMainPainter()||!d)return!1;switch(a){case "ToggleZoom":if(d.zoom_xmin!==d.zoom_xmax||
d.zoom_ymin!==d.zoom_ymax||d.zoom_zmin!==d.zoom_zmax)return d.unzoom(),d.zoomChangedInteractive("reset"),!0;if(this.draw_content&&"function"===typeof this.autoZoom)return this.autoZoom(),!0;break;case "ToggleLogX":d.toggleAxisLog("x");break;case "ToggleLogY":d.toggleAxisLog("y");break;case "ToggleLogZ":d.toggleAxisLog("z");break;case "ToggleStatBox":return this.toggleStat(),!0}return!1};y.prototype.fillToolbar=function(a){var d=this.getPadPainter();d&&(d.addPadButton("auto_zoom","Toggle between unzoom and autozoom-in",
"ToggleZoom","Ctrl *"),d.addPadButton("arrow_right","Toggle log x","ToggleLogX","PageDown"),d.addPadButton("arrow_up","Toggle log y","ToggleLogY","PageUp"),1<this.getDimension()&&d.addPadButton("arrow_diag","Toggle log z","ToggleLogZ"),0>=this.options.Axis&&d.addPadButton("statbox","Toggle stat box","ToggleStatBox"),a||d.showPadButtons())};y.prototype.get3DToolTip=function(a){var d=this.getHisto(),b={bin:a,name:d.fName,title:d.fTitle};switch(this.getDimension()){case 1:b.ix=a;b.iy=1;b.value=d.getBinContent(b.ix);
b.error=d.getBinError(a);b.lines=this.getBinTooltips(a-1);break;case 2:b.ix=a%(this.nbinsx+2);b.iy=(a-b.ix)/(this.nbinsx+2);b.value=d.getBinContent(b.ix,b.iy);b.error=d.getBinError(a);b.lines=this.getBinTooltips(b.ix-1,b.iy-1);break;case 3:b.ix=a%(this.nbinsx+2),b.iy=(a-b.ix)/(this.nbinsx+2)%(this.nbinsy+2),b.iz=(a-b.ix-b.iy*(this.nbinsx+2))/(this.nbinsx+2)/(this.nbinsy+2),b.value=d.getBinContent(b.ix,b.iy,b.iz),b.error=d.getBinError(a),b.lines=this.getBinTooltips(b.ix-1,b.iy-1,b.iz-1)}return b};
y.prototype.createContour=function(a,d,b,c,f){d=new B(d,b);f?d.createCustom(f):(2>a&&(a=JSROOT.gStyle.fNumberContours),f=this.getPadPainter().getRootPad(!0),d.createNormal(a,f?f.fLogz:0,c),d.configIndicies(this.options.Zero?-1:0,0!=d.colzmin||!this.options.Zero||this.isTH2Poly()?0:-1));a=this.getFramePainter();3>this.getDimension()&&a&&(a.zmin=d.colzmin,a.zmax=d.colzmax);return this.fContour=d};y.prototype.getContour=function(a){if(this.fContour&&!a)return this.fContour;var d=this.getMainPainter();
a=this.getFramePainter();if(d&&d!==this&&d.fContour)return this.fContour=d.fContour;d=this.getObject();var b=0,c=this.minbin,f=this.maxbin,e=this.minposbin,g;c===f&&(c=this.gminbin,f=this.gmaxbin,e=this.gminposbin);-1111!==this.options.minimum&&-1111!=this.options.maximum&&(c=this.options.minimum,f=this.options.maximum);a&&a.zoom_zmin!=a.zoom_zmax&&(c=a.zoom_zmin,f=a.zoom_zmax);d.fContour&&1<d.fContour.length&&(d.TestBit(J.kUserContour)?g=d.fContour:b=d.fContour.length);return this.createContour(b,
c,f,e,g)};y.prototype.getContourLevels=function(){return this.getContour().getLevels()};y.prototype.getHistPalette=function(a){a&&(this.fPalette=null);this.fPalette||this.options.Palette||(a=this.getPadPainter())&&a.getCustomPalette&&(this.fPalette=a.getCustomPalette());this.fPalette||(this.fPalette=da(this.options.Palette));return this.fPalette};y.prototype.fillPaletteMenu=function(a){var d=this,b=this.options.Palette||JSROOT.settings.Palette,c=function(c,e,g){return a.addchk(c===b||g,"<nobr>"+e+
"</nobr>",c,function(a){d.options.Palette=parseInt(a);d.getHistPalette(!0);d.redraw()})};a.add("sub:Palette");c(50,"ROOT 5",10<=b&&51>b);c(51,"Deep Sea");c(52,"Grayscale",0<b&&10>b);c(53,"Dark body radiator");c(54,"Two-color hue");c(55,"Rainbow");c(56,"Inverted dark body radiator");c(57,"Bird",113<b);c(58,"Cubehelix");c(59,"Green Red Violet");c(60,"Blue Red Yellow");c(61,"Ocean");c(62,"Color Printable On Grey");c(63,"Alpine");c(64,"Aquamarine");c(65,"Army");c(66,"Atlantic");a.add("endsub:")};y.prototype.drawColorPalette=
function(a,d,b){var c=this,f=this.getMainPainter();if(f!==this&&f&&!1!==f.draw_content)return Promise.resolve(null);var e=this.findFunction("TPaletteAxis"),g=this.getPadPainter();f=g?g.findPainterFor(e):null;this._can_move_colz&&(b=!0,delete this._can_move_colz);f||e||!(f=g?g.findPainterFor(void 0,void 0,"TPaletteAxis"):null)||(e=f.getObject(),this.addFunction(e,!0));if(!a)return f&&(f.Enabled=!1,f.removeG()),Promise.resolve(null);if(!e){if(this.options.PadPalette)return Promise.resolve(null);e=JSROOT.create("TPave");
JSROOT.extend(e,{_typename:"TPaletteAxis",fName:"TPave",fH:null,fAxis:JSROOT.create("TGaxis"),fX1NDC:.905,fX2NDC:.945,fY1NDC:.1,fY2NDC:.9,fInit:1,$can_move:!0});a=this.getHisto().fZaxis;JSROOT.extend(e.fAxis,{fTitle:a.fTitle,fTitleSize:a.fTitleSize,fChopt:"+",fLineColor:a.fAxisColor,fLineSyle:1,fLineWidth:1,fTextAngle:0,fTextSize:a.fLabelSize,fTextAlign:11,fTextColor:a.fLabelColor,fTextFont:a.fLabelFont});this.addFunction(e,!0);b=!0}var k=this.getFramePainter();b&&k&&e.$can_move&&(e.fX2NDC=k.fX2NDC+
.005+(e.fX2NDC-e.fX1NDC),e.fX1NDC=k.fX2NDC+.005,e.fY1NDC=k.fY1NDC,e.fY2NDC=k.fY2NDC);e.$main_painter=this;a="";d&&(a+=";postpone");b&&!this.do_redraw_palette&&(a+=";can_move");if(f)f.Enabled=!0,f=f.drawPave(a);else{var t=this.selectCurrentPad(this.getPadName());f=T(this.getDom(),e,a).then(function(a){c.selectCurrentPad(t);return a})}return f.then(function(a){a.$secondary=!0;a.redraw=function(){};b&&k&&e.fX1NDC-.005<k.fX2NDC&&!c.do_redraw_palette&&(c.do_redraw_palette=!0,k.fX2NDC=e.fX1NDC-.01,k.redraw(),
d||c.redraw(),delete c.do_redraw_palette);return a})};y.prototype.toggleColz=function(){if(this.options.Mode3D?12===this.options.Lego||14===this.options.Lego||11===this.options.Surf||12===this.options.Surf:this.options.Color||this.options.Contour)this.options.Zscale=!this.options.Zscale,this.drawColorPalette(this.options.Zscale,!1,!0)};y.prototype.toggleMode3D=function(){this.options.Mode3D=!this.options.Mode3D;!this.options.Mode3D||this.options.Surf||this.options.Lego||this.options.Error||(this.options.Lego=
50<=this.nbinsx||50<=this.nbinsy?this.options.Color?14:13:this.options.Color?12:1,this.options.Zero=!1);this.copyOptionsToOthers();this.interactiveRedraw("pad","drawopt")};y.prototype.prepareColorDraw=function(a){a||(a={rounding:!0,extra:0,middle:0});void 0===a.extra&&(a.extra=0);void 0===a.middle&&(a.middle=0);var d=this.getHisto(),b=d.fXaxis,c=d.fYaxis,f=this.getFramePainter(),e=this.getDimension(),g,k={i1:this.getSelectIndex("x","left",0-a.extra),i2:this.getSelectIndex("x","right",1+a.extra),j1:1===
e?0:this.getSelectIndex("y","left",0-a.extra),j2:1===e?1:this.getSelectIndex("y","right",1+a.extra),min:0,max:0,sumz:0,xbar1:0,xbar2:1,ybar1:0,ybar2:1};k.grx=new Float32Array(k.i2+1);k.gry=new Float32Array(k.j2+1);"number"!=typeof d.fBarOffset||"number"!=typeof d.fBarWidth||!d.fBarOffset&&1E3===d.fBarWidth||(1E3>=d.fBarOffset?k.xbar1=k.ybar1=.001*d.fBarOffset:3E3>=d.fBarOffset?k.xbar1=.001*(d.fBarOffset-2E3):5E3>=d.fBarOffset&&(k.ybar1=.001*(d.fBarOffset-4E3)),1E3>=d.fBarWidth?(k.xbar2=Math.min(1,
k.xbar1+.001*d.fBarWidth),k.ybar2=Math.min(1,k.ybar1+.001*d.fBarWidth)):3E3>=d.fBarWidth?k.xbar2=Math.min(1,k.xbar1+.001*(d.fBarWidth-2E3)):5E3>=d.fBarWidth&&(k.ybar2=Math.min(1,k.ybar1+.001*(d.fBarWidth-4E3))));a.original&&(k.original=!0,k.origx=new Float32Array(k.i2+1),k.origy=new Float32Array(k.j2+1));a.pixel_density&&(a.rounding=!0);if(!f)return console.warn("cannot draw histogram without frame"),k;var t=f.getGrFuncs(this.options.second_x,this.options.second_y);for(g=k.i1;g<=k.i2;++g){var n=b.GetBinCoord(g+
a.middle);t.logx&&0>=n?k.i1=g+1:(k.origx&&(k.origx[g]=n),k.grx[g]=t.grx(n),a.rounding&&(k.grx[g]=Math.round(k.grx[g])),a.use3d&&(k.grx[g]<-f.size_x3d&&(k.i1=g,k.grx[g]=-f.size_x3d),k.grx[g]>f.size_x3d&&(k.i2=g,k.grx[g]=f.size_x3d)))}if(1===e)k.gry[0]=t.gry(0),k.gry[1]=t.gry(1);else for(b=k.j1;b<=k.j2;++b)g=c.GetBinCoord(b+a.middle),t.logy&&0>=g?k.j1=b+1:(k.origy&&(k.origy[b]=g),k.gry[b]=t.gry(g),a.rounding&&(k.gry[b]=Math.round(k.gry[b])),a.use3d&&(k.gry[b]<-f.size_y3d&&(k.j1=b,k.gry[b]=-f.size_y3d),
k.gry[b]>f.size_y3d&&(k.j2=b,k.gry[b]=f.size_y3d)));this.maxbin=this.minbin=this.minposbin=null;for(g=k.i1;g<k.i2;++g)for(b=k.j1;b<k.j2;++b){c=d.getBinContent(g+1,b+1);k.sumz+=c;if(a.pixel_density){f=(k.grx[g+1]-k.grx[g])*(k.gry[b]-k.gry[b+1]);if(0>=f)continue;k.max=Math.max(k.max,c);0<c&&(c<k.min||0===k.min)&&(k.min=c);c/=f}null===this.maxbin?this.maxbin=this.minbin=c:(this.maxbin=Math.max(this.maxbin,c),this.minbin=Math.min(this.minbin,c));0<c&&(null===this.minposbin||c<this.minposbin)&&(this.minposbin=
c)}this.fContour=null;return k};y.prototype.getAxisBinTip=function(a,d,b){var c=this.getFramePainter().getGrFuncs(this.options.second_x,this.options.second_y),f=c[a+"_handle"],e=d.GetBinLowEdge(b+1);if("labels"===f.kind)return c.axisAsText(a,e);d=d.GetBinLowEdge(b+2);return"time"===f.kind?c.axisAsText(a,(e+d)/2):"["+c.axisAsText(a,e)+", "+c.axisAsText(a,d)+")"};G.prototype=Object.create(y.prototype);G.prototype.convertTH1K=function(){var a=this.getObject();if(!a.fReady){var d=a.fArray,b=a.fEntries;
a.fNcells=a.fXaxis.fNbins+2;a.fArray=new Float64Array(a.fNcells);for(var c=0;c<a.fNcells;++c)a.fArray[c]=0;for(c=0;c<a.fNIn;++c)a.Fill(d[c]);a.fReady=!0;a.fEntries=b}};G.prototype.scanContent=function(a){a&&!this.nbinsx&&(a=!1);this.isTH1K()&&this.convertTH1K();var d=this.getHisto();a||this.extractAxesProperties(1);var b=this.getSelectIndex("x","left"),c=this.getSelectIndex("x","right");if(!a||b!==this.scan_xleft||c!==this.scan_xright){this.draw_content=!(0<this.options.Axis);this.scan_xleft=b;this.scan_xright=
c;for(var f=0,e=0,g=0,k=0,t=!0,n=this.isTProfile(),l,z,u=0;u<this.nbinsx;++u)l=d.getBinContent(u+1),k+=n?d.fBinEntries[u+1]:l,u<b||u>=c||(0<l&&(0==e||l<e)&&(e=l),t&&(f=g=l,t=!1),z=this.options.Error?d.getBinError(u+1):0,f=Math.min(f,l-z),g=Math.max(g,l+z));this.stat_entries=k=n?k+(d.fBinEntries[0]+d.fBinEntries[this.nbinsx+1]):k+(d.getBinContent(0)+d.getBinContent(this.nbinsx+1));1<d.fEntries&&(this.stat_entries=d.fEntries);this.hmin=f;this.hmax=g;this.ymin_nz=e;if(0==this.nbinsx||1E-300>Math.abs(f)&&
1E-300>Math.abs(g))this.draw_content=!1;d=!1;this.draw_content&&(f>=g?0==f?(this.ymin=0,this.ymax=1):0>f?(this.ymin=2*f,this.ymax=0):(this.ymin=0,this.ymax=2*f):(b=.05*(g-f),this.ymin=f-b,0>this.ymin&&0<=f&&(this.ymin=0),this.ymax=g+b));f=this.options.minimum;g=this.options.maximum;f===g&&-1111!==f&&(0>f?(f*=2,g=0):(f=0,(g*=2)||(g=1)));-1111==f||-1111==g||this.draw_content?(-1111!=f&&(f<this.ymin?this.ymin=f:d=!0),-1111!=g&&(g>this.ymax?this.ymax=g:d=!0)):(this.ymin=f,this.ymax=g);a||(d&&this.draw_content?
(this.zoom_ymin=-1111==f?this.ymin:f,this.zoom_ymax=-1111==g?this.ymax:g):(delete this.zoom_ymin,delete this.zoom_ymax));this.wheel_zoomy=1<this.getDimension()||!this.draw_content}};G.prototype.countStat=function(a){for(var d=this.isTProfile(),b=this.getHisto(),c=b.fXaxis,f=this.getSelectIndex("x","left"),e=this.getSelectIndex("x","right"),g=0,k=0,t=0,n=0,l=0,z,u,m=null,r=null,q=this.getFramePainter(),v={name:b.fName,meanx:0,meany:0,rmsx:0,rmsy:0,integral:0,entries:this.stat_entries,xmax:0,wmax:0};f<
e;++f)if(z=c.GetBinCoord(f+.5),!a||a(z)){d?(u=b.fBinEntries[f+1],n+=b.fArray[f+1],l+=b.fSumw2[f+1]):u=b.getBinContent(f+1);if(null===m||u>r)m=z,r=u;g+=u;k+=u*z;t+=u*z*z}!q.isAxisZoomed("x")&&0<b.fTsumw&&(g=b.fTsumw,k=b.fTsumwx,t=b.fTsumwx2);v.integral=g;0<g&&(v.meanx=k/g,v.meany=n/g,v.rmsx=Math.sqrt(Math.abs(t/g-v.meanx*v.meanx)),v.rmsy=Math.sqrt(Math.abs(l/g-v.meany*v.meany)));null!==m&&(v.xmax=m,v.wmax=r);return v};G.prototype.fillStatistic=function(a,d,b){if(this.isIgnoreStatsFill())return!1;var c=
this.getHisto(),f=this.countStat(),e=d%10,g=Math.floor(d/10)%10,k=Math.floor(d/100)%10,t=Math.floor(d/1E3)%10,n=Math.floor(d/1E4)%10,l=Math.floor(d/1E5)%10,z=Math.floor(d/1E6)%10,u=Math.floor(d/1E7)%10;d=Math.floor(d/1E8)%10;a.clearPave();0<e&&a.addText(f.name);this.isTProfile()?(0<g&&a.addText("Entries = "+a.format(f.entries,"entries")),0<k&&(a.addText("Mean = "+a.format(f.meanx)),a.addText("Mean y = "+a.format(f.meany))),0<t&&(a.addText("Std Dev = "+a.format(f.rmsx)),a.addText("Std Dev y = "+a.format(f.rmsy)))):
(0<g&&a.addText("Entries = "+a.format(f.entries,"entries")),0<k&&a.addText("Mean = "+a.format(f.meanx)),0<t&&a.addText("Std Dev = "+a.format(f.rmsx)),0<n&&a.addText("Underflow = "+a.format(0<c.fArray.length?c.fArray[0]:0,"entries")),0<l&&a.addText("Overflow = "+a.format(0<c.fArray.length?c.fArray[c.fArray.length-1]:0,"entries")),0<z&&a.addText("Integral = "+a.format(f.integral,"entries")),0<u&&a.addText("Skew = <not avail>"),0<d&&a.addText("Kurt = <not avail>"));b&&a.fillFunctionStat(this.findFunction("TF1"),
b);return!0};G.prototype.drawBars=function(a,d,b){this.createG(!0);var c=this.getSelectIndex("x","left",-1),f=this.getSelectIndex("x","right",1),e=this.getHisto(),g=e.fXaxis,k=this.options.Text,t="",n="",l="",z=10<this.options.BarStyle?this.options.BarStyle%10:0;4<z&&(z=4);var u=d.swap_xy?0:a;Number.isFinite(this.options.BaseLine)&&this.options.BaseLine>=b.scale_ymin&&(u=Math.round(b.gry(this.options.BaseLine)));if(k){var m=this.getColor(e.fMarkerColor);var r=-1*this.options.TextAngle;var q=20;1!==
e.fMarkerSize&&r&&(q=.02*a*e.fMarkerSize);this.startTextDrawing(42,q,this.draw_g,q)}for(a=c;a<f;++a){c=g.GetBinLowEdge(a+1);var v=g.GetBinLowEdge(a+2);if(!(d.logx&&0>=v)){c=Math.round(b.grx(c));var w=Math.round(b.grx(v));var W=e.getBinContent(a+1);if(!(b.logy&&W<b.scale_ymin)){v=Math.round(b.gry(W));var x=w-c;c+=Math.round(e.fBarOffset/1E3*x);x=Math.round(e.fBarWidth/1E3*x);t=d.swap_xy?t+("M"+u+","+c+"h"+(v-u)+"v"+x+"h"+(u-v)+"z"):t+("M"+c+","+v+"h"+x+"v"+(u-v)+"h"+-x+"z");0<z&&(w=c+x,x=Math.round(x*
z/10),d.swap_xy?(n+="M"+u+","+c+"h"+(v-u)+"v"+x+"h"+(u-v)+"z",l+="M"+u+","+w+"h"+(v-u)+"v"+-x+"h"+(u-v)+"z"):(n+="M"+c+","+v+"h"+x+"v"+(u-v)+"h"+-x+"z",l+="M"+w+","+v+"h"+-x+"v"+(u-v)+"h"+x+"z"));k&&W&&(w=W===Math.round(W)?W.toString():p.floatToString(W,JSROOT.gStyle.fPaintTextFormat),d.swap_xy?this.drawText({align:12,x:Math.round(v+q/2),y:Math.round(c+.1),height:Math.round(.8*x),text:w,color:m,latex:0}):r?this.drawText({align:12,x:c+x/2,y:Math.round(v-2-q/5),width:0,height:0,rotate:r,text:w,color:m,
latex:0}):this.drawText({align:22,x:Math.round(c+.1*x),y:Math.round(v-2-q),width:Math.round(.8*x),height:q,text:w,color:m,latex:0}))}}}t&&this.draw_g.append("svg:path").attr("d",t).call(this.fillatt.func);n&&this.draw_g.append("svg:path").attr("d",n).call(this.fillatt.func).style("fill",h.rgb(this.fillatt.color).brighter(.5).toString());l&&this.draw_g.append("svg:path").attr("d",l).call(this.fillatt.func).style("fill",h.rgb(this.fillatt.color).darker(.5).toString());k&&this.finishTextDrawing()};G.prototype.drawFilledErrors=
function(a){this.createG(!0);for(var d=this.getSelectIndex("x","left",-1),b=this.getSelectIndex("x","right",1),c=this.getHisto(),f=c.fXaxis,e,g,k,t,n=[],l=[];d<b;++d)e=f.GetBinCoord(d+.5),a.logx&&0>=e||(e=Math.round(a.grx(e)),g=c.getBinContent(d+1),k=c.getBinError(d+1),a.logy&&g-k<a.scale_ymin||(t=Math.round(a.gry(g+k)),g=Math.round(a.gry(g-k)),n.push({grx:e,gry:t}),l.unshift({grx:e,gry:g})));a=4===this.options.ErrorKind?"bezier":"line";n=p.buildSvgPath(a,n);l=p.buildSvgPath("L"+a,l);this.draw_g.append("svg:path").attr("d",
n.path+l.path+"Z").style("stroke","none").call(this.fillatt.func)};G.prototype.draw1DBins=function(){var a=this;this.createHistDrawAttributes();var d=this.getFramePainter(),b=d.getGrFuncs(this.options.second_x,this.options.second_y),c=d.getFrameWidth(),f=d.getFrameHeight();if(!this.draw_content||0>=c||0>=f)return this.removeG();if(this.options.Bar)return this.drawBars(f,d,b);if(3===this.options.ErrorKind||4===this.options.ErrorKind)return this.drawFilledErrors(d,b);var e=this.getSelectIndex("x","left",
-1),g=this.getSelectIndex("x","right",2),k=this.getHisto(),t=!JSROOT.batch_mode&&JSROOT.settings.Tooltip,n=k.fXaxis;d="";var l=!1,z,u,m,r,q,v,w=!this.options.Zero,h=this.options.Error,x=this.options.Mark,y=this.options.Line||this.options.Curve,ea=this.options.Text,R=ea&&"E"==this.options.TextKind&&this.isTProfile()&&k.fBinEntries,F=null,C=null,D=null,A=null,E=null,B=null,M=5,G=!1,H=!1,I=0,O=0,K,P,J,Z,Q,S,X,N,fa,T;h&&!x&&1<k.fMarkerStyle&&(x=!0);2===this.options.ErrorKind?this.fillatt.empty()?x=!0:
F="":this.options.Error&&(C="",E=t?"":null,H=!0);y&&(A="");O=this.lineatt.width+JSROOT.gStyle.fEndErrorSize;1===this.options.ErrorKind&&(I=Math.floor((this.lineatt.width-1)/2));x&&(this.createAttMarker({attr:k,style:this.options.MarkStyle}),0<this.markeratt.size?(D="",G=!0,this.markeratt.resetPos(),null===E&&t&&(!this.markeratt.fill||7>this.markeratt.getFullSize())&&(B="",M=Math.max(5,Math.round(.7*this.markeratt.getFullSize())))):x=!1);var ka=h||x,la=ka||ea||y;x=this.options.Hist&&(!this.lineatt.empty()||
!this.fillatt.empty());if(!x&&!la)return this.removeG();this.createG(!0);if(ea){var ba=this.getColor(k.fMarkerColor);var ha=-1*this.options.TextAngle;var U=20;1!==k.fMarkerSize&&ha&&(U=.02*f*k.fMarkerSize);ha||this.options.TextKind||(l=c/(g-e+1),l<3*U&&(ha=270,U=Math.round(.7*l)));this.startTextDrawing(42,U,this.draw_g,U)}var ca=g-e>3*c;la&&(ca=!0);var da=function(a){Z=k.getBinContent(a+1);if(w&&0===Z)return!1;S=Math.round(b.grx(n.GetBinLowEdge(a+1)));X=Math.round(b.grx(n.GetBinLowEdge(a+2)));N=Math.round((S+
X)/2);K=Math.round(b.gry(Z));P=J=20;h&&(Q=k.getBinError(a+1),P=Math.round(K-b.gry(Z+Q)),J=Math.round(b.gry(Z-Q)-K));return!0},ma=function(){var b=5;0<a.options.errorX&&(b=Math.round((X-S)*a.options.errorX),fa=N-b,T=N+b,C=1===a.options.ErrorKind?C+("M"+(fa+I)+","+(K-O)+"v"+2*O+"m0,-"+O+"h"+(T-fa-2*I)+"m0,-"+O+"v"+2*O):C+("M"+(fa+I)+","+K+"h"+(T-fa-2*I)));C=1===a.options.ErrorKind?C+("M"+(N-O)+","+(K-P+I)+"h"+2*O+"m"+-O+",0v"+(P+J-2*I)+"m"+-O+",0h"+2*O):C+("M"+N+","+(K-P+I)+"v"+(P+J-2*I));null!==E&&
(E+="M"+(N-b)+","+(K-P)+"h"+2*b+"v"+(P+J)+"h"+-2*b+"z")},ia=function(b){da(b)&&(ea&&(b=R?k.fBinEntries[b+1]:Z,0!==b&&(b=b===Math.round(b)?b.toString():p.floatToString(b,JSROOT.gStyle.fPaintTextFormat),ha?a.drawText({align:12,x:N,y:Math.round(K-2-U/5),width:0,height:0,rotate:ha,text:b,color:ba,latex:0}):a.drawText({align:22,x:Math.round(S+.1*(X-S)),y:Math.round(K-2-U),width:Math.round(.8*(X-S)),height:U,text:b,color:ba,latex:0}))),y&&null!==A&&(A+=(0===A.length?"M":"L")+N+","+K),ka&&K>=-P&&K<=f+J&&
(null!==F&&(F+="M"+S+","+(K-P)+"h"+(X-S)+"v"+(P+J+1)+"h-"+(X-S)+"z"),null!==D&&G&&(D+=a.markeratt.create(N,K),null!==B&&(B+="M"+(N-M)+","+(K-M)+"h"+2*M+"v"+2*M+"h"+-2*M+"z")),null!==C&&H&&ma()))};if(G||H)if(!JSROOT.settings.OptimizeDraw||5E4>g-e&&1==JSROOT.settings.OptimizeDraw){for(c=e;c<g;++c)da(c)&&(null!==D&&(D+=this.markeratt.create(N,K)),null!==B&&(B+="M"+(N-M)+","+(K-M)+"h"+2*M+"v"+2*M+"h"+-2*M+"z"),null!==C&&ma());H=G=!1}for(c=e;c<=g;++c)if(l=n.GetBinLowEdge(c+1),!(this.logx&&0>=l)){var V=
Math.round(b.grx(l));if((l=c===g)&&e<g)var L=m;else L=k.getBinContent(c+1),L=Math.round(b.gry(L));if(0===d.length){var Y=v=c;var ja=z=u=V;var aa=r=q=m=L;d="M"+u+","+m}else if(ca)V!==u||l?(la&&(Y===v?ia(Y):Y<v?(ia(Y),ia(v)):(ia(v),ia(Y))),!x||r===q&&aa===r||(ja!==u&&(d+="h"+(u-ja)),m===r?(q!==aa&&(d+="v"+(q-aa)),r!==q&&(d+="v"+(r-q))):(r!==aa&&(d+="v"+(r-aa)),q!==r&&(d+="v"+(q-r)),m!==q&&(d+="v"+(m-q))),ja=u,aa=m),l&&ja!==V&&(d+="h"+(V-ja)),Y=v=c,r=q=m=L,u=V):(L<r?v=c:L>q&&(Y=c),r=Math.min(r,L),q=
Math.max(q,L),m=L);else if(L!==m||l)V!==u&&(d+="h"+(V-u)),L!==m&&(d+="v"+(L-m)),m=L,u=V}m=t&&this.fillatt.empty()&&x&&!ka&&!y;r=f+3;m||(q=Math.round(b.gry(0)),0>=q?r=-3:q<f&&(r=q));z="L"+u+","+r+"L"+z+","+r+"Z";if(ka||y)null!==F&&0<F.length&&this.draw_g.append("svg:path").attr("d",F).call(this.fillatt.func),null!==C&&0<C.length&&this.draw_g.append("svg:path").attr("d",C).call(this.lineatt.func),null!==E&&0<E.length&&this.draw_g.append("svg:path").attr("d",E).attr("stroke","none").attr("fill","none").attr("pointer-events",
"visibleFill"),null!==A&&0<A.length&&(this.fillatt.empty()||x||this.draw_g.append("svg:path").attr("d",A+z).attr("stroke","none").call(this.fillatt.func),this.draw_g.append("svg:path").attr("d",A).attr("fill","none").call(this.lineatt.func)),null!==D&&0<D.length&&this.draw_g.append("svg:path").attr("d",D).call(this.markeratt.func),null!==B&&0<B.length&&this.draw_g.append("svg:path").attr("d",B).attr("stroke","none").attr("fill","none").attr("pointer-events","visibleFill");if(0<d.length&&x){if(!this.fillatt.empty()||
m)d+=z;this.draw_g.append("svg:path").attr("d",d).style("stroke-linejoin","miter").call(this.lineatt.func).call(this.fillatt.func)}ea&&this.finishTextDrawing()};G.prototype.getBinTooltips=function(a){var d=[],b=this.getObjectHint(),c=this.getFramePainter().getGrFuncs(this.options.second_x,this.options.second_y),f=this.getHisto(),e=f.fXaxis.GetBinLowEdge(a+1),g=f.fXaxis.GetBinLowEdge(a+2),k=f.getBinContent(a+1),t=this.getAxisBinTip("x",f.fXaxis,a);0<b.length&&d.push(b);this.options.Error||this.options.Mark?
(d.push("x = "+t),d.push("y = "+c.axisAsText("y",k)),this.options.Error&&("["==t[0]&&d.push("error x = "+((g-e)/2).toPrecision(4)),d.push("error y = "+f.getBinError(a+1).toPrecision(4)))):(d.push("bin = "+(a+1)),d.push("x = "+t),f.$baseh&&(k-=f.$baseh.getBinContent(a+1)),k===Math.round(k)?d.push("entries = "+k):d.push("entries = "+p.floatToString(k,JSROOT.gStyle.fStatFormat)));return d};G.prototype.processTooltipEvent=function(a){function d(a){a=k.fXaxis.GetBinLowEdge(a+1);return g.logx&&0>=a?null:
g.grx(a)}function b(a){a=k.getBinContent(a+1);return g.logy&&a<g.scale_ymin?g.swap_xy?-1E3:10*e:Math.round(g.gry(a))}if(!a||!this.draw_content||!this.draw_g||this.options.Mode3D)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;var c=this.getFramePainter(),f=c.getFrameWidth(),e=c.getFrameHeight(),g=c.getGrFuncs(this.options.second_x,this.options.second_y),k=this.getHisto(),t=null,n,l=2,z=this.getSelectIndex("x","left",-1),u=this.getSelectIndex("x","right",2);var m=z;var r=u;var q=
a.x,v=a.y;g.swap_xy&&(t=a.x,q=v,v=t,t=e,e=f,f=t);for(;m<r-1;){t=Math.round(.5*(m+r));var w=d(t);null===w||w<q-.5?g.swap_xy?r=t:m=t:w>q+.5?g.swap_xy?m=t:r=t:(m++,r--)}t=r=m;w=d(t);if(c.swap_xy){for(;m>z&&d(m-1)<w+2;)--m;for(;r<u&&d(r+1)>w-2;)++r}else{for(;m>z&&d(m-1)>w-2;)--m;for(;r<u&&d(r+1)<w+2;)++r}if(m<r){w=e;for(c=m;c<=r;c++){var h=Math.abs(b(c)-v);h<w&&(w=h,t=c)}w>e/10&&(t=Math.round(m+(r-m)/e*v));w=d(t)}w=Math.round(w);c=Math.round(d(t+1));this.options.Bar&&(m=c-w,w+=Math.round(k.fBarOffset/
1E3*m),c=w+Math.round(k.fBarWidth/1E3*m));w>c&&(m=w,w=c,c=m);m=Math.round((w+c)/2);r=h=n=b(t);if(this.options.Bar){f=!0;l=0;h=Math.round(g.gry(!1!==this.options.BaseLine&&this.options.BaseLine>g.scale_ymin?this.options.BaseLine:g.scale_ymin));if(h>n){var x=h;h=n;n=x}!a.touch&&1===a.nproc&&(v<h||v>n)&&(t=null)}else if(this.options.Error||this.options.Mark||this.options.Line||this.options.Curve){f=!0;x=3;this.markeratt&&(x=Math.max(x,this.markeratt.getFullSize()));if(this.options.Error){var p=k.getBinContent(t+
1);n=k.getBinError(t+1);h=Math.round(g.gry(p+n));n=Math.round(g.gry(p-n));0==p&&this.isTProfile()&&(t=null);c=(c-w)*this.options.errorX;w=Math.round(m-c);c=Math.round(m+c)}c-w<2*x&&(w=m-x,c=m+x);h=Math.min(h,r-x);n=Math.max(n,r+x);!a.touch&&1===a.nproc&&(v<h||v>n)&&(t=null)}else if(f=1===a.nproc&&u-z<f)n=e,this.fillatt.empty()||(n=Math.round(g.gry(0)),0>n?n=0:n>e&&(n=e),n<h&&(x=h,h=n,n=x)),(a.y<h||a.y>n)&&!a.touch&&(t=null);null!==t&&(t===z&&w>q+l?t=null:t===u-1&&c<q-l?t=null:q<w-l||q>c+l?t=null:
this.options.Zero||0!==k.getBinContent(t+1)||(t=null));l=this.draw_g.select(".tooltip_bin");if(null===t||0>=n||h>=e)return l.remove(),null;z={name:k.fName,title:k.fTitle,x:m,y:r,exact:!0,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getBinTooltips(t)};a.disabled?(l.remove(),z.changed=!0):f?(l.empty()&&(l=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")),z.changed=l.property("current_bin")!==
t,z.changed&&l.attr("x",g.swap_xy?h:w).attr("width",g.swap_xy?n-h:c-w).attr("y",g.swap_xy?w:h).attr("height",g.swap_xy?c-w:n-h).style("opacity","0.3").property("current_bin",t),z.exact=5>=Math.abs(r-v)||v>=h&&v<=n,z.menu=!0,z.menu_dist=Math.sqrt((m-q)*(m-q)+(r-v)*(r-v))):(q=this.lineatt.width+3,l.empty()&&(l=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",q).call(this.lineatt.func).call(this.fillatt.func)),z.exact=Math.abs(m-a.x)<=q&&Math.abs(r-
a.y)<=q,z.menu=z.exact,z.menu_dist=Math.sqrt((m-a.x)*(m-a.x)+(r-a.y)*(r-a.y)),z.changed=l.property("current_bin")!==t,z.changed&&l.attr("cx",m).attr("cy",r).property("current_bin",t));z.changed&&(z.user_info={obj:k,name:k.fName,bin:t,cont:k.getBinContent(t+1),grx:m,gry:r});return z};G.prototype.fillHistContextMenu=function(a){var d=this;a.add("Auto zoom-in",function(){return d.autoZoom()});var b=p.getDrawSettings("ROOT."+this.getObject()._typename,"nosame");a.addDrawMenu("Draw with",b.opts,function(a){if("inspect"===
a)return d.showInspector();d.decodeOptions(a);d.options.need_fillcol&&d.fillatt&&d.fillatt.empty()&&d.fillatt.change(5,1001);d.interactiveRedraw("pad","drawopt")});this.snapid||this.isTProfile()||a.addRebinMenu(function(a){return d.rebinHist(a)})};G.prototype.rebinHist=function(a){var d=this.getHisto(),b=d.fXaxis,c=Math.floor(b.fNbins/a);if(!(2>c)){var f=Array(c+2),e=null;0<b.fXbins.length&&(e=Array(c));f[0]=d.fArray[0];for(var g=1,k=1;k<=c;++k){e&&(e[k-1]=b.fXbins[g-1]);for(var t=0,n=0;n<a;++n)t+=
d.fArray[g++];f[k]=t}e?(g<=b.fXbins.length&&(b.fXmax=b.fXbins[g-1]),b.fXbins=e):b.fXmax=b.fXmin+(b.fXmax-b.fXmin)/b.fNbins*c*a;b.fNbins=c;for(a=0;g<d.fArray.length;)a+=d.fArray[g++];f[c+1]=a;d.fArray=f;d.fSumw2=[];this.scanContent();this.interactiveRedraw("pad")}};G.prototype.autoZoom=function(){var a=this.getSelectIndex("x","left",-1),d=this.getSelectIndex("x","right",1),b=d-a,c=this.getHisto();if(0!=b&&c){for(var f=c.getBinContent(a+1),e=a;e<d;++e)f=Math.min(f,c.getBinContent(e+1));if(!(0<f)){for(;a<
d&&c.getBinContent(a+1)<=f;)++a;for(;a<d&&c.getBinContent(d)<=f;)--d;a===d-1&&2<a&&d<this.nbinsx-2&&(--a,++d);d-a<b&&a<d&&this.getFramePainter().zoom(c.fXaxis.GetBinLowEdge(a+1),c.fXaxis.GetBinLowEdge(d+1))}}};G.prototype.canZoomInside=function(a,d,b){var c=this.getHisto();return"x"==a&&c&&1<c.fXaxis.FindBin(b,.5)-c.fXaxis.FindBin(d,0)||"y"==a&&Math.abs(b-d)>1E-6*Math.abs(this.ymax-this.ymin)?!0:!1};G.prototype.callDrawFunc=function(a){var d=this.getMainPainter(),b=this.getFramePainter();d!==this&&
b&&b.mode3d!==this.options.Mode3D&&this.copyOptionsFrom(d);return this[this.options.Mode3D?"draw3D":"draw2D"](a)};G.prototype.draw2D=function(){var a=this;this.clear3DScene();this.scanContent(!0);"function"===typeof this.drawColorPalette&&this.isMainPainter()&&this.drawColorPalette(!1);return this.drawAxes().then(function(){a.draw1DBins();return a.drawHistTitle()}).then(function(){a.updateStatWebCanvas();return a.addInteractivity()})};G.prototype.draw3D=function(a){var d=this;this.mode3d=!0;return JSROOT.require("hist3d").then(function(){return d.draw3D(a)})};
G.prototype.redraw=function(a){return this.callDrawFunc(a)};E.prototype=Object.create(y.prototype);E.prototype.cleanup=function(){delete this.tt_handle;y.prototype.cleanup.call(this)};E.prototype.toggleProjection=function(a,d){var b=this;if("Projections"==a||"Off"==a)a="";"string"==typeof a&&1<a.length&&(d=parseInt(a.substr(1)),a=a[0]);d||(d=1);if(a&&this.is_projection==a)if(this.projection_width===d)a="";else{this.projection_width=d;return}delete this.proj_hist;var c=this.is_projection===a?"":a;
this.projection_width=d;this.is_projection="";this.provideSpecialDrawArea(c).then(function(){b.is_projection=c;return b.redrawProjection()})};E.prototype.redrawProjection=function(a,d,b,c){if(this.is_projection){if(void 0===c){if(!this.tt_handle)return;a=Math.round((this.tt_handle.i1+this.tt_handle.i2)/2);d=a+1;b=Math.round((this.tt_handle.j1+this.tt_handle.j2)/2);c=b+1}var f=this.getCanvPainter(),e=this.getHisto();if(f&&!f._readonly&&void 0!==this.snapid)e="EXECANDSEND:D"+this.is_projection+"PROJ:"+
this.snapid+":",e="X"==this.is_projection?e+('ProjectionX("_projx",'+(b+1)+","+c+',"")'):e+('ProjectionY("_projy",'+(a+1)+","+d+',"")'),f.sendWebsocket(e);else{this.proj_hist||("X"==this.is_projection?(this.proj_hist=JSROOT.createHistogram("TH1D",this.nbinsx),JSROOT.extend(this.proj_hist.fXaxis,e.fXaxis),this.proj_hist.fName="xproj",this.proj_hist.fTitle="X projection"):(this.proj_hist=JSROOT.createHistogram("TH1D",this.nbinsy),JSROOT.extend(this.proj_hist.fXaxis,e.fYaxis),this.proj_hist.fName="yproj",
this.proj_hist.fTitle="Y projection"));f=0;var g=-1;if("X"==this.is_projection){for(a=0;a<this.nbinsx;++a){d=0;for(var k=b;k<c;++k)d+=e.getBinContent(a+1,k+1);this.proj_hist.setBinContent(a+1,d)}this.proj_hist.fTitle="X projection "+(b+1==c?"bin "+c:"bins ["+(b+1)+" .. "+c+"]");this.tt_handle&&(f=this.tt_handle.i1+1,g=this.tt_handle.i2)}else{for(b=0;b<this.nbinsy;++b){c=0;for(k=a;k<d;++k)c+=e.getBinContent(k+1,b+1);this.proj_hist.setBinContent(b+1,c)}this.proj_hist.fTitle="Y projection "+(a+1==d?
"bin "+d:"bins ["+(a+1)+" .. "+d+"]");this.tt_handle&&(f=this.tt_handle.j1+1,g=this.tt_handle.j2)}f<g&&(e=this.proj_hist.fXaxis,e.fFirst=f,e.fLast=g,(1==e.fFirst&&e.fLast==e.fNbins)==e.TestBit(JSROOT.EAxisBits.kAxisRange)&&e.InvertBit(JSROOT.EAxisBits.kAxisRange));this.proj_hist.fEntries=0;this.proj_hist.fTsumw=0;return this.drawInSpecialArea(this.proj_hist)}}};E.prototype.executeMenuCommand=function(a,d){return y.prototype.executeMenuCommand.call(this,a,d)?!0:"SetShowProjectionX"==a.fName||"SetShowProjectionY"==
a.fName?(this.toggleProjection(a.fName[17],d&&parseInt(d)?parseInt(d):1),!0):!1};E.prototype.fillHistContextMenu=function(a){var d=this;if(!this.isTH2Poly()){a.add("sub:Projections",function(){return d.toggleProjection()});var b=this.is_projection||"";b&&(b+=this.projection_width);var c="X1 X2 X3 X5 X10 Y1 Y2 Y3 Y5 Y10".split(" ");this.is_projection&&c.push("Off");for(var f=0;f<c.length;++f)a.addchk(b==c[f],c[f],c[f],function(a){return d.toggleProjection(a)});a.add("endsub:");a.add("Auto zoom-in",
function(){return d.autoZoom()})}b=p.getDrawSettings("ROOT."+this.getObject()._typename,"nosame");a.addDrawMenu("Draw with",b.opts,function(a){if("inspect"===a)return d.showInspector();d.decodeOptions(a);d.interactiveRedraw("pad","drawopt")});this.options.Color&&this.fillPaletteMenu(a)};E.prototype.clickButton=function(a){if(y.prototype.clickButton.call(this,a))return!0;if(this!==this.getMainPainter())return!1;switch(a){case "ToggleColor":this.toggleColor();break;case "ToggleColorZ":this.toggleColz();
break;case "Toggle3D":this.toggleMode3D();break;default:return!1}return!0};E.prototype.fillToolbar=function(){y.prototype.fillToolbar.call(this,!0);var a=this.getPadPainter();a&&(this.isTH2Poly()||a.addPadButton("th2color","Toggle color","ToggleColor"),a.addPadButton("th2colorz","Toggle color palette","ToggleColorZ"),a.addPadButton("th2draw3d","Toggle 3D mode","Toggle3D"),a.showPadButtons())};E.prototype.toggleColor=function(){this.options.Mode3D?(this.options.Mode3D=!1,this.options.Color=!0):this.options.Color=
!this.options.Color;this._can_move_colz=!0;this.copyOptionsToOthers();this.redrawPad()};E.prototype.autoZoom=function(){if(!this.isTH2Poly()){var a=this.getSelectIndex("x","left",-1),d=this.getSelectIndex("x","right",1),b=this.getSelectIndex("y","left",-1),c=this.getSelectIndex("y","right",1),f,e,g=this.getObject();if(a!=d&&b!=c){var k=g.getBinContent(a+1,b+1);for(f=a;f<d;++f)for(e=b;e<c;++e)k=Math.min(k,g.getBinContent(f+1,e+1));if(!(0<k)){var t=d,n=a,l=c,z=b;for(f=a;f<d;++f)for(e=b;e<c;++e)g.getBinContent(f+
1,e+1)>k&&(f<t&&(t=f),f>=n&&(n=f+1),e<l&&(l=e),e>=z&&(z=e+1));f=!1;t===n-1&&t>a+1&&n<d-1&&(t--,n++);l===z-1&&l>b+1&&z<c-1&&(l--,z++);if((t>a||n<d)&&t<n-1){var h=g.fXaxis.GetBinLowEdge(t+1);var m=g.fXaxis.GetBinLowEdge(n+1);f=!0}if((l>b||z<c)&&l<z-1){var r=g.fYaxis.GetBinLowEdge(l+1);var q=g.fYaxis.GetBinLowEdge(z+1);f=!0}f&&this.getFramePainter().zoom(h,m,r,q)}}}};E.prototype.scanContent=function(a){if(!(a&&this.nbinsx&&this.nbinsy)){var d;a=this.getObject();this.extractAxesProperties(2);if(this.isTH2Poly()){this.gminposbin=
null;var b=this.gminbin=this.gmaxbin=0;for(d=a.fBins.arr.length;b<d;++b){var c=a.fBins.arr[b].fContent;0===b&&(this.gminbin=this.gmaxbin=c);c<this.gminbin?this.gminbin=c:c>this.gmaxbin&&(this.gmaxbin=c);0<c&&(null===this.gminposbin||this.gminposbin>c)&&(this.gminposbin=c)}}else for(this.gminbin=this.gmaxbin=a.getBinContent(1,1),this.gminposbin=null,b=0;b<this.nbinsx;++b)for(d=0;d<this.nbinsy;++d)c=a.getBinContent(b+1,d+1),c<this.gminbin?this.gminbin=c:c>this.gmaxbin&&(this.gmaxbin=c),0<c&&(null===
this.gminposbin||this.gminposbin>c)&&(this.gminposbin=c);null===this.gminposbin&&(this.gminposbin=1E-4*this.gmaxbin);0<this.options.Axis?this.draw_content=!1:(this.draw_content=0<this.gmaxbin,!this.draw_content&&this.options.Zero&&this.isTH2Poly()&&(this.draw_content=!0,this.options.Line=1))}};E.prototype.countStat=function(a){var d=this.getHisto(),b=d.fXaxis,c=d.fYaxis,f=0,e=0,g=0,k=0,t=0,n,l,z=this.getFramePainter(),h=z.getGrFuncs(this.options.second_x,this.options.second_y),m={name:d.fName,entries:0,
integral:0,meanx:0,meany:0,rmsx:0,rmsy:0,matrix:[0,0,0,0,0,0,0,0,0],xmax:0,ymax:0,wmax:null};if(this.isTH2Poly()){b=d.fBins.arr.length;var r,q,v;for(c=0;c<b;++c){var w=d.fBins.arr[c];var p=n=1;w.fXmin>h.scale_xmax?n=2:w.fXmax<h.scale_xmin&&(n=0);w.fYmin>h.scale_ymax?p=2:w.fYmax<h.scale_ymin&&(p=0);var x=l=v=0;var y=w.fPoly;var A=1;"TMultiGraph"===y._typename&&(A=w.fPoly.fGraphs.arr.length,y=null);for(q=0;q<A;++q){if(!y||0<q)y=w.fPoly.fGraphs.arr[q];for(r=0;r<y.fNpoints;++r)++v,x+=y.fX[r],l+=y.fY[r]}1<
v&&(x/=v,l/=v);w=w.fContent;m.entries+=w;m.matrix[3*p+n]+=w;if(1==n&&1==p&&(!a||a(x,l))){if(null===m.wmax||w>m.wmax)m.wmax=w,m.xmax=x,m.ymax=l;f+=w;e+=x*w;g+=l*w;k+=x*x*w;t+=l*l*w}}}else for(h=this.getSelectIndex("x","left"),r=this.getSelectIndex("x","right"),y=this.getSelectIndex("y","left"),q=this.getSelectIndex("y","right"),A=0;A<=this.nbinsx+1;++A)for(n=A<=h?0:A>r?2:1,x=b.GetBinCoord(A-.5),v=0;v<=this.nbinsy+1;++v)if(p=v<=y?0:v>q?2:1,l=c.GetBinCoord(v-.5),w=d.getBinContent(A,v),m.entries+=w,m.matrix[3*
p+n]+=w,1==n&&1==p&&(!a||a(x,l))){if(null===m.wmax||w>m.wmax)m.wmax=w,m.xmax=x,m.ymax=l;f+=w;e+=x*w;g+=l*w;k+=x*x*w;t+=l*l*w}!z.isAxisZoomed("x")&&!z.isAxisZoomed("y")&&0<d.fTsumw&&(f=d.fTsumw,e=d.fTsumwx,k=d.fTsumwx2,g=d.fTsumwy,t=d.fTsumwy2);0<f&&(m.meanx=e/f,m.meany=g/f,m.rmsx=Math.sqrt(Math.abs(k/f-m.meanx*m.meanx)),m.rmsy=Math.sqrt(Math.abs(t/f-m.meany*m.meany)));null===m.wmax&&(m.wmax=0);m.integral=f;1<d.fEntries&&(m.entries=d.fEntries);return m};E.prototype.fillStatistic=function(a,d,b){if(this.isIgnoreStatsFill())return!1;
var c=this.countStat(),f=Math.floor(d%10),e=Math.floor(d/10)%10,g=Math.floor(d/100)%10,k=Math.floor(d/1E3)%10,t=Math.floor(d/1E4)%10,n=Math.floor(d/1E5)%10,l=Math.floor(d/1E6)%10,h=Math.floor(d/1E7)%10;d=Math.floor(d/1E8)%10;a.clearPave();0<f&&a.addText(c.name);0<e&&a.addText("Entries = "+a.format(c.entries,"entries"));0<g&&(a.addText("Mean x = "+a.format(c.meanx)),a.addText("Mean y = "+a.format(c.meany)));0<k&&(a.addText("Std Dev x = "+a.format(c.rmsx)),a.addText("Std Dev y = "+a.format(c.rmsy)));
0<l&&a.addText("Integral = "+a.format(c.matrix[4],"entries"));0<h&&(a.addText("Skewness x = <undef>"),a.addText("Skewness y = <undef>"));0<d&&a.addText("Kurt = <undef>");if(0<t||0<n)c=c.matrix,a.addText(""+c[6].toFixed(0)+" | "+c[7].toFixed(0)+" | "+c[7].toFixed(0)),a.addText(""+c[3].toFixed(0)+" | "+c[4].toFixed(0)+" | "+c[5].toFixed(0)),a.addText(""+c[0].toFixed(0)+" | "+c[1].toFixed(0)+" | "+c[2].toFixed(0));b&&a.fillFunctionStat(this.findFunction("TF2"),b);return!0};E.prototype.drawBinsColor=
function(){for(var a=this,d=this.getHisto(),b=this.prepareColorDraw(),c=this.getContour(),f=this.getHistPalette(),e=[],g=!this.options.Zero,k=this._show_empty_bins,t=1===b.ybar2&&0===b.ybar1,n,l,h,u,m,r=null,q=function(){r.path+="h"+n+"v"+(r.y2-r.y)+"h"+-n+"z";r=null},v=b.i1;v<b.i2;++v){n=b.grx[v+1]-b.grx[v];h=Math.round(b.grx[v]+n*b.xbar1);n=Math.round(n*(b.xbar2-b.xbar1))||1;for(var w=b.j1;w<b.j2;++w)if(u=d.getBinContent(v+1,w+1),(l=0===u)&&g)r&&q();else{m=c.getPaletteIndex(f,u);if(null===m)if(l&&
k)m=0;else{r&&q();continue}l=b.gry[w+1]-b.gry[w];u=Math.round(b.gry[w]+l*b.ybar1);l=Math.round(l*(b.ybar2-b.ybar1))||-1;var p="M"+h+","+u,x=e[m];if(x)if(t&&x===r){x.y2=u+l;continue}else{m=h-x.x;var y=u-x.y;if(m||y)m="m"+m+","+y,x.path+=m.length<p.length?m:p}else x=e[m]={path:p};r&&q();x.x=h;x.y=u;t?(x.y2=u+l,r=x):x.path+="h"+n+"v"+l+"h"+-n+"z"}r&&q()}e.forEach(function(b,c){b&&a.draw_g.append("svg:path").attr("fill",f.getColor(c)).attr("d",b.path)});return b};E.prototype.buildContour=function(a,d,
b,c){function f(a,b,c,e,f,m,n,q){var h=c===n;n=h?q-e:n-c;b+=1;f-=a;q=l-1;for(var z=999+l,v=0,r;b<=m&&q<=z;)r=d[b],r-=a,r/=f,r*=n,h?(g[q]=c,k[q]=e+r):(g[q]=c+r,k[q]=e),t[q]=b,v++,q+=2,b++;return v}var e=this.getObject(),g=new Float32Array(4008),k=new Float32Array(4008),t=new Int32Array(4008),n=d.length,l=0,h=[],u=0,m=[0,0,0,0],r=[0,0,0,0],q=[0,0,0,0],v=[0,0,0,0],w,p,x,y,A=function(a){for(var b=0;b<n;++b)if(a<d[b])return b-1;return n-1},B=a.original?a.origx:a.grx,F=a.original?a.origy:a.gry;for(p=a.j1;p<
a.j2-1;++p)for(r[1]=r[0]=(F[p]+F[p+1])/2,r[3]=r[2]=(F[p+1]+F[p+2])/2,w=a.i1;w<a.i2-1;++w){q[0]=e.getBinContent(w+1,p+1);q[1]=e.getBinContent(w+2,p+1);q[2]=e.getBinContent(w+2,p+2);q[3]=e.getBinContent(w+1,p+2);for(x=0;4>x;x++)v[x]=A(q[x]);if(v[0]!==v[1]||v[1]!==v[2]||v[2]!==v[3]||v[3]!==v[0]){m[3]=m[0]=(B[w]+B[w+1])/2;m[2]=m[1]=(B[w+1]+B[w+2])/2;var C=q[0]<=q[1]?0:1;var D=q[2]<=q[3]?2:3;q[C]>q[D]&&(C=D);C++;for(x=l=1;4>=x;x++)D=C%4+1,C=f(q[C-1],v[C-1],m[C-1],r[C-1],q[D-1],v[D-1],m[D-1],r[D-1]),l+=
2*C,C=D;C=q[0]<=q[1]?0:1;D=q[2]<=q[3]?2:3;q[C]>q[D]&&(C=D);C++;l=2;for(x=1;4>=x;x++)D=1==C?4:C-1,C=f(q[C-1],v[C-1],m[C-1],r[C-1],q[D-1],v[D-1],m[D-1],r[D-1]),l+=2*C,C=D;D=0;for(x=1;x<=l-5;x+=2)for(;t[x-1]!=t[x];){C=g[x];var E=k[x];var G=t[x];for(y=x;y<=l-5;y+=2)g[y]=g[y+2],k[y]=k[y+2],t[y]=t[y+2];g[l-3]=C;k[l-3]=E;t[l-3]=G;if(2E3<D)break;D++}if(!(2E3<D))for(x=1;x<=l-2;x+=2)D=t[x-1],0<=D&&D<d.length&&((C=h[D])||(C=h[D]=JSROOT.createTPolyLine(8016,!0)),D=C.fLastPoint,D<C.fN-2&&(C.fX[D+1]=Math.round(g[x-
1]),C.fY[D+1]=Math.round(k[x-1]),C.fX[D+2]=Math.round(g[x]),C.fY[D+2]=Math.round(k[x]),C.fLastPoint=D+2,u=Math.max(u,C.fLastPoint+1)))}}a=new Int32Array(d.length);for(D=w=0;D<d.length;D++)if(0<=d[D]){w=D;break}x=0;for(D=w-1;0<=D;D--)a[x]=D,x++;for(D=w;D<d.length;D++)a[x]=D,x++;e=new Float32Array(2*u);m=new Float32Array(2*u);for(x=0;x<d.length;++x)if(D=a[x],C=h[D])for(r=b.calcColorIndex(D,d.length),q=C.fX,v=C.fY,p=C.fLastPoint+1,A=0,C=F=B=void 0;;){B=u;F=B+1;e[B]=q[A];m[B]=v[A];e[F]=q[A+1];m[F]=v[A+
1];q[A]=q[A+1]=0;for(v[A]=v[A+1]=0;;){C=0;for(w=2;w<p;w+=2)F<2*u-1&&q[w]===e[F]&&v[w]===m[F]&&(F++,e[F]=q[w+1],m[F]=v[w+1],q[w]=q[w+1]=0,v[w]=v[w+1]=0,C++),0<B&&q[w+1]===e[B]&&v[w+1]===m[B]&&(B--,e[B]=q[w],m[B]=v[w],q[w]=q[w+1]=0,v[w]=v[w+1]=0,C++);if(0==C)break}B+1<F&&0<=B&&c(r,e,m,B,F,D);A=0;for(w=2;w<p;w+=2)if(0!==q[w]&&0!==v[w]){A=w;break}if(0===A)break}};E.prototype.drawBinsContour=function(){function a(a,b,c,d,e){for(var f="",g,k,l,m,n=!1,q,r,z,v=c;v<=d;++v){h?(z=h(a[v],b[v]),r=Math.round(t.grx(z.x)),
z=Math.round(t.gry(z.y))):(r=Math.round(a[v]),z=Math.round(b[v]));if(f)if(v==d&&c!==d&&r==l&&z==m){if(!n)return"";f+="z";e=!1;q=!0}else g=r-g,k=z-k,g?(n=!0,f+=k?"l"+g+","+k:"h"+g):k&&(n=!0,f+="v"+k);else f="M"+r+","+z,l=r,m=z;g=r;k=z}if(e&&!q&&!h)return"<failed>";e&&(f+="z");return f}function d(a,b){var c=a.x2-a.x1;var d=a.y2-a.y1;var e=b.x2-b.x1;var f=b.y2-b.y1;var g=c*f-e*d;if(0==g)return 0;var k=0<g;var l=a.x1-b.x1;var m=a.y1-b.y1;b=c*m-d*l;if(0>b==k)return null;l=e*m-f*l;if(0>l==k||b>g==k||l>
g==k)return null;g=l/g;return{x:Math.round(a.x1+g*c),y:Math.round(a.y1+g*d)}}function b(b,c,e,f,l){var m=[{x:0,y:0},{x:g,y:0},{x:g,y:k},{x:0,y:k}],n=function(a,e){a={x1:b[a],y1:c[a],x2:2*b[a]-b[a+e],y2:2*c[a]-c[a+e]};for(e=0;4>e;++e){var f=d(a,{x1:m[e].x,y1:m[e].y,x2:m[(e+1)%4].x,y2:m[(e+1)%4].y});if(f)return f.indx=e+.5,f}return null};for(e--;e<f-1&&!t;)var t=n(++e,1);for(f++;e<f-1&&t&&!h;)var h=n(--f,-1);if(!t||!h)return"";e=a(b,c,e,f);f=h.indx;l*=.5;for(e+="L"+h.x+","+h.y;.1<Math.abs(f-t.indx);)f=
Math.round(f+l)%4,e+="L"+m[f].x+","+m[f].y,f+=l;return e+("L"+t.x+","+t.y+"z")}var c=this,f=this.prepareColorDraw({rounding:!1,extra:100,original:0!=this.options.Proj}),e=this.getFramePainter(),g=e.getFrameWidth(),k=e.getFrameHeight(),t=e.getGrFuncs(this.options.second_x,this.options.second_y),n=this.getContourLevels(),l=this.getHistPalette(),h=e.getProjectionFunc();if(14===this.options.Contour){e="M0,0h"+g+"v"+k+"h"+-g+"z";if(this.options.Proj){e=f.j2-f.j1;for(var u=new Float32Array(2*e),m=new Float32Array(2*
e),r=0;r<e;++r)u[r]=f.origx[f.i1],m[r]=(f.origy[f.j1]*(r+.5)+f.origy[f.j2]*(e-.5-r))/e,u[r+e]=f.origx[f.i2],m[r+e]=(f.origy[f.j2]*(r+.5)+f.origy[f.j1]*(e-.5-r))/e;e=a(u,m,0,2*e-1,!0)}this.draw_g.append("svg:path").attr("d",e).style("stroke","none").style("fill",l.calcColor(0,n.length))}this.buildContour(f,n,l,function(d,e,f,g,k,m){var t=l.getColor(d);d=t;switch(c.options.Contour){case 11:d="none";var n=new JSROOT.TAttLineHandler({color:t});break;case 12:d="none";n=new JSROOT.TAttLineHandler({color:1,
style:m%5+1,width:1});break;case 13:d="none",n=c.lineatt}m=a(e,f,g,k,"none"!=d);"<failed>"==m&&(m=b(e,f,g,k,1));m&&(e=c.draw_g.append("svg:path").attr("class","th2_contour").attr("d",m).style("fill",d),n?e.call(n.func):e.style("stroke","none"))});f.hide_only_zeros=!0;return f};E.prototype.createPolyBin=function(a,d,b){var c="",f="",e=0,g=0,k,t=1,n=null;"TMultiGraph"==d.fPoly._typename?t=d.fPoly.fGraphs.arr.length:n=d.fPoly;b&&(d._sumx=d._sumy=d._suml=0);var l=function(a,b,c,e){var f=Math.sqrt((a-
c)*(a-c)+(b-e)*(b-e));d._sumx+=(a+c)*f/2;d._sumy+=(b+e)*f/2;d._suml+=f},h=function(){e&&(f+="h"+e,e=0);g&&(f+="v"+g,g=0)};for(k=0;k<t;++k){if(!n||0<k)n=d.fPoly.fGraphs.arr[k];var u=n.fX,m=n.fY,r=void 0,q=void 0,v=void 0,w=n.fNpoints,p=void 0,x=void 0,y=Math.round(a.grx(u[0])),A=Math.round(a.gry(m[0]));2<w&&u[0]===u[w-1]&&m[0]===m[w-1]&&w--;var B="M"+y+","+A;f="";for(r=1;r<w;++r)if(q=Math.round(a.grx(u[r])),v=Math.round(a.gry(m[r])),b&&l(y,A,q,v),p=q-y,x=v-A,p||x)0===p?(0!==g&&0>x===0>g||h(),g+=x):
0===x?(0!==e&&0>p===0>e||h(),e+=p):(h(),f+="l"+p+","+x),y=q,A=v;b&&l(y,A,Math.round(a.grx(u[0])),Math.round(a.gry(m[0])));h();f&&(c+=B+f+"z")}b&&(0<d._suml?(d._midx=Math.round(d._sumx/d._suml),d._midy=Math.round(d._sumy/d._suml)):(d._midx=Math.round(a.grx((d.fXmin+d.fXmax)/2)),d._midy=Math.round(a.gry((d.fYmin+d.fYmax)/2))));return c};E.prototype.drawPolyBinsColor=function(){var a=this.getObject(),d=this.getFramePainter(),b=d.getGrFuncs(this.options.second_x,this.options.second_y),c=d.getFrameHeight(),
f=[];d=[];var e,g=a.fBins.arr.length;this.maxbin=this.gmaxbin;this.minbin=this.gminbin;this.minposbin=this.gminposbin;var k=this.getContour(!0),t=this.getHistPalette();for(e=0;e<g;++e){var n=a.fBins.arr[e];var l=k.getPaletteIndex(t,n.fContent);if(null!==l){if(0===n.fContent){if(!this.options.Zero||!this.options.Line)continue;l=0}if(!(n.fXmin>b.scale_xmax||n.fXmax<b.scale_xmin||n.fYmin>b.scale_ymax||n.fYmax<b.scale_ymin)){var h=this.createPolyBin(b,n,this.options.Text&&n.fContent);f[l]=void 0===f[l]?
h:f[l]+h;this.options.Text&&n.fContent&&d.push(n)}}}for(l=0;l<f.length;++l)f[l]&&(n=this.draw_g.append("svg:path").attr("fill",l?this.fPalette.getColor(l):"none").attr("d",f[l]),this.options.Line&&n.call(this.lineatt.func));if(0<d.length){b=this.getColor(a.fMarkerColor);f=-1*this.options.TextAngle;l=this.draw_g.append("svg:g").attr("class","th2poly_text");n=12;1!==a.fMarkerSize&&f&&(n=Math.round(.02*c*a.fMarkerSize));this.startTextDrawing(42,n,l,n);for(e=0;e<d.length;++e)n=d[e],a="",this.options.TextKind?
(n.fPoly&&(a=n.fPoly.fName),"Graph"===a&&(a=""),a||(a=n.fNumber)):a=Math.round(n.fContent)===n.fContent?n.fContent.toString():p.floatToString(n.fContent,JSROOT.gStyle.fPaintTextFormat),this.drawText({align:22,x:n._midx,y:n._midy,rotate:f,text:a,color:b,latex:0,draw_g:l});this.finishTextDrawing(l)}return{poly:!0}};E.prototype.drawBinsText=function(a){var d=this.getObject(),b,c=this.getColor(d.fMarkerColor),f=-1*this.options.TextAngle,e=this.draw_g.append("svg:g").attr("class","th2_text");var g=20;
var k=0,t=this.matchObjectType("TProfile2D")&&"function"==typeof d.getBinEntries,n="E"==this.options.TextKind,l=n&&!this.options.TextLine?1:0;null===a&&(a=this.prepareColorDraw({rounding:!1}));1!==d.fMarkerSize&&f&&(g=Math.round(.02*d.fMarkerSize*this.getFramePainter().getFrameHeight()));0!==d.fBarOffset&&(k=.001*d.fBarOffset);this.startTextDrawing(42,g,e,g);for(g=a.i1;g<a.i2;++g)for(b=a.j1;b<a.j2;++b){var h=d.getBinContent(g+1,b+1);if(0!==h||this._show_empty_bins){var u=a.grx[g+1]-a.grx[g];var m=
a.gry[b]-a.gry[b+1];t&&(h=d.getBinEntries(g+1,b+1));h=h===Math.round(h)?h.toString():p.floatToString(h,JSROOT.gStyle.fPaintTextFormat);if(n){var r=d.getBinError(d.getBin(g+1,b+1));r=r===Math.round(r)?r.toString():p.floatToString(r,JSROOT.gStyle.fPaintTextFormat);h=this.options.TextLine?h+("\u00b1"+r):"#splitline{"+h+"}{#pm"+r+"}"}if(f){r=Math.round(a.grx[g]+.5*u);var q=Math.round(a.gry[b+1]+m*(.5+k));m=u=0}else r=Math.round(a.grx[g]+.1*u),q=Math.round(a.gry[b+1]+m*(.1+k)),u=Math.round(.8*u),m=Math.round(.8*
m);this.drawText({align:22,x:r,y:q,width:u,height:m,rotate:f,text:h,color:c,latex:l,draw_g:e})}}this.finishTextDrawing(e);a.hide_only_zeros=!0;return a};E.prototype.drawBinsArrow=function(){for(var a=this.getObject(),d="",b,c,f=1E-30,e,g,k,t,n,l,h=this.prepareColorDraw({rounding:!1}),u=(h.grx[h.i2]-h.grx[h.i1])/(h.i2-h.i1+1-.03)/2,m=(h.gry[h.j2]-h.gry[h.j1])/(h.j2-h.j1+1-.03)/2,r=function(a,b){return a?b?"l"+a+","+b:"h"+a:b?"v"+b:""},q=0;2>q;++q)for(b=h.i1;b<h.i2;++b)for(c=h.j1;c<h.j2;++c)if(e=b===
h.i1?a.getBinContent(b+2,c+1)-a.getBinContent(b+1,c+1):b===h.i2-1?a.getBinContent(b+1,c+1)-a.getBinContent(b,c+1):.5*(a.getBinContent(b+2,c+1)-a.getBinContent(b,c+1)),g=c===h.j1?a.getBinContent(b+1,c+2)-a.getBinContent(b+1,c+1):c===h.j2-1?a.getBinContent(b+1,c+1)-a.getBinContent(b+1,c):.5*(a.getBinContent(b+1,c+2)-a.getBinContent(b+1,c)),0===q)f=Math.max(f,Math.abs(e),Math.abs(g));else if(k=(h.grx[b]+h.grx[b+1])/2,t=(h.gry[c]+h.gry[c+1])/2,n=u*e/f,e=m*g/f,l=k-n,g=k+n,k=t-e,t+=e,e=Math.round(g-l),
g=Math.round(t-k),e||g)if(d+="M"+Math.round(l)+","+Math.round(k)+r(e,g),5<Math.abs(e)||5<Math.abs(g))if(t=Math.sqrt(2/(e*e+g*g)),l=Math.round(t*(e+g)),e=Math.round(t*(e-g)),l||e)d+="m"+-l+","+e+r(l,-e)+r(-e,-l);this.draw_g.append("svg:path").attr("d",d).style("fill","none").call(this.lineatt.func);return h};E.prototype.drawBinsBox=function(){var a=this.getObject(),d=this.prepareColorDraw({rounding:!1}),b=this.getMainPainter();b===this&&(b.maxbin===b.minbin&&(b.maxbin=b.gmaxbin,b.minbin=b.gminbin,
b.minposbin=b.gminposbin),b.maxbin===b.minbin&&(b.minbin=Math.min(0,b.maxbin-1)));var c=Math.max(Math.abs(b.maxbin),Math.abs(b.minbin)),f=Math.max(0,b.minbin),e,g="",k="",t="",n="",l=!1,p=0;if((e=this.getPadPainter().getRootPad(!0))&&e.fLogz&&0<c){l=!0;c=Math.log(c);p=0<f?Math.log(f):1<=b.minposbin&&100>b.minposbin?Math.log(.7):0<b.minposbin?Math.log(.7*b.minposbin):c-10;p>=c&&(p=c-10);var u=1/(c-p)}else u=1/(c-f);for(b=d.i1;b<d.i2;++b)for(c=d.j1;c<d.j2;++c){e=a.getBinContent(b+1,c+1);var m=Math.abs(e);
if(!(0===m||m<f)){var r=l?0<m?Math.log(m)-p:0:m-f;r=.5*(0>r?1:1-Math.sqrt(r*u));0>r&&(r=0);m=d.grx[b+1]-d.grx[b];var q=d.gry[c]-d.gry[c+1];var v=r*m;var w=r*q;r=Math.round(d.grx[b]+v);var y=Math.round(d.gry[c+1]+w);m=Math.max(Math.round(m-2*v),1);q=Math.max(Math.round(q-2*w),1);g+="M"+r+","+y+"v"+q+"h"+m+"v"+-q+"z";0>e&&10===this.options.BoxStyle&&(k+="M"+r+","+y+"l"+m+","+q+"m0,"+-q+"l"+-m+","+q);if(11===this.options.BoxStyle&&5<m&&5<q){w=Math.round(.1*m);var x=Math.round(.1*q);v="M"+r+","+y+"h"+
m+"l"+-w+","+x+"h"+(2*w-m)+"v"+(q-2*x)+"l"+-w+","+x+"z";m="M"+(r+m)+","+(y+q)+"v"+-q+"l"+-w+","+x+"v"+(q-2*x)+"h"+(2*w-m)+"l"+-w+","+x+"z";0>e?(n+=v,t+=m):(t+=v,n+=m)}}}0<g.length&&(a=this.draw_g.append("svg:path").attr("d",g).call(this.fillatt.func),11!==this.options.BoxStyle&&this.fillatt.empty()?a.call(this.lineatt.func):a.style("stroke","none"));0<t.length&&this.fillatt.hasColor()&&this.draw_g.append("svg:path").attr("d",t).style("stroke","none").call(this.fillatt.func).style("fill",h.rgb(this.fillatt.color).brighter(.5).toString());
0<n.length&&this.draw_g.append("svg:path").attr("d",n).style("stroke","none").call(this.fillatt.func).style("fill",this.fillatt.hasColor()?h.rgb(this.fillatt.color).darker(.5).toString():"red");0<k.length&&(k=this.draw_g.append("svg:path").attr("d",k).style("fill","none"),this.lineatt.empty()?k.style("stroke","black"):k.call(this.lineatt.func));return d};E.prototype.drawBinsCandle=function(){var a=this.getHisto(),d=this.prepareColorDraw(),b=this.getFramePainter().getGrFuncs(this.options.second_x,
this.options.second_y),c,f,e,g,k,h="",n="";1===a.fMarkerColor&&(a.fMarkerColor=a.fLineColor);this.createAttMarker({attr:a,style:5});this.markeratt.resetPos();d.candle=[];for(f=d.i1;f<d.i2;++f){for(c=g=k=e=0;c<this.nbinsy;++c)k+=a.getBinContent(f+1,c+1);var l={bin:f,meany:0,m25y:0,p25y:0,median:0,iqr:0,whiskerp:0,whiskerm:0};for(c=0;c<this.nbinsy;++c){var p=a.getBinContent(f+1,c+1);var u=a.fYaxis.GetBinCenter(c+1);.001>g/k&&.001<=(g+p)/k&&(l.whiskerm=u);.25>g/k&&.25<=(g+p)/k&&(l.m25y=u);.5>g/k&&.5<=
(g+p)/k&&(l.median=u);.75>g/k&&.75<=(g+p)/k&&(l.p25y=u);.999>g/k&&.999<=(g+p)/k&&(l.whiskerp=u);g+=p;e+=p*u}0<g&&(l.meany=e/g);l.iqr=l.p25y-l.m25y;l.m25y-1.5*l.iqr>l.whsikerm&&(l.whiskerm=l.m25y-1.5*l.iqr);l.p25y+1.5*l.iqr<l.whiskerp&&(l.whiskerp=l.p25y+1.5*l.iqr);if(!(b.logy&&0>=l.whiskerm)){c=d.grx[f+1]-d.grx[f];c*=.66;e=(d.grx[f+1]+d.grx[f])/2+a.fBarOffset/1E3*c;0<a.fBarWidth&&(c=c*a.fBarWidth/1E3);l.x1=Math.round(e-c/2);l.x2=Math.round(e+c/2);e=Math.round(e);l.y0=Math.round(b.gry(l.median));h+=
"M"+l.x1+","+l.y0+"h"+(l.x2-l.x1);l.y1=Math.round(b.gry(l.p25y));l.y2=Math.round(b.gry(l.m25y));h+="M"+l.x1+","+l.y1+"v"+(l.y2-l.y1)+"h"+(l.x2-l.x1)+"v-"+(l.y2-l.y1)+"z";l.yy1=Math.round(b.gry(l.whiskerp));l.yy2=Math.round(b.gry(l.whiskerm));h+="M"+e+","+l.y1+"v"+(l.yy1-l.y1);h+="M"+l.x1+","+l.yy1+"h"+(l.x2-l.x1);h+="M"+e+","+l.y2+"v"+(l.yy2-l.y2);h+="M"+l.x1+","+l.yy2+"h"+(l.x2-l.x1);for(c=0;c<this.nbinsy;++c)p=a.getBinContent(f+1,c+1),u=a.fYaxis.GetBinCenter(c+1),0<p&&u<l.whiskerm&&(n+=this.markeratt.create(e,
u)),0<p&&u>l.whiskerp&&(n+=this.markeratt.create(e,u));d.candle.push(l)}}0<h.length&&this.draw_g.append("svg:path").attr("d",h).call(this.lineatt.func).call(this.fillatt.func);0<n.length&&this.draw_g.append("svg:path").attr("d",n).call(this.markeratt.func);return d};E.prototype.drawBinsScatter=function(){var a=this.getObject(),d=this.prepareColorDraw({rounding:!0,pixel_density:!0}),b=[],c=[],f=[],e=[],g=[],k,h,n=1,l=this.options.ScatCoef*(2E3<this.gmaxbin?2E3/this.gmaxbin:1);JSROOT.seed(d.sumz);if(1E5>
l*d.sumz){this.createAttMarker({attr:a});this.markeratt.resetPos();b="";for(k=d.i1;k<d.i2;++k){var p=d.grx[k+1]-d.grx[k];for(h=d.j1;h<d.j2;++h){var u=d.gry[h]-d.gry[h+1];var m=a.getBinContent(k+1,h+1);e=Math.round(l*m);if(!(0>=e))for(g=0;g<e;++g)b+=this.markeratt.create(Math.round(d.grx[k]+p*JSROOT.random()),Math.round(d.gry[h+1]+u*JSROOT.random()))}}this.draw_g.append("svg:path").attr("d",b).call(this.markeratt.func);return d}.7<this.maxbin&&(n=.7/this.maxbin);l=Math.round(d.max-d.min);l=this.createContour(50<
l?50:l,this.minposbin,this.maxbin,this.minposbin);for(k=d.i1;k<d.i2;++k)for(h=d.j1;h<d.j2;++h)if(m=a.getBinContent(k+1,h+1),!(0>=m||m<this.minbin||(p=d.grx[k+1]-d.grx[k],u=d.gry[h]-d.gry[h+1],0>=p*u||(m=l.getContourIndex(m/p/u),0>m)))){var r="M"+d.grx[k]+","+d.gry[h+1];if(void 0===b[m])b[m]=r,e[m]=p,g[m]=u;else{var q="m"+(d.grx[k]-c[m])+","+(d.gry[h+1]-f[m]);b[m]+=q.length<r.length?q:r;e[m]=Math.max(e[m],p);g[m]=Math.max(g[m],u)}c[m]=d.grx[k];f[m]=d.gry[h+1];b[m]+="v"+u+"h"+p+"v"+-u+"z"}m=this.getFrameSvg().select(".main_layer");
k=m.select("defs");k.empty()&&0<b.length&&(k=m.insert("svg:defs",":first-child"));this.createAttMarker({attr:a});for(m=0;m<b.length;++m)if(void 0!==b[m]&&m<l.arr.length){h="scatter_"+m;a=k.select("."+h);a.empty()?a=k.append("svg:pattern").attr("class",h).attr("id","jsroot_scatter_pattern_"+JSROOT._.id_counter++).attr("patternUnits","userSpaceOnUse"):a.selectAll("*").remove();h=Math.round(n*l.arr[m]*e[m]*g[m]);1>h&&(h=1);p=new Float32Array(h);u=new Float32Array(h);if(1===h)p[0]=u[0]=.5;else for(c=
0;c<h;++c)p[c]=JSROOT.random(),u[c]=JSROOT.random();this.markeratt.resetPos();c="";for(f=0;f<h;++f)c+=this.markeratt.create(p[f]*e[m],u[f]*g[m]);a.attr("width",e[m]).attr("height",g[m]).append("svg:path").attr("d",c).call(this.markeratt.func);this.draw_g.append("svg:path").attr("scatter-index",m).attr("fill","url(#"+a.attr("id")+")").attr("d",b[m])}return d};E.prototype.draw2DBins=function(){if(!this.draw_content)return this.removeG();this.createHistDrawAttributes();this.createG(!0);var a=null;this.isTH2Poly()?
a=this.drawPolyBinsColor():(this.options.Scat?a=this.drawBinsScatter():this.options.Color?a=this.drawBinsColor():this.options.Box?a=this.drawBinsBox():this.options.Arrow?a=this.drawBinsArrow():this.options.Contour?a=this.drawBinsContour():this.options.Candle&&(a=this.drawBinsCandle()),this.options.Text&&(a=this.drawBinsText(a)),a||(a=this.drawBinsScatter()));this.tt_handle=a};E.prototype.getBinTooltips=function(a,d){var b=[],c=this.getHisto(),f=c.getBinContent(a+1,d+1);b.push(this.getObjectHint());
b.push("x = "+this.getAxisBinTip("x",c.fXaxis,a));b.push("y = "+this.getAxisBinTip("y",c.fYaxis,d));b.push("bin = "+a+", "+d);c.$baseh&&(f-=c.$baseh.getBinContent(a+1,d+1));b.push("entries = "+(f===Math.round(f)?f:p.floatToString(f,JSROOT.gStyle.fStatFormat)));if("E"==this.options.TextKind||this.matchObjectType("TProfile2D"))a=c.getBinError(c.getBin(a+1,d+1)),b.push("error = "+(a===Math.round(a)?a.toString():p.floatToString(a,JSROOT.gStyle.fPaintTextFormat)));return b};E.prototype.getCandleTooltips=
function(a){var d=[],b=this.getFramePainter().getGrFuncs(this.options.second_x,this.options.second_y),c=this.getHisto();d.push(this.getObjectHint());d.push("x = "+b.axisAsText("x",c.fXaxis.GetBinLowEdge(a.bin+1)));d.push("mean y = "+p.floatToString(a.meany,JSROOT.gStyle.fStatFormat));d.push("m25 = "+p.floatToString(a.m25y,JSROOT.gStyle.fStatFormat));d.push("p25 = "+p.floatToString(a.p25y,JSROOT.gStyle.fStatFormat));return d};E.prototype.getPolyBinTooltips=function(a,d,b){a=this.getHisto().fBins.arr[a];
var c=this.getFramePainter().getGrFuncs(this.options.second_x,this.options.second_y),f=a.fPoly.fName,e=[],g=0;"Graph"===f&&(f="");0===f.length&&(f=a.fNumber);if(void 0===d&&void 0===b){d=b=0;var k=a.fPoly,h=1;"TMultiGraph"===k._typename&&(h=a.fPoly.fGraphs.arr.length,k=null);for(var n=0;n<h;++n){if(!k||0<n)k=a.fPoly.fGraphs.arr[n];for(var l=0;l<k.fNpoints;++l)++g,d+=k.fX[l],b+=k.fY[l]}1<g&&(d/=g,b/=g)}e.push(this.getObjectHint());e.push("x = "+c.axisAsText("x",d));e.push("y = "+c.axisAsText("y",b));
0<g&&e.push("npnts = "+g);e.push("bin = "+f);a.fContent===Math.round(a.fContent)?e.push("content = "+a.fContent):e.push("content = "+p.floatToString(a.fContent,JSROOT.gStyle.fStatFormat));return e};E.prototype.processTooltipEvent=function(a){if(!(a&&this.draw_content&&this.draw_g&&this.tt_handle)||this.options.Proj)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;var d=this.getHisto(),b=this.tt_handle,c=this.draw_g.select(".tooltip_bin");if(b.poly){b=this.getFramePainter().getGrFuncs(this.options.second_x,
this.options.second_y);var f=-1,e=b.revertAxis("x",a.x),g=b.revertAxis("y",a.y);if(void 0!==e&&void 0!==g)for(var k=d.fBins.arr.length,h=0;h<k&&0>f;++h){var n=d.fBins.arr[h];if(!(e<n.fXmin||e>n.fXmax||g<n.fYmin||g>n.fYmax||0===n.fContent&&!this.options.Zero)){var l=n.fPoly,p=1;"TMultiGraph"===l._typename&&(p=n.fPoly.fGraphs.arr.length,l=null);for(var u=0;u<p;++u){if(!l||0<u)l=n.fPoly.fGraphs.arr[u];if(l.IsInside(e,g)){f=h;break}}}}if(0>f)return c.remove(),null;e={name:d.fName,title:d.fTitle,x:a.x,
y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",exact:!0,menu:!0,lines:this.getPolyBinTooltips(f,e,g)};a.disabled?(c.remove(),e.changed=!0):(c.empty()&&(c=this.draw_g.append("svg:path").attr("class","tooltip_bin h1bin").style("pointer-events","none")),e.changed=c.property("current_bin")!==f,e.changed&&c.attr("d",this.createPolyBin(b,n)).style("opacity","0.7").property("current_bin",f));e.changed&&(e.user_info={obj:d,name:d.fName,
bin:f,cont:n.fContent,grx:a.x,gry:a.y});return e}if(b.candle){for(f=0;f<b.candle.length;++f){var m=b.candle[f];if(m.x1<=a.x&&a.x<=m.x2&&m.yy1<=a.y&&a.y<=m.yy2)break}if(f>=b.candle.length)return c.remove(),null;b={name:d.fName,title:d.fTitle,x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getCandleTooltips(m),exact:!0,menu:!0};a.disabled?(c.remove(),b.changed=!0):(c.empty()&&(c=this.draw_g.append("svg:rect").attr("class",
"tooltip_bin h1bin").style("pointer-events","none")),b.changed=c.property("current_bin")!==f,b.changed&&c.attr("x",m.x1).attr("width",m.x2-m.x1).attr("y",m.yy1).attr("height",m.yy2-m.yy1).style("opacity","0.7").property("current_bin",f));b.changed&&(b.user_info={obj:d,name:d.fName,bin:f+1,cont:m.median,binx:f+1,biny:1,grx:a.x,gry:a.y});return b}var r=0,q=null,v=this.getFramePainter();if(v.reverse_x)for(n=b.i1;n<b.i2&&!(a.x<=b.grx[n]&&a.x>=b.grx[n+1]);++n);else for(n=b.i1;n<b.i2&&!(a.x>=b.grx[n]&&
a.x<=b.grx[n+1]);++n);if(v.reverse_y)for(m=b.j1;m<b.j2&&!(a.y<=b.gry[m+1]&&a.y>=b.gry[m]);++m);else for(m=b.j1;m<b.j2&&!(a.y>=b.gry[m+1]&&a.y<=b.gry[m]);++m);if(n<b.i2&&m<b.j2){f=n;e=n+1;g=m;k=m+1;h=b.grx[f];l=b.grx[e];p=b.gry[k];u=b.gry[g];q=!0;if(this.options.Color){r=l-h;var w=u-p;l=Math.round(h+r*b.xbar2);h=Math.round(h+r*b.xbar1);u=Math.round(p+w*b.ybar2);p=Math.round(p+w*b.ybar1);if(v.reverse_x){if(a.x>h||a.x<=l)q=!1}else if(a.x<h||a.x>=l)q=!1;if(v.reverse_y){if(a.y>p||a.y<=u)q=!1}else if(a.y<
p||a.y>=u)q=!1}r=d.getBinContent(n+1,m+1);this.is_projection?q=0:q?b.hide_only_zeros?q=0!==r||this._show_empty_bins?0:null:(q=this.getContour().getPaletteIndex(this.getHistPalette(),r),null===q&&0===r&&this._show_empty_bins&&(q=0)):q=null}if(null===q)return c.remove(),null;v={name:d.fName,title:d.fTitle,x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getBinTooltips(n,m),exact:!0,menu:!0};this.options.Color&&(v.color2=
this.getHistPalette().getColor(q));a.disabled&&!this.is_projection?(c.remove(),v.changed=!0):(c.empty()&&(c=this.draw_g.append("svg:path").attr("class","tooltip_bin h1bin").style("pointer-events","none")),q=1E4*n+m,"X"==this.is_projection?(h=0,l=this.getFramePainter().getFrameWidth(),1<this.projection_width&&(p=(this.projection_width-1)/2,k+p>=b.j2?(k=Math.min(Math.round(k+p),b.j2),g=Math.max(k-this.projection_width,b.j1)):(g=Math.max(Math.round(g-p),b.j1),k=Math.min(g+this.projection_width,b.j2))),
p=b.gry[k],u=b.gry[g],q=777*g+333*k):"Y"==this.is_projection&&(p=0,u=this.getFramePainter().getFrameHeight(),1<this.projection_width&&(h=(this.projection_width-1)/2,e+h>=b.i2?(e=Math.min(Math.round(e+h),b.i2),f=Math.max(e-this.projection_width,b.i1)):(f=Math.max(Math.round(f-h),b.i1),e=Math.min(f+this.projection_width,b.i2))),h=b.grx[f],l=b.grx[e],q=777*f+333*e),v.changed=c.property("current_bin")!==q,v.changed&&c.attr("d","M"+h+","+p+"h"+(l-h)+"v"+(u-p)+"h"+(h-l)+"z").style("opacity","0.7").property("current_bin",
q),this.is_projection&&v.changed&&this.redrawProjection(f,e,g,k));v.changed&&(v.user_info={obj:d,name:d.fName,bin:d.getBin(n+1,m+1),cont:r,binx:n+1,biny:m+1,grx:a.x,gry:a.y});return v};E.prototype.canZoomInside=function(a,d,b){if("z"==a)return!0;var c=this.getHisto();c&&(c="y"==a?c.fYaxis:c.fXaxis);return!c||1<c.FindBin(b,.5)-c.FindBin(d,0)};E.prototype.draw2D=function(){var a=this;this.clear3DScene();return this.drawColorPalette(this.options.Zscale&&(this.options.Color||this.options.Contour),!0).then(function(d){return a.drawAxes().then(function(){a.draw2DBins();
if(!d)return!0;d.$main_painter=a;return d.drawPave()})}).then(function(){return a.drawHistTitle()}).then(function(){a.updateStatWebCanvas();return a.addInteractivity()})};E.prototype.draw3D=function(a){var d=this;this.mode3d=!0;return JSROOT.require("hist3d").then(function(){return d.draw3D(a)})};E.prototype.callDrawFunc=function(a){var d=this.getMainPainter(),b=this.getFramePainter();d!==this&&b&&b.mode3d!==this.options.Mode3D&&this.copyOptionsFrom(d);return this[this.options.Mode3D?"draw3D":"draw2D"](a)};
E.prototype.redraw=function(a){return this.callDrawFunc(a)};var ca=function(a,d,b){var c=new JSROOT.TH2Painter(a,d);return p.ensureTCanvas(c).then(function(){c.setAsMainPainter();c.decodeOptions(b);c.isTH2Poly()&&(c.options.Mode3D?c.options.Lego=12:c.options.Color||(c.options.Color=!0));c._show_empty_bins=!1;c.checkPadRange(!c.options.Mode3D&&14!=c.options.Contour);c.scanContent();c.createStat();return c.callDrawFunc()}).then(function(){return c.drawNextFunction(0)}).then(function(){!c.Mode3D&&c.options.AutoZoom&&
c.autoZoom();c.fillToolbar();c.options.Project&&!c.mode3d&&c.toggleProjection(c.options.Project);return c})};I.prototype=Object.create(JSROOT.ObjectPainter.prototype);I.prototype.cleanup=function(){var a=this,d=this.getPadPainter();d&&d.cleanPrimitives(function(b){return b===a.firstpainter||0<=a.painters.indexOf(b)});delete this.firstpainter;delete this.painters;JSROOT.ObjectPainter.prototype.cleanup.call(this)};I.prototype.buildStack=function(a){if(!a.fHists)return!1;var d=a.fHists.arr.length;if(0>=
d)return!1;var b=JSROOT.create("TList");b.Add(JSROOT.clone(a.fHists.arr[0]),a.fHists.opt[0]);for(var c=1;c<d;++c){var f=JSROOT.clone(a.fHists.arr[c]),e=a.fHists.opt[c],g=b.arr[c-1];if(f.fNbins!=g.fNbins||f.fXaxis.fXmin!=g.fXaxis.fXmin||f.fXaxis.fXmax!=g.fXaxis.fXmax)return console.warn("When drawing THStack, cannot sum-up histograms "+f.fName+" and "+g.fName),b.Clear(),!1;for(var k=0;k<f.fArray.length;++k)f.fArray[k]+=g.fArray[k];b.Add(f,e)}a.fStack=b;return!0};I.prototype.getMinMax=function(a){function d(a,
b){var c={min:0,max:0},d=!0,e=!0;-1111!==a.fMinimum&&(c.min=a.fMinimum,d=!1);-1111!==a.fMaximum&&(c.max=a.fMaximum,e=!1);if(!d&&!e)return c;var f=1,g=a.fXaxis.fNbins,k=1,h=1,p=!0;a.fXaxis.TestBit(JSROOT.EAxisBits.kAxisRange)&&(f=a.fXaxis.fFirst,g=a.fXaxis.fLast);0===a._typename.indexOf("TH2")&&(h=a.fYaxis.fNbins,a.fYaxis.TestBit(JSROOT.EAxisBits.kAxisRange)&&(k=a.fYaxis.fFirst,h=a.fYaxis.fLast));for(;k<=h;++k)for(var t=f;t<=g;++t){var y=a.getBinContent(t,k),x=b?a.getBinError(a.getBin(t,k)):0;d&&(p||
y-x<c.min)&&(c.min=y-x);e&&(p||y+x>c.max)&&(c.max=y+x);p=!1}return c}var b={min:0,max:0},c=this.getObject(),f=this.getPadPainter().getRootPad(!0);if(this.options.nostack)for(var e=0;e<c.fHists.arr.length;++e){var g=d(c.fHists.arr[e],a);0==e?b=g:(b.min=Math.min(b.min,g.min),b.max=Math.max(b.max,g.max))}else b.min=d(c.fStack.arr[0],a).min,b.max=d(c.fStack.arr[c.fStack.arr.length-1],a).max;-1111!=c.fMaximum&&(b.max=c.fMaximum);b.max*=1.05;-1111!=c.fMinimum&&(b.min=c.fMinimum);f&&(1==this.options.ndim?
f.fLogy:f.fLogz)?(0>=b.max&&(b.max=1),0>=b.min&&(b.min=1E-4*b.max),a=1+.2*Math.log10(b.max/b.min),b.min*=1/(1+.5*Math.log10(b.max/b.min)),b.max*=a):0<b.min&&b.min<.05*b.max&&(b.min=0);return b};I.prototype.drawNextHisto=function(a){var d=this,b=this.getObject(),c=(b=this.options.nostack?b.fHists:b.fStack)&&b.arr?b.arr.length:0;if(a>=c)return Promise.resolve(this);var f=this.options.horder?a:c-a-1,e=b.arr[f],g=b.opt[f]||e.fOption||this.options.hopt;0>g.toUpperCase().indexOf(this.options.hopt)&&(g+=
this.options.hopt);this.options.draw_errors&&!g&&(g="E");g+=" same nostat";if(this.options._pfc||this.options._plc||this.options._pmc){var k=this.getMainPainter();k&&k.createAutoColor&&(c=k.createAutoColor(c),this.options._pfc&&(e.fFillColor=c),this.options._plc&&(e.fLineColor=c),this.options._pmc&&(e.fMarkerColor=c))}0<f&&!this.options.nostack&&(e.$baseh=b.arr[f-1]);return JSROOT.draw(this.getDom(),e,g).then(function(b){d.painters.push(b);return d.drawNextHisto(a+1)})};I.prototype.decodeOptions=
function(a){this.options||(this.options={});JSROOT.extend(this.options,{ndim:1,nostack:!1,same:!1,horder:!0,has_errors:!1,draw_errors:!1,hopt:""});var d=this.getObject(),b=d.fHistogram||(d.fHists?d.fHists.arr[0]:null)||(d.fStack?d.fStack.arr[0]:null);b&&0==b._typename.indexOf("TH2")&&(this.options.ndim=2);2!=this.options.ndim||a||(a="lego1");if(d.fHists&&!this.options.nostack)for(b=0;b<d.fHists.arr.length;++b){var c=this.options,f;if(!(f=this.options.has_errors))a:{f=d.fHists.arr[b];if(f.fSumw2&&
0<f.fSumw2.length)for(var e=0;e<f.fSumw2.length;++e)if(0<f.fSumw2[e]){f=!0;break a}f=!1}c.has_errors=f}a=new JSROOT.DrawOptions(a);this.options.nostack=a.check("NOSTACK");a.check("STACK")&&(this.options.nostack=!1);this.options.same=a.check("SAME");this.options._pfc=a.check("PFC");this.options._plc=a.check("PLC");this.options._pmc=a.check("PMC");this.options.hopt=a.remain();d=a.check("LEGO");this.options.errors=a.check("E");!this.options.nostack&&this.options.has_errors&&!d&&!a.check("HIST")&&0>this.options.hopt.indexOf("E")&&
(this.options.draw_errors=!0);this.options.horder=this.options.nostack||d};I.prototype.createHistogram=function(a){var d=a.fHists,b=d?d.arr.length:0;if(!b)return d=JSROOT.createHistogram("TH1I",100),d.fTitle=a.fTitle,d;var c=d.arr[0],f=JSROOT.createHistogram(1==this.options.ndim?"TH1I":"TH2I",c.fXaxis.fNbins,c.fYaxis.fNbins);f.fName="axis_hist";JSROOT.extend(f.fXaxis,c.fXaxis);2==this.options.ndim&&JSROOT.extend(f.fYaxis,c.fYaxis);for(c=1;c<b;++c){var e=d.arr[c];f.fXaxis.fLabels||(f.fXaxis.fXmin=
Math.min(f.fXaxis.fXmin,e.fXaxis.fXmin),f.fXaxis.fXmax=Math.max(f.fXaxis.fXmax,e.fXaxis.fXmax));2!=this.options.ndim||f.fYaxis.fLabels||(f.fYaxis.fXmin=Math.min(f.fYaxis.fXmin,e.fYaxis.fXmin),f.fYaxis.fXmax=Math.max(f.fYaxis.fXmax,e.fYaxis.fXmax))}f.fTitle=a.fTitle;return f};I.prototype.updateObject=function(a){var d=this;if(!this.matchObjectType(a))return!1;var b=this.getObject();b.fHists=a.fHists;b.fStack=a.fStack;b.fTitle=a.fTitle;this.options.nostack||(this.options.nostack=!this.buildStack(b));
this.firstpainter&&(a=a.fHistogram,a||(a=b.fHistogram=this.createHistogram(b)),this.firstpainter.updateObject(a),a=this.getMinMax(this.options.errors||this.options.draw_errors),this.firstpainter.options.minimum=a.min,this.firstpainter.options.maximum=a.max,1==this.options.ndim&&(this.firstpainter.ymin=a.min,this.firstpainter.ymax=a.max));a=(b=this.options.nostack?b.fHists:b.fStack)&&b.arr?b.arr.length:0;if(a!==this.painters.length)(b=this.getPadPainter())&&b.cleanPrimitives(function(a){return 0<=
d.painters.indexOf(a)}),this.painters=[],this.did_update=!0;else for(var c=0;c<a;++c)this.painters[c].updateObject(b.arr[this.options.horder?c:a-c-1]);return!0};I.prototype.redraw=function(){if(this.did_update)return delete this.did_update,this.drawNextHisto(0)};p.getColorPalette=da;p.drawPave=T;p.produceLegend=function(a,d){var b=p.getElementMainPainter(a);if(b){var c=b.getPadPainter();b=c.getRootPad(!0);if(c&&b){for(var f=JSROOT.create("TLegend"),e=0;e<c.painters.length;++e){var g=c.painters[e],
k=g.getObject();if(k){var h=JSROOT.create("TLegendEntry");h.fObject=k;h.fLabel="all"==d?k.fName:g.getItemName();h.fOption="";h.fLabel&&(g.lineatt&&g.lineatt.used&&(h.fOption+="l"),g.fillatt&&g.fillatt.used&&(h.fOption+="f"),g.markeratt&&g.markeratt.used&&(h.fOption+="m"),h.fOption||(h.fOption="l"),f.fPrimitives.Add(h))}}if(d=f.fPrimitives.arr.length)return 8<d&&(d=8),d*=.1,f.fX1NDC=.4*b.fLeftMargin+.6*(1-b.fRightMargin),f.fY1NDC=(1-d)*(1-b.fTopMargin)+d*b.fBottomMargin,f.fX2NDC=.99-b.fRightMargin,
f.fY2NDC=.99-b.fTopMargin,f.fFillStyle=1001,T(a,f)}}};p.drawHistogram1D=function(a,d,b){var c=new G(a,d);return p.ensureTCanvas(c).then(function(){c.setAsMainPainter();c.decodeOptions(b);c.checkPadRange(!c.options.Mode3D);c.scanContent();c.createStat();return c.callDrawFunc()}).then(function(){return c.drawNextFunction(0)}).then(function(){!c.options.Mode3D&&c.options.AutoZoom&&c.autoZoom();c.fillToolbar();return c})};p.drawHistogram2D=ca;p.drawTF2=function(a,d,b){b=new JSROOT.DrawOptions(b);var c=
b.check("NOSAVE"),f=Q(d,c);b=b.empty()?"cont3":"SAME"===b.opt?"cont2 same":b.opt;return ca(a,f,b).then(function(a){a.tf2_typename=d._typename;a.tf2_nosave=c;a.updateObject=function(a){if(!a||this.tf2_typename!=a._typename)return!1;Q(a,this.tf2_nosave,this.getHisto());return!0};return a})};p.drawHStack=function(a,d,b){if(!d.fHists||!d.fHists.arr)return null;var c=new I(a,d,b);return p.ensureTCanvas(c,!1).then(function(){c.decodeOptions(b);c.options.nostack||(c.options.nostack=!c.buildStack(d));if(!c.options.same){d.fHistogram||
(d.fHistogram=c.createHistogram(d));var f=c.getMinMax(c.options.errors||c.options.draw_errors),e=c.options.hopt+" axis";f&&(e+=";minimum:"+f.min+";maximum:"+f.max);return JSROOT.draw(a,d.fHistogram,e).then(function(a){c.firstpainter=a})}}).then(function(){return c.drawNextHisto(0)})};JSROOT.TPavePainter=A;JSROOT.THistPainter=y;JSROOT.TH1Painter=G;JSROOT.TH2Painter=E;JSROOT.THStackPainter=I;return JSROOT});
