var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(f){var q=0;return function(){return q<f.length?{done:!1,value:f[q++]}:{done:!0}}};$jscomp.arrayIterator=function(f){return{next:$jscomp.arrayIteratorImpl(f)}};$jscomp.makeIterator=function(f){var q="undefined"!=typeof Symbol&&Symbol.iterator&&f[Symbol.iterator];return q?q.call(f):$jscomp.arrayIterator(f)};
$jscomp.getGlobal=function(f){return"undefined"!=typeof window&&window===f?f:"undefined"!=typeof global&&null!=global?global:f};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(f,q,z){f!=Array.prototype&&f!=Object.prototype&&(f[q]=z.value)};
$jscomp.polyfill=function(f,q,z,n){if(q){z=$jscomp.global;f=f.split(".");for(n=0;n<f.length-1;n++){var y=f[n];y in z||(z[y]={});z=z[y]}f=f[f.length-1];n=z[f];q=q(n);q!=n&&null!=q&&$jscomp.defineProperty(z,f,{configurable:!0,writable:!0,value:q})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(f){function q(){this.batch_=null}function z(F){return F instanceof y?F:new y(function(f,n){f(F)})}if(f&&!$jscomp.FORCE_POLYFILL_PROMISE)return f;q.prototype.asyncExecute=function(F){if(null==this.batch_){this.batch_=[];var f=this;this.asyncExecuteFunction(function(){f.executeBatch_()})}this.batch_.push(F)};var n=$jscomp.global.setTimeout;q.prototype.asyncExecuteFunction=function(F){n(F,0)};q.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var F=
this.batch_;this.batch_=[];for(var f=0;f<F.length;++f){var n=F[f];F[f]=null;try{n()}catch(a){this.asyncThrow_(a)}}}this.batch_=null};q.prototype.asyncThrow_=function(f){this.asyncExecuteFunction(function(){throw f;})};var y=function(f){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var F=this.createResolveAndReject_();try{f(F.resolve,F.reject)}catch(I){F.reject(I)}};y.prototype.createResolveAndReject_=function(){function f(a){return function(c){q||(q=!0,a.call(n,c))}}var n=this,q=!1;
return{resolve:f(this.resolveTo_),reject:f(this.reject_)}};y.prototype.resolveTo_=function(f){if(f===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(f instanceof y)this.settleSameAsPromise_(f);else{a:switch(typeof f){case "object":var n=null!=f;break a;case "function":n=!0;break a;default:n=!1}n?this.resolveToNonPromiseObj_(f):this.fulfill_(f)}};y.prototype.resolveToNonPromiseObj_=function(f){var n=void 0;try{n=f.then}catch(I){this.reject_(I);return}"function"==typeof n?
this.settleSameAsThenable_(n,f):this.fulfill_(f)};y.prototype.reject_=function(f){this.settle_(2,f)};y.prototype.fulfill_=function(f){this.settle_(1,f)};y.prototype.settle_=function(f,n){if(0!=this.state_)throw Error("Cannot settle("+f+", "+n+"): Promise already settled in state"+this.state_);this.state_=f;this.result_=n;this.executeOnSettledCallbacks_()};y.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var f=0;f<this.onSettledCallbacks_.length;++f)B.asyncExecute(this.onSettledCallbacks_[f]);
this.onSettledCallbacks_=null}};var B=new q;y.prototype.settleSameAsPromise_=function(f){var n=this.createResolveAndReject_();f.callWhenSettled_(n.resolve,n.reject)};y.prototype.settleSameAsThenable_=function(f,n){var q=this.createResolveAndReject_();try{f.call(n,q.resolve,q.reject)}catch(a){q.reject(a)}};y.prototype.then=function(f,n){function q(b,h){return"function"==typeof b?function(d){try{a(b(d))}catch(m){c(m)}}:h}var a,c,b=new y(function(b,h){a=b;c=h});this.callWhenSettled_(q(f,a),q(n,c));return b};
y.prototype.catch=function(f){return this.then(void 0,f)};y.prototype.callWhenSettled_=function(f,n){function q(){switch(a.state_){case 1:f(a.result_);break;case 2:n(a.result_);break;default:throw Error("Unexpected state: "+a.state_);}}var a=this;null==this.onSettledCallbacks_?B.asyncExecute(q):this.onSettledCallbacks_.push(q)};y.resolve=z;y.reject=function(f){return new y(function(n,q){q(f)})};y.race=function(f){return new y(function(n,q){for(var a=$jscomp.makeIterator(f),c=a.next();!c.done;c=a.next())z(c.value).callWhenSettled_(n,
q)})};y.all=function(f){var n=$jscomp.makeIterator(f),q=n.next();return q.done?z([]):new y(function(a,c){function b(b){return function(c){d[b]=c;h--;0==h&&a(d)}}var d=[],h=0;do d.push(void 0),h++,z(q.value).callWhenSettled_(b(d.length-1),c),q=n.next();while(!q.done)})};return y},"es6","es3");$jscomp.polyfill("Number.isFinite",function(f){return f?f:function(f){return"number"!==typeof f?!1:!isNaN(f)&&Infinity!==f&&-Infinity!==f}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(f,q){this.$jscomp$symbol$id_=f;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:q})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function f(z){if(this instanceof f)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(z||"")+"_"+q++,z)}var q=0;return f}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var f=$jscomp.global.Symbol.iterator;f||(f=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[f]&&$jscomp.defineProperty(Array.prototype,f,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var f=$jscomp.global.Symbol.asyncIterator;f||(f=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(f){$jscomp.initSymbolIterator();f={next:f};f[$jscomp.global.Symbol.iterator]=function(){return this};return f};
$jscomp.iteratorFromArray=function(f,q){$jscomp.initSymbolIterator();f instanceof String&&(f+="");var z=0,n={next:function(){if(z<f.length){var y=z++;return{value:q(y,f[y]),done:!1}}n.next=function(){return{done:!0,value:void 0}};return n.next()}};n[Symbol.iterator]=function(){return n};return n};$jscomp.polyfill("Array.prototype.entries",function(f){return f?f:function(){return $jscomp.iteratorFromArray(this,function(f,z){return[f,z]})}},"es6","es3");
JSROOT.define(["d3","painter","v7gpad"],function(f,q){function z(a){"ROOT::Experimental::RAxisEquidistant"==a._typename||"ROOT::Experimental::RAxisLabels"==a._typename?(0===a.fInvBinWidth&&(a.$dummy=!0,a.fInvBinWidth=1,a.fNBinsNoOver=0,a.fLow=0),a.min=a.fLow,a.max=a.fLow+a.fNBinsNoOver/a.fInvBinWidth,a.GetNumBins=function(){return this.fNBinsNoOver},a.GetBinCoord=function(a){return this.fLow+a/this.fInvBinWidth},a.FindBin=function(a,b){return Math.floor((a-this.fLow)*this.fInvBinWidth+b)}):"ROOT::Experimental::RAxisIrregular"==
a._typename&&(a.min=a.fBinBorders[0],a.max=a.fBinBorders[a.fBinBorders.length-1],a.GetNumBins=function(){return this.fBinBorders.length},a.GetBinCoord=function(a){var b=Math.round(a);if(0>=b)return this.fBinBorders[0];if(b>=this.fBinBorders.length)return this.fBinBorders[this.fBinBorders.length-1];if(b==a)return this.fBinBorders[b];var c=a<b?b-1:b+1;return this.fBinBorders[b]*Math.abs(a-c)+this.fBinBorders[c]*Math.abs(a-b)},a.FindBin=function(a,b){for(var c=1;c<this.fBinBorders.length;++c)if(a<this.fBinBorders[c])return Math.floor(c-
1+b);return this.fBinBorders.length-1});a.GetBinCenter=function(a){return this.GetBinCoord(a-.5)};a.GetBinLowEdge=function(a){return this.GetBinCoord(a-1)}}function n(a,c){JSROOT.ObjectPainter.call(this,a,c);this.csstype="hist";this.draw_content=!0;this.nbinsy=this.nbinsx=0;this.accept_drops=!0;this.mode3d=!1;this.getHisto(!0)}function y(a,c){n.call(this,a,c);this.wheel_zoomy=!1}function B(a,c){n.call(this,a,c);this.wheel_zoomy=!0}function F(a,c,b){JSROOT.v7.RPavePainter.call(this,a,c,b,"stats")}
n.prototype=Object.create(JSROOT.ObjectPainter.prototype);n.prototype.isDisplayItem=function(){var a=this.getObject();return a&&a.fAxes?!0:!1};n.prototype.getHisto=function(a){var c=this.getObject(),b=c&&c.fHistImpl?c.fHistImpl.fIO:null;!b||b.getBinContent&&!a?!b&&c&&c.fAxes&&(b=c,!b.getBinContent||a)&&(3==b.fAxes.length?(z(b.fAxes[0]),z(b.fAxes[1]),z(b.fAxes[2]),b.nx=b.fIndicies[1]-b.fIndicies[0],b.dx=b.fIndicies[0]+1,b.stepx=b.fIndicies[2],b.ny=b.fIndicies[4]-b.fIndicies[3],b.dy=b.fIndicies[3]+
1,b.stepy=b.fIndicies[5],b.nz=b.fIndicies[7]-b.fIndicies[6],b.dz=b.fIndicies[6]+1,b.stepz=b.fIndicies[8],b.getBin=function(a,b,c){return a-1+this.fAxes[0].GetNumBins()*(b-1)+this.fAxes[0].GetNumBins()*this.fAxes[1].GetNumBins()*(c-1)},b.getBin0=1<b.stepx||1<b.stepy||1<b.stepz?function(a,b,c){return Math.floor((a-this.dx)/this.stepx)+this.nx/this.stepx*Math.floor((b-this.dy)/this.stepy)+this.nx/this.stepx*this.ny/this.stepy*Math.floor((c-this.dz)/this.stepz)}:function(a,b,c){return a-this.dx+this.nx*
(b-this.dy)+this.nx*this.ny*(c-dz)},b.getBinContent=function(a,b,c){return this.fBinContent[this.getBin0(a,b,c)]},b.getBinError=function(a,b,c){return Math.sqrt(Math.abs(this.getBinContent(a,b,c)))}):2==b.fAxes.length?(z(b.fAxes[0]),z(b.fAxes[1]),b.nx=b.fIndicies[1]-b.fIndicies[0],b.dx=b.fIndicies[0]+1,b.stepx=b.fIndicies[2],b.ny=b.fIndicies[4]-b.fIndicies[3],b.dy=b.fIndicies[3]+1,b.stepy=b.fIndicies[5],b.getBin=function(a,b){return a-1+this.fAxes[0].GetNumBins()*(b-1)},b.getBin0=1<b.stepx||1<b.stepy?
function(a,b){return Math.floor((a-this.dx)/this.stepx)+this.nx/this.stepx*Math.floor((b-this.dy)/this.stepy)}:function(a,b){return a-this.dx+this.nx*(b-this.dy)},b.getBinContent=function(a,b){return this.fBinContent[this.getBin0(a,b)]},b.getBinError=function(a,b){return Math.sqrt(Math.abs(this.getBinContent(a,b)))}):(z(b.fAxes[0]),b.nx=b.fIndicies[1]-b.fIndicies[0],b.dx=b.fIndicies[0]+1,b.stepx=b.fIndicies[2],b.getBin=function(a){return a-1},b.getBin0=1<b.stepx?function(a){return Math.floor((a-this.dx)/
this.stepx)}:function(a){return a-this.dx},b.getBinContent=function(a){return this.fBinContent[this.getBin0(a)]},b.getBinError=function(a){return Math.sqrt(Math.abs(this.getBinContent(a)))})):b.fAxes._2?(z(b.fAxes._0),z(b.fAxes._1),z(b.fAxes._2),b.getBin=function(a,b,c){return a-1+this.fAxes._0.GetNumBins()*(b-1)+this.fAxes._0.GetNumBins()*this.fAxes._1.GetNumBins()*(c-1)},b.getBinContent=function(a,b,c){return this.fStatistics.fBinContent[this.getBin(a,b,c)]},b.getBinError=function(a,b,c){a=this.getBin(a,
b,c);return this.fStatistics.fSumWeightsSquared?Math.sqrt(this.fStatistics.fSumWeightsSquared[a]):Math.sqrt(Math.abs(this.fStatistics.fBinContent[a]))}):b.fAxes._1?(z(b.fAxes._0),z(b.fAxes._1),b.getBin=function(a,b){return a-1+this.fAxes._0.GetNumBins()*(b-1)},b.getBinContent=function(a,b){return this.fStatistics.fBinContent[this.getBin(a,b)]},b.getBinError=function(a,b){a=this.getBin(a,b);return this.fStatistics.fSumWeightsSquared?Math.sqrt(this.fStatistics.fSumWeightsSquared[a]):Math.sqrt(Math.abs(this.fStatistics.fBinContent[a]))}):
(z(b.fAxes._0),b.getBin=function(a){return a-1},b.getBinContent=function(a){return this.fStatistics.fBinContent[a-1]},b.getBinError=function(a){return this.fStatistics.fSumWeightsSquared?Math.sqrt(this.fStatistics.fSumWeightsSquared[a-1]):Math.sqrt(Math.abs(this.fStatistics.fBinContent[a-1]))});return b};n.prototype.isRProfile=function(){return!1};n.prototype.isRH2Poly=function(){return!1};n.prototype.decodeOptions=function(){this.options||(this.options={Hist:1})};n.prototype.copyOptionsFrom=function(a){a!==
this&&(this.options.Mode3D=a.options.Mode3D)};n.prototype.copyOptionsToOthers=function(){var a=this;this.forEachPainter(function(c){c!==a&&"function"==typeof c.copyOptionsFrom&&c.copyOptionsFrom(a)},"objects")};n.prototype.clear3DScene=function(){var a=this.getFramePainter();a&&"function"===typeof a.create3DScene&&a.create3DScene(-1);this.mode3d=!1};n.prototype.cleanup=function(){this.clear3DScene();delete this.options;JSROOT.ObjectPainter.prototype.cleanup.call(this)};n.prototype.getDimension=function(){return 1};
n.prototype.scanContent=function(){};n.prototype.drawFrameAxes=function(){var a=this.getFramePainter();if(!a)return Promise.resolve(!1);if(!this.draw_content)return Promise.resolve(!0);if(!this.isMainPainter()){if(!this.options.second_x&&!this.options.second_y)return Promise.resolve(!0);a.setAxes2Ranges(this.options.second_x,this.getAxis("x"),this.xmin,this.xmax,this.options.second_y,this.getAxis("y"),this.ymin,this.ymax);return a.drawAxes2(this.options.second_x,this.options.second_y)}a.cleanupAxes();
a.xmin=a.xmax=0;a.ymin=a.ymax=0;a.zmin=a.zmax=0;a.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,this.getAxis("y"),this.ymin,this.ymax,this.getAxis("z"),this.zmin,this.zmax);return a.drawAxes()};n.prototype.createHistDrawAttributes=function(){this.createv7AttFill();this.createv7AttLine()};n.prototype.updateDisplayItem=function(a,c){if(!a||!c)return!1;a.fAxes=c.fAxes;a.fIndicies=c.fIndicies;a.fBinContent=c.fBinContent;a.fContMin=c.fContMin;a.fContMinPos=c.fContMinPos;a.fContMax=c.fContMax;this.getHisto(!0);
return!0};n.prototype.updateObject=function(a){var c=this.getObject();if(a!==c){if(!this.matchObjectType(a))return!1;if(this.isDisplayItem())this.updateDisplayItem(c,a);else{var b=c&&c.fHistImpl?c.fHistImpl.fIO:null,d=a&&a.fHistImpl?a.fHistImpl.fIO:null;if(!b||!d)return!1;b.fStatistics=d.fStatistics;c.fTitle=a.fTitle}}this.scanContent();return this.histogram_updated=!0};n.prototype.getAxis=function(a){var c=this.getHisto(),b=this.getObject(),d=null;if(b&&b.fAxes)switch(a){case "x":d=b.fAxes[0];break;
case "y":d=b.fAxes[1];break;case "z":d=b.fAxes[2];break;default:d=b.fAxes[0]}else if(c&&c.fAxes)switch(a){case "x":d=c.fAxes._0;break;case "y":d=c.fAxes._1;break;case "z":d=c.fAxes._2;break;default:d=c.fAxes._0}d&&!d.GetBinCoord&&z(d);return d};n.prototype.getAxisBinTip=function(a,c,b){var d=this.getFramePainter(),h=d[a+"_handle"],k=this.getAxis(a),m=k.GetBinCoord(c);if("labels"===h.kind)return d.axisAsText(a,m);c=k.GetBinCoord(c+(b||1));return"time"===h.kind?d.axisAsText(a,(m+c)/2):"["+d.axisAsText(a,
m)+", "+d.axisAsText(a,c)+")"};n.prototype.extractAxesProperties=function(a){if(this.getHisto()){this.nbinsx=this.nbinsy=this.nbinsz=0;var c=this.getAxis("x");this.nbinsx=c.GetNumBins();this.xmin=c.min;this.xmax=c.max;2>a||(c=this.getAxis("y"),this.nbinsy=c.GetNumBins(),this.ymin=c.min,this.ymax=c.max,3>a||(c=this.getAxis("z"),this.nbinsz=c.GetNumBins(),this.zmin=c.min,this.zmax=c.max))}};n.prototype.addInteractivity=function(){var a=this.isMainPainter(),c=this.options.second_x||this.options.second_y,
b=a||c?this.getFramePainter():null;return b?b.addInteractivity(!a&&c):Promise.resolve(!0)};n.prototype.processItemReply=function(a,c){if(!this.isDisplayItem())return console.error("Get item when display normal histogram");c.reqid===this.current_item_reqid&&(null!==a&&this.updateDisplayItem(this.getObject(),a.item),c.resolveFunc(!0))};n.prototype.drawingBins=function(a){var c=this,b=!1;a&&"string"==typeof a&&0==a.indexOf("zoom")&&(0<a.indexOf("0")&&(b=!0),1<this.getDimension()&&0<a.indexOf("1")&&(b=
!0),2<this.getDimension()&&0<a.indexOf("2")&&(b=!0));return this.isDisplayItem()&&b&&this.v7CommMode()==JSROOT.v7.CommMode.kNormal&&this.prepareDraw({only_indexes:!0}).incomplete?new Promise(function(a){var b=c.v7SubmitRequest("",{_typename:"ROOT::Experimental::RHistDrawableBase::RRequest"},c.processItemReply.bind(c));b?(c.current_item_reqid=b.reqid,b.resolveFunc=a,setTimeout(c.processItemReply.bind(c,null,b),1E3)):a(!0)}):Promise.resolve(!0)};n.prototype.toggleStat=function(){};n.prototype.getSelectIndex=
function(a,c,b){var d=this.getAxis(a),h=this["nbins"+a]||0;this.options.second_x&&"x"==a&&(a="x2");this.options.second_y&&"y"==a&&(a="y2");var k=this.getFramePainter(),m=k?k["zoom_"+a+"min"]:0;a=k?k["zoom_"+a+"max"]:0;m!==a&&d?(c="left"==c?d.FindBin(m,b||0):d.FindBin(a,(b||0)+.5),0>c?c=0:c>h&&(c=h)):c="left"==c?0:h;return c};n.prototype.clickButton=function(a){switch(a){case "ToggleZoom":if(this.zoom_xmin!==this.zoom_xmax||this.zoom_ymin!==this.zoom_ymax||this.zoom_zmin!==this.zoom_zmax)return this.unzoom(),
this.getFramePainter().zoomChangedInteractive("reset"),!0;if(this.draw_content&&"function"===typeof this.autoZoom)return this.autoZoom(),!0;break;case "ToggleLogX":this.getFramePainter().toggleAxisLog("x");break;case "ToggleLogY":this.getFramePainter().toggleAxisLog("y");break;case "ToggleLogZ":this.getFramePainter().toggleAxisLog("z");break;case "ToggleStatBox":return this.toggleStat(),!0}return!1};n.prototype.fillToolbar=function(a){var c=this.getPadPainter();c&&(c.addPadButton("auto_zoom","Toggle between unzoom and autozoom-in",
"ToggleZoom","Ctrl *"),c.addPadButton("arrow_right","Toggle log x","ToggleLogX","PageDown"),c.addPadButton("arrow_up","Toggle log y","ToggleLogY","PageUp"),1<this.getDimension()&&c.addPadButton("arrow_diag","Toggle log z","ToggleLogZ"),this.draw_content&&c.addPadButton("statbox","Toggle stat box","ToggleStatBox"),a||c.showPadButtons())};n.prototype.get3DToolTip=function(a){var c=this.getHisto(),b={bin:a,name:c.fName||"histo",title:c.fTitle};switch(this.getDimension()){case 1:b.ix=a+1;b.iy=1;b.value=
c.getBinContent(b.ix);b.error=c.getBinError(b.ix);b.lines=this.getBinTooltips(a-1);break;case 2:b.ix=a%this.nbinsx+1;b.iy=(a-(b.ix-1))/this.nbinsx+1;b.value=c.getBinContent(b.ix,b.iy);b.error=c.getBinError(b.ix,b.iy);b.lines=this.getBinTooltips(b.ix-1,b.iy-1);break;case 3:b.ix=a%this.nbinsx+1,b.iy=(a-(b.ix-1))/this.nbinsx%this.nbinsy+1,b.iz=(a-(b.ix-1)-(b.iy-1)*this.nbinsx)/this.nbinsx/this.nbinsy+1,b.value=c.getBinContent(b.ix,b.iy,b.iz),b.error=c.getBinError(b.ix,b.iy,b.iz),b.lines=this.getBinTooltips(b.ix-
1,b.iy-1,b.iz-1)}return b};n.prototype.createContour=function(a,c,b){if(a&&c){b||(b={});var d=JSROOT.gStyle.fNumberContours,h=this.minbin,k=this.maxbin,m=this.minposbin;b.scatter_plot&&(50<d&&(d=50),h=this.minposbin);h===k&&(h=this.gminbin,k=this.gmaxbin,m=this.gminposbin);3>this.getDimension()&&(a.zoom_zmin!==a.zoom_zmax?(h=a.zoom_zmin,k=a.zoom_zmax):b.full_z_range&&(h=a.zmin,k=a.zmax));c.setFullRange(a.zmin,a.zmax);c.createContour(a.logz,d,h,k,m);3>this.getDimension()&&(a.scale_zmin=c.colzmin,a.scale_zmax=
c.colzmax)}};n.prototype.changeValuesRange=function(a,c){var b=this.getFramePainter();if(b){var d=b.isAxisZoomed(c)?"zoom_"+c:c;a.input("Enter values range for axis "+c+" like [0,100] or empty string to unzoom","["+b[d+"min"]+","+b[d+"max"]+"]").then(function(a){(a=a?JSON.parse(a):[])&&"object"==typeof a&&2==a.length&&Number.isFinite(a[0])&&Number.isFinite(a[1])?b.zoom(c,a[0],a[1]):b.unzoom(c)})}};n.prototype.fillContextMenu=function(a){var c=this;a.add("header:v7histo::anyname");this.draw_content&&
(a.addchk(this.toggleStat("only-check"),"Show statbox",function(){return c.toggleStat()}),2==this.getDimension()&&a.add("Values range",function(){return c.changeValuesRange(a,"z")}),"function"==typeof this.fillHistContextMenu&&this.fillHistContextMenu(a));var b=this.getFramePainter();if(this.options.Mode3D){0<a.size()&&a.add("separator");var d=this.getMainPainter()||this;a.addchk(d.isTooltipAllowed(),"Show tooltips",function(){return d.setTooltipAllowed("toggle")});a.addchk(b.enable_highlight,"Highlight bins",
function(){b.enable_highlight=!b.enable_highlight;!b.enable_highlight&&d.highlightBin3D&&d.mode3d&&d.highlightBin3D(null)});b&&b.render3D&&(a.addchk(d.options.FrontBox,"Front box",function(){d.options.FrontBox=!d.options.FrontBox;b.render3D()}),a.addchk(d.options.BackBox,"Back box",function(){d.options.BackBox=!d.options.BackBox;b.render3D()}));this.draw_content&&(a.addchk(!this.options.Zero,"Suppress zeros",function(){c.options.Zero=!c.options.Zero;c.redrawPad()}),12==this.options.Lego||14==this.options.Lego)&&
(a.addchk(this.options.Zscale,"Z scale",function(){return c.toggleColz()}),this.fillPaletteMenu&&this.fillPaletteMenu(a));d.control&&"function"===typeof d.control.reset&&a.add("Reset camera",function(){return d.control.reset()})}a.addAttributesMenu(this);this.histogram_updated&&b.zoomChangedInteractive()&&a.add("Let update zoom",function(){return b.zoomChangedInteractive("reset")});return!0};n.prototype.updatePaletteDraw=function(){if(this.isMainPainter()){var a=this.getPadPainter().findPainterFor(void 0,
void 0,"ROOT::Experimental::RPaletteDrawable");a&&a.drawPalette()}};n.prototype.fillPaletteMenu=function(a){function c(a){h.options.Palette=parseInt(a);h.redraw()}function b(b,h,g){a.addchk(b===d||g,"<nobr>"+h+"</nobr>",b,c)}var d=this.options.Palette,h=this;if(null===d||0===d)d=JSROOT.settings.Palette;a.add("sub:Palette");b(50,"ROOT 5",10<=d&&51>d);b(51,"Deep Sea");b(52,"Grayscale",0<d&&10>d);b(53,"Dark body radiator");b(54,"Two-color hue");b(55,"Rainbow");b(56,"Inverted dark body radiator");b(57,
"Bird",112<d);b(58,"Cubehelix");b(59,"Green Red Violet");b(60,"Blue Red Yellow");b(61,"Ocean");b(62,"Color Printable On Grey");b(63,"Alpine");b(64,"Aquamarine");b(65,"Army");b(66,"Atlantic");a.add("endsub:")};n.prototype.drawColorPalette=function(){return null};n.prototype.toggleColz=function(){if(this.options.Mode3D?12===this.options.Lego||14===this.options.Lego||11===this.options.Surf||12===this.options.Surf:this.options.Color||this.options.Contour)this.options.Zscale=!this.options.Zscale,this.drawColorPalette(this.options.Zscale,
!1,!0)};n.prototype.toggleMode3D=function(){this.options.Mode3D=!this.options.Mode3D;!this.options.Mode3D||this.options.Surf||this.options.Lego||this.options.Error||(this.options.Lego=50<=this.nbinsx||50<=this.nbinsy?this.options.Color?14:13:this.options.Color?12:1,this.options.Zero=!1);this.copyOptionsToOthers();this.interactiveRedraw("pad","drawopt")};n.prototype.prepareDraw=function(a){a||(a={rounding:!0,extra:0,middle:0});void 0===a.extra&&(a.extra=0);void 0===a.right_extra&&(a.right_extra=a.extra);
void 0===a.middle&&(a.middle=0);var c=this.getHisto(),b=this.getAxis("x"),d=this.getAxis("y"),h=this.getFramePainter(),k=this.getDimension(),m,g,e={i1:this.getSelectIndex("x","left",0-a.extra),i2:this.getSelectIndex("x","right",1+a.right_extra),j1:2>k?0:this.getSelectIndex("y","left",0-a.extra),j2:2>k?1:this.getSelectIndex("y","right",1+a.right_extra),k1:3>k?0:this.getSelectIndex("z","left",0-a.extra),k2:3>k?1:this.getSelectIndex("z","right",1+a.right_extra),stepi:1,stepj:1,stepk:1,min:0,max:0,sumz:0,
xbar1:0,xbar2:1,ybar1:0,ybar2:1};this.isDisplayItem()&&c.fIndicies&&(e.i1<c.fIndicies[0]&&(e.i1=c.fIndicies[0],e.incomplete=!0),e.i2>c.fIndicies[1]&&(e.i2=c.fIndicies[1],e.incomplete=!0),e.stepi=c.fIndicies[2],1<e.stepi&&(e.incomplete=!0),1<k&&5<c.fIndicies.length&&(e.j1<c.fIndicies[3]&&(e.j1=c.fIndicies[3],e.incomplete=!0),e.j2>c.fIndicies[4]&&(e.j2=c.fIndicies[4],e.incomplete=!0),e.stepj=c.fIndicies[5],1<e.stepj&&(e.incomplete=!0)),2<k&&8<c.fIndicies.length&&(e.k1<c.fIndicies[6]&&(e.k1=c.fIndicies[6],
e.incomplete=!0),e.k2>c.fIndicies[7]&&(e.k2=c.fIndicies[7],e.incomplete=!0),e.stepk=c.fIndicies[8],1<e.stepk&&(e.incomplete=!0)));if(a.only_indexes)return e;e.grx=Array(e.i2+e.stepi+1);e.gry=Array(e.j2+e.stepj+1);a.original&&(e.original=!0,e.origx=Array(e.i2+1),e.origy=Array(e.j2+1));a.pixel_density&&(a.rounding=!0);var w=h.getGrFuncs(this.options.second_x,this.options.second_y);for(m=e.i1;m<=e.i2;++m){var p=b.GetBinCoord(m+a.middle);w.logx&&0>=p?e.i1=m+1:(e.origx&&(e.origx[m]=p),e.grx[m]=w.grx(p),
a.rounding&&(e.grx[m]=Math.round(e.grx[m])),a.use3d&&(e.grx[m]<-h.size_x3d&&(e.i1=m,e.grx[m]=-h.size_x3d),e.grx[m]>h.size_x3d&&(e.i2=m,e.grx[m]=h.size_x3d)))}a.use3d&&(e.i1<e.i2-2&&e.grx[e.i1]==e.grx[e.i1+1]&&e.i1++,e.i1<e.i2-2&&e.grx[e.i2-1]==e.grx[e.i2]&&e.i2--);for(;m<e.i2+e.stepi+1;)e.grx[m++]=e.grx[e.i2];if(1===k)e.gry[0]=w.gry(0),e.gry[1]=w.gry(1);else for(g=e.j1;g<=e.j2;++g)m=d.GetBinCoord(g+a.middle),w.logy&&0>=m?e.j1=g+1:(e.origy&&(e.origy[g]=m),e.gry[g]=w.gry(m),a.rounding&&(e.gry[g]=Math.round(e.gry[g])),
a.use3d&&(e.gry[g]<-h.size_y3d&&(e.j1=g,e.gry[g]=-h.size_y3d),e.gry[g]>h.size_y3d&&(e.j2=g,e.gry[g]=h.size_y3d)));a.use3d&&1<k&&(e.j1<e.j2-2&&e.gry[e.j1]==e.gry[e.j1+1]&&e.j1++,e.j1<e.j2-2&&e.gry[e.j2-1]==e.gry[e.j2]&&e.j2--);for(;1<k&&g<e.j2+e.stepj+1;)e.gry[g++]=e.gry[e.j2];this.maxbin=this.minbin=this.minposbin=null;for(m=e.i1;m<e.i2;m+=e.stepi)for(g=e.j1;g<e.j2;g+=e.stepj)if(d=c.getBinContent(m+1,g+1),Number.isFinite(d)){e.sumz+=d;if(a.pixel_density){k=(e.grx[m+e.stepi]-e.grx[m])*(e.gry[g]-e.gry[g+
e.stepj]);if(0>=k)continue;e.max=Math.max(e.max,d);0<d&&(d<e.min||0===e.min)&&(e.min=d);d/=k}null===this.maxbin?this.maxbin=this.minbin=d:(this.maxbin=Math.max(this.maxbin,d),this.minbin=Math.min(this.minbin,d));0<d&&(null===this.minposbin||d<this.minposbin)&&(this.minposbin=d)}e.palette=h.getHistPalette();e.palette&&this.createContour(h,e.palette,a);return e};y.prototype=Object.create(n.prototype);y.prototype.scanContent=function(a){var c=this.getHisto();if(c){!this.nbinsx&&a&&(a=!1);a||this.extractAxesProperties(1);
var b=0,d=0,h=0,k=0;if(this.isDisplayItem())b=c.fContMin,d=c.fContMinPos,k=h=c.fContMax;else{var m=this.getSelectIndex("x","left"),g=this.getSelectIndex("x","right");if(a&&m===this.scan_xleft&&g===this.scan_xright)return;this.scan_xleft=m;this.scan_xright=g;a=!0;for(var e,w=0;w<this.nbinsx;++w)e=c.getBinContent(w+1),k+=e,w<m||w>=g||(0<e&&(0==d||e<d)&&(d=e),a&&(b=h=e,a=!1),b=Math.min(b,e-0),h=Math.max(h,e+0))}this.stat_entries=k;this.hmin=b;this.hmax=h;this.ymin_nz=d;if(this.draw_content=0==this.nbinsx||
1E-300>Math.abs(b)&&1E-300>Math.abs(h)?!1:!0)b>=h?0==b?(this.ymin=0,this.ymax=1):0>b?(this.ymin=2*b,this.ymax=0):(this.ymin=0,this.ymax=2*b):(c=.05*(h-b),this.ymin=b-c,0>this.ymin&&0<=b&&(this.ymin=0),this.ymax=h+c)}};y.prototype.countStat=function(a){for(var c=this.isRProfile(),b=this.getHisto(),d=this.getAxis("x"),h=this.getSelectIndex("x","left"),k=this.getSelectIndex("x","right"),m=0,g=0,e=0,w=0,p=0,l,x,r=null,t=null,u=this.getFramePainter(),v={name:"histo",meanx:0,meany:0,rmsx:0,rmsy:0,integral:0,
entries:this.stat_entries,xmax:0,wmax:0};h<k;++h)if(l=d.GetBinCoord(h+.5),!a||a(l)){c?(x=b.fBinEntries[h+1],w+=b.fArray[h+1],p+=b.fSumw2[h+1]):x=b.getBinContent(h+1);if(null===r||x>t)r=l,t=x;m+=x;g+=x*l;e+=x*l*l}!u.isAxisZoomed("x")&&b.fTsumw&&(m=b.fTsumw,g=b.fTsumwx,e=b.fTsumwx2);v.integral=m;0<m&&(v.meanx=g/m,v.meany=w/m,v.rmsx=Math.sqrt(Math.abs(e/m-v.meanx*v.meanx)),v.rmsy=Math.sqrt(Math.abs(p/m-v.meany*v.meany)));null!==r&&(v.xmax=r,v.wmax=t);return v};y.prototype.fillStatistic=function(a,c){var b=
this.countStat(),d=c%10,h=Math.floor(c/10)%10,k=Math.floor(c/100)%10,m=Math.floor(c/1E3)%10,g=Math.floor(c/1E4)%10,e=Math.floor(c/1E5)%10,w=Math.floor(c/1E6)%10,p=Math.floor(c/1E7)%10;c=Math.floor(c/1E8)%10;a.clearStat();0<d&&a.addText(b.name);this.isRProfile()?(0<h&&a.addText("Entries = "+a.format(b.entries,"entries")),0<k&&(a.addText("Mean = "+a.format(b.meanx)),a.addText("Mean y = "+a.format(b.meany))),0<m&&(a.addText("Std Dev = "+a.format(b.rmsx)),a.addText("Std Dev y = "+a.format(b.rmsy)))):
(0<h&&a.addText("Entries = "+a.format(b.entries,"entries")),0<k&&a.addText("Mean = "+a.format(b.meanx)),0<m&&a.addText("Std Dev = "+a.format(b.rmsx)),0<g&&a.addText("Underflow = "+a.format(histo.getBinContent(0),"entries")),0<e&&a.addText("Overflow = "+a.format(histo.getBinContent(this.nbinsx+1),"entries")),0<w&&a.addText("Integral = "+a.format(b.integral,"entries")),0<p&&a.addText("Skew = <not avail>"),0<c&&a.addText("Kurt = <not avail>"));return!0};y.prototype.drawBars=function(a,c,b,d){this.createG(!0);
var h=a.i1;b=a.i2;a=a.stepi;var k=this.getFramePainter(),m=this.getHisto(),g=this.getAxis("x"),e="",w="",p="";d=k.swap_xy?0:d;for(Number.isFinite(this.options.BaseLine)&&this.options.BaseLine>=c.scale_ymin&&(d=Math.round(c.gry(this.options.BaseLine)));h<b;h+=a){var l=g.GetBinCoord(h);var x=g.GetBinCoord(h+a);if(!(c.logx&&0>=x)){l=Math.round(c.grx(l));x=Math.round(c.grx(x));var r=m.getBinContent(h+1);if(!(c.logy&&r<c.scale_ymin)){r=Math.round(c.gry(r));var t=x-l;l+=Math.round(this.options.BarOffset*
t);t=Math.round(this.options.BarWidth*t);e=k.swap_xy?e+("M"+d+","+l+"h"+(r-d)+"v"+t+"h"+(d-r)+"z"):e+("M"+l+","+r+"h"+t+"v"+(d-r)+"h"+-t+"z");0<this.options.BarStyle&&(x=l+t,t=Math.round(t/10),k.swap_xy?(w+="M"+d+","+l+"h"+(r-d)+"v"+t+"h"+(d-r)+"z",p+="M"+d+","+x+"h"+(r-d)+"v"+-t+"h"+(d-r)+"z"):(w+="M"+l+","+r+"h"+t+"v"+(d-r)+"h"+-t+"z",p+="M"+x+","+r+"h"+-t+"v"+(d-r)+"h"+t+"z"))}}}this.fillatt.empty()&&this.fillatt.setSolidColor("blue");0<e.length&&this.draw_g.append("svg:path").attr("d",e).call(this.fillatt.func);
0<w.length&&this.draw_g.append("svg:path").attr("d",w).call(this.fillatt.func).style("fill",f.rgb(this.fillatt.color).brighter(.5).toString());0<p.length&&this.draw_g.append("svg:path").attr("d",p).call(this.fillatt.func).style("fill",f.rgb(this.fillatt.color).darker(.5).toString())};y.prototype.drawFilledErrors=function(a,c){this.createG(!0);var b=a.i1,d=a.i2,h=a.stepi,k=this.getHisto(),m=this.getAxis("x"),g=[];for(a=[];b<d;b+=h){var e=m.GetBinCoord(b+.5);if(!(c.logx&&0>=e)){e=Math.round(c.grx(e));
var w=k.getBinContent(b+1);var p=k.getBinError(b+1);if(!(c.logy&&w-p<c.scale_ymin)){var l=Math.round(c.gry(w+p));w=Math.round(c.gry(w-p));g.push({grx:e,gry:l});a.unshift({grx:e,gry:w})}}}c=4===this.options.ErrorKind?"bezier":"line";d=q.buildSvgPath(c,g);a=q.buildSvgPath("L"+c,a);this.fillatt.empty()&&this.fillatt.setSolidColor("blue");this.draw_g.append("svg:path").attr("d",d.path+a.path+"Z").style("stroke","none").call(this.fillatt.func)};y.prototype.draw1DBins=function(){var a=this.getFramePainter(),
c=a.getFrameRect();if(!this.draw_content||0>=c.width||0>=c.height)return this.removeG();this.createHistDrawAttributes();var b=this.prepareDraw({extra:1,only_indexes:!0});a=a.getGrFuncs(this.options.second_x,this.options.second_y);return this.options.Bar?this.drawBars(b,a,c.width,c.height):3===this.options.ErrorKind||4===this.options.ErrorKind?this.drawFilledErrors(b,a,c.width,c.height):this.drawHistBins(b,a,c.width,c.height)};y.prototype.drawHistBins=function(a,c,b,d){var h=this;this.createG(!0);
var k=this.options,m=a.i1,g=a.i2,e=a.stepi,w=this.getHisto(),p=!JSROOT.batch_mode&&JSROOT.settings.Tooltip,l=this.getAxis("x");a="";var x=!1,r,t,u,v,f,J,n=!k.Zero,A=k.Error;x=k.Mark;var R=k.Line,y=k.Text,B=y&&"E"==this.options.TextKind&&this.isRProfile(),D=null,C=null,z=null,F=null,S=null,aa="",ba="",X=0,H,K,T,U,I,L,P,N;A&&!x&&1<this.v7EvalAttr("marker_style",1)&&(x=!0);2===k.ErrorKind?this.fillatt.empty()?x=!0:D="":k.Error&&(C="",S=p?"":null);R&&(F="");x&&(this.createv7AttMarker(),0<this.markeratt.size?
(z="",this.markeratt.resetPos()):x=!1);if(y){var M=this.v7EvalFont("text",{size:20,color:"black",align:22});M.angle||k.TextKind||(p=b/(g-m+1),p<3*M.size&&(M.setAngle(270),M.setSize(Math.round(.7*p))));this.startTextDrawing(M,"font")}b=g-m>3*b;1===k.ErrorKind&&(p=this.lineatt.width+JSROOT.gStyle.fEndErrorSize,aa="m0,"+p+"v-"+2*p+"m0,"+p,ba="m"+p+",0h-"+2*p+"m"+p+",0",X=Math.floor((this.lineatt.width-1)/2));var V=A||x;if(V||y||R)b=!0;var Y=function(a){U=w.getBinContent(a+1);if(!n||0!==U)if(L=Math.round(c.grx(l.GetBinCoord(a))),
P=Math.round(c.grx(l.GetBinCoord(a+e))),N=Math.round((L+P)/2),H=Math.round(c.gry(U)),K=T=20,A&&(I=w.getBinError(a+1),K=Math.round(H-c.gry(U+I)),T=Math.round(c.gry(U-I)-H)),y&&(a=B?w.fBinEntries[a+1]:U,0!==a&&(a=a===Math.round(a)?a.toString():q.floatToString(a,JSROOT.gStyle.fPaintTextFormat),M.angle?h.drawText({align:12,x:N,y:Math.round(H-2-M.size/5),width:0,height:0,text:a,latex:0}):h.drawText({x:Math.round(L+.1*(P-L)),y:Math.round(H-2-M.size),width:Math.round(.8*(P-L)),height:M.size,text:a,latex:0}))),
R&&null!==F&&(F+=(0===F.length?"M":"L")+N+","+H),V&&H>=-K&&H<=d+T&&(null!==D&&(D+="M"+L+","+(H-K)+"h"+(P-L)+"v"+(K+T+1)+"h-"+(P-L)+"z"),null!==z&&(z+=h.markeratt.create(N,H)),null!==C)){a=5;if(0<h.options.errorX){a=Math.round((P-L)*h.options.errorX);var b=N-a;C+="M"+(b+X)+","+H+aa+"h"+(N+a-b-2*X)+aa}C+="M"+N+","+(H-K+X)+ba+"v"+(K+T-2*X)+ba;null!==S&&(S+="M"+(N-a)+","+(H-K)+"h"+2*a+"v"+(K+T)+"h"+-2*a+"z")}};for(p=m;p<=g;p+=e)if(x=l.GetBinCoord(p),!(c.logx&&0>=x)){var O=Math.round(c.grx(x));if((x=p>
g-e)&&m<g)var G=u;else G=w.getBinContent(p+1),G=Math.round(c.gry(G));if(0===a.length){var Q=J=p;var Z=r=t=O;var W=v=f=u=G;a="M"+t+","+u}else if(b)if(O!==t||x){if(V||y||R)Q===J?Y(Q):Q<J?(Y(Q),Y(J)):(Y(J),Y(Q));V||v===f&&W===v||(Z!==t&&(a+="h"+(t-Z)),u===v?(f!==W&&(a+="v"+(f-W)),v!==f&&(a+="v"+(v-f))):(v!==W&&(a+="v"+(v-W)),f!==v&&(a+="v"+(f-v)),u!==f&&(a+="v"+(u-f))),Z=t,W=u);x&&Z!==O&&(a+="h"+(O-Z));Q=J=p;v=f=u=G;t=O}else G<v?J=p:G>f&&(Q=p),v=Math.min(v,G),f=Math.max(f,G),u=G;else if(G!==u||x)O!==
t&&(a+="h"+(O-t)),G!==u&&(a+="v"+(G-u)),u=G,t=O}g="";m=!JSROOT.batch_mode&&this.fillatt.empty()&&k.Hist&&JSROOT.settings.Tooltip&&!V&&!R;if(!this.fillatt.empty()||m)g=d+3,m&&(m=Math.round(c.gry(0)),0>=m?g=-3:m<d&&(g=m)),g="L"+t+","+g+"L"+r+","+g+"Z",0<a.length&&(a+=g);V||R?(null!==D&&0<D.length&&this.draw_g.append("svg:path").attr("d",D).call(this.fillatt.func),null!==C&&0<C.length&&this.draw_g.append("svg:path").attr("d",C).call(this.lineatt.func),null!==S&&0<S.length&&this.draw_g.append("svg:path").attr("d",
S).attr("stroke","none").attr("fill","none").attr("pointer-events","visibleFill"),null!==F&&0<F.length&&(this.fillatt.empty()||this.draw_g.append("svg:path").attr("d",k.Fill?F+g:a).attr("stroke","none").call(this.fillatt.func),this.draw_g.append("svg:path").attr("d",F).attr("fill","none").call(this.lineatt.func)),null!==z&&0<z.length&&this.draw_g.append("svg:path").attr("d",z).call(this.markeratt.func)):a&&k.Hist&&this.draw_g.append("svg:path").attr("d",a).style("stroke-linejoin","miter").call(this.lineatt.func).call(this.fillatt.func);
y&&this.finishTextDrawing()};y.prototype.getBinTooltips=function(a){var c=[],b=this.getObjectHint(),d=this.getFramePainter(),h=this.getHisto(),k=this.getAxis("x"),m=this.isDisplayItem()?h.stepx:1,g=k.GetBinCoord(a),e=k.GetBinCoord(a+m);k=h.getBinContent(a+1);var w=this.getAxisBinTip("x",a,m);0<b.length&&c.push(b);this.options.Error||this.options.Mark?(c.push("x = "+w),c.push("y = "+d.axisAsText("y",k)),this.options.Error&&("["==w[0]&&c.push("error x = "+((e-g)/2).toPrecision(4)),c.push("error y = "+
h.getBinError(a+1).toPrecision(4)))):(c.push("bin = "+a),c.push("x = "+w),h.$baseh&&(k-=h.$baseh.getBinContent(a+1)),a="entries = "+(1<m?"~":""),k===Math.round(k)?c.push(a+k):c.push(a+q.floatToString(k,JSROOT.gStyle.fStatFormat)));return c};y.prototype.processTooltipEvent=function(a){function c(a){a=e.GetBinCoord(a);return h.logx&&0>=a?null:h.grx(a)}function b(a){a=g.getBinContent(a+1);return h.logy&&a<h.scale_ymin?h.swap_xy?-1E3:10*m:Math.round(h.gry(a))}if(!a||!this.draw_content||this.options.Mode3D||
!this.draw_g)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;var d=this.getFramePainter(),h=d.getGrFuncs(this.options.second_x,this.options.second_y),k=d.getFrameWidth(),m=d.getFrameHeight(),g=this.getHisto(),e=this.getAxis("x"),w=null,p,l,x=2,r=this.getSelectIndex("x","left",-1),t=this.getSelectIndex("x","right",2);var u=r;var v=t;for(var f=h.swap_xy?a.y:a.x,n=h.swap_xy?a.x:a.y;u<v-1;){w=Math.round(.5*(u+v));var E=c(w);null===E||E<f-.5?h.swap_xy?v=w:u=w:E>f+.5?h.swap_xy?u=w:
v=w:(u++,v--)}w=v=u;E=c(w);if(h.swap_xy){for(;u>r&&c(u-1)<E+2;)--u;for(;v<t&&c(v+1)>E-2;)++v}else{for(;u>r&&c(u-1)>E-2;)--u;for(;v<t&&c(v+1)<E+2;)++v}if(u<v){E=m;for(p=u;p<=v;p++){var A=Math.abs(b(p)-n);A<E&&(E=A,w=p)}E>m/10&&(w=Math.round(u+(v-u)/m*n));E=c(w)}E=Math.round(E);p=Math.round(c(w+1));this.options.Bar&&(u=p-E,E+=Math.round(this.options.BarOffset*u),p=E+Math.round(this.options.BarWidth*u));E>p&&(u=E,E=p,p=u);u=Math.round((E+p)/2);v=A=l=b(w);if(this.options.Bar){k=!0;x=0;A=Math.round(h.gry(!1!==
this.options.BaseLine&&this.options.BaseLine>h.scale_ymin?this.options.BaseLine:h.scale_ymin));if(A>l){var q=A;A=l;l=q}!a.touch&&1===a.nproc&&(n<A||n>l)&&(w=null)}else if(this.options.Error||this.options.Mark){k=!0;q=3;this.markeratt&&(q=Math.max(q,this.markeratt.getFullSize()));if(this.options.Error){var y=g.getBinContent(w+1);l=g.getBinError(w+1);A=Math.round(h.gry(y+l));l=Math.round(h.gry(y-l));0==y&&this.isRProfile()&&(w=null);p=(p-E)*this.options.errorX;E=Math.round(u-p);p=Math.round(u+p)}p-
E<2*q&&(E=u-q,p=u+q);A=Math.min(A,v-q);l=Math.max(l,v+q);!a.touch&&1===a.nproc&&(n<A||n>l)&&(w=null)}else if(this.options.Line)k=!1;else if(k=1===a.nproc&&t-r<k)l=m,this.fillatt.empty()||(l=Math.round(h.gry(0)),0>l?l=0:l>m&&(l=m),l<A&&(q=A,A=l,l=q)),(a.y<A||a.y>l)&&!a.touch&&(w=null);null!==w&&(w===r&&E>f+x?w=null:w===t-1&&p<f-x?w=null:f<E-x||f>p+x?w=null:this.options.Zero||0!==g.getBinContent(w+1)||(w=null));x=this.draw_g.select(".tooltip_bin");if(null===w||0>=l||A>=m)return x.remove(),null;r={name:"histo",
title:g.fTitle,x:u,y:v,exact:!0,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getBinTooltips(w)};a.disabled?(x.remove(),r.changed=!0):k?(x.empty()&&(x=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")),r.changed=x.property("current_bin")!==w,r.changed&&x.attr("x",d.swap_xy?A:E).attr("width",d.swap_xy?l-A:p-E).attr("y",d.swap_xy?E:A).attr("height",d.swap_xy?p-E:l-A).style("opacity",
"0.3").property("current_bin",w),r.exact=5>=Math.abs(v-n)||n>=A&&n<=l,r.menu=!0,r.menu_dist=Math.sqrt((u-f)*(u-f)+(v-n)*(v-n))):(d=this.lineatt.width+3,x.empty()&&(x=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",d).call(this.lineatt.func).call(this.fillatt.func)),r.exact=Math.abs(u-a.x)<=d&&Math.abs(v-a.y)<=d,r.menu=r.exact,r.menu_dist=Math.sqrt((u-a.x)*(u-a.x)+(v-a.y)*(v-a.y)),r.changed=x.property("current_bin")!==w,r.changed&&x.attr("cx",u).attr("cy",
v).property("current_bin",w));r.changed&&(r.user_info={obj:g,name:"histo",bin:w,cont:g.getBinContent(w+1),grx:u,gry:v});return r};y.prototype.fillHistContextMenu=function(a){var c=this;a.add("Auto zoom-in",function(){return c.autoZoom()});var b=q.getDrawSettings("ROOT."+this.getObject()._typename,"nosame");a.addDrawMenu("Draw with",b.opts,function(a){if("inspect"===a)return c.showInspector();c.decodeOptions(a);c.options.need_fillcol&&c.fillatt&&c.fillatt.empty()&&c.fillatt.change(5,1001);c.interactiveRedraw("pad",
"drawopt")})};y.prototype.autoZoom=function(){var a=this.getSelectIndex("x","left",-1),c=this.getSelectIndex("x","right",1),b=c-a,d=this.getHisto(),h=this.getAxis("x");if(0!=b){for(var k=d.getBinContent(a+1),m=a;m<c;++m)k=Math.min(k,d.getBinContent(m+1));if(!(0<k)){for(;a<c&&d.getBinContent(a+1)<=k;)++a;for(;a<c&&d.getBinContent(c)<=k;)--c;a===c-1&&2<a&&c<this.nbinsx-2&&(--a,++c);c-a<b&&a<c&&this.getFramePainter().zoom(h.GetBinCoord(a),h.GetBinCoord(c))}}};y.prototype.canZoomInside=function(a,c,b){var d=
this.getAxis("x");return"x"==a&&1<d.FindBin(b,.5)-d.FindBin(c,0)||"y"==a&&Math.abs(b-c)>1E-6*Math.abs(this.ymax-this.ymin)?!0:!1};y.prototype.callDrawFunc=function(a){var c=this.getFramePainter();c&&c.mode3d!==this.options.Mode3D&&!this.isMainPainter()&&(this.options.Mode3D=c.mode3d);return this[this.options.Mode3D?"draw3D":"draw2D"](a)};y.prototype.draw2D=function(a){var c=this;this.clear3DScene();return this.drawFrameAxes().then(function(b){return b?c.drawingBins(a):!1}).then(function(a){if(!a)return!1;
c.draw1DBins();return c.addInteractivity()}).then(function(a){return a?c:null})};y.prototype.draw3D=function(a){var c=this;this.mode3d=!0;return JSROOT.require("v7hist3d").then(function(){return c.draw3D(a)})};y.prototype.redraw=function(a){this.callDrawFunc(a)};var ca=function(a,c,b){var d=new y(a,c);return q.ensureRCanvas(d).then(function(){d.setAsMainPainter();d.options={Hist:!1,Bar:!1,BarStyle:0,Error:!1,ErrorKind:-1,errorX:JSROOT.gStyle.fErrorX,Zero:!1,Mark:!1,Line:!1,Fill:!1,Lego:0,Surf:0,Text:!1,
TextAngle:0,TextKind:"",AutoColor:0,BarOffset:0,BarWidth:1,BaseLine:!1,Mode3D:!1};var a=new JSROOT.DrawOptions(b);a.check("R3D_",!0)&&(d.options.Render3D=JSROOT.constants.Render3D.fromString(a.part.toLowerCase()));a=d.v7EvalAttr("kind","hist");var c=d.v7EvalAttr("sub",0),m=!!d.getMainPainter(),g=d.options;g.Text=d.v7EvalAttr("drawtext",!1);g.BarOffset=d.v7EvalAttr("baroffset",0);g.BarWidth=d.v7EvalAttr("barwidth",1);g.second_x=m&&d.v7EvalAttr("secondx",!1);g.second_y=m&&d.v7EvalAttr("secondy",!1);
switch(a){case "bar":g.Bar=!0;g.BarStyle=c;break;case "err":g.Error=!0;g.ErrorKind=c;break;case "p":g.Mark=!0;break;case "l":g.Line=!0;break;case "lego":g.Lego=0<c?10+c:12;g.Mode3D=!0;break;default:g.Hist=!0}d.scanContent();return d.callDrawFunc()})};B.prototype=Object.create(n.prototype);B.prototype.cleanup=function(){delete this.tt_handle;n.prototype.cleanup.call(this)};B.prototype.getDimension=function(){return 2};B.prototype.toggleProjection=function(a,c){var b=this;"Projections"==a&&(a="");"string"==
typeof a&&1<a.length&&(c=parseInt(a.substr(1)),a=a[0]);c||(c=1);if(a&&this.is_projection==a)if(this.projection_width===c)a="";else{this.projection_width=c;return}delete this.proj_hist;var d=this.is_projection===a?"":a;this.is_projection="";this.projection_width=c;this.provideSpecialDrawArea(d).then(function(){b.is_projection=d;return b.redrawProjection()})};B.prototype.redrawProjection=function(){};B.prototype.executeMenuCommand=function(a,c){return n.prototype.executeMenuCommand.call(this,a,c)?!0:
"SetShowProjectionX"==a.fName||"SetShowProjectionY"==a.fName?(this.toggleProjection(a.fName[17],c&&parseInt(c)?parseInt(c):1),!0):!1};B.prototype.fillHistContextMenu=function(a){var c=this;a.add("sub:Projections",function(){return c.toggleProjection()});var b=this.is_projection||"";b&&(b+=this.projection_width);for(var d="X1 X2 X3 X5 X10 Y1 Y2 Y3 Y5 Y10".split(" "),h=0;h<d.length;++h)a.addchk(b==d[h],d[h],d[h],function(a){return c.toggleProjection(a)});a.add("endsub:");a.add("Auto zoom-in",function(){return c.autoZoom()});
b=q.getDrawSettings("ROOT."+this.getObject()._typename,"nosame");a.addDrawMenu("Draw with",b.opts,function(a){if("inspect"===a)return c.showInspector();c.decodeOptions(a);c.interactiveRedraw("pad","drawopt")});this.options.Color&&this.fillPaletteMenu(a)};B.prototype.clickButton=function(a){if(n.prototype.clickButton.call(this,a))return!0;switch(a){case "ToggleColor":this.toggleColor();break;case "ToggleColorZ":this.toggleColz();break;case "Toggle3D":this.toggleMode3D();break;default:return!1}return!0};
B.prototype.fillToolbar=function(){n.prototype.fillToolbar.call(this,!0);var a=this.getPadPainter();a&&(this.isRH2Poly()||a.addPadButton("th2color","Toggle color","ToggleColor"),a.addPadButton("th2colorz","Toggle color palette","ToggleColorZ"),a.addPadButton("th2draw3d","Toggle 3D mode","Toggle3D"),a.showPadButtons())};B.prototype.toggleColor=function(){this.options.Mode3D?(this.options.Mode3D=!1,this.options.Color=!0):this.options.Color=!this.options.Color;this.redraw()};B.prototype.autoZoom=function(){if(!this.isRH2Poly()){var a=
this.getSelectIndex("x","left",-1),c=this.getSelectIndex("x","right",1),b=this.getSelectIndex("y","left",-1),d=this.getSelectIndex("y","right",1),h,k,m=this.getHisto(),g=this.getAxis("x"),e=this.getAxis("y");if(a!=c&&b!=d){var w=m.getBinContent(a+1,b+1);for(h=a;h<c;++h)for(k=b;k<d;++k)w=Math.min(w,m.getBinContent(h+1,k+1));if(!(0<w)){var p=c,l=a,x=d,r=b;for(h=a;h<c;++h)for(k=b;k<d;++k)m.getBinContent(h+1,k+1)>w&&(h<p&&(p=h),h>=l&&(l=h+1),k<x&&(x=k),k>=r&&(r=k+1));h=!1;p===l-1&&p>a+1&&l<c-1&&(p--,
l++);x===r-1&&x>b+1&&r<d-1&&(x--,r++);if((p>a||l<c)&&p<l-1){var t=g.GetBinCoord(p);var f=g.GetBinCoord(l);h=!0}if((x>b||r<d)&&x<r-1){var v=e.GetBinCoord(x);var n=e.GetBinCoord(r);h=!0}h&&this.getFramePainter().zoom(t,f,v,n)}}}};B.prototype.scanContent=function(a){if(!(a&&this.nbinsx&&this.nbinsy)){var c;a=this.getHisto();this.extractAxesProperties(2);if(this.isRH2Poly()){this.gminposbin=null;var b=this.gminbin=this.gmaxbin=0;for(c=a.fBins.arr.length;b<c;++b){var d=a.fBins.arr[b].fContent;0===b&&(this.gminbin=
this.gmaxbin=d);d<this.gminbin?this.gminbin=d:d>this.gmaxbin&&(this.gmaxbin=d);0<d&&(null===this.gminposbin||this.gminposbin>d)&&(this.gminposbin=d)}}else if(this.isDisplayItem())this.gminbin=a.fContMin,this.gminposbin=0<a.fContMinPos?a.fContMinPos:null,this.gmaxbin=a.fContMax;else for(this.gminbin=this.gmaxbin=a.getBinContent(1,1),this.gminposbin=null,b=0;b<this.nbinsx;++b)for(c=0;c<this.nbinsy;++c)d=a.getBinContent(b+1,c+1),d<this.gminbin?this.gminbin=d:d>this.gmaxbin&&(this.gmaxbin=d),0<d&&(null===
this.gminposbin||this.gminposbin>d)&&(this.gminposbin=d);this.zmin=this.gminbin;this.zmax=this.gmaxbin;null===this.gminposbin&&(this.gminposbin=1E-4*this.gmaxbin);0<this.options.Axis?this.draw_content=!1:(this.draw_content=0<this.gmaxbin,!this.draw_content&&this.options.Zero&&this.isRH2Poly()&&(this.draw_content=!0,this.options.Line=1))}};B.prototype.countStat=function(a){var c=this.getHisto(),b=0,d=0,h=0,k=0,m=0,g={name:"histo",entries:0,integral:0,meanx:0,meany:0,rmsx:0,rmsy:0,matrix:[0,0,0,0,0,
0,0,0,0],xmax:0,ymax:0,wmax:null},e=this.getSelectIndex("x","left"),w=this.getSelectIndex("x","right"),p=this.getSelectIndex("y","left"),l=this.getSelectIndex("y","right"),x,r,t=this.getAxis("x"),f=this.getAxis("y");for(x=1;x<=this.nbinsx;++x){var v=x<=e+1?0:x>w+1?2:1;var n=t.GetBinCoord(x-.5);for(r=1;r<=this.nbinsy;++r){var J=r<=p+1?0:r>l+1?2:1;var q=f.GetBinCoord(r-.5);var A=c.getBinContent(x,r);g.entries+=A;g.matrix[3*J+v]+=A;if(1==v&&1==J&&(null==a||a(n,q))){if(null==g.wmax||A>g.wmax)g.wmax=A,
g.xmax=n,g.ymax=q;b+=A;d+=n*A;h+=q*A;k+=n*n*A;m+=q*q*A}}}0<b&&(g.meanx=d/b,g.meany=h/b,g.rmsx=Math.sqrt(Math.abs(k/b-g.meanx*g.meanx)),g.rmsy=Math.sqrt(Math.abs(m/b-g.meany*g.meany)));null===g.wmax&&(g.wmax=0);g.integral=b;return g};B.prototype.fillStatistic=function(a,c){var b=this.countStat(),d=Math.floor(c%10),h=Math.floor(c/10)%10,k=Math.floor(c/100)%10,m=Math.floor(c/1E3)%10,g=Math.floor(c/1E4)%10,e=Math.floor(c/1E5)%10,w=Math.floor(c/1E6)%10,p=Math.floor(c/1E7)%10;c=Math.floor(c/1E8)%10;a.clearStat();
0<d&&a.addText(b.name);0<h&&a.addText("Entries = "+a.format(b.entries,"entries"));0<k&&(a.addText("Mean x = "+a.format(b.meanx)),a.addText("Mean y = "+a.format(b.meany)));0<m&&(a.addText("Std Dev x = "+a.format(b.rmsx)),a.addText("Std Dev y = "+a.format(b.rmsy)));0<w&&a.addText("Integral = "+a.format(b.matrix[4],"entries"));0<p&&(a.addText("Skewness x = <undef>"),a.addText("Skewness y = <undef>"));0<c&&a.addText("Kurt = <undef>");if(0<g||0<e)b=b.matrix,a.addText(""+b[6].toFixed(0)+" | "+b[7].toFixed(0)+
" | "+b[7].toFixed(0)),a.addText(""+b[3].toFixed(0)+" | "+b[4].toFixed(0)+" | "+b[5].toFixed(0)),a.addText(""+b[0].toFixed(0)+" | "+b[1].toFixed(0)+" | "+b[2].toFixed(0));return!0};B.prototype.drawBinsColor=function(){var a=this,c=this.getHisto(),b=this.prepareDraw(),d=b.stepi,h=b.stepj,k=[],m,g,e=function(){t.path+="h"+w+"v"+(t.y2-t.y)+"h"+-w+"z";t.dy=0;t=null};for(m=b.i1;m<b.i2;m+=d){var w=b.grx[m+d]-b.grx[m]||1;for(g=b.j1;g<b.j2;g+=h){var p=c.getBinContent(m+1,g+1);var l=b.palette.getContourIndex(p);
0===p&&(this.options.Zero?null===l&&this._show_empty_bins&&(l=0):l=null);if(null===l)t&&e();else{p="M"+b.grx[m]+","+b.gry[g];var x=b.gry[g+h]-b.gry[g]||-1;var f=k[l];if(void 0===f)f=k[l]={path:p};else if(f===t){f.y2=b.gry[g]+x;continue}else l="m"+(b.grx[m]-f.x)+","+(b.gry[g]-f.y),f.path+=l.length<p.length?l:p;t&&e();f.x=b.grx[m];f.y=b.gry[g];f.y2=b.gry[g]+x;var t=f}}t&&e()}k.forEach(function(c,d){c&&a.draw_g.append("svg:path").attr("fill",b.palette.getColor(d)).attr("d",c.path)});this.updatePaletteDraw();
return b};B.prototype.buildContour=function(a,c,b,d){function h(a){for(var b=0;b<c.length;++b)if(a<c[b])return b-1;return c.length-1}function k(a,b,d,h,m,l,k,f){var t=d===k;k=t?f-h:k-d;b+=1;m-=a;f=p-1;for(var x=999+p,u=0,r;b<=l&&f<=x;)r=c[b],r-=a,r/=m,r*=k,t?(g[f]=d,e[f]=h+r):(g[f]=d+r,e[f]=h),w[f]=b,u++,f+=2,b++;return u}var m=this.getHisto(),g=new Float32Array(4008),e=new Float32Array(4008),w=new Int32Array(4008),p=0;b=[];var l=0,f=[0,0,0,0],r=[0,0,0,0],t=[0,0,0,0],u=[0,0,0,0],v,n,q,E,A=a.stepi,
y=a.stepj,z=a.original?a.origx:a.grx,B=a.original?a.origy:a.gry;for(n=a.j1;n<a.j2-y;n+=y)for(r[1]=r[0]=(B[n]+B[n+y])/2,r[3]=r[2]=(B[n+y]+B[n+2*y])/2,v=a.i1;v<a.i2-A;v+=A){t[0]=m.getBinContent(v+1,n+1);t[1]=m.getBinContent(v+1+A,n+1);t[2]=m.getBinContent(v+1+A,n+1+y);t[3]=m.getBinContent(v+1,n+1+y);for(q=0;4>q;q++)u[q]=h(t[q]);if(u[0]!==u[1]||u[1]!==u[2]||u[2]!==u[3]||u[3]!==u[0]){f[3]=f[0]=(z[v]+z[v+1])/2;f[2]=f[1]=(z[v+1]+z[v+2])/2;var D=t[0]<=t[1]?0:1;var C=t[2]<=t[3]?2:3;t[D]>t[C]&&(D=C);D++;for(q=
p=1;4>=q;q++)C=D%4+1,D=k(t[D-1],u[D-1],f[D-1],r[D-1],t[C-1],u[C-1],f[C-1],r[C-1]),p+=2*D,D=C;D=t[0]<=t[1]?0:1;C=t[2]<=t[3]?2:3;t[D]>t[C]&&(D=C);D++;p=2;for(q=1;4>=q;q++)C=1==D?4:D-1,D=k(t[D-1],u[D-1],f[D-1],r[D-1],t[C-1],u[C-1],f[C-1],r[C-1]),p+=2*D,D=C;C=0;for(q=1;q<=p-5;q+=2)for(;w[q-1]!=w[q];){D=g[q];var F=e[q];var I=w[q];for(E=q;E<=p-5;E+=2)g[E]=g[E+2],e[E]=e[E+2],w[E]=w[E+2];g[p-3]=D;e[p-3]=F;w[p-3]=I;if(2E3<C)break;C++}if(!(2E3<C))for(q=1;q<=p-2;q+=2)C=w[q-1],0<=C&&C<c.length&&((D=b[C])||(D=
b[C]=JSROOT.createTPolyLine(8016,!0)),C=D.fLastPoint,C<D.fN-2&&(D.fX[C+1]=Math.round(g[q-1]),D.fY[C+1]=Math.round(e[q-1]),D.fX[C+2]=Math.round(g[q]),D.fY[C+2]=Math.round(e[q]),D.fLastPoint=C+2,l=Math.max(l,D.fLastPoint+1)))}}a=new Int32Array(c.length);for(C=v=0;C<c.length;C++)if(0<=c[C]){v=C;break}q=0;for(C=v-1;0<=C;C--)a[q]=C,q++;for(C=v;C<c.length;C++)a[q]=C,q++;m=new Float32Array(2*l);f=new Float32Array(2*l);for(q=0;q<c.length;++q)if(C=a[q],D=b[C])for(r=C,t=D.fX,u=D.fY,n=D.fLastPoint+1,A=0,B=z=
y=void 0;;){y=l;z=y+1;m[y]=t[A];f[y]=u[A];m[z]=t[A+1];f[z]=u[A+1];t[A]=t[A+1]=0;for(u[A]=u[A+1]=0;;){B=0;for(v=2;v<n;v+=2)z<2*l-1&&t[v]===m[z]&&u[v]===f[z]&&(z++,m[z]=t[v+1],f[z]=u[v+1],t[v]=t[v+1]=0,u[v]=u[v+1]=0,B++),0<y&&t[v+1]===m[y]&&u[v+1]===f[y]&&(y--,m[y]=t[v],f[y]=u[v],t[v]=t[v+1]=0,u[v]=u[v+1]=0,B++);if(0==B)break}y+1<z&&0<=y&&d(r,m,f,y,z,C);A=0;for(v=2;v<n;v+=2)if(0!==t[v]&&0!==u[v]){A=v;break}if(0===A)break}};B.prototype.drawBinsContour=function(a,c,b){var d=this,h=this.prepareDraw({rounding:!1,
extra:100,original:0!=this.options.Proj}),k=this.getFramePainter(),m=k.getHistPalette(),g=m.getContour(),e=k.getProjectionFunc(),f=function(b,c,d,h,g){for(var m="",k,l,p,f=d;f<=h;++f){e?(d=e(b[f],c[f]),d.x=Math.round(a.grx(d.x)),d.y=Math.round(a.gry(d.y))):d={x:Math.round(b[f]),y:Math.round(c[f])};if(m)if(f==h&&l&&d.x==l.x&&d.y==l.y){if(!p)return"";m+="z";g=!1}else d.x!=k.x&&d.y!=k.y?(m+="l"+(d.x-k.x)+","+(d.y-k.y),p=!0):d.x!=k.x?(m+="h"+(d.x-k.x),p=!0):d.y!=k.y&&(m+="v"+(d.y-k.y),p=!0);else m="M"+
d.x+","+d.y,l=d;k=d}g&&(m+="z");return m};if(14===this.options.Contour){c="M0,0h"+c+"v"+b+"h-"+c+"z";if(this.options.Proj){c=h.stepj;b=parseInt((h.j2-h.j1)/c);k=new Float32Array(2*b);for(var p=new Float32Array(2*b),l=0;l<b;++l)k[l]=h.origx[h.i1],p[l]=(h.origy[h.j1]*(l*c+.5)+h.origy[h.j2]*(b-.5-l*c))/b,k[l+b]=h.origx[h.i2],p[l+b]=(h.origy[h.j2]*(l*c+.5)+h.origy[h.j1]*(b-.5-l*c))/b;c=f(k,p,0,2*b-1,!0)}this.draw_g.append("svg:path").attr("d",c).style("stroke","none").style("fill",m.getColor(0))}this.buildContour(h,
g,m,function(a,b,c,e,h){var g=m.getColor(a),k=g;switch(d.options.Contour){case 11:k="none";var l=new JSROOT.TAttLineHandler({color:g});break;case 12:k="none";l=new JSROOT.TAttLineHandler({color:1,style:a%5+1,width:1});break;case 13:k="none",l=d.lineatt}if(a=f(b,c,e,h,"none"!=k))k=d.draw_g.append("svg:path").attr("class","th2_contour").attr("d",a).style("fill",k),l?k.call(l.func):k.style("stroke","none")});h.hide_only_zeros=!0;return h};B.prototype.createPolyBin=function(a,c,b){function d(a,b,d,e){var h=
Math.sqrt((a-d)*(a-d)+(b-e)*(b-e));c._sumx+=(a+d)*h/2;c._sumy+=(b+e)*h/2;c._suml+=h}var h="",k=1,m=null,g=a.getGrFuncs(this.options.second_x,this.options.second_y);"TMultiGraph"==c.fPoly._typename?k=c.fPoly.fGraphs.arr.length:m=c.fPoly;b&&(c._sumx=c._sumy=c._suml=0);for(a=0;a<k;++a){if(!m||0<a)m=c.fPoly.fGraphs.arr[a];var e=m.fNpoints,f=void 0,p=m.fX,l=m.fY,x=Math.round(g.grx(p[0])),r=Math.round(g.gry(l[0])),t=void 0,u=void 0;2<e&&p[0]==p[e-1]&&l[0]==l[e-1]&&e--;h+="M"+x+","+r;for(f=1;f<e;++f){t=
Math.round(g.grx(p[f]));u=Math.round(g.gry(l[f]));b&&d(x,r,t,u);if(x!==t||r!==u)h=x===t?h+("v"+(u-r)):r===u?h+("h"+(t-x)):h+("l"+(t-x)+","+(u-r));x=t;r=u}b&&d(x,r,Math.round(g.grx(p[0])),Math.round(g.gry(l[0])));h+="z"}b&&(0<c._suml?(c._midx=Math.round(c._sumx/c._suml),c._midy=Math.round(c._sumy/c._suml)):(c._midx=Math.round(g.grx((c.fXmin+c.fXmax)/2)),c._midy=Math.round(g.gry((c.fYmin+c.fYmax)/2))));return h};B.prototype.drawPolyBinsColor=function(){var a=this.getHisto(),c=this.getFramePainter(),
b=[],d=[],h,k=a.fBins.arr.length,m=c.getHistPalette();this.maxbin=this.gmaxbin;this.minbin=this.gminbin;this.minposbin=this.gminposbin;this.createContour(c,m);for(h=0;h<k;++h){var g=a.fBins.arr[h];var e=m.getContourIndex(g.fContent);if(null!==e){if(0===g.fContent){if(!this.options.Zero||!this.options.Line)continue;e=0}if(!(g.fXmin>c.scale_xmax||g.fXmax<c.scale_xmin||g.fYmin>c.scale_ymax||g.fYmax<c.scale_ymin)){var f=this.createPolyBin(c,g,this.options.Text&&g.fContent);b[e]=void 0===b[e]?f:b[e]+f;
this.options.Text&&d.push(g)}}}for(e=0;e<b.length;++e)b[e]&&(g=this.draw_g.append("svg:path").attr("fill",e?m.getColor(e):"none").attr("d",b[e]),this.options.Line&&g.call(this.lineatt.func));if(0<d.length){g=this.v7EvalFont("text",{size:12,color:"black",align:22});b=this.draw_g.append("svg:g").attr("class","th2poly_text");this.startTextDrawing(g,"font",b);for(h=0;h<d.length;++h)g=d[h],e="",this.options.TextKind?(g.fPoly&&(e=g.fPoly.fName),"Graph"===e&&(e=""),e||(e=g.fNumber)):e=Math.round(g.fContent)===
g.fContent?g.fContent.toString():q.floatToString(g.fContent,JSROOT.gStyle.fPaintTextFormat),this.drawText({x:g._midx,y:g._midy,text:e,latex:0,draw_g:b});this.finishTextDrawing(b)}return{poly:!0}};B.prototype.drawBinsText=function(a){var c=this.getHisto(),b,d;null===a&&(a=this.prepareDraw({rounding:!1}));var h=this.v7EvalFont("text",{size:20,color:"black",align:22}),k=0,m=this.draw_g.append("svg:g").attr("class","th2_text"),g=a.stepi,e=a.stepj,f="E"==this.options.TextKind&&this.matchObjectType("TProfile2D")&&
"function"==typeof c.getBinEntries;this.options.BarOffset&&(k=this.options.BarOffset);this.startTextDrawing(h,"font",m);for(b=a.i1;b<a.i2;b+=g)for(d=a.j1;d<a.j2;d+=e){var p=c.getBinContent(b+1,d+1);if(0!==p||this._show_empty_bins){var l=a.grx[b+g]-a.grx[b];var x=a.gry[d]-a.gry[d+e];f&&(p=c.getBinEntries(b+1,d+1));p=p===Math.round(p)?p.toString():q.floatToString(p,JSROOT.gStyle.fPaintTextFormat);if(h.angle){var r=Math.round(a.grx[b]+.5*l);var t=Math.round(a.gry[d+e]+x*(.5+k));x=l=0}else r=Math.round(a.grx[b]+
.1*l),t=Math.round(a.gry[d+e]+x*(.1+k)),l=Math.round(.8*l),x=Math.round(.8*x);this.drawText({align:22,x:r,y:t,width:l,height:x,text:p,latex:0,draw_g:m})}}this.finishTextDrawing(m);a.hide_only_zeros=!0;return a};B.prototype.drawBinsArrow=function(){for(var a=this.getHisto(),c="",b,d,h=1E-30,k,m,g,e,f,p,l=this.prepareDraw({rounding:!1}),x=(l.grx[l.i2]-l.grx[l.i1])/(l.i2-l.i1+1-.03)/2,r=(l.gry[l.j2]-l.gry[l.j1])/(l.j2-l.j1+1-.03)/2,t=l.stepi,u=l.stepj,v=function(a,b){return a?b?"l"+a+","+b:"h"+a:b?"v"+
b:""},n=0;2>n;++n)for(b=l.i1;b<l.i2;b+=t)for(d=l.j1;d<l.j2;d+=u)if(k=b===l.i1?a.getBinContent(b+1+t,d+1)-a.getBinContent(b+1,d+1):b>=l.i2-t?a.getBinContent(b+1,d+1)-a.getBinContent(b+1-t,d+1):.5*(a.getBinContent(b+1+t,d+1)-a.getBinContent(b+1-t,d+1)),m=d===l.j1?a.getBinContent(b+1,d+1+u)-a.getBinContent(b+1,d+1):d>=l.j2-u?a.getBinContent(b+1,d+1)-a.getBinContent(b+1,d+1-u):.5*(a.getBinContent(b+1,d+1+u)-a.getBinContent(b+1,d+1-u)),0===n)h=Math.max(h,Math.abs(k),Math.abs(m));else if(g=(l.grx[b]+l.grx[b+
t])/2,e=(l.gry[d]+l.gry[d+u])/2,f=x*k/h,k=r*m/h,p=g-f,m=g+f,g=e-k,e+=k,k=Math.round(m-p),m=Math.round(e-g),0!==k||0!==m)if(c+="M"+Math.round(p)+","+Math.round(g)+v(k,m),5<Math.abs(k)||5<Math.abs(m))if(e=Math.sqrt(2/(k*k+m*m)),p=Math.round(e*(k+m)),k=Math.round(e*(k-m)),p||k)c+="m"+-p+","+k+v(p,-k)+v(-k,-p);this.draw_g.append("svg:path").attr("d",c).style("fill","none").call(this.lineatt.func);return l};B.prototype.drawBinsBox=function(){var a=this.getHisto(),c=this.prepareDraw({rounding:!1}),b=this.getFramePainter();
b.maxbin===b.minbin&&(b.maxbin=this.gmaxbin,b.minbin=this.gminbin,b.minposbin=this.gminposbin);b.maxbin===b.minbin&&(b.minbin=Math.min(0,b.maxbin-1));var d=Math.max(Math.abs(b.maxbin),Math.abs(b.minbin)),h=Math.max(0,b.minbin),k="",m="",g="",e="",w=!1,p=0,l=c.stepi,x=c.stepj;if(b.logz&&0<d){w=!0;d=Math.log(d);p=0<h?Math.log(h):1<=b.minposbin&&100>b.minposbin?Math.log(.7):0<b.minposbin?Math.log(.7*b.minposbin):d-10;p>=d&&(p=d-10);var r=1/(d-p)}else r=1/(d-h);for(b=c.i1;b<c.i2;b+=l)for(d=c.j1;d<c.j2;d+=
x){var t=a.getBinContent(b+1,d+1);var u=Math.abs(t);if(!(0===u||u<h)){var n=w?0<u?Math.log(u)-p:0:u-h;n=.5*(0>n?1:1-Math.sqrt(n*r));0>n&&(n=0);u=c.grx[b+l]-c.grx[b];var q=c.gry[d]-c.gry[d+x];var y=n*u;var z=n*q;n=Math.round(c.grx[b]+y);var A=Math.round(c.gry[d+x]+z);u=Math.max(Math.round(u-2*y),1);q=Math.max(Math.round(q-2*z),1);k+="M"+n+","+A+"v"+q+"h"+u+"v-"+q+"z";0>t&&10===this.options.BoxStyle&&(m+="M"+n+","+A+"l"+u+","+q+"M"+(n+u)+","+A+"l-"+u+","+q);if(11===this.options.BoxStyle&&5<u&&5<q){z=
Math.round(.1*u);var B=Math.round(.1*q);y="M"+n+","+A+"h"+u+"l"+-z+","+B+"h"+(2*z-u)+"v"+(q-2*B)+"l"+-z+","+B+"z";u="M"+(n+u)+","+(A+q)+"v"+-q+"l"+-z+","+B+"v"+(q-2*B)+"h"+(2*z-u)+"l"+-z+","+B+"z";0>t?(e+=y,g+=u):(g+=y,e+=u)}}}0<k.length&&(a=this.draw_g.append("svg:path").attr("d",k).call(this.fillatt.func),11!==this.options.BoxStyle&&this.fillatt.empty()?a.call(this.lineatt.func):a.style("stroke","none"));0<g.length&&this.fillatt.hasColor()&&this.draw_g.append("svg:path").attr("d",g).style("stroke",
"none").call(this.fillatt.func).style("fill",f.rgb(this.fillatt.color).brighter(.5).toString());0<e.length&&this.draw_g.append("svg:path").attr("d",e).style("stroke","none").call(this.fillatt.func).style("fill",this.fillatt.hasColor()?f.rgb(this.fillatt.color).darker(.5).toString():"red");0<m.length&&(m=this.draw_g.append("svg:path").attr("d",m).style("fill","none"),this.lineatt.empty()?m.style("stroke","black"):m.call(this.lineatt.func));return c};B.prototype.drawBinsCandle=function(a,c){var b=this.getHisto(),
d=this.getAxis("y"),h=this.prepareDraw(),k,m,g,e,f="",p="";this.createv7AttMarker();this.markeratt.resetPos();h.candle=[];for(k=h.i1;k<h.i2;++k){for(c=g=e=m=0;c<this.nbinsy;++c)e+=b.getBinContent(k+1,c+1);var l={bin:k,meany:0,m25y:0,p25y:0,median:0,iqr:0,whiskerp:0,whiskerm:0};for(c=0;c<this.nbinsy;++c){var n=b.getBinContent(k+1,c+1);var r=d.GetBinCoord(c+.5);.001>g/e&&.001<=(g+n)/e&&(l.whiskerm=r);.25>g/e&&.25<=(g+n)/e&&(l.m25y=r);.5>g/e&&.5<=(g+n)/e&&(l.median=r);.75>g/e&&.75<=(g+n)/e&&(l.p25y=
r);.999>g/e&&.999<=(g+n)/e&&(l.whiskerp=r);g+=n;m+=n*r}0<g&&(l.meany=m/g);l.iqr=l.p25y-l.m25y;l.m25y-1.5*l.iqr>l.whsikerm&&(l.whiskerm=l.m25y-1.5*l.iqr);l.p25y+1.5*l.iqr<l.whiskerp&&(l.whiskerp=l.p25y+1.5*l.iqr);if(!(a.logy&&0>=l.whiskerm)){c=h.grx[k+1]-h.grx[k];c*=.66;m=(h.grx[k+1]+h.grx[k])/2+this.options.BarOffset*c;0<this.options.BarWidth&&(c*=this.options.BarWidth);l.x1=Math.round(m-c/2);l.x2=Math.round(m+c/2);m=Math.round(m);l.y0=Math.round(a.gry(l.median));f+="M"+l.x1+","+l.y0+"h"+(l.x2-l.x1);
l.y1=Math.round(a.gry(l.p25y));l.y2=Math.round(a.gry(l.m25y));f+="M"+l.x1+","+l.y1+"v"+(l.y2-l.y1)+"h"+(l.x2-l.x1)+"v-"+(l.y2-l.y1)+"z";l.yy1=Math.round(a.gry(l.whiskerp));l.yy2=Math.round(a.gry(l.whiskerm));f+="M"+m+","+l.y1+"v"+(l.yy1-l.y1);f+="M"+l.x1+","+l.yy1+"h"+(l.x2-l.x1);f+="M"+m+","+l.y2+"v"+(l.yy2-l.y2);f+="M"+l.x1+","+l.yy2+"h"+(l.x2-l.x1);for(c=0;c<this.nbinsy;++c)n=b.getBinContent(k+1,c+1),r=d.GetBinCoord(c+.5),0<n&&r<l.whiskerm&&(p+=this.markeratt.create(m,r)),0<n&&r>l.whiskerp&&(p+=
this.markeratt.create(m,r));h.candle.push(l)}}0<f.length&&this.draw_g.append("svg:path").attr("d",f).call(this.lineatt.func).call(this.fillatt.func);0<p.length&&this.draw_g.append("svg:path").attr("d",p).call(this.markeratt.func);return h};B.prototype.drawBinsScatter=function(){var a=this.getHisto(),c=this.prepareDraw({rounding:!0,pixel_density:!0,scatter_plot:!0}),b=[],d=[],h=[],k=[],m=[],g,e,f=1;var p=this.options.ScatCoef*(2E3<this.gmaxbin?2E3/this.gmaxbin:1);var l=c.stepi,n=c.stepj;JSROOT.seed(c.sumz);
if(1E5>p*c.sumz){this.createv7AttMarker();this.markeratt.resetPos();b="";for(g=c.i1;g<c.i2;g+=l){var r=c.grx[g+l]-c.grx[g];for(e=c.j1;e<c.j2;e+=n){var t=c.gry[e]-c.gry[e+n];var u=a.getBinContent(g+1,e+1);m=Math.round(p*u);if(!(0>=m))for(k=0;k<m;++k)b+=this.markeratt.create(Math.round(c.grx[g]+r*JSROOT.random()),Math.round(c.gry[e+1]+t*JSROOT.random()))}}this.draw_g.append("svg:path").attr("d",b).call(this.markeratt.func);return c}.7<this.maxbin&&(f=.7/this.maxbin);for(g=c.i1;g<c.i2;g+=l)for(e=c.j1;e<
c.j2;e+=n)if(u=a.getBinContent(g+1,e+1),!(0>=u||u<this.minbin||(r=c.grx[g+l]-c.grx[g],t=c.gry[e]-c.gry[e+n],0>=r*t||(p=c.palette.getContourIndex(u/r/t),0>p)))){u="M"+c.grx[g]+","+c.gry[e+n];if(void 0===b[p])b[p]=u,k[p]=r,m[p]=t;else{var q="m"+(c.grx[g]-d[p])+","+(c.gry[e+n]-h[p]);b[p]+=q.length<u.length?q:u;k[p]=Math.max(k[p],r);m[p]=Math.max(m[p],t)}d[p]=c.grx[g];h[p]=c.gry[e+n];b[p]+="v"+t+"h"+r+"v-"+t+"z"}p=this.getFrameSvg().select(".main_layer");a=p.select("defs");a.empty()&&0<b.length&&(a=p.insert("svg:defs",
":first-child"));this.createv7AttMarker();g=c.palette.getContour();for(p=0;p<b.length;++p)if(void 0!==b[p]&&p<g.length){r="scatter_"+p;e=a.select("."+r);e.empty()?e=a.append("svg:pattern").attr("class",r).attr("id","jsroot_scatter_pattern_"+JSROOT._.id_counter++).attr("patternUnits","userSpaceOnUse"):e.selectAll("*").remove();r=Math.round(f*g[p]*k[p]*m[p]);1>r&&(r=1);t=new Float32Array(r);l=new Float32Array(r);if(1===r)t[0]=l[0]=.5;else for(n=0;n<r;++n)t[n]=JSROOT.random(),l[n]=JSROOT.random();this.markeratt.resetPos();
n="";for(d=0;d<r;++d)n+=this.markeratt.create(t[d]*k[p],l[d]*m[p]);e.attr("width",k[p]).attr("height",m[p]).append("svg:path").attr("d",n).call(this.markeratt.func);this.draw_g.append("svg:path").attr("scatter-index",p).attr("fill","url(#"+e.attr("id")+")").attr("d",b[p])}return c};B.prototype.draw2DBins=function(){if(!this.draw_content)return this.removeG();this.createHistDrawAttributes();this.createG(!0);var a=this.getFramePainter(),c=a.getFrameRect();a=a.getGrFuncs(this.options.second_x,this.options.second_y);
var b=null;this.isRH2Poly()?b=this.drawPolyBinsColor():(this.options.Scat?b=this.drawBinsScatter():this.options.Color?b=this.drawBinsColor():this.options.Box?b=this.drawBinsBox():this.options.Arrow?b=this.drawBinsArrow():0<this.options.Contour?b=this.drawBinsContour(a,c.width,c.height):this.options.Candle&&(b=this.drawBinsCandle(a,c.width)),this.options.Text&&(b=this.drawBinsText(b)),b||(b=this.drawBinsColor()));this.tt_handle=b};B.prototype.getBinTooltips=function(a,c){var b=[],d=this.getHisto(),
h=d.getBinContent(a+1,c+1),k=1,m=1;this.isDisplayItem()&&(k=d.stepx||1,m=d.stepy||1);b.push(this.getObjectHint()||"histo<2>");b.push("x = "+this.getAxisBinTip("x",a,k));b.push("y = "+this.getAxisBinTip("y",c,m));b.push("bin = "+a+", "+c);d.$baseh&&(h-=d.$baseh.getBinContent(a+1,c+1));a="entries = "+(1<k||1<m?"~":"");h===Math.round(h)?b.push(a+h):b.push(a+q.floatToString(h,JSROOT.gStyle.fStatFormat));return b};B.prototype.getCandleTooltips=function(a){var c=[],b=this.getFramePainter(),d=this.getAxis("y");
c.push(this.getObjectHint()||"histo");c.push("x = "+b.axisAsText("x",d.GetBinCoord(a.bin)));c.push("mean y = "+q.floatToString(a.meany,JSROOT.gStyle.fStatFormat));c.push("m25 = "+q.floatToString(a.m25y,JSROOT.gStyle.fStatFormat));c.push("p25 = "+q.floatToString(a.p25y,JSROOT.gStyle.fStatFormat));return c};B.prototype.getPolyBinTooltips=function(a,c,b){a=this.getHisto().fBins.arr[a];var d=this.getFramePainter(),h=a.fPoly.fName,k=[],m=0;"Graph"===h&&(h="");0===h.length&&(h=a.fNumber);if(void 0===c&&
void 0===b){c=b=0;var g=a.fPoly,e=1;"TMultiGraph"===g._typename&&(e=a.fPoly.fGraphs.arr.length,g=null);for(var f=0;f<e;++f){if(!g||0<f)g=a.fPoly.fGraphs.arr[f];for(var p=0;p<g.fNpoints;++p)++m,c+=g.fX[p],b+=g.fY[p]}1<m&&(c/=m,b/=m)}k.push(this.getObjectHint()||"histo");k.push("x = "+d.axisAsText("x",c));k.push("y = "+d.axisAsText("y",b));0<m&&k.push("npnts = "+m);k.push("bin = "+h);a.fContent===Math.round(a.fContent)?k.push("content = "+a.fContent):k.push("content = "+q.floatToString(a.fContent,JSROOT.gStyle.fStatFormat));
return k};B.prototype.processTooltipEvent=function(a){if(!(a&&this.draw_content&&this.draw_g&&this.tt_handle)||this.options.Proj)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;var c=this.getHisto(),b=this.tt_handle,d=this.draw_g.select(".tooltip_bin");if(b.poly){b=this.getFramePainter();var h=-1,k=b.revertAxis("x",a.x),m=b.revertAxis("y",a.y);if(void 0!==k&&void 0!==m)for(var g=c.fBins.arr.length,e=0;e<g&&0>h;++e){var f=c.fBins.arr[e];if(!(k<f.fXmin||k>f.fXmax||m<f.fYmin||m>
f.fYmax||0===f.fContent&&!this.options.Zero)){var p=f.fPoly,l=1;"TMultiGraph"===p._typename&&(l=f.fPoly.fGraphs.arr.length,p=null);for(var n=0;n<l;++n){if(!p||0<n)p=f.fPoly.fGraphs.arr[n];if(p.IsInside(k,m)){h=e;break}}}}if(0>h)return d.remove(),null;k={name:"histo",title:c.fTitle||"title",x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",exact:!0,menu:!0,lines:this.getPolyBinTooltips(h,k,m)};a.disabled?(d.remove(),k.changed=
!0):(d.empty()&&(d=this.draw_g.append("svg:path").attr("class","tooltip_bin h1bin").style("pointer-events","none")),k.changed=d.property("current_bin")!==h,k.changed&&d.attr("d",this.createPolyBin(b,f)).style("opacity","0.7").property("current_bin",h));k.changed&&(k.user_info={obj:c,name:"histo",bin:h,cont:f.fContent,grx:a.x,gry:a.y});return k}if(b.candle){for(f=0;f<b.candle.length&&!(h=b.candle[f],h.x1<=a.x&&a.x<=h.x2&&h.yy1<=a.y&&a.y<=h.yy2);++f);if(f>=b.candle.length)return d.remove(),null;b={name:"histo",
title:c.fTitle||"title",x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getCandleTooltips(h),exact:!0,menu:!0};a.disabled?(d.remove(),b.changed=!0):(d.empty()&&(d=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")),b.changed=d.property("current_bin")!==f,b.changed&&d.attr("x",h.x1).attr("width",h.x2-h.x1).attr("y",h.yy1).attr("height",h.yy2-h.yy1).style("opacity","0.7").property("current_bin",
f));b.changed&&(b.user_info={obj:c,name:"histo",bin:f+1,cont:h.median,binx:f+1,biny:1,grx:a.x,gry:a.y});return b}k=0;g=null;for(f=b.i1;f<b.i2&&!(a.x>=b.grx[f]&&a.x<=b.grx[f+1]);++f);for(h=b.j1;h<b.j2&&!(a.y>=b.gry[h+1]&&a.y<=b.gry[h]);++h);f<b.i2&&h<b.j2&&(k=c.getBinContent(f+1,h+1),this.is_projection?g=0:b.hide_only_zeros?g=0!==k||this._show_empty_bins?0:null:(g=b.palette.getContourIndex(k),null===g&&0===k&&this._show_empty_bins&&(g=0)));if(null===g)return d.remove(),null;m={name:"histo",title:c.fTitle||
"title",x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getBinTooltips(f,h),exact:!0,menu:!0};this.options.Color&&(m.color2=b.palette.getColor(g));if(a.disabled&&!this.is_projection)d.remove(),m.changed=!0;else{d.empty()&&(d=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none"));g=f;e=f+1;p=h;l=h+1;n=b.grx[g];var r=b.grx[e],t=b.gry[l],q=b.gry[p],v=1E4*f+h;"X"==this.is_projection?
(n=0,r=this.getFramePainter().getFrameWidth(),1<this.projection_width&&(t=(this.projection_width-1)/2,l+t>=b.j2?(l=Math.min(Math.round(l+t),b.j2),p=Math.max(l-this.projection_width,b.j1)):(p=Math.max(Math.round(p-t),b.j1),l=Math.min(p+this.projection_width,b.j2))),t=b.gry[l],q=b.gry[p],v=777*p+333*l):"Y"==this.is_projection&&(t=0,q=this.getFramePainter().getFrameHeight(),1<this.projection_width&&(n=(this.projection_width-1)/2,e+n>=b.i2?(e=Math.min(Math.round(e+n),b.i2),g=Math.max(e-this.projection_width,
b.i1)):(g=Math.max(Math.round(g-n),b.i1),e=Math.min(g+this.projection_width,b.i2))),n=b.grx[g],r=b.grx[e],v=777*g+333*e);m.changed=d.property("current_bin")!==v;m.changed&&d.attr("x",n).attr("width",r-n).attr("y",t).attr("height",q-t).style("opacity","0.7").property("current_bin",v);this.is_projection&&m.changed&&this.redrawProjection(g,e,p,l)}m.changed&&(m.user_info={obj:c,name:"histo",bin:c.getBin(f+1,h+1),cont:k,binx:f+1,biny:h+1,grx:a.x,gry:a.y});return m};B.prototype.canZoomInside=function(a,
c,b){if("z"==a)return!0;a=this.getAxis(a);return 1<a.FindBin(b,.5)-a.FindBin(c,0)};B.prototype.draw2D=function(a){var c=this;this.clear3DScene();return this.drawFrameAxes().then(function(b){return b?c.drawingBins(a):!1}).then(function(a){if(!a)return!1;c.draw2DBins();return c.addInteractivity()}).then(function(a){return a?c:null})};B.prototype.draw3D=function(a){var c=this;this.mode3d=!0;return JSROOT.require("v7hist3d").then(function(){return c.draw3D(a)})};B.prototype.callDrawFunc=function(a){var c=
this.getFramePainter();c&&c.mode3d!==this.options.Mode3D&&!this.isMainPainter()&&(this.options.Mode3D=c.mode3d);return this[this.options.Mode3D?"draw3D":"draw2D"](a)};B.prototype.redraw=function(a){this.callDrawFunc(a)};var I=function(a,c,b){var d=new B(a,c);return q.ensureRCanvas(d).then(function(){d.setAsMainPainter();d.options={Hist:!1,Error:!1,Zero:!1,Mark:!1,Line:!1,Fill:!1,Lego:0,Surf:0,Text:!0,TextAngle:0,TextKind:"",BaseLine:!1,Mode3D:!1,AutoColor:0,Color:!1,Scat:!1,ScatCoef:1,Candle:"",Box:!1,
BoxStyle:0,Arrow:!1,Contour:0,Proj:0,BarOffset:0,BarWidth:1,minimum:-1111,maximum:-1111};var a=d.v7EvalAttr("kind",""),b=d.v7EvalAttr("sub",0),c=d.options;c.Text=d.v7EvalAttr("drawtext",!1);switch(a){case "lego":c.Lego=0<b?10+b:12;c.Mode3D=!0;break;case "surf":c.Surf=0<b?10+b:1;c.Mode3D=!0;break;case "box":c.Box=!0;c.BoxStyle=10+b;break;case "err":c.Error=!0;c.Mode3D=!0;break;case "cont":c.Contour=0<b?10+b:1;break;case "arr":c.Arrow=!0;break;case "scat":c.Scat=!0;break;case "col":c.Color=!0;break;
default:c.Text||(c.Color=!0)}d.isRH2Poly()&&(c.Mode3D?c.Lego=12:c.Color=!0);d._show_empty_bins=!1;d.scanContent();return d.callDrawFunc()})};F.prototype=Object.create(JSROOT.v7.RPavePainter.prototype);F.prototype.clearStat=function(){this.stats_lines=[]};F.prototype.addText=function(a){this.stats_lines.push(a)};F.prototype.updateStatistic=function(a){this.stats_lines=a.lines;this.drawStatistic(this.stats_lines)};F.prototype.fillStatistic=function(){var a=this.getPadPainter();if(a&&a._fast_drawing)return!1;
a=this.getObject();return void 0!==a.fLines?(this.stats_lines=a.fLines,delete a.fLines,!0):this.v7CommMode()==JSROOT.v7.CommMode.kOffline?(a=this.getMainPainter())&&"function"===typeof a.fillStatistic?a.fillStatistic(this,JSROOT.gStyle.fOptStat,JSROOT.gStyle.fOptFit):!1:void 0!==this.stats_lines};F.prototype.format=function(a,c){c||(c="stat");switch(c){case "stat":c=JSROOT.gStyle.fStatFormat;break;case "fit":c=JSROOT.gStyle.fFitFormat;break;case "entries":if(1E9>Math.abs(a)&&Math.round(a)==a)return a.toFixed(0);
c="14.7g";break;case "last":c=this.lastformat}a=q.floatToString(a,c||"6.4g",!0);this.lastformat=a[1];return a[0]};F.prototype.drawContent=function(){return this.fillStatistic()?this.drawStatistic(this.stats_lines):Promise.resolve(this)};F.prototype.changeMask=function(a){var c=this.getObject();a=1<<a;c.fShowMask=c.fShowMask&a?c.fShowMask&~a:c.fShowMask|a;this.fillStatistic()&&this.drawStatistic(this.stats_lines)};F.prototype.statsContextMenu=function(a){var c=this;a.preventDefault();a.stopPropagation();
q.createMenu(a,this).then(function(a){var b=c.getObject(),f=c.changeMask.bind(c);a.add("header: StatBox");for(var k=0;k<b.fEntries.length;++k)a.addchk(b.fShowMask&1<<k,b.fEntries[k],k,f);return c.fillObjectExecMenu(a)}).then(function(a){return a.show()})};F.prototype.drawStatistic=function(a){var c=this.v7EvalFont("stats_text",{size:12,color:"black",align:22}),b=0,d=0,f=0,k=this.pave_width,m=this.pave_height;if(!a)return Promise.resolve(this);for(var g=a.length,e=0;e<g;++e){var n=a[e];0<e&&(f=Math.max(f,
n.length));0==e||0>n.indexOf("|")||(0===b&&(b=e),n=n.split("|"),n.length>d&&(d=n.length))}e=m/g;var p=!1,l=.02*k;n=this.draw_g.select(".statlines");n.empty()?n=this.draw_g.append("svg:g").attr("class","statlines"):n.selectAll("*").remove();c.setSize(m/(1.2*g));this.startTextDrawing(c,"font",n);if(1==g)this.drawText({width:k,height:m,text:a[0],latex:1,draw_g:n});else for(c=0;c<g;++c){var q=c*e;if(b&&c>=b)for(var r=a[c].split("|"),t=0;t<r.length;++t)this.drawText({align:"middle",x:k*t/d,y:q,latex:0,
width:k/d,height:e,text:r[t],draw_g:n});else if(0>a[c].indexOf("="))0==c&&(p=!0,r=Math.max(f,Math.round((k-2*l)/e/.65)),a[c].length>r+5&&(a[c]=a[c].substr(0,r+2)+"...")),this.drawText({align:0==c?"middle":"start",x:l,y:q,width:k-2*l,height:e,text:a[c],draw_g:n});else{t=a[c].split("=");r=[];for(var u=0;2>u;++u)r.push({align:0==u?"start":"end",x:l,y:q,width:k-2*l,height:e,text:t[u],draw_g:n,_expected_width:k-2*l,_args:r,post_process:function(a){this._args[0].ready&&this._args[1].ready&&a.scaleTextDrawing(1.05*
(this._args[0].result_width&&this._args[1].result_width)/this.__expected_width,this.draw_g)}});for(q=0;2>q;++q)this.drawText(r[q])}}a="";p&&(a+="M0,"+Math.round(e)+"h"+k);if(0<b&&1<d){for(f=b;f<g;++f)a+="M0,"+Math.round(f*e)+"h"+k;for(g=0;g<d-1;++g)a+="M"+Math.round(k/d*(g+1))+","+Math.round(b*e)+"V"+m}a&&this.draw_g.append("svg:path").attr("d",a);return this.finishTextDrawing(n)};F.prototype.redraw=function(a){var c=this;a&&"string"==typeof a&&0==a.indexOf("zoom")&&this.v7CommMode()==JSROOT.v7.CommMode.kNormal&&
(a={_typename:"ROOT::Experimental::RHistStatBoxBase::RRequest",mask:this.getObject().fShowMask},this.v7SubmitRequest("stat",a,function(a){return c.updateStatistic(a)}));this.drawPave()};JSROOT.v7.RHistPainter=n;JSROOT.v7.RH1Painter=y;JSROOT.v7.RH2Painter=B;JSROOT.v7.drawHist1=ca;JSROOT.v7.drawHist2=I;JSROOT.v7.drawHistDisplayItem=function(a,c,b){return c?1==c.fAxes.length?ca(a,c,b):2==c.fAxes.length?I(a,c,b):3==c.fAxes.length?JSROOT.require("v7hist3d").then(function(){return JSROOT.v7.drawHist3(a,
c,b)}):null:null};JSROOT.v7.drawHistStats=function(a,c,b){var d=new F(a,c,b);return q.ensureRCanvas(d,!1).then(function(){return d.drawPave()})};return JSROOT});
