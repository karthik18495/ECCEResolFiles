var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(h,f,n){h!=Array.prototype&&h!=Object.prototype&&(h[f]=n.value)};$jscomp.getGlobal=function(h){return"undefined"!=typeof window&&window===h?h:"undefined"!=typeof global&&null!=global?global:h};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(h,f,n,k){if(f){n=$jscomp.global;h=h.split(".");for(k=0;k<h.length-1;k++){var e=h[k];e in n||(n[e]={});n=n[e]}h=h[h.length-1];k=n[h];f=f(k);f!=k&&null!=f&&$jscomp.defineProperty(n,h,{configurable:!0,writable:!0,value:f})}};$jscomp.polyfill("Number.isFinite",function(h){return h?h:function(f){return"number"!==typeof f?!1:!isNaN(f)&&Infinity!==f&&-Infinity!==f}},"es6","es3");
$jscomp.polyfill("Number.isInteger",function(h){return h?h:function(f){return Number.isFinite(f)?f===Math.floor(f):!1}},"es6","es3");$jscomp.polyfill("Math.log10",function(h){return h?h:function(f){return Math.log(f)/Math.LN10}},"es6","es3");$jscomp.arrayIteratorImpl=function(h){var f=0;return function(){return f<h.length?{done:!1,value:h[f++]}:{done:!0}}};$jscomp.arrayIterator=function(h){return{next:$jscomp.arrayIteratorImpl(h)}};
$jscomp.makeIterator=function(h){var f="undefined"!=typeof Symbol&&Symbol.iterator&&h[Symbol.iterator];return f?f.call(h):$jscomp.arrayIterator(h)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(h){function f(){this.batch_=null}function n(f){return f instanceof e?f:new e(function(e,h){e(f)})}if(h&&!$jscomp.FORCE_POLYFILL_PROMISE)return h;f.prototype.asyncExecute=function(e){if(null==this.batch_){this.batch_=[];var f=this;this.asyncExecuteFunction(function(){f.executeBatch_()})}this.batch_.push(e)};var k=$jscomp.global.setTimeout;f.prototype.asyncExecuteFunction=function(e){k(e,0)};f.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var e=
this.batch_;this.batch_=[];for(var f=0;f<e.length;++f){var h=e[f];e[f]=null;try{h()}catch(E){this.asyncThrow_(E)}}}this.batch_=null};f.prototype.asyncThrow_=function(e){this.asyncExecuteFunction(function(){throw e;})};var e=function(e){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var f=this.createResolveAndReject_();try{e(f.resolve,f.reject)}catch(w){f.reject(w)}};e.prototype.createResolveAndReject_=function(){function e(e){return function(k){h||(h=!0,e.call(f,k))}}var f=this,h=!1;
return{resolve:e(this.resolveTo_),reject:e(this.reject_)}};e.prototype.resolveTo_=function(f){if(f===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(f instanceof e)this.settleSameAsPromise_(f);else{a:switch(typeof f){case "object":var h=null!=f;break a;case "function":h=!0;break a;default:h=!1}h?this.resolveToNonPromiseObj_(f):this.fulfill_(f)}};e.prototype.resolveToNonPromiseObj_=function(e){var f=void 0;try{f=e.then}catch(w){this.reject_(w);return}"function"==typeof f?
this.settleSameAsThenable_(f,e):this.fulfill_(e)};e.prototype.reject_=function(e){this.settle_(2,e)};e.prototype.fulfill_=function(e){this.settle_(1,e)};e.prototype.settle_=function(e,f){if(0!=this.state_)throw Error("Cannot settle("+e+", "+f+"): Promise already settled in state"+this.state_);this.state_=e;this.result_=f;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var e=0;e<this.onSettledCallbacks_.length;++e)m.asyncExecute(this.onSettledCallbacks_[e]);
this.onSettledCallbacks_=null}};var m=new f;e.prototype.settleSameAsPromise_=function(e){var f=this.createResolveAndReject_();e.callWhenSettled_(f.resolve,f.reject)};e.prototype.settleSameAsThenable_=function(e,f){var h=this.createResolveAndReject_();try{e.call(f,h.resolve,h.reject)}catch(E){h.reject(E)}};e.prototype.then=function(f,h){function k(e,f){return"function"==typeof e?function(f){try{m(e(f))}catch(K){n(K)}}:f}var m,n,J=new e(function(e,f){m=e;n=f});this.callWhenSettled_(k(f,m),k(h,n));return J};
e.prototype.catch=function(e){return this.then(void 0,e)};e.prototype.callWhenSettled_=function(e,f){function h(){switch(k.state_){case 1:e(k.result_);break;case 2:f(k.result_);break;default:throw Error("Unexpected state: "+k.state_);}}var k=this;null==this.onSettledCallbacks_?m.asyncExecute(h):this.onSettledCallbacks_.push(h)};e.resolve=n;e.reject=function(f){return new e(function(e,h){h(f)})};e.race=function(f){return new e(function(e,h){for(var k=$jscomp.makeIterator(f),m=k.next();!m.done;m=k.next())n(m.value).callWhenSettled_(e,
h)})};e.all=function(f){var h=$jscomp.makeIterator(f),k=h.next();return k.done?n([]):new e(function(e,f){function m(f){return function(h){B[f]=h;w--;0==w&&e(B)}}var B=[],w=0;do B.push(void 0),w++,n(k.value).callWhenSettled_(m(B.length-1),f),k=h.next();while(!k.done)})};return e},"es6","es3");$jscomp.findInternal=function(h,f,n){h instanceof String&&(h=String(h));for(var k=h.length,e=0;e<k;e++){var m=h[e];if(f.call(n,m,e,h))return{i:e,v:m}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(h){return h?h:function(f,h){return $jscomp.findInternal(this,f,h).v}},"es6","es3");$jscomp.polyfill("Array.prototype.findIndex",function(h){return h?h:function(f,h){return $jscomp.findInternal(this,f,h).i}},"es6","es3");
JSROOT.define(["d3","painter"],function(h,f){function n(a,b,c){JSROOT.AxisBasePainter.call(this,a,b);this.embedded=c;this.lbls_both_sides=this.invert_side=!1}function k(a,b){JSROOT.ObjectPainter.call(this,a,b&&b.$dummy?null:b);this.zoom_kind=0;this.mode3d=!1;this.ymin=this.ymax=this.xmin=this.xmax=this.shrink_frame_left=0;this.axes_drawn=this.ranges_set=!1;this.keys_handler=null;this.projection=0}function e(a,b,c){JSROOT.ObjectPainter.call(this,a,b);this.pad=b;this.iscan=c;this.this_pad_name="";!this.iscan&&
null!==b&&"fName"in b&&(this.this_pad_name=b.fName.replace(" ","_"),/^[A-Za-z][A-Za-z0-9_]*$/.test(this.this_pad_name)||(this.this_pad_name="jsroot_pad_"+JSROOT.id_counter++));this.painters=[];this.has_canvas=!0}function m(a,b){e.call(this,a,b,!0);this._websocket=null;this.tooltip_allowed=JSROOT.settings.Tooltip}JSROOT.EAxisBits={kDecimals:JSROOT.BIT(7),kTickPlus:JSROOT.BIT(9),kTickMinus:JSROOT.BIT(10),kAxisRange:JSROOT.BIT(11),kCenterTitle:JSROOT.BIT(12),kCenterLabels:JSROOT.BIT(14),kRotateTitle:JSROOT.BIT(15),
kPalette:JSROOT.BIT(16),kNoExponent:JSROOT.BIT(17),kLabelsHori:JSROOT.BIT(18),kLabelsVert:JSROOT.BIT(19),kLabelsDown:JSROOT.BIT(20),kLabelsUp:JSROOT.BIT(21),kIsInteger:JSROOT.BIT(22),kMoreLogLabels:JSROOT.BIT(23),kOppositeTitle:JSROOT.BIT(32)};n.prototype=Object.create(JSROOT.AxisBasePainter.prototype);n.prototype.getAxisType=function(){return"TAxis"};n.prototype.configureAxis=function(a,b,c,d,g,l,v,q){var e=this;this.name=a;this.full_min=b;this.full_max=c;this.kind="normal";this.vertical=l;this.log=
q.log||0;this.symlog=q.symlog||!1;this.reverse=q.reverse||!1;this.swap_side=q.swap_side||!1;a=this.getObject();q.time_scale||a.fTimeDisplay?(this.kind="time",this.timeoffset=f.getTimeOffset(a)):this.kind=a.fLabels?"labels":"normal";if("time"==this.kind)this.func=h.scaleTime().domain([this.convertDate(d),this.convertDate(g)]);else if(this.log){this.logbase=2===this.log?2:10;0>=g&&(g=1);if(0>=d&&a&&!q.logcheckmin)for(b=0;b<a.fNbins&&!(d=Math.max(d,a.GetBinLowEdge(b+1)),0<d);++b);0>=d&&q.log_min_nz&&
(d=q.log_min_nz);if(0>=d||d>=g)d=g*(q.logminfactor||1E-4);this.func=h.scaleLog().base(2==this.log?2:10).domain([d,g])}else this.symlog?(q=Math.max(Math.abs(d),Math.abs(g)),q=Number.isInteger(this.symlog)&&0<this.symlog?q*Math.pow(10,-1*this.symlog):.01*q,this.func=h.scaleSymlog().constant(q).domain([d,g])):this.func=h.scaleLinear().domain([d,g]);this.vertical^this.reverse&&(q=v[0],v[0]=v[1],v[1]=q);this.func.range(v);this.scale_min=d;this.scale_max=g;this.gr="time"==this.kind?function(a){return e.func(e.convertDate(a))}:
this.log?function(a){return a<e.scale_min?e.vertical?e.func.range()[0]+5:-5:e.func(a)}:this.func;d=a&&"TGaxis"===a._typename;delete this.format;g=508;d?g=a.fNdiv:a&&(g=Math.max(a.fNdivisions,4));this.nticks=g%100;this.nticks2=(g%1E4-this.nticks)/100;this.nticks3=Math.floor(g/1E4);a&&!d&&20<this.nticks&&(this.nticks=20);g=Math.abs(this.func.range()[1]-this.func.range()[0]);0>=g&&(g=100);if("time"==this.kind){8<this.nticks&&(this.nticks=8);d=this.scale_max-this.scale_min;a=f.getTimeFormat(a);g=f.chooseTimeFormat(d/
g,!1);if(0==a.length||d<.1*(this.full_max-this.full_min))a=f.chooseTimeFormat(d/this.nticks,!0);this.tfunc1=this.tfunc2=h.timeFormat(a);g!==a&&(this.tfunc2=h.timeFormat(g));this.format=this.formatTime}else this.log?(1<this.nticks2&&(this.nticks*=this.nticks2,this.nticks2=1),this.noexp=a?a.TestBit(JSROOT.EAxisBits.kNoExponent):!1,300>this.scale_max&&.3<this.scale_min&&(this.noexp=!0),this.moreloglabels=a?a.TestBit(JSROOT.EAxisBits.kMoreLogLabels):!1,this.format=this.formatLog):"labels"==this.kind?
(this.nticks=50,d=this.scale_max-this.scale_min,this.nticks>d&&(this.nticks=Math.round(d)),this.regular_labels=!0,a&&a.fNbins&&a.fLabels&&(a.fNbins!=Math.round(a.fXmax-a.fXmin)||0!=a.fXmin||a.fXmax!=a.fNbins)&&(this.regular_labels=!1),this.nticks2=1,this.format=this.formatLabels):(this.ndig=this.order=0,this.format=this.formatNormal)};n.prototype.getScaleMin=function(){return this.func?this.func.domain()[0]:0};n.prototype.getScaleMax=function(){return this.func?this.func.domain()[1]:0};n.prototype.formatLabels=
function(a){a=parseFloat(a);var b=this.getObject();this.regular_labels||(a=(a-b.fXmin)/(b.fXmax-b.fXmin)*b.fNbins);a=Math.floor(a);if(0>a||a>=b.fNbins)return null;for(var c=0;c<b.fLabels.arr.length;++c){var d=b.fLabels.arr[c];if(d.fUniqueID===a+1)return d.fString}return null};n.prototype.createTicks=function(a,b,c,d){c&&this.nticks&&"normal"==this.kind&&(this.noticksopt=!0);c={nminor:0,nmiddle:0,nmajor:0,func:this.func};c.minor=c.middle=c.major=this.produceTicks(this.nticks);if(a)return d=c.major,
c=1E-5*(this.scale_max-this.scale_min),d[0]>this.scale_min+c&&d.unshift(this.scale_min),d[d.length-1]<this.scale_max-c&&d.push(this.scale_max),d;if("labels"==this.kind&&!this.regular_labels){c.lbl_pos=[];a=this.getObject();for(var g=0;g<a.fNbins;++g){var l=a.fXmin+g/a.fNbins*(a.fXmax-a.fXmin);l>=this.scale_min&&l<this.scale_max&&c.lbl_pos.push(l)}}1<this.nticks2&&(!this.log||10===this.logbase)&&((c.minor=c.middle=this.produceTicks(c.major.length,this.nticks2),a=Math.abs(this.func.range()[1]-this.func.range()[0]),
c.middle.length<=c.major.length||c.middle.length>a/3.5)?c.minor=c.middle=c.major:1<this.nticks3&&!this.log&&(c.minor=this.produceTicks(c.middle.length,this.nticks3),c.minor.length<=c.middle.length||c.minor.length>a/1.7)&&(c.minor=c.middle));c.reset=function(){this.nminor=this.nmiddle=this.nmajor=0};c.next=function(a){if(this.nminor>=this.minor.length)return!1;this.tick=this.minor[this.nminor++];this.grpos=this.func(this.tick);a&&(this.grpos=Math.round(this.grpos));this.kind=3;this.nmiddle<this.middle.length&&
1>Math.abs(this.grpos-this.func(this.middle[this.nmiddle]))&&(this.nmiddle++,this.kind=2);this.nmajor<this.major.length&&1>Math.abs(this.grpos-this.func(this.major[this.nmajor]))&&(this.nmajor++,this.kind=1);return!0};c.last_major=function(){return 1!==this.kind?!1:this.nmajor==this.major.length};c.next_major_grpos=function(){return this.nmajor>=this.major.length?null:this.func(this.major[this.nmajor])};this.ndig=this.order=0;if("normal"==this.kind&&!this.log&&0<c.major.length){l=a=0;g=!1;if(!b){b=
Math.max(Math.abs(c.major[0]),Math.abs(c.major[c.major.length-1]));var v=Math.min(Math.abs(c.major[0]),Math.abs(c.major[c.major.length-1])),q=0<b?3*Math.round(Math.log10(b)/3):0,e=0<v?3*Math.round(Math.log10(v)/3):0;g=2E4>b;if(b||v)a=Math.max(q,e)+3,l=Math.min(q,e)-3}b=0;v=this.ndig;for(q=1E10;l<=a;l+=3)if(!g||3!==l){this.order=l;this.ndig=0;e=[];for(var t=0,f=0;t<c.major.length;){var h=this.format(c.major[t],!0);if(0>e.indexOf(h))e.push(h),f+=h.length,t++;else{if(15<++this.ndig)break;e=[];f=t=0}}!l&&
4>this.ndig&&(f-=2*c.major.length+3);f<q&&(q=f,b=this.order,v=this.ndig)}this.order=b;this.ndig=v;d&&(this.order&&console.warn("Axis painter - integer labels are configured, but axis order "+this.order+" is preferable"),this.ndig&&console.warn("Axis painter - integer labels are configured, but "+this.ndig+" decimal digits are required"),this.order=this.ndig=0)}return c};n.prototype.isCenteredLabels=function(){if("labels"===this.kind)return!0;if(this.log)return!1;var a=this.getObject();return a&&a.TestBit(JSROOT.EAxisBits.kCenterLabels)};
n.prototype.addTitleDrag=function(a,b,c,d,g){var l=this;if(JSROOT.settings.MoveResize&&!JSROOT.batch_mode){var v=null,q,e,t,f,u,p,r,k=h.drag().subject(Object);k.on("start",function(c){c.sourceEvent.preventDefault();c.sourceEvent.stopPropagation();c=a.node().getBBox();var N=l.getObject(),h=b?c.height:c.width,k=N.TestBit(JSROOT.EAxisBits.kOppositeTitle);t=q=a.property("shift_x");f=e=a.property("shift_y");u=b?0<q:0<e;p=b?[g,g/2,0]:[0,g/2,g];h=b?-h/2:h/2;"middle"==l.title_align?(p[0]+=h,p[2]-=h):"begin"==
l.title_align?(p[1]-=h,p[2]-=2*h):(p[0]+=2*h,p[1]+=h);r=N.TestBit(JSROOT.EAxisBits.kCenterTitle)?1:d^k?0:2;p[r]=b?e:q;v=a.append("rect").classed("zoom",!0).attr("x",c.x).attr("y",c.y).attr("width",c.width).attr("height",c.height).style("cursor","move")}).on("drag",function(c){if(v){c.sourceEvent.preventDefault();c.sourceEvent.stopPropagation();q+=c.dx;e+=c.dy;var d;var g=b?e:q;c=0;for(d=1;3>d;++d)Math.abs(g-p[d])<Math.abs(g-p[c])&&(c=d);b?(g=q,d=p[c]):(d=e,g=p[c]);u===(b?0<g:0<d)&&(t=g,f=d,r=c,a.attr("transform",
"translate("+t+","+f+")"))}}).on("end",function(d){if(v){d.sourceEvent.preventDefault();d.sourceEvent.stopPropagation();a.property("shift_x",t).property("shift_y",f);var g=l.getObject();d=JSROOT.EAxisBits;var q=function(a,b){g.TestBit(a)!=b&&g.InvertBit(a)};g.fTitleOffset=(b?t:f)/c;1==r?(q(d.kCenterTitle,!0),q(d.kOppositeTitle,!1)):0==r?(q(d.kCenterTitle,!1),q(d.kOppositeTitle,!0)):(q(d.kCenterTitle,!1),q(d.kOppositeTitle,!1));v.remove();v=null}});a.style("cursor","move").call(k)}};n.prototype.drawTicks=
function(a,b,c,d,g,l,v){var q="",e="",f=0,h=0;for(this.ticks=[];b.next(!0);){var u=Math.round(d/4);3>b.kind&&(u=Math.round(d/2));1==b.kind&&(null!==this.format(b.tick,!0)&&(u=d),this.ticks.push(b.grpos));if(0<g)var p=-u;else 0>c?(p=-u,u=0):p=0;0==q.length?(q=this.vertical?"M"+u+","+b.grpos:"M"+b.grpos+","+-u,e=this.vertical?"M"+(l-u)+","+b.grpos:"M"+b.grpos+","+(l+u)):(q+=this.vertical?"m"+(u-h)+","+(b.grpos-f):"m"+(b.grpos-f)+","+(h-u),e+=this.vertical?"m"+(h-u)+","+(b.grpos-f):"m"+(b.grpos-f)+","+
(u-h));q+=this.vertical?"h"+(p-u):"v"+(u-p);e+=this.vertical?"h"+(u-p):"v"+(p-u);f=b.grpos;h=p}0<q.length&&v&&a.append("svg:path").attr("d",q).call(this.lineatt.func);0!==l&&0<e.length&&v&&a.append("svg:path").attr("d",e).call(this.lineatt.func)};n.prototype.findLabelModifier=function(a,b,c){if(!a.fModLabs)return null;for(var d=0;d<a.fModLabs.arr.length;++d){var g=a.fModLabs.arr[d];if(g.fLabNum===b+1||0>g.fLabNum&&b===c+g.fLabNum)return g}return null};n.prototype.drawLabels=function(a,b,c,d,g,l,e,
q,f,t,k){function v(a){var b=this.result_width;G=Math.max(G,b);if(b&&(!a.vertical&&!m||a.vertical&&m)&&!a.log){var c=.45*this.gap_before+.45*this.gap_after;this.gap_before?this.gap_after||(c=.9*this.gap_before):c=.9*this.gap_after;n=Math.min(n,c/b)}else a.vertical&&k&&this.normal_side&&20<k-q&&b>k-q&&(n=Math.min(n,(k-q)/b));.01<n&&.7>n&&!a.vertical&&!m&&5<w&&1==y.length&&(C=!0);b=n*(C?3:1);.01<b&&1>b&&(z=1/b,a.scaleTextDrawing(z,y[0]))}var p=this,N=this.getColor(b.fLabelColor),V=this.isCenteredLabels(),
m=b.TestBit(JSROOT.EAxisBits.kLabelsVert),n=1,w=0,z=0,y=[a.append("svg:g").attr("class","axis_labels")];g=g.lbl_pos||g.major;var C=!1,G=0;this.lbls_both_sides&&y.push(a.append("svg:g").attr("class","axis_labels").attr("transform",this.vertical?"translate("+c+",0)":"translate(0,"+-d+")"));var B=new JSROOT.FontHandler(b.fLabelFont,e);for(a=0;a<y.length;++a){0<a&&(l=-l);var I=0,E=this.vertical?-q*l:(q+2)*l+t*f;this.startTextDrawing(B,"font",y[a]);for(var F=0;F<g.length;++F){var M=this.format(g[F],!0);
if(null!==M){var D=this.findLabelModifier(b,F,g.length);if(!D||0!=D.fTextSize){D&&D.fLabText&&(M=D.fLabText);var x={text:M,color:N,latex:1,draw_g:y[a],normal_side:0==a},A=Math.round(this.func(g[F]));D&&0<D.fTextColor&&(x.color=this.getColor(D.fTextColor));x.gap_before=0<F?Math.abs(Math.round(A-this.func(g[F-1]))):0;x.gap_after=F<g.length-1?Math.abs(Math.round(this.func(g[F+1])-A)):0;if(V&&(D=x.gap_after||x.gap_before,A=Math.round(A-(this.vertical?.5*D:-.5*D)),-5>A||A>(this.vertical?d:c)+5))continue;
w=Math.max(w,M.length);this.vertical?(x.x=E,x.y=A,x.align=m?0>l?23:20:0>l?12:32):(x.x=A,x.y=E,x.align=m?0>l?12:32:0>l?20:23);m&&(x.rotate=270);0==a&&(x.post_process=v);this.drawText(x);I&&A!=I&&(this.vertical&&!m||!this.vertical&&m)&&(n=Math.min(n,.9*Math.abs(A-I)/e));I=A}}}this.order&&this.drawText({color:N,x:this.vertical?5*l:c+5,y:this.has_obstacle?E:this.vertical?-3:-3*l,align:this.vertical?0>l?30:10:this.has_obstacle^0>l?13:10,latex:1,text:"#times"+this.formatExp(10,this.order),draw_g:y[a]})}return this.finishTextDrawing(y[0]).then(function(){return 1<
y.length?(z&&p.scaleTextDrawing(z,y[1]),p.finishTextDrawing(y[1])):!0}).then(function(){C&&y[0].selectAll("text").each(function(){var a=h.select(this),b=a.attr("transform");a.attr("transform",b+" rotate(25)").style("text-anchor","start")});B&&(e=B.size);return[e,G]})};n.prototype.drawAxis=function(a,b,c,d,g,l,e,q){var v=this,f=this.getObject(),h="",k=f&&"TGaxis"===f._typename,p=a,r=.03,m,n=!0,w=(m=this.getPadPainter())?m.getPadWidth():10,B=m?m.getPadHeight():10,z=this.vertical,y=this.swap_side||!1;
g?this.invert_side&&(g=-g):g=0;k?(this.createAttLine({attr:f}),n=0!=f.fLineColor,h=f.fChopt,r=f.fTickSize,m=z?1.7*c:.6*b):(this.createAttLine({color:f.fAxisColor,width:1,style:1}),h=z^this.invert_side?"-S":"+S",r=f.fTickLength,m=z?w:B);this.lineatt.not_standard=!0;k&&"zaxis"!==this.name||(p=a.select("."+this.name+"_container"),p.empty()?p=a.append("svg:g").attr("class",this.name+"_container"):p.selectAll("*").remove());!l&&n&&p.append("svg:path").attr("d","M0,0"+(z?"v"+c:"h"+b)).call(this.lineatt.func);
p.attr("transform",d||null);var C=1;a=0;var G=Math.min(w,B),E=0<=h.indexOf("+"),I=0<=h.indexOf("-"),K=0<=h.indexOf("S");d=0<=h.indexOf("U")||this.optionUnlab;var F=0<=h.indexOf("N");h=0<=h.indexOf("I");var M=f.TestBit(JSROOT.EAxisBits.kNoExponent);0>=G&&(G=1E-4);k&&f.TestBit(JSROOT.EAxisBits.kTickPlus)&&(E=!0);k&&f.TestBit(JSROOT.EAxisBits.kTickMinus)&&(I=!0);E&&I?a=C=1:I?C=y^z?1:-1:E&&(C=y^z?-1:1);r=Math.round((K?r:.03)*m);this.max_tick_size&&r>this.max_tick_size&&(r=this.max_tick_size);m=this.createTicks(!1,
M,F,h);this.drawTicks(p,m,C,r,a,g,n&&!l&&!this.disable_ticks);g=Math.round(1>f.fLabelSize?f.fLabelSize*G:f.fLabelSize);var D=Math.round(Math.abs(f.fLabelOffset)*G);if(0>=g||1.1<Math.abs(f.fLabelOffset))d=!0;var x=0,A=0,H=null,L=null,O=0,J=0;return(l||d?Promise.resolve([g,0]):this.drawLabels(p,f,b,c,m,C,g,D,r,a,e)).then(function(a){J=a[1];if(JSROOT.settings.Zooming&&!v.disable_zooming&&!JSROOT.batch_mode){var d=a[0];a=p.append("svg:rect").attr("class","axis_zoom").style("opacity","0").style("cursor",
"crosshair");z?(d=(J||2*d)+3,a.attr("x",0<C?-d:0).attr("y",0).attr("width",d).attr("height",c)):a.attr("x",0).attr("y",0<C?0:-d-3).attr("width",b).attr("height",d+3)}v.position=0;if(q){a=p.node();d=v.getPadSvg().node();if(a&&d&&a.getBoundingClientRect&&d.getBoundingClientRect){var g=a.getBoundingClientRect(),e=d.getBoundingClientRect();v.position=g.left-e.left}a&&!d&&console.warn("Why PAD element missing when search for position")}if(!f.fTitle||l)return!0;H=p.append("svg:g").attr("class","axis_title");
O=1<=f.fTitleSize?f.fTitleSize:Math.round(f.fTitleSize*G);a=1.6*(1>f.fTitleSize?f.fTitleSize:f.fTitleSize/(G||10));d=f.TestBit(JSROOT.EAxisBits.kCenterTitle);var h=f.TestBit(JSROOT.EAxisBits.kOppositeTitle);g=f.TestBit(JSROOT.EAxisBits.kRotateTitle)?-1:1;e=v.getColor(k?f.fTextColor:f.fTitleColor);v.startTextDrawing(f.fTitleFont,O,H);h^=y;v.title_align=d?"middle":0>g^h?"begin":"end";if(z){a*=-C*w;x=Math.round(a*f.fTitleOffset);if("zaxis"==v.name&&k&&"getBoundingClientRect"in p.node()){var t=p.node().getBoundingClientRect();
x<t.width-r&&(x=Math.round(t.width-r))}A=Math.round(d?c/2:h?c:0);v.drawText({align:v.title_align+";middle",rotate:0>g?90:270,text:f.fTitle,color:e,draw_g:H})}else a*=C*B,x=Math.round(d?b/2:h?0:b),A=Math.round(a*f.fTitleOffset),v.drawText({align:v.title_align+";middle",rotate:0>g?180:0,text:f.fTitle,color:e,draw_g:H});z&&0==f.fTitleOffset&&"getBoundingClientRect"in p.node()&&(L=p.node().getBoundingClientRect());v.addTitleDrag(H,z,a,y,z?c:b);return v.finishTextDrawing(H)}).then(function(){if(H){if(L){var a=
H.node().getBoundingClientRect();x=L.left!=L.right&&a.left!=a.right?0<C?Math.round(L.left-a.right-.3*O):Math.round(L.right-a.left+.3*O):-1*Math.round((0<C?D+J:0)+.7*O)}H.attr("transform","translate("+x+","+A+")").property("shift_x",x).property("shift_y",A)}return v})};n.prototype.convertTo=function(a){var b=this.getObject(),c=this.axisToSvg("x",b.fX1),d=this.axisToSvg("y",b.fY1),g=this.axisToSvg("x",b.fX2),l=this.axisToSvg("y",b.fY2);if("ndc"==a){a=this.getPadPainter().getPadWidth();var f=this.getPadPainter().getPadHeight();
b.fX1=c/a;b.fX2=g/a;b.fY1=(f-d)/f;b.fY2=(f-l)/f;this.use_ndc=!0}else"frame"==a&&(a=this.getFramePainter().getFrameRect(),b.fX1=(c-a.x)/a.width,b.fX2=(g-a.x)/a.width,b.fY1=(d-a.y)/a.height,b.fY2=(l-a.y)/a.height,this.bind_frame=!0)};n.prototype.redraw=function(){var a=this.getObject();if(this.bind_frame){var b=this.getFramePainter().getFrameRect();var c=Math.round(b.x+a.fX1*b.width);var d=Math.round(b.x+a.fX2*b.width);var g=Math.round(b.y+a.fY1*b.height);b=Math.round(b.y+a.fY2*b.height)}else c=this.axisToSvg("x",
a.fX1,this.use_ndc),g=this.axisToSvg("y",a.fY1,this.use_ndc),d=this.axisToSvg("x",a.fX2,this.use_ndc),b=this.axisToSvg("y",a.fY2,this.use_ndc);var l=d-c,f=g-b,q=Math.abs(l)<Math.abs(f),e=q?f:l,h=!1,k=a.fWmin,u=a.fWmax;0>e&&(h=!0,e=-e,q?b=g:c=d);this.configureAxis(q?"yaxis":"xaxis",k,u,k,u,q,[0,e],{time_scale:0<=a.fChopt.indexOf("t"),log:0<=a.fChopt.indexOf("G")?1:0,reverse:h,swap_side:h});this.createG();return this.drawAxis(this.getG(),Math.abs(l),Math.abs(f),"translate("+c+","+b+")")};var J=function(a,
b){var c=Math.PI/180;a=a/2*c;b*=c;var d=Math.sqrt(2),g=2*d/Math.PI,l=Math.cos(b),f=Math.sqrt(1+l*Math.cos(a));return{x:l*Math.sin(a)*2*d/f/g/c,y:Math.sin(b)*d/f/g/c}},T=function(a,b){return{x:a,y:Math.log(Math.tan((Math.PI/2+b/180*Math.PI)/2))}},w=function(a,b){return{x:a*Math.cos(b/180*Math.PI),y:b}},E=function(a,b){return{x:a*(2*Math.cos(2*b/180*Math.PI/3)-1),y:180*Math.sin(b/180*Math.PI/3)}};k.prototype=Object.create(JSROOT.ObjectPainter.prototype);k.prototype.getFramePainter=function(){return this};
k.prototype.is_root6=function(){return!0};k.prototype.getObject=function(a){return"xaxis"===a?this.xaxis:"yaxis"===a?this.yaxis:JSROOT.ObjectPainter.prototype.getObject.call(this)};k.prototype.setFrameActive=function(a){this.enabledKeys=a&&JSROOT.settings.HandleKeys?!0:!1;this.control&&(this.control.enableKeys=this.enabledKeys)};k.prototype.shrinkFrame=function(a,b){this.fX1NDC+=a;this.fX2NDC-=b};k.prototype.setLastEventPos=function(a){this.fLastEventPnt=a};k.prototype.getLastEventPos=function(){return this.fLastEventPnt};
k.prototype.getProjectionFunc=function(){switch(this.projection){case 1:return J;case 2:return T;case 3:return w;case 4:return E}};k.prototype.recalculateRange=function(a){this.projection=a||0;2==this.projection&&(-90>=this.scale_ymin||90<=this.scale_ymax)&&(console.warn("Mercator Projection","Latitude out of range",this.scale_ymin,this.scale_ymax),this.projection=0);var b=this.getProjectionFunc();if(b)for(a=[b(this.scale_xmin,this.scale_ymin),b(this.scale_xmin,this.scale_ymax),b(this.scale_xmax,
this.scale_ymax),b(this.scale_xmax,this.scale_ymin)],0>this.scale_xmin&&0<this.scale_xmax&&(a.push(b(0,this.scale_ymin)),a.push(b(0,this.scale_ymax))),0>this.scale_ymin&&0<this.scale_ymax&&(a.push(b(this.scale_xmin,0)),a.push(b(this.scale_xmax,0))),this.original_xmin=this.scale_xmin,this.original_xmax=this.scale_xmax,this.original_ymin=this.scale_ymin,this.original_ymax=this.scale_ymax,this.scale_xmin=this.scale_xmax=a[0].x,this.scale_ymin=this.scale_ymax=a[0].y,b=1;b<a.length;++b)this.scale_xmin=
Math.min(this.scale_xmin,a[b].x),this.scale_xmax=Math.max(this.scale_xmax,a[b].x),this.scale_ymin=Math.min(this.scale_ymin,a[b].y),this.scale_ymax=Math.max(this.scale_ymax,a[b].y)};k.prototype.setAxesRanges=function(a,b,c,d,g,l,f,e,h){this.ranges_set=!0;this.xaxis=a;this.xmin=b;this.xmax=c;this.yaxis=d;this.ymin=g;this.ymax=l;this.zaxis=f;this.zmin=e;this.zmax=h};k.prototype.setAxes2Ranges=function(a,b,c,d,g,l,f,e){a&&(this.x2axis=b,this.x2min=c,this.x2max=d);g&&(this.y2axis=l,this.y2min=f,this.y2max=
e)};k.prototype.getAxis=function(a){switch(a){case "x":return this.xaxis;case "y":return this.yaxis;case "z":return this.zaxis;case "x2":return this.x2axis;case "y2":return this.y2axis}return null};k.prototype.applyPadUserRange=function(a,b){if(a){var c=a["fU"+b+"min"],d=a["fU"+b+"max"],g=1E-7;if("x"==b){if(Math.abs(a.fX1)>g||Math.abs(a.fX2-1)>g)d=a.fX2-a.fX1,c=a.fX1+d*a.fLeftMargin,d=a.fX2-d*a.fRightMargin}else if(Math.abs(a.fY1)>g||Math.abs(a.fY2-1)>g)d=a.fY2-a.fY1,c=a.fY1+d*a.fBottomMargin,d=a.fY2-
d*a.fTopMargin;if(!(c>=d||Math.abs(c)<g&&Math.abs(d-1)<g)){0<a["fLog"+b]&&(c=Math.exp(c*Math.log(10)),d=Math.exp(d*Math.log(10)));a=b;this.swap_xy&&(a="x"==b?"y":"x");b="scale_"+a+"min";var l="scale_"+a+"max";g=1E-7*(this[l]-this[b]);if(Math.abs(c-this[b])>g||Math.abs(d-this[l])>g)this["zoom_"+a+"min"]=c,this["zoom_"+a+"max"]=d}}};k.prototype.createXY=function(a){var b=this;this.cleanXY();a||(a={ndim:1});this.swap_xy=a.swap_xy||!1;this.reverse_x=a.reverse_x||!1;this.reverse_y=a.reverse_y||!1;this.logx=
this.logy=0;var c=this.getFrameWidth(),d=this.getFrameHeight(),g=this.getPadPainter().getRootPad();this.scale_xmin=this.xmin;this.scale_xmax=this.xmax;this.scale_ymin=this.ymin;this.scale_ymax=this.ymax;a.extra_y_space&&(this.scale_ymax=(this.swap_xy?g.fLogx:g.fLogy)&&0<this.scale_ymax?Math.exp(1.1*Math.log(this.scale_ymax)):this.scale_ymax+.1*(this.scale_ymax-this.scale_ymin));if(a.check_pad_range){var l=function(a){if(!b.zoomChangedInteractive(a)){b["zoom_"+a+"min"]=b["zoom_"+a+"max"]=0;var c=b.getAxis(a);
c&&c.TestBit(JSROOT.EAxisBits.kAxisRange)&&c.fFirst!==c.fLast&&(1<c.fFirst||c.fLast<c.fNbins)&&(b["zoom_"+a+"min"]=1<c.fFirst?c.GetBinLowEdge(c.fFirst):c.fXmin,b["zoom_"+a+"max"]=c.fLast<c.fNbins?c.GetBinLowEdge(c.fLast+1):c.fXmax,c.InvertBit(JSROOT.EAxisBits.kAxisRange),c.fFirst=1,c.fLast=c.fNbins)}};l("x");1<a.ndim&&l("y");2<a.ndim&&l("z");"pad_range"===a.check_pad_range&&(l=this.getCanvPainter(),l&&l.online_canvas||(this.applyPadUserRange(g,"x"),this.applyPadUserRange(g,"y")))}a.zoom_ymin==a.zoom_ymax||
this.zoom_ymin!=this.zoom_ymax||this.zoomChangedInteractive("y")||(this.zoom_ymin=a.zoom_ymin,this.zoom_ymax=a.zoom_ymax);this.zoom_xmin!=this.zoom_xmax&&(this.scale_xmin=this.zoom_xmin,this.scale_xmax=this.zoom_xmax);this.zoom_ymin!=this.zoom_ymax&&(this.scale_ymin=this.zoom_ymin,this.scale_ymax=this.zoom_ymax);this.recalculateRange(a.Proj);this.x_handle=new n(this.getDom(),this.xaxis,!0);this.x_handle.setPadName(this.getPadName());this.x_handle.configureAxis("xaxis",this.xmin,this.xmax,this.scale_xmin,
this.scale_xmax,this.swap_xy,this.swap_xy?[0,d]:[0,c],{reverse:this.reverse_x,log:this.swap_xy?g.fLogy:g.fLogx,symlog:this.swap_xy?a.symlog_y:a.symlog_x,logcheckmin:this.swap_xy,logminfactor:1E-4});this.x_handle.assignFrameMembers(this,"x");this.y_handle=new n(this.getDom(),this.yaxis,!0);this.y_handle.setPadName(this.getPadName());this.y_handle.configureAxis("yaxis",this.ymin,this.ymax,this.scale_ymin,this.scale_ymax,!this.swap_xy,this.swap_xy?[0,c]:[0,d],{reverse:this.reverse_y,log:this.swap_xy?
g.fLogx:g.fLogy,symlog:this.swap_xy?a.symlog_x:a.symlog_y,logcheckmin:2>a.ndim||this.swap_xy,log_min_nz:a.ymin_nz&&a.ymin_nz<.01*this.ymax?.3*a.ymin_nz:0,logminfactor:3E-4});this.y_handle.assignFrameMembers(this,"y");this.setRootPadRange(g)};k.prototype.createXY2=function(a){a||(a={});this.reverse_x2=a.reverse_x||!1;this.reverse_y2=a.reverse_y||!1;this.logx2=this.logy2=0;var b=this.getFrameWidth(),c=this.getFrameHeight(),d=this.getPadPainter().getRootPad();a.second_x&&(this.scale_x2min=this.x2min,
this.scale_x2max=this.x2max);a.second_y&&(this.scale_y2min=this.y2min,this.scale_y2max=this.y2max);a.extra_y_space&&a.second_y&&(this.scale_y2max=(this.swap_xy?d.fLogx:d.fLogy)&&0<this.scale_y2max?Math.exp(1.1*Math.log(this.scale_y2max)):this.scale_y2max+.1*(this.scale_y2max-this.scale_y2min));this.zoom_x2min!=this.zoom_x2max&&a.second_x&&(this.scale_x2min=this.zoom_x2min,this.scale_x2max=this.zoom_x2max);this.zoom_y2min!=this.zoom_y2max&&a.second_y&&(this.scale_y2min=this.zoom_y2min,this.scale_y2max=
this.zoom_y2max);a.second_x&&(this.x2_handle=new n(this.getDom(),this.x2axis,!0),this.x2_handle.setPadName(this.getPadName()),this.x2_handle.configureAxis("x2axis",this.x2min,this.x2max,this.scale_x2min,this.scale_x2max,this.swap_xy,this.swap_xy?[0,c]:[0,b],{reverse:this.reverse_x2,log:this.swap_xy?d.fLogy:d.fLogx,logcheckmin:this.swap_xy,logminfactor:1E-4}),this.x2_handle.assignFrameMembers(this,"x2"));a.second_y&&(this.y2_handle=new n(this.getDom(),this.y2axis,!0),this.y2_handle.setPadName(this.getPadName()),
this.y2_handle.configureAxis("y2axis",this.y2min,this.y2max,this.scale_y2min,this.scale_y2max,!this.swap_xy,this.swap_xy?[0,b]:[0,c],{reverse:this.reverse_y2,log:this.swap_xy?d.fLogx:d.fLogy,logcheckmin:2>a.ndim||this.swap_xy,log_min_nz:a.ymin_nz&&a.ymin_nz<.01*this.y2max?.3*a.ymin_nz:0,logminfactor:3E-4}),this.y2_handle.assignFrameMembers(this,"y2"))};k.prototype.getGrFuncs=function(a,b){a=a&&this.grx2;b=b&&this.gry2;return a||b?{use_x2:a,grx:a?this.grx2:this.grx,logx:this.logx,x_handle:a?this.x2_handle:
this.x_handle,scale_xmin:a?this.scale_x2min:this.scale_xmin,scale_xmax:a?this.scale_x2max:this.scale_xmax,use_y2:b,gry:b?this.gry2:this.gry,logy:this.logy,y_handle:b?this.y2_handle:this.y_handle,scale_ymin:b?this.scale_y2min:this.scale_ymin,scale_ymax:b?this.scale_y2max:this.scale_ymax,swap_xy:this.swap_xy,fp:this,revertAxis:function(a,b){"x"==a&&this.use_x2&&(a="x2");"y"==a&&this.use_y2&&(a="y2");return this.fp.revertAxis(a,b)},axisAsText:function(a,b){"x"==a&&this.use_x2&&(a="x2");"y"==a&&this.use_y2&&
(a="y2");return this.fp.axisAsText(a,b)}}:this};k.prototype.setRootPadRange=function(a,b){if(a&&this.ranges_set){b?(a.fUxmin=a.fUymin=-.9,a.fUxmax=a.fUymax=.9):(a.fLogx=this.swap_xy?this.logy:this.logx,a.fUxmin=a.fLogx?Math.log10(this.scale_xmin):this.scale_xmin,a.fUxmax=a.fLogx?Math.log10(this.scale_xmax):this.scale_xmax,a.fLogy=this.swap_xy?this.logx:this.logy,a.fUymin=a.fLogy?Math.log10(this.scale_ymin):this.scale_ymin,a.fUymax=a.fLogy?Math.log10(this.scale_ymax):this.scale_ymax);b=a.fUxmax-a.fUxmin;
var c=1-a.fLeftMargin-a.fRightMargin,d=a.fUymax-a.fUymin,g=1-a.fBottomMargin-a.fTopMargin;0>=c&&(c=.01);0>=g&&(g=.01);a.fX1=a.fUxmin-b/c*a.fLeftMargin;a.fX2=a.fUxmax+b/c*a.fRightMargin;a.fY1=a.fUymin-d/g*a.fBottomMargin;a.fY2=a.fUymax+d/g*a.fTopMargin}};k.prototype.drawGrids=function(){var a=this.getFrameSvg().select(".grid_layer");a.selectAll(".xgrid").remove();a.selectAll(".ygrid").remove();var b=this.getPadPainter(),c=b?b.getRootPad(!0):null,d=this.getFrameHeight(),g=this.getFrameWidth();b=JSROOT.gStyle.fGridStyle;
if(0>b||b>=f.root_line_styles.length)b=11;if(c&&c.fGridx&&this.x_handle){for(var l="",e=0;e<this.x_handle.ticks.length;++e)l=this.swap_xy?l+("M0,"+this.x_handle.ticks[e]+"h"+g):l+("M"+this.x_handle.ticks[e]+",0v"+d);e=0<JSROOT.gStyle.fGridColor?JSROOT.gStyle.fGridColor:this.getAxis("x")?this.getAxis("x").fAxisColor:1;e=this.getColor(e)||"black";0<l.length&&a.append("svg:path").attr("class","xgrid").attr("d",l).style("stroke",e).style("stroke-width",JSROOT.gStyle.fGridWidth).style("stroke-dasharray",
f.root_line_styles[b])}if(c&&c.fGridy&&this.y_handle){c="";for(l=0;l<this.y_handle.ticks.length;++l)c=this.swap_xy?c+("M"+this.y_handle.ticks[l]+",0v"+d):c+("M0,"+this.y_handle.ticks[l]+"h"+g);d=0<JSROOT.gStyle.fGridColor?JSROOT.gStyle.fGridColor:this.getAxis("y")?this.getAxis("y").fAxisColor:1;d=this.getColor(d)||"black";0<c.length&&a.append("svg:path").attr("class","ygrid").attr("d",c).style("stroke",d).style("stroke-width",JSROOT.gStyle.fGridWidth).style("stroke-dasharray",f.root_line_styles[b])}};
k.prototype.axisAsText=function(a,b){var c=this[a+"_handle"];return c?c.axisAsText(b,JSROOT.settings[a.toUpperCase()+"ValuesFormat"]):b.toPrecision(4)};k.prototype.hasDrawnAxes=function(a,b){return a||b?!1:this.axes_drawn};k.prototype.drawAxes=function(a,b,c,d,g){var l=this;this.cleanAxesDrawings();if(this.xmin==this.xmax||this.ymin==this.ymax)return Promise.resolve(!1);void 0===d&&(d=0);var f=this.getFrameSvg().select(".axis_layer"),e=this.getFrameWidth(),h=this.getFrameHeight(),t=this.getPadPainter().getRootPad(!0);
this.x_handle.invert_side=10<=d;this.x_handle.lbls_both_sides=!this.x_handle.invert_side&&t&&1<t.fTickx;this.x_handle.has_obstacle=g;this.y_handle.invert_side=1===d%10;this.y_handle.lbls_both_sides=!this.y_handle.invert_side&&t&&1<t.fTicky;d=this.swap_xy?this.y_handle:this.x_handle;var k=this.swap_xy?this.x_handle:this.y_handle;b&&c||(g=this.getPadPainter())&&g._fast_drawing&&(b=c=!0);if(b&&c)c=Promise.resolve(!0);else{var u=!a&&JSROOT.settings.CanAdjustFrame;b=d.drawAxis(f,e,h,d.invert_side?void 0:
"translate(0,"+h+")",t&&t.fTickx?-h:0,b,void 0,!1);c=k.drawAxis(f,e,h,k.invert_side?"translate("+e+",0)":void 0,t&&t.fTicky?e:0,c,k.invert_side?0:this._frame_x,u);c=Promise.all([b,c]).then(function(){l.drawGrids();if(u){var a=0,b=k.position;-.2*e<b&&0>b?(a=-b/e+.001,l.shrink_frame_left+=a):0<b&&b<.3*e&&0<l.shrink_frame_left&&b/e>l.shrink_frame_left&&(a=-l.shrink_frame_left,l.shrink_frame_left=0);if(0!=a)return l.shrinkFrame(a,0),l.redraw(),l.drawAxes(!0)}})}return c.then(function(){a||(l.axes_drawn=
!0);return!0})};k.prototype.drawAxes2=function(a,b){var c=this.getFrameSvg().select(".axis_layer"),d=this.getFrameWidth(),g=this.getFrameHeight(),l=this.getPadPainter().getRootPad(!0);a&&(this.x2_handle.invert_side=!0,this.x2_handle.lbls_both_sides=!1,this.x2_handle.has_obstacle=!1);b&&(this.y2_handle.invert_side=!0,this.y2_handle.lbls_both_sides=!1);a=this.swap_xy?this.y2_handle:this.x2_handle;b=this.swap_xy?this.x2_handle:this.y2_handle;if(a||b){var e=this.getPadPainter();e&&e._fast_drawing&&(a=
b=null)}var f=e=!0;a&&(e=a.drawAxis(c,d,g,a.invert_side?void 0:"translate(0,"+g+")",l&&l.fTickx?-g:0,!1,void 0,!1));b&&(f=b.drawAxis(c,d,g,b.invert_side?"translate("+d+",0)":void 0,l&&l.fTicky?d:0,!1,b.invert_side?0:this._frame_x,!1));return Promise.all([e,f])};k.prototype.updateAttributes=function(a){var b=this.getPadPainter(),c=b?b.getRootPad(!0):null,d=this.getObject();if(void 0===this.fX1NDC||a&&!this.modified_NDC)c?JSROOT.extend(this,{fX1NDC:c.fLeftMargin,fX2NDC:1-c.fRightMargin,fY1NDC:c.fBottomMargin,
fY2NDC:1-c.fTopMargin}):JSROOT.extend(this,JSROOT.settings.FrameNDC);void 0===this.fillatt&&(d?this.createAttFill({attr:d}):c&&c.fFrameFillColor?this.createAttFill({pattern:c.fFrameFillStyle,color:c.fFrameFillColor}):c?this.createAttFill({attr:c}):this.createAttFill({pattern:1001,color:0}),!d&&this.fillatt.empty()&&b&&b.iscan&&this.fillatt.setSolidColor("white"));!d&&c&&void 0!==c.fFrameLineColor?this.createAttLine({color:c.fFrameLineColor,width:c.fFrameLineWidth,style:c.fFrameLineStyle}):this.createAttLine({attr:d,
color:"black"})};k.prototype.sizeChanged=function(){var a=this.getPadPainter();if(a=a?a.getRootPad(!0):null)a.fLeftMargin=this.fX1NDC,a.fRightMargin=1-this.fX2NDC,a.fBottomMargin=this.fY1NDC,a.fTopMargin=1-this.fY2NDC,this.setRootPadRange(a);this.interactiveRedraw("pad","frame")};k.prototype.cleanXY=function(){delete this.grx;delete this.gry;delete this.grz;this.x_handle&&(this.x_handle.cleanup(),delete this.x_handle);this.y_handle&&(this.y_handle.cleanup(),delete this.y_handle);this.z_handle&&(this.z_handle.cleanup(),
delete this.z_handle);delete this.grx2;delete this.gry2;this.x2_handle&&(this.x2_handle.cleanup(),delete this.x2_handle);this.y2_handle&&(this.y2_handle.cleanup(),delete this.y2_handle)};k.prototype.cleanAxesDrawings=function(){this.x_handle&&this.x_handle.removeG();this.y_handle&&this.y_handle.removeG();this.z_handle&&this.z_handle.removeG();this.x2_handle&&this.x2_handle.removeG();this.y2_handle&&this.y2_handle.removeG();var a=this.getG();a&&(a.select(".grid_layer").selectAll("*").remove(),a.select(".axis_layer").selectAll("*").remove());
this.axes_drawn=!1};k.prototype.cleanFrameDrawings=function(){"function"===typeof this.create3DScene&&this.create3DScene(-1);this.cleanAxesDrawings();this.cleanXY();this.ranges_set=!1;this.scale_zmin=this.scale_zmax=this.scale_ymin=this.scale_ymax=this.scale_xmin=this.scale_xmax=this.zoom_zmin=this.zoom_zmax=this.zoom_ymin=this.zoom_ymax=this.zoom_xmin=this.zoom_xmax=this.zmin=this.zmax=this.ymin=this.ymax=this.xmin=this.xmax=0;this.draw_g&&(this.draw_g.select(".main_layer").selectAll("*").remove(),
this.draw_g.select(".upper_layer").selectAll("*").remove());this.zaxis=this.yaxis=this.xaxis=null;this.draw_g&&(this.draw_g.selectAll("*").remove(),this.draw_g.on("mousedown",null).on("dblclick",null).on("wheel",null).on("contextmenu",null).property("interactive_set",null),this.draw_g.remove());delete this.draw_g;this.keys_handler&&(window.removeEventListener("keydown",this.keys_handler,!1),this.keys_handler=null)};k.prototype.cleanup=function(){this.cleanFrameDrawings();delete this._click_handler;
delete this._dblclick_handler;delete this.enabledKeys;var a=this.getPadPainter();a&&a.frame_painter_ref===this&&delete a.frame_painter_ref;JSROOT.ObjectPainter.prototype.cleanup.call(this)};k.prototype.redraw=function(){var a=this,b=this.getPadPainter();b&&(b.frame_painter_ref=this);this.updateAttributes();var c=b?b.getPadRect():{width:10,height:10},d=Math.round(c.width*this.fX1NDC),g=Math.round(c.width*(this.fX2NDC-this.fX1NDC)),l=Math.round(c.height*(1-this.fY2NDC));c=Math.round(c.height*(this.fY2NDC-
this.fY1NDC));var e=!1,f=!1;b&&b.options&&(b.options.RotateFrame&&(e=!0),b.options.FixFrame&&(f=!0));if(e){b="rotate(-90,"+d+","+l+") translate("+(d-c)+","+l+")";var h=g;g=c;c=h}else b="translate("+d+","+l+")";this._frame_x=d;this._frame_y=l;this._frame_width=g;this._frame_height=c;this._frame_rotate=e;this._frame_fixpos=f;this.mode3d||(this.draw_g=this.getLayerSvg("primitives_layer").select(".root_frame"),this.draw_g.empty()?(this.draw_g=this.getLayerSvg("primitives_layer").append("svg:g").attr("class",
"root_frame"),this.draw_g.append("svg:title").text(""),d=this.draw_g.append("svg:path"),this.draw_g.append("svg:g").attr("class","grid_layer"),l=this.draw_g.append("svg:svg").attr("class","main_layer").attr("x",0).attr("y",0).attr("overflow","hidden"),this.draw_g.append("svg:g").attr("class","axis_layer"),this.draw_g.append("svg:g").attr("class","upper_layer")):(d=this.draw_g.select("path"),l=this.draw_g.select(".main_layer")),this.axes_drawn=!1,this.draw_g.attr("transform",b),d.attr("d","M0,0H"+
g+"V"+c+"H0Z").call(this.fillatt.func).call(this.lineatt.func),l.attr("width",g).attr("height",c).attr("viewBox","0 0 "+g+" "+c),JSROOT.batch_mode||(d.attr("pointer-events","visibleFill"),JSROOT.require(["interactive"]).then(function(b){b.FrameInteractive.assign(a);a.addBasicInteractivity()})))};k.prototype.changeAxisLog=function(a,b){var c=this.getPadPainter(),d=c?c.getRootPad(!0):null;if(d){c._interactively_changed=!0;c="fLog"+a;if(!d[c]){this.swap_xy&&"x"===a?a="y":this.swap_xy&&"y"===a&&(a="x");
var g=this[a+"_handle"];if(g&&"labels"===g.kind)return}if("toggle"==b||void 0===b)b=d[c]?0:1;d[c]=b;this.interactiveRedraw("pad","log"+a)}};k.prototype.toggleAxisLog=function(a){this.changeAxisLog(a,"toggle")};k.prototype.fillContextMenu=function(a,b,c){var d=this,g=this.getMainPainter(),l=this.getPadPainter(),e=l?l.getRootPad(!0):null;if("x"==b||"y"==b||"z"==b||"x2"==b||"y2"==b){var f=c||this[b+"axis"];a.add("header: "+b.toUpperCase()+" axis");a.add("Unzoom",function(){return d.unzoom(b)});e&&(a.add("sub:SetLog "+
b[0]),a.addchk(0==e["fLog"+b[0]],"linear",function(){return d.changeAxisLog(b[0],0)}),a.addchk(1==e["fLog"+b[0]],"log",function(){return d.changeAxisLog(b[0],1)}),a.addchk(2==e["fLog"+b[0]],"log2",function(){return d.changeAxisLog(b[0],2)}),a.add("endsub:"));a.addchk(f.TestBit(JSROOT.EAxisBits.kMoreLogLabels),"More log",function(){f.InvertBit(JSROOT.EAxisBits.kMoreLogLabels);d.redrawPad()});a.addchk(f.TestBit(JSROOT.EAxisBits.kNoExponent),"No exponent",function(){f.InvertBit(JSROOT.EAxisBits.kNoExponent);
d.redrawPad()});"z"===b&&g&&g.options&&g.options.Zscale&&"function"==typeof g.fillPaletteMenu&&g.fillPaletteMenu(a);if(f){var h=this[b+"_handle"];h&&"labels"==h.kind&&20<f.fNbins&&a.add("Find label",function(){return a.input("Label id").then(function(a){if(a)for(var c=0;c<f.fNbins;++c)if(h.formatLabels(c)==a)return d.zoom(b,Math.max(0,c-4),Math.min(f.fNbins,c+5))})});a.addTAxisMenu(g||this,f,b)}return!0}(c=0==a.size())?a.add("header:Frame"):a.add("separator");this.zoom_xmin!==this.zoom_xmax&&a.add("Unzoom X",
function(){return d.unzoom("x")});this.zoom_ymin!==this.zoom_ymax&&a.add("Unzoom Y",function(){return d.unzoom("y")});this.zoom_zmin!==this.zoom_zmax&&a.add("Unzoom Z",function(){return d.unzoom("z")});this.zoom_x2min!==this.zoom_x2max&&a.add("Unzoom X2",function(){return d.unzoom("x2")});this.zoom_y2min!==this.zoom_y2max&&a.add("Unzoom Y2",function(){return d.unzoom("y2")});a.add("Unzoom all",function(){return d.unzoom("all")});e&&(a.addchk(e.fLogx,"SetLogx",function(){return d.toggleAxisLog("x")}),
a.addchk(e.fLogy,"SetLogy",function(){return d.toggleAxisLog("y")}),g&&"function"===typeof g.getDimension&&1<g.getDimension()&&a.addchk(e.fLogz,"SetLogz",function(){return d.toggleAxisLog("z")}),a.add("separator"));a.addchk(this.isTooltipAllowed(),"Show tooltips",function(){return d.setTooltipAllowed("toggle")});a.addAttributesMenu(this,c?"":"Frame ");a.add("separator");a.add("Save as frame.png",function(){return l.saveAs("png","frame","frame.png")});a.add("Save as frame.svg",function(){return l.saveAs("svg",
"frame","frame.svg")});return!0};k.prototype.fillWebObjectOptions=function(a){if(!a){if(!this.snapid)return null;a={_typename:"TWebObjectOptions",snapid:this.snapid.toString(),opt:this.getDrawOpt(),fcust:"",fopt:[]}}a.fcust="frame";a.fopt=[this.scale_xmin||0,this.scale_ymin||0,this.scale_xmax||0,this.scale_ymax||0];return a};k.prototype.getFrameWidth=function(){return this._frame_width||0};k.prototype.getFrameHeight=function(){return this._frame_height||0};k.prototype.getFrameRect=function(){return{x:this._frame_x||
0,y:this._frame_y||0,width:this.getFrameWidth(),height:this.getFrameHeight(),transform:this.draw_g?this.draw_g.attr("transform"):"",hint_delta_x:0,hint_delta_y:0}};k.prototype.configureUserClickHandler=function(a){this._click_handler=a&&"function"==typeof a?a:null};k.prototype.configureUserDblclickHandler=function(a){this._dblclick_handler=a&&"function"==typeof a?a:null};k.prototype.zoom=function(a,b,c,d,g,l){var e=this;if(this.projection)return Promise.resolve(!1);"x"===a?(a=b,b=c,c=void 0):"y"===
a?(d=c,c=b,a=b=void 0):"z"===a&&(g=b,l=c,a=b=c=void 0);var f=a!==b,h=c!==d,k=g!==l,m=!1,u=!1,p=!1;if(f){var r=0;a<=this.xmin&&(a=this.xmin,r++);b>=this.xmax&&(b=this.xmax,r++);2===r&&(f=!1,m=!0)}else m=a===b&&0===a;h?(r=0,c<=this.ymin&&(c=this.ymin,r++),d>=this.ymax&&(d=this.ymax,r++),2===r&&(h=!1,u=!0)):u=c===d&&0===c;k?(r=0,g<=this.zmin&&(g=this.zmin,r++),l>=this.zmax&&(l=this.zmax,r++),2===r&&(k=!1,p=!0)):p=g===l&&0===g;var n=!1;(f||h||k)&&this.forEachPainter(function(q){"function"==typeof q.canZoomInside&&
(f&&q.canZoomInside("x",a,b)&&(e.zoom_xmin=a,e.zoom_xmax=b,n=!0,f=!1),h&&q.canZoomInside("y",c,d)&&(e.zoom_ymin=c,e.zoom_ymax=d,n=!0,h=!1),k&&q.canZoomInside("z",g,l)&&(e.zoom_zmin=g,e.zoom_zmax=l,n=!0,k=!1))});if(m||u||p)m&&(this.zoom_xmin!==this.zoom_xmax&&(n=!0),this.zoom_xmin=this.zoom_xmax=0),u&&(this.zoom_ymin!==this.zoom_ymax&&(n=!0),this.zoom_ymin=this.zoom_ymax=0),p&&(this.zoom_zmin!==this.zoom_zmax&&(n=!0),this.zoom_zmin=this.zoom_zmax=0),n||(r=this.getPadPainter())&&r.painters&&r.painters.forEach(function(a){a&&
"function"==typeof a.unzoomUserRange&&a.unzoomUserRange(m,u,p)&&(n=!0)});return n?this.interactiveRedraw("pad","zoom").then(function(){return!0}):Promise.resolve(!1)};k.prototype.zoomSingle=function(a,b,c){var d=this;if(this.projection||!this[a+"_handle"])return Promise.resolve(!1);var g=b!==c,l=!1;if(g){var e=0;b<=this[a+"min"]&&(b=this[a+"min"],e++);c>=this[a+"max"]&&(c=this[a+"max"],e++);2===e&&(g=!1,l=!0)}else l=b===c&&0===b;var f=!1;g&&this.forEachPainter(function(e){"function"==typeof e.canZoomInside&&
g&&e.canZoomInside(a[0],b,c)&&(d["zoom_"+a+"min"]=b,d["zoom_"+a+"max"]=c,f=!0,g=!1)});l&&(this["zoom_"+a+"min"]!==this["zoom_"+a+"max"]&&(f=!0),this["zoom_"+a+"min"]=this["zoom_"+a+"max"]=0);return f?this.interactiveRedraw("pad","zoom").then(function(){return!0}):Promise.resolve(!1)};k.prototype.isAxisZoomed=function(a){return this["zoom_"+a+"min"]!==this["zoom_"+a+"max"]};k.prototype.unzoom=function(a,b,c){var d=this;if("all"==a)return this.unzoom("x2").then(function(){return d.unzoom("y2")}).then(function(){return d.unzoom("xyz")});
if("x2"==a||"y2"==a)return this.zoomSingle(a,0,0).then(function(b){b&&d.zoomChangedInteractive(a,"unzoom");return b});"undefined"===typeof a?a=b=c=!0:"string"===typeof a&&(c=0<=a.indexOf("z"),b=0<=a.indexOf("y"),a=0<=a.indexOf("x"));return this.zoom(a?0:void 0,a?0:void 0,b?0:void 0,b?0:void 0,c?0:void 0,c?0:void 0).then(function(g){g&&a&&d.zoomChangedInteractive("x","unzoom");g&&b&&d.zoomChangedInteractive("y","unzoom");g&&c&&d.zoomChangedInteractive("z","unzoom");return g})};k.prototype.zoomChangedInteractive=
function(a,b){if("reset"==a)this.zoom_changed_x=this.zoom_changed_y=this.zoom_changed_z=void 0;else{if(!a||"any"==a)return this.zoom_changed_x||this.zoom_changed_y||this.zoom_changed_z;if("x"===a||"y"===a||"z"===a){a="zoom_changed_"+a;if(void 0===b)return this[a];"unzoom"===b?this[a]?delete this[a]:this[a]=!0:b&&(this[a]=!0)}}};k.prototype.revertAxis=function(a,b){return(a=this[a+"_handle"])?a.revertPoint(b):0};k.prototype.showAxisStatus=function(a,b){var c=this.getAxis(a),d=a,g="TAxis";b=h.pointer(b,
this.getFrameSvg().node());var e="x"==a?0:1;c&&(d=c.fName,g=c.fTitle||"TAxis object for "+a);this.swap_xy&&(e=1-e);c=this.revertAxis(a,b[e]);this.showObjectStatus(d,g,a+" : "+this.axisAsText(a,c),b[0]+","+b[1])};k.prototype.addKeysHandler=function(){var a=this;JSROOT.batch_mode||JSROOT.require(["interactive"]).then(function(b){b.FrameInteractive.assign(a);a.addKeysHandler()})};k.prototype.addInteractivity=function(a){var b=this;return JSROOT.batch_mode||!JSROOT.settings.Zooming&&!JSROOT.settings.ContextMenu?
Promise.resolve(!1):JSROOT.require(["interactive"]).then(function(c){c.FrameInteractive.assign(b);return b.addInteractivity(a)})};var P=function(a,b,c){var d=new k(a,b);return f.ensureTCanvas(d,!1).then(function(){"3d"==c&&(d.mode3d=!0);d.redraw();return d})};e.prototype=Object.create(JSROOT.ObjectPainter.prototype);e.prototype.isRoot6=function(){return!0};e.prototype.svg_this_pad=function(){return this.getPadSvg(this.this_pad_name)};e.prototype.getMainPainter=function(){return this.main_painter_ref||
null};e.prototype.setMainPainter=function(a,b){if(!this.main_painter_ref||b)this.main_painter_ref=a};e.prototype.cleanup=function(){this._doing_draw&&console.error("pad drawing is not completed when cleanup is called");this.painters.forEach(function(a){return a.cleanup()});var a=this.svg_this_pad();a.empty()||(a.property("pad_painter",null),this.iscan||a.remove());delete this.main_painter_ref;delete this.frame_painter_ref;delete this.pads_cache;delete this.custom_palette;delete this._pad_x;delete this._pad_y;
delete this._pad_width;delete this._pad_height;delete this._doing_draw;delete this._interactively_changed;this.painters=[];this.pad=null;this.this_pad_name=void 0;this.has_canvas=!1;f.selectActivePad({pp:this,active:!1});JSROOT.ObjectPainter.prototype.cleanup.call(this)};e.prototype.getFramePainter=function(){return this.frame_painter_ref};e.prototype.getPadWidth=function(){return this._pad_width||0};e.prototype.getPadHeight=function(){return this._pad_height||0};e.prototype.getPadRect=function(){return{x:this._pad_x||
0,y:this._pad_y||0,width:this.getPadWidth(),height:this.getPadHeight()}};e.prototype.getRootPad=function(a){return void 0===a||a?this.pad:null};e.prototype.cleanPrimitives=function(a){if(a&&"function"===typeof a)for(var b=this.painters.length-1;0<=b;--b)a(this.painters[b])&&(this.painters[b].cleanup(),this.painters.splice(b,1))};e.prototype.getCustomPalette=function(){if(this.custom_palette)return this.custom_palette;var a=this.getCanvPainter();return a?a.custom_palette:null};e.prototype.forEachPainterInPad=
function(a,b){b||(b="all");"objects"!=b&&a(this);for(var c=0;c<this.painters.length;++c){var d=this.painters[c];"function"===typeof d.forEachPainterInPad?"objects"!=b&&d.forEachPainterInPad(a,b):"pads"!=b&&a(d)}};e.prototype.forEachPainter=e.prototype.forEachPainterInPad;e.prototype.registerForPadEvents=function(a){this.pad_events_receiver=a};e.prototype.producePadEvent=function(a,b,c,d,g){"select"==a&&"function"==typeof this.selectActivePad&&this.selectActivePad(b,c,d);this.pad_events_receiver&&
this.pad_events_receiver({what:a,padpainter:b,painter:c,position:d,place:g})};e.prototype.selectObjectPainter=function(a,b,c){var d=this.iscan||!this.has_canvas,g=d?this:this.getCanvPainter();void 0===a&&(a=this);b&&!d&&(b=f.getAbsPosInCanvas(this.svg_this_pad(),b));f.selectActivePad({pp:this,active:!0});g&&g.producePadEvent("select",this,a,b,c)};e.prototype.drawActiveBorder=function(a,b){if(void 0!==b){if(this.is_active_pad===b)return;this.is_active_pad=b}void 0!==this.is_active_pad&&(a||(a=this.iscan?
this.getCanvSvg().select(".canvas_fillrect"):this.svg_this_pad().select(".root_pad_border")),(b=this.is_active_pad?new JSROOT.TAttLineHandler({style:1,width:1,color:"red"}):this.lineatt)||(b=new JSROOT.TAttLineHandler({color:"none"})),a.call(b.func))};e.prototype.createCanvasSvg=function(a,b){var c=this,d=null,g=null,e=null,h;if(0<a){if(this._fixed_size)return 1<a;g=this.getCanvSvg();if(g.empty())return!1;d=g.property("height_factor");e=this.testMainResize(a,null,d);if(!e.changed)return!1;JSROOT.batch_mode||
(h=this.getLayerSvg("btns_layer",this.this_pad_name))}else{a=this.selectDom();"static"==a.style("position")&&a.style("position","relative");g=a.append("svg").attr("class","jsroot root_canvas").property("pad_painter",this).property("current_pad","").property("redraw_by_resize",!1);this.setTopPainter();JSROOT.batch_mode&&(g.attr("xmlns","http://www.w3.org/2000/svg"),g.attr("xmlns:xlink","http://www.w3.org/1999/xlink"));g.append("svg:title").text("ROOT canvas");e=g.append("svg:path").attr("class","canvas_fillrect");
if(!JSROOT.batch_mode)e.style("pointer-events","visibleFill").on("dblclick",function(a){return c.enlargePad(a)}).on("click",function(){return c.selectObjectPainter()}).on("mouseenter",function(){return c.showObjectStatus()});g.append("svg:g").attr("class","primitives_layer");g.append("svg:g").attr("class","info_layer");JSROOT.batch_mode||(h=g.append("svg:g").attr("class","btns_layer").property("leftside","left"==JSROOT.settings.ToolBarSide).property("vertical",JSROOT.settings.ToolBarVert));if(JSROOT.settings.ContextMenu&&
!JSROOT.batch_mode)g.select(".canvas_fillrect").on("contextmenu",function(a){return c.padContextMenu(a)});d=.66;this.pad&&this.pad.fCw&&this.pad.fCh&&0<this.pad.fCw&&(d=this.pad.fCh/this.pad.fCw,.1>d||10<d)&&(d=.66);this._fixed_size?(a.style("overflow","auto"),e={width:this.pad.fCw,height:this.pad.fCh},e.width&&e.height||(e=f.getElementRect(a))):e=this.testMainResize(2,b,d)}this.createAttFill({attr:this.pad});5>=e.width||5>=e.height?(g.style("display","none"),console.warn("Hide canvas while geometry too small w="+
e.width+" h="+e.height),e.width=200,e.height=100):g.style("display",null);this._fixed_size?g.attr("x",0).attr("y",0).attr("width",e.width).attr("height",e.height).style("position","absolute"):g.attr("x",0).attr("y",0).style("width","100%").style("height","100%").style("position","absolute").style("left",0).style("top",0).style("right",0).style("bottom",0);g.attr("viewBox","0 0 "+e.width+" "+e.height).attr("preserveAspectRatio","none").property("height_factor",d).property("draw_x",0).property("draw_y",
0).property("draw_width",e.width).property("draw_height",e.height);this._pad_y=this._pad_x=0;this._pad_width=e.width;this._pad_height=e.height;b=g.select(".canvas_fillrect").attr("d","M0,0H"+e.width+"V"+e.height+"H0Z").call(this.fillatt.func);this._fast_drawing=JSROOT.settings.SmallPad&&(e.width<JSROOT.settings.SmallPad.width||e.height<JSROOT.settings.SmallPad.height);this.drawActiveBorder(b);this.alignButtons&&h&&this.alignButtons(h,e.width,e.height);return!0};e.prototype.enlargePad=function(a){a&&
(a.preventDefault(),a.stopPropagation());a=this.getCanvSvg();var b=a.property("pad_enlarged");if(!this.iscan&&this.has_canvas&&(b||this.hasObjectsToDraw()||this.painters))b?b===this.pad?(this.enlargeMain(!1),a.property("pad_enlarged",null)):console.error("missmatch with pad double click events"):(this.enlargeMain(!0,!0),a.property("pad_enlarged",this.pad));else{if(this._fixed_size||!this.enlargeMain("toggle"))return;"off"==this.enlargeMain("state")&&a.property("pad_enlarged",null)}a=this._fast_drawing;
this.checkResize(!0);this._fast_drawing!=a&&this.showPadButtons()};e.prototype.createPadSvg=function(a){var b=this;if(!this.has_canvas)return this.createCanvasSvg(a?2:0),!0;var c=this.getCanvSvg(),d=c.property("draw_width"),g=c.property("draw_height"),e=c.property("pad_enlarged"),f=!this.pad_draw_disabled&&(!e||e===this.pad),h=Math.round(this.pad.fAbsWNDC*d),k=Math.round(this.pad.fAbsHNDC*g),t=Math.round(this.pad.fAbsXlowNDC*d),m=Math.round(g*(1-this.pad.fAbsYlowNDC))-k,u=null,p=null,r=null;e===this.pad&&
(h=d,k=g,t=m=0);if(a)u=this.svg_this_pad(),p=u.select(".root_pad_border"),JSROOT.batch_mode||(r=this.getLayerSvg("btns_layer",this.this_pad_name));else{u=c.select(".primitives_layer").append("svg:svg").classed("__root_pad_"+this.this_pad_name,!0).attr("pad",this.this_pad_name).property("pad_painter",this);p=u.append("svg:path").attr("class","root_pad_border");u.append("svg:g").attr("class","primitives_layer");JSROOT.batch_mode||(r=u.append("svg:g").attr("class","btns_layer").property("leftside","left"!=
JSROOT.settings.ToolBarSide).property("vertical",JSROOT.settings.ToolBarVert));if(JSROOT.settings.ContextMenu)p.on("contextmenu",function(a){return b.padContextMenu(a)});if(!JSROOT.batch_mode)p.attr("pointer-events","visibleFill").on("dblclick",function(a){return b.enlargePad(a)}).on("click",function(){return b.selectObjectPainter()}).on("mouseenter",function(){return b.showObjectStatus()})}this.createAttFill({attr:this.pad});this.createAttLine({attr:this.pad,color0:0==this.pad.fBorderMode?"none":
""});u.attr("display",f?null:"none").attr("viewBox","0 0 "+h+" "+k).attr("preserveAspectRatio","none").attr("x",t).attr("y",m).attr("width",h).attr("height",k).property("draw_x",t).property("draw_y",m).property("draw_width",h).property("draw_height",k);this._pad_x=t;this._pad_y=m;this._pad_width=h;this._pad_height=k;p.attr("d","M0,0H"+h+"V"+k+"H0Z").call(this.fillatt.func).call(this.lineatt.func);this.drawActiveBorder(p);this._fast_drawing=JSROOT.settings.SmallPad&&(h<JSROOT.settings.SmallPad.width||
k<JSROOT.settings.SmallPad.height);u.property("can3d")===JSROOT.constants.Embed3D.Overlay&&this.selectDom().select(".draw3d_"+this.this_pad_name).style("display",f?"":"none");this.alignButtons&&r&&this.alignButtons(r,h,k);return f};e.prototype.disablePadDrawing=function(){this.pad_draw_disabled||!this.has_canvas||this.iscan||(this.pad_draw_disabled=!0,this.createPadSvg(!0))};e.prototype.checkSpecial=function(a){if(!a)return!1;if("TStyle"==a._typename)return JSROOT.extend(JSROOT.gStyle,a),!0;if("TObjArray"==
a._typename&&"ListOfColors"==a.name){if(this.options&&this.options.CreatePalette){for(var b=[],c=a.arr.length-this.options.CreatePalette;c<a.arr.length;++c){var d=f.getRGBfromTColor(a.arr[c]);if(!d){console.log("Fail to create color for palette");b=null;break}b.push(d)}b&&(this.custom_palette=new JSROOT.ColorPalette(b))}this.options&&!this.options.GlobalColors||f.adoptRootColors(a);this.options&&this.options.LocalColors&&(this.root_colors=f.extendRootColors(null,a));return!0}if("TObjArray"==a._typename&&
"CurrentColorPalette"==a.name){b=[];c=!1;for(d=0;d<a.arr.length;++d){var g=a.arr[d];g&&"TColor"==g._typename?b[d]=f.getRGBfromTColor(g):(console.log("Missing color with index "+d),c=!0)}this.options&&(c||this.options.IgnorePalette)||(this.custom_palette=new JSROOT.ColorPalette(b));return!0}return!1};e.prototype.checkSpecialsInPrimitives=function(a){if(a=a?a.fPrimitives:null)for(var b=0;b<a.arr.length;++b)this.checkSpecial(a.arr[b])&&(a.arr.splice(b,1),a.opt.splice(b,1),b--)};e.prototype.findInPrimitives=
function(a,b){var c=this.pad&&this.pad.fPrimitives?this.pad.fPrimitives.arr:null;return c?c.find(function(c){return c.fName==a&&(b?c.typename==b:!0)}):null};e.prototype.findPainterFor=function(a,b,c){return this.painters.find(function(d){if(d=d.getObject()){if(a&&d===a)return!0;if(b||c)if(!b||d.fName===b)if(!c||d._typename===c)return!0}})};e.prototype.hasObjectsToDraw=function(){var a=this.pad&&this.pad.fPrimitives?this.pad.fPrimitives.arr:null;return a&&a.find(function(a){return"TPad"!=a._typename})?
!0:!1};e.prototype.syncDraw=function(a){var b={kind:a||"redraw"};if(void 0===this._doing_draw)return this._doing_draw=[b],Promise.resolve(!0);if(!0!==b.kind&&0<this._doing_draw.findIndex(function(a,d){return 0<d&&a.kind==b.kind}))return!1;this._doing_draw.push(b);return new Promise(function(a){b.func=a})};e.prototype.confirmDraw=function(){if(void 0===this._doing_draw)return console.warn("failure, should not happen");this._doing_draw.shift();if(0==this._doing_draw.length)delete this._doing_draw;else{var a=
this._doing_draw[0];a.func&&(a.func(),delete a.func)}};e.prototype.drawPrimitives=function(a){var b=this;if(void 0===a)return this.iscan&&(this._start_tm=(new Date).getTime()),this._num_primitives=this.pad&&this.pad.fPrimitives?this.pad.fPrimitives.arr.length:0,this.syncDraw(!0).then(function(){return b.drawPrimitives(0)});if(a>=this._num_primitives){if(this._start_tm){var c=(new Date).getTime()-this._start_tm;1E3<c&&console.log("Canvas "+(this.pad?this.pad.fName:"---")+" drawing took "+(.001*c).toFixed(2)+
"s");delete this._start_tm}this.confirmDraw();return Promise.resolve()}return JSROOT.draw(this.getDom(),this.pad.fPrimitives.arr[a],this.pad.fPrimitives.opt[a]).then(function(c){c&&"object"==typeof c&&(c._primitive=!0);return b.drawPrimitives(a+1)})};e.prototype.divide=function(a,b){var c=this;if(!b){var d=a;if(2>d)return Promise.resolve(this);a=b=Math.round(Math.sqrt(d));a*b<d&&(a+=1)}if(2>a*b)return Promise.resolve(this);d=1/b;for(var g=1/a,e=0,f=[],h=0;h<b;h++){var k=1-h*d-.01,t=k-d+.02;0>t&&(t=
0);if(!(t>k))for(var m=0;m<a;m++){var u=m*g+.01,p=u+g-.02;if(!(u>p)){e++;var r=JSROOT.create("TPad");r.fName=r.fTitle=this.pad.fName+"_"+e;r.fNumber=e;this.iscan?(r.fAbsWNDC=p-u,r.fAbsHNDC=k-t,r.fAbsXlowNDC=u,r.fAbsYlowNDC=t):(r.fAbsWNDC=(p-u)*this.pad.fAbsWNDC,r.fAbsHNDC=(k-t)*this.pad.fAbsHNDC,r.fAbsXlowNDC=this.pad.fAbsXlowNDC+u*this.pad.fAbsWNDC,r.fAbsYlowNDC=this.pad.fAbsYlowNDC+t*this.pad.fAbsWNDC);f.push(r)}}}var n=function(){return 0==f.length?Promise.resolve(c):JSROOT.draw(c.getDom(),f.shift()).then(n)};
return n()};e.prototype.getSubPadPainter=function(a){for(var b=0;b<this.painters.length;++b){var c=this.painters[b];if(c.pad&&"function"===typeof c.forEachPainterInPad&&c.pad.fNumber===a)return c}return null};e.prototype.processPadTooltipEvent=function(a){var b=[],c=[];null!==this.painters&&this.painters.forEach(function(a){"function"==typeof a.processTooltipEvent&&b.push(a)});a&&(a.nproc=b.length);b.forEach(function(b){var d=b.processTooltipEvent(a);d||(d={user_info:null});c.push(d);a&&a.painters&&
(d.painter=b)});return c};e.prototype.fillContextMenu=function(a){var b=this;this.pad?a.add("header: "+this.pad._typename+"::"+this.pad.fName):a.add("header: Canvas");a.addchk(this.isTooltipAllowed(),"Show tooltips",function(){return b.setTooltipAllowed("toggle")});if(!this._websocket){var c=function(a){this.pad[a.substr(1)]=parseInt(a[0]);this.interactiveRedraw("pad",a.substr(1))};a.addchk(this.pad.fGridx,"Grid x",(this.pad.fGridx?"0":"1")+"fGridx",c);a.addchk(this.pad.fGridy,"Grid y",(this.pad.fGridy?
"0":"1")+"fGridy",c);a.add("sub:Ticks x");a.addchk(0==this.pad.fTickx,"normal","0fTickx",c);a.addchk(1==this.pad.fTickx,"ticks on both sides","1fTickx",c);a.addchk(2==this.pad.fTickx,"labels on both sides","2fTickx",c);a.add("endsub:");a.add("sub:Ticks y");a.addchk(0==this.pad.fTicky,"normal","0fTicky",c);a.addchk(1==this.pad.fTicky,"ticks on both sides","1fTicky",c);a.addchk(2==this.pad.fTicky,"labels on both sides","2fTicky",c);a.add("endsub:");a.addAttributesMenu(this)}a.add("separator");"function"==
typeof this.hasMenuBar&&"function"==typeof this.actiavteMenuBar&&a.addchk(this.hasMenuBar(),"Menu bar",function(a){return b.actiavteMenuBar(a)});"function"==typeof this.hasEventStatus&&"function"==typeof this.activateStatusBar&&a.addchk(this.hasEventStatus(),"Event status",function(){return b.activateStatusBar("toggle")});(this.enlargeMain()||this.has_canvas&&this.hasObjectsToDraw())&&a.addchk("on"==this.enlargeMain("state"),"Enlarge "+(this.iscan?"canvas":"pad"),function(){return b.enlargePad()});
c=this.this_pad_name;0===c.length&&(c=this.iscan?"canvas":"pad");a.add("Save as "+c+".png",c+".png",function(){return b.saveAs("png",!1)});a.add("Save as "+c+".svg",c+".svg",function(){return b.saveAs("svg",!1)});return!0};e.prototype.padContextMenu=function(a){var b=this;if(a.stopPropagation){var c=h.pointer(a,this.svg_this_pad().node());if(c&&2==c.length&&0<=c[0]&&10>c[0]&&0<=c[1]&&10>c[1])return;a.stopPropagation();a.preventDefault();(c=this.getFramePainter())&&c.setLastEventPos()}f.createMenu(a,
this).then(function(a){b.fillContextMenu(a);return b.fillObjectExecMenu(a,"")}).then(function(a){return a.show()})};e.prototype.redrawPad=function(a){var b=this,c=this.syncDraw(a);if(!1===c)return console.log("Prevent redrawing",this.pad.fName),Promise.resolve(!1);var d=!0,g=function(c){for(;c<b.painters.length;){var e=b.painters[c++],l=0;if(d||e.this_pad_name)l=e.redraw(a);if(f.isPromise(l))return l.then(function(){return g(c)})}return Promise.resolve(!0)};return c.then(function(){b.iscan?b.createCanvasSvg(2):
d=b.createPadSvg(!0);return g(0)}).then(function(){b.confirmDraw();if(f.getActivePad()===b){var a=b.getCanvPainter();a&&a.producePadEvent("padredraw",b)}return!0})};e.prototype.redraw=function(a){this.redrawPad(a)};e.prototype.needRedrawByResize=function(){var a=this.svg_this_pad();return a.empty()||a.property("can3d")!==JSROOT.constants.Embed3D.Overlay?0<=this.painters.findIndex(function(a){if("function"===typeof a.needRedrawByResize)return a.needRedrawByResize()}):!0};e.prototype.checkCanvasResize=
function(a,b){var c=this;if(!this.iscan&&this.has_canvas)return!1;var d=this.syncDraw("canvas_resize");if(!1===d)return!1;if(!0===a||!1===a)b=a,a=null;a&&"object"===typeof a&&a.force&&(b=!0);b||(b=this.needRedrawByResize());var g=!1,e=function(a){if(!g||a>=c.painters.length)return c.confirmDraw(),g;var d=c.painters[a].redraw(b?"redraw":"resize");f.isPromise(d)||(d=Promise.resolve());return d.then(function(){return e(a+1)})};return d.then(function(){g=c.createCanvasSvg(b?2:1,a);return e(0)})};e.prototype.updateObject=
function(a){if(!a)return!1;this.pad.fBits=a.fBits;this.pad.fTitle=a.fTitle;this.pad.fGridx=a.fGridx;this.pad.fGridy=a.fGridy;this.pad.fTickx=a.fTickx;this.pad.fTicky=a.fTicky;this.pad.fLogx=a.fLogx;this.pad.fLogy=a.fLogy;this.pad.fLogz=a.fLogz;this.pad.fUxmin=a.fUxmin;this.pad.fUxmax=a.fUxmax;this.pad.fUymin=a.fUymin;this.pad.fUymax=a.fUymax;this.pad.fX1=a.fX1;this.pad.fX2=a.fX2;this.pad.fY1=a.fY1;this.pad.fY2=a.fY2;this.pad.fLeftMargin=a.fLeftMargin;this.pad.fRightMargin=a.fRightMargin;this.pad.fBottomMargin=
a.fBottomMargin;this.pad.fTopMargin=a.fTopMargin;this.pad.fFillColor=a.fFillColor;this.pad.fFillStyle=a.fFillStyle;this.pad.fLineColor=a.fLineColor;this.pad.fLineStyle=a.fLineStyle;this.pad.fLineWidth=a.fLineWidth;this.pad.fPhi=a.fPhi;this.pad.fTheta=a.fTheta;this.iscan&&this.checkSpecialsInPrimitives(a);var b=this.getFramePainter();b&&b.updateAttributes(!b.modified_NDC);if(!a.fPrimitives)return!1;b=!1;for(var c=0,d=0;d<a.fPrimitives.arr.length;++d)for(;c<this.painters.length;){var g=this.painters[c++];
if(g._primitive){g.updateObject(a.fPrimitives.arr[d])&&(b=!0);break}}return b};e.prototype.addObjectPainter=function(a,b,c){if(a&&b&&b[c]&&void 0===a.snapid){var d=this.painters.indexOf(a);0>d&&this.painters.push(a);"function"==typeof a.setSnapId?a.setSnapId(b[c].fObjectID):a.snapid=b[c].fObjectID;a.$primary&&0<d&&this.painters[d-1].$secondary&&(this.painters[d-1].snapid=a.snapid+"#hist",console.log("ASSIGN SECONDARY HIST ID",this.painters[d-1].snapid))}};e.prototype.drawNextSnap=function(a,b){var c=
this;void 0===b&&(b=-1,this._snaps_map={},this._num_primitives=a?a.length:0);++b;if(!a||b>=a.length)return delete this._snaps_map,Promise.resolve(this);var d=a[b],g=d.fObjectID,l=this._snaps_map[g],h=null;l?l++:l=1;this._snaps_map[g]=l;for(var k=0;k<this.painters.length;++k)if(this.painters[k].snapid===g&&0===--l){h=this.painters[k];break}if(h){if(3===d.fKind)return h.redrawPadSnap(d).then(function(){return c.drawNextSnap(a,b)});var m;1===d.fKind?h.updateObject(d.fSnapshot,d.fOption)&&(m=h.redraw()):
2===d.fKind&&h.updateObject(d.fSnapshot)&&(m=h.redraw());f.isPromise(m)||(m=Promise.resolve(!0));return m.then(function(){return c.drawNextSnap(a,b)})}if(5===d.fKind)return JSROOT.extend(JSROOT.gStyle,d.fSnapshot),this.drawNextSnap(a,b);if(4===d.fKind){g=[];l=d.fSnapshot.fOper.split(";");for(h=0;h<l.length;++h)k=l[h],m=k.indexOf(":"),0<m?g[parseInt(k.substr(0,m))]="rgb("+k.substr(m+1)+")":(m=k.indexOf("="),g[parseInt(k.substr(0,m))]="rgba("+k.substr(m+1)+")");this.options&&!this.options.GlobalColors||
f.adoptRootColors(g);this.options&&this.options.LocalColors&&(this.root_colors=f.extendRootColors(null,g));if(d.fSnapshot.fBuf&&(!this.options||!this.options.IgnorePalette)){l=[];for(h=0;h<d.fSnapshot.fBuf.length;++h)l[h]=g[Math.round(d.fSnapshot.fBuf[h])];this.custom_palette=new JSROOT.ColorPalette(l)}return this.drawNextSnap(a,b)}if(3===d.fKind){g=d.fSnapshot;g.fPrimitives=null;var t=new e(this.getDom(),g,!1);t.decodeOptions(d.fOption);t.addToPadPrimitives(this.this_pad_name);t.snapid=d.fObjectID;
t.createPadSvg();t.matchObjectType("TPad")&&0<d.fPrimitives.length&&t.addPadButtons(!0);var n=t.selectCurrentPad(t.this_pad_name);return t.drawNextSnap(d.fPrimitives).then(function(){t.selectCurrentPad(n);return c.drawNextSnap(a,b)})}return 1===d.fKind||2===d.fKind?JSROOT.draw(this.getDom(),d.fSnapshot,d.fOption).then(function(d){c.addObjectPainter(d,a,b);return c.drawNextSnap(a,b)}):this.drawNextSnap(a,b)};e.prototype.findSnap=function(a){if(this.snapid===a)return this;if(!this.painters)return null;
for(var b=0;b<this.painters.length;++b){var c=this.painters[b];"function"===typeof c.findSnap?c=c.findSnap(a):c.snapid!==a&&(c=null);if(c)return c}return null};e.prototype.redrawPadSnap=function(a){var b=this;if(!a||!a.fPrimitives)return Promise.resolve(this);this.is_active_pad=!!a.fActive;this._readonly=void 0===a.fReadOnly?!0:a.fReadOnly;var c=a.fSnapshot;c.fPrimitives=null;if(void 0===this.snapid){this.snapid=a.fObjectID;this.pad=this.draw_object=c;!this.batch_mode||c.fCw&&c.fCh||(c.fCw=900,c.fCh=
700);c.fCw&&c.fCh||(this._fixed_size=!1);!JSROOT.BrowserLayout||this.batch_mode||this.use_openui||this.brlayout||(c=this.selectDom().attr("id"))&&"string"==typeof c&&(this.brlayout=new JSROOT.BrowserLayout(c,null,this),this.brlayout.create(c,!0),this.setDom(this.brlayout.drawing_divid()),f.registerForResize(this.brlayout));this.createCanvasSvg(0);this.batch_mode||this.addPadButtons(!0);if(a.fScripts&&"string"==typeof a.fScripts){c="";0==a.fScripts.indexOf("load:")?c=a.fScripts:0==a.fScripts.indexOf("assert:")&&
(c=a.fScripts.substr(7));if(c)return JSROOT.require(c).then(function(){return b.drawNextSnap(a.fPrimitives)});console.log("Calling eval "+a.fScripts.length);eval(a.fScripts);console.log("Calling eval done")}return this.drawNextSnap(a.fPrimitives)}this.updateObject(c);this.iscan?this.createCanvasSvg(2):this.createPadSvg(!0);c=function(a,b,c,d){(a=a.find(function(a){if(void 0!==a.snapid&&a.matchObjectType(c)&&(!d||a.getObject()&&a.getObject().fName===d))return!0}))&&(b=b.find(function(a){if(1===a.fKind&&
a.fSnapshot&&a.fSnapshot._typename===c&&(!d||a.fSnapshot.fName===d))return!0}))&&a.snapid!==b.fObjectID&&(a.snapid=b.fObjectID)};c(this.painters,a.fPrimitives,"TFrame");c(this.painters,a.fPrimitives,"TPaveText","title");for(var d=c=!1,g=0;g<this.painters.length;++g){var e=this.painters[g];if(void 0!==e.snapid&&!e.$secondary){for(var h=0;h<a.fPrimitives.length;++h)if(a.fPrimitives[h].fObjectID===e.snapid){e=null;c=!0;break}e&&(console.log("Remove painter "+g+" from "+this.painters.length+" class "+
e.getClassName()),this.painters.splice(g--,1),e.cleanup(),d=!0)}}d&&delete this.pads_cache;if(!c){var k=this.getFramePainter();this.painters.forEach(function(a){k!==a&&a.cleanup()});delete this.main_painter_ref;this.painters=[];k&&(this.painters.push(k),k.cleanFrameDrawings(),k.redraw());this.removePadButtons&&this.removePadButtons();this.addPadButtons(!0)}var m=this.selectCurrentPad(this.this_pad_name);return this.drawNextSnap(a.fPrimitives).then(function(){var a=[];b.painters.forEach(function(b){if(void 0===
b.snapid||b.$secondary)b=b.redraw(),f.isPromise(b)&&a.push(b)});return Promise.all(a)}).then(function(){b.selectCurrentPad(m);if(f.getActivePad()===b){var a=b.getCanvPainter();a&&a.producePadEvent("padredraw",b)}return b})};e.prototype.createImage=function(a){return"pdf"==a?Promise.resolve(btoa("dummy PDF file")):"png"==a||"jpeg"==a||"svg"==a?this.produceImage(!0,a).then(function(b){if(!b||"svg"==a)return b;var c=b.indexOf("base64,");return 0<c?b.substr(c+7):""}):Promise.resolve("")};e.prototype.getWebPadOptions=
function(a){var b=void 0===a,c=null,d=!0;if(b&&this._readonly)return"";"only_this"===a&&(b=!0,d=!1);b&&(a=[]);this.snapid&&(c={_typename:"TWebPadOptions",snapid:this.snapid.toString(),active:!!this.is_active_pad,bits:0,primitives:[],logx:this.pad.fLogx,logy:this.pad.fLogy,logz:this.pad.fLogz,gridx:this.pad.fGridx,gridy:this.pad.fGridy,tickx:this.pad.fTickx,ticky:this.pad.fTicky,mleft:this.pad.fLeftMargin,mright:this.pad.fRightMargin,mtop:this.pad.fTopMargin,mbottom:this.pad.fBottomMargin,zx1:0,zx2:0,
zy1:0,zy2:0,zz1:0,zz2:0},this.iscan&&(c.bits=this.getStatusBits()),this.getPadRanges(c)?a.push(c):console.log("fail to get ranges for pad "+this.pad.fName));this.painters.forEach(function(b){if("function"==typeof b.getWebPadOptions)d&&b.getWebPadOptions(a);else if(b.snapid){var g={_typename:"TWebObjectOptions",snapid:b.snapid.toString(),opt:b.getDrawOpt(),fcust:"",fopt:[]};"function"==typeof b.fillWebObjectOptions&&(g=b.fillWebObjectOptions(g));c.primitives.push(g)}});if(b)return JSROOT.toJSON(a)};
e.prototype.getPadRanges=function(a){if(!a)return!1;var b=this.getFramePainter(),c=this.svg_this_pad();a.ranges=b&&b.ranges_set?!0:!1;a.ux1=a.px1=a.ranges?b.scale_xmin:0;a.uy1=a.py1=a.ranges?b.scale_ymin:0;a.ux2=a.px2=a.ranges?b.scale_xmax:0;a.uy2=a.py2=a.ranges?b.scale_ymax:0;b&&(b.zoom_xmin!==b.zoom_xmax&&(a.zx1=b.zoom_xmin,a.zx2=b.zoom_xmax),b.zoom_ymin!==b.zoom_ymax&&(a.zy1=b.zoom_ymin,a.zy2=b.zoom_ymax),b.zoom_zmin!==b.zoom_zmax&&(a.zz1=b.zoom_zmin,a.zz2=b.zoom_zmax));if(!a.ranges||c.empty())return!0;
var d=function(a){return a},g=[d,Math.log10,function(a){return Math.log10(a)/Math.log10(2)}],e=[d,function(a){return Math.pow(10,a)},function(a){return Math.pow(2,a)}];d=function(a,b,c){return Math.abs(b-a)<1E-10*Math.abs(c)?b:a};var f=g[b.logx],h=e[b.logx],k=(f(b.scale_xmax)-f(b.scale_xmin))/c.property("draw_width");f=f(b.scale_xmin)-k*c.property("draw_x");k=f+k*c.property("draw_width");a.ux1=d(h(f),a.ux1,a.px2-a.px1);a.ux2=d(h(k),a.ux2,a.px2-a.px1);f=g[b.logy];h=e[b.logy];k=(f(b.scale_ymax)-f(b.scale_ymin))/
c.property("draw_height");b=f(b.scale_ymax)+k*c.property("draw_y");c=b-k*c.property("draw_height");a.uy1=d(h(c),a.uy1,a.py2-a.py1);a.uy2=d(h(b),a.uy2,a.py2-a.py1);return!0};e.prototype.itemContextMenu=function(a){var b=this,c=this.svg_this_pad().node().getBoundingClientRect(),d={clientX:c.left+10,clientY:c.top+10};if("pad"==a)return setTimeout(function(){return b.padContextMenu(d)},50);var g=null;switch(a){case "xaxis":case "yaxis":case "zaxis":g=this.getFramePainter();var e=a[0];break;case "frame":g=
this.getFramePainter();break;default:a=parseInt(a),Number.isInteger(a)&&(g=this.painters[a])}g&&"function"===typeof g.fillContextMenu&&f.createMenu(d,g).then(function(a){g.fillContextMenu(a,e)&&setTimeout(function(){return a.show()},50)})};e.prototype.saveAs=function(a,b,c){c||(c=this.this_pad_name,0===c.length&&(c=this.iscan?"canvas":"pad"),c+="."+a);this.produceImage(b,a).then(function(b){var d=document.createElement("a");d.download=c;d.href="svg"!=a?b:"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(b);
document.body.appendChild(d);d.addEventListener("click",function(){return d.parentNode.removeChild(d)});d.click()})};e.prototype.produceImage=function(a,b){var c="frame"===a,d=c?this.getFrameSvg():a?this.getCanvSvg():this.svg_this_pad();if(d.empty())return Promise.resolve("");var g=[],e=null;(a&&!c?this.getCanvPainter():this).forEachPainterInPad(function(a){a.is_active_pad&&!e&&(e=a,e.drawActiveBorder(null,!1));if(!c){var b={prnt:a.svg_this_pad()};g.push(b);var d=a.getLayerSvg("btns_layer",a.this_pad_name);
b.btns_node=d.node();b.btns_node&&(b.btns_prnt=b.btns_node.parentNode,b.btns_next=b.btns_node.nextSibling,d.remove());var f=a.getFramePainter();if(f&&"function"===typeof f.render3D&&"function"===typeof f.access3dKind){var h=f.access3dKind();if(h===JSROOT.constants.Embed3D.Overlay||h===JSROOT.constants.Embed3D.Embed){a=f.getSizeFor3d(JSROOT.constants.Embed3D.Embed);d=f.renderer.domElement;f.render3D(0);var l=d.toDataURL("image/png");h===JSROOT.constants.Embed3D.Embed&&(b.foreign=b.prnt.select("."+
a.clname),b.foreign.remove());f=f.getFrameSvg();b.frame_node=f.node();b.frame_node&&(b.frame_next=b.frame_node.nextSibling,f.remove());b.img=b.prnt.insert("image",".primitives_layer").attr("x",a.x).attr("y",a.y).attr("width",d.width).attr("height",d.height).attr("href",l)}}}},"pads");var h=function(a){a=encodeURIComponent(a);a=a.replace(/%([0-9A-F]{2})/g,function(a,b){a=String.fromCharCode("0x"+b);return"%"===a?"%25":a});return decodeURIComponent(a)},k=function(){e&&e.drawActiveBorder(null,!0);for(var a=
0;a<g.length;++a){var b=g[a];b.img&&b.img.remove();var c=b.prnt.select(".primitives_layer");b.foreign&&b.prnt.node().insertBefore(b.foreign.node(),c.node());b.frame_node&&c.node().insertBefore(b.frame_node,b.frame_next);b.btns_node&&b.btns_prnt.insertBefore(b.btns_node,b.btns_next)}};a=d.property("draw_width");var m=d.property("draw_height");c&&(m=this.getFramePainter(),a=m.getFrameWidth(),m=m.getFrameHeight());var n='<svg width="'+a+'" height="'+m+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">'+
d.node().innerHTML+"</svg>";f.processSvgWorkarounds&&(n=f.processSvgWorkarounds(n));n=f.compressSVG(n);if("svg"==b)return k(),Promise.resolve(n);var w=new Image;return new Promise(function(a){w.onload=function(){var c=document.createElement("canvas");c.width=w.width;c.height=w.height;c.getContext("2d").drawImage(w,0,0);k();a(c.toDataURL("image/"+b))};w.onerror=function(b){console.log("IMAGE ERROR",b);k();a(null)};w.src="data:image/svg+xml;base64,"+window.btoa(h('<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'+
n))})};e.prototype.clickPadButton=function(a,b){var c=this;if("CanvasSnapShot"==a)return this.saveAs("png",!0);if("enlargePad"==a)return this.enlargePad();if("PadSnapShot"==a)return this.saveAs("png",!1);if("PadContextMenus"==a)b&&(b.preventDefault(),b.stopPropagation()),f.closeMenu&&f.closeMenu()||f.createMenu(b,this).then(function(a){a.add("header:Menus");c.iscan?a.add("Canvas","pad",c.itemContextMenu):a.add("Pad","pad",c.itemContextMenu);c.getFramePainter()&&a.add("Frame","frame",c.itemContextMenu);
var b=c.getMainPainter();b&&(a.add("X axis","xaxis",c.itemContextMenu),a.add("Y axis","yaxis",c.itemContextMenu),"function"===typeof b.getDimension&&1<b.getDimension()&&a.add("Z axis","zaxis",c.itemContextMenu));if(c.painters&&0<c.painters.length){a.add("separator");var d=[];c.painters.forEach(function(b,g){if((b=b?b.getObject():null)&&!(0<=d.indexOf(b))){var e="_typename"in b?b._typename+"::":"";"fName"in b&&(e+=b.fName);e.length||(e="item"+g);a.add(e,g,c.itemContextMenu)}})}a.show()});else{var d=
!1;this.painters.forEach(function(b){"function"==typeof b.clickPadButton&&b.clickPadButton(a);d||"function"!=typeof b.clickButton||(d=b.clickButton(a))})}};e.prototype.addPadButton=function(a,b,c,d){if(JSROOT.settings.ToolBar&&!JSROOT.batch_mode&&!this.batch_mode){this._buttons||(this._buttons=[]);for(var e=0;e<this._buttons.length;++e)if(this._buttons[e].funcname==c)return;this._buttons.push({btn:a,tooltip:b,funcname:c,keyname:d});!this.iscan&&this.has_canvas&&0!=c.indexOf("Pad")&&"enlargePad"!==
c&&(d=this.getCanvPainter())&&d!==this&&d.addPadButton(a,b,c)}};e.prototype.showPadButtons=function(){var a=this;this._buttons&&JSROOT.require(["interactive"]).then(function(b){b.PadButtonsHandler.assign(a);a.showPadButtons()})};e.prototype.addPadButtons=function(a){this.addPadButton("camera","Create PNG",this.iscan?"CanvasSnapShot":"PadSnapShot","Ctrl PrintScreen");JSROOT.settings.ContextMenu&&this.addPadButton("question","Access context menus","PadContextMenus");(!this.iscan&&this.has_canvas&&this.hasObjectsToDraw()||
this.enlargeMain("verify"))&&this.addPadButton("circle","Enlarge canvas","enlargePad");a&&this.brlayout&&(this.addPadButton("diamand","Toggle Ged","ToggleGed"),this.addPadButton("three_circles","Toggle Status","ToggleStatus"))};e.prototype.decodeOptions=function(a){var b=this.getObject();if(b){var c=new JSROOT.DrawOptions(a);c.check("WEBSOCKET")&&this.openWebsocket&&this.openWebsocket();this.options||(this.options={});JSROOT.extend(this.options,{GlobalColors:!0,LocalColors:!1,CreatePalette:0,IgnorePalette:!1,
RotateFrame:!1,FixFrame:!1});if(c.check("NOCOLORS")||c.check("NOCOL"))this.options.GlobalColors=this.options.LocalColors=!1;if(c.check("LCOLORS")||c.check("LCOL"))this.options.GlobalColors=!1,this.options.LocalColors=!0;if(c.check("NOPALETTE")||c.check("NOPAL"))this.options.IgnorePalette=!0;c.check("ROTATE")&&(this.options.RotateFrame=!0);c.check("FIXFRAME")&&(this.options.FixFrame=!0);c.check("CP",!0)&&(this.options.CreatePalette=c.partAsInt(0,0));c.check("NOZOOMX")&&(this.options.NoZoomX=!0);c.check("NOZOOMY")&&
(this.options.NoZoomY=!0);c.check("NOMARGINS")&&(b.fLeftMargin=b.fRightMargin=b.fBottomMargin=b.fTopMargin=0);c.check("WHITE")&&(b.fFillColor=0);c.check("LOG2X")&&(b.fLogx=2,b.fUxmin=0,b.fUxmax=1,b.fX1=0,b.fX2=1);c.check("LOGX")&&(b.fLogx=1,b.fUxmin=0,b.fUxmax=1,b.fX1=0,b.fX2=1);c.check("LOG2Y")&&(b.fLogy=2,b.fUymin=0,b.fUymax=1,b.fY1=0,b.fY2=1);c.check("LOGY")&&(b.fLogy=1,b.fUymin=0,b.fUymax=1,b.fY1=0,b.fY2=1);c.check("LOG2Z")&&(b.fLogz=2);c.check("LOGZ")&&(b.fLogz=1);c.check("LOG2")&&(b.fLogx=b.fLogy=
b.fLogz=2);c.check("LOG")&&(b.fLogx=b.fLogy=b.fLogz=1);c.check("GRIDX")&&(b.fGridx=1);c.check("GRIDY")&&(b.fGridy=1);c.check("GRID")&&(b.fGridx=b.fGridy=1);c.check("TICKX")&&(b.fTickx=1);c.check("TICKY")&&(b.fTicky=1);c.check("TICK")&&(b.fTickx=b.fTicky=1);c.check("OTX")&&(b.$OTX=!0);c.check("OTY")&&(b.$OTY=!0);c.check("CTX")&&(b.$CTX=!0);c.check("CTY")&&(b.$CTY=!0);c.check("RX")&&(b.$RX=!0);c.check("RY")&&(b.$RY=!0);this.storeDrawOpt(a)}};var R=JSROOT.BIT(15);JSROOT.BIT(16);var B=JSROOT.BIT(17),
U=JSROOT.BIT(18),Q=JSROOT.BIT(19);JSROOT.BIT(20);JSROOT.BIT(21);JSROOT.BIT(22);var K=JSROOT.BIT(23);m.prototype=Object.create(e.prototype);m.prototype.cleanup=function(){this._changed_layout&&this.setLayoutKind("simple");delete this._changed_layout;e.prototype.cleanup.call(this)};m.prototype.getLayoutKind=function(){var a=this.selectDom("origin");return(a.empty()?"":a.property("layout"))||"simple"};m.prototype.setLayoutKind=function(a,b){var c=this.selectDom("origin");c.empty()||(a||(a="simple"),
c.property("layout",a),c.property("layout_selector","simple"!=a&&b?b:null),this._changed_layout="simple"!==a)};m.prototype.changeLayout=function(a,b){var c=this;if(this.getLayoutKind()==a)return Promise.resolve(!0);for(var d=this.selectDom("origin"),e=d.select(".side_panel"),f=this.selectDom(),k=[];f.node().firstChild;)k.push(f.node().removeChild(f.node().firstChild));e.empty()||JSROOT.cleanup(e.node());this.setLayoutKind("simple");d.html("");if("simple"==a){f=d;for(var m=0;m<k.length;++m)f.node().appendChild(k[m]);
this.setLayoutKind(a);JSROOT.resize(f.node());return Promise.resolve(!0)}return JSROOT.require("jq2d").then(function(){var g=new JSROOT.GridDisplay(d.node(),a);void 0==b&&(b=0==a.indexOf("vert")?0:1);f=h.select(g.getGridFrame(b));e=h.select(g.getGridFrame(1-b));f.classed("central_panel",!0).style("position","relative");e.classed("side_panel",!0).style("position","relative");for(g=0;g<k.length;++g)f.node().appendChild(k[g]);c.setLayoutKind(a,".central_panel");d.property("mdi",null);JSROOT.resize(f.node());
return!0})};m.prototype.toggleProjection=function(a){delete this.proj_painter;a&&(this.proj_painter=1);if(this.showUI5ProjectionArea)return this.showUI5ProjectionArea(a);var b="simple";switch(a){case "X":case "bottom":b="vert2_31";var c=0;break;case "Y":case "left":b="horiz2_13";c=1;break;case "top":b="vert2_13";c=1;break;case "right":b="horiz2_31",c=0}return this.changeLayout(b,c)};m.prototype.drawProjection=function(a,b,c){var d=this;if(this.proj_painter)if(void 0===c&&(c="hist"),1===this.proj_painter){var e=
JSROOT.create("TCanvas"),f=this.pad,h=this.getFramePainter();if("X"==a){e.fLeftMargin=f.fLeftMargin;e.fRightMargin=f.fRightMargin;e.fLogx=h.logx;e.fUxmin=h.logx?Math.log10(h.scale_xmin):h.scale_xmin;e.fUxmax=h.logx?Math.log10(h.scale_xmax):h.scale_xmax;var k="fixframe"}else"Y"==a&&(e.fBottomMargin=f.fBottomMargin,e.fTopMargin=f.fTopMargin,e.fLogx=h.logy,e.fUxmin=h.logy?Math.log10(h.scale_ymin):h.scale_ymin,e.fUxmax=h.logy?Math.log10(h.scale_ymax):h.scale_ymax,k="rotate");e.fPrimitives.Add(b,c);(this.drawInUI5ProjectionArea?
this.drawInUI5ProjectionArea(e,k):this.drawInSidePanel(e,k)).then(function(a){d.proj_painter=a})}else(a=this.proj_painter.getMainPainter())&&a.updateObject(b,c),this.proj_painter.redrawPad()};m.prototype.testUI5=function(){if(!this.use_openui)return!1;console.warn("full ui5 should be used - not loaded yet? Please check!!");return!0};m.prototype.drawInSidePanel=function(a,b){var c=this.selectDom("origin").select(".side_panel");return c.empty()?Promise.resolve(null):JSROOT.draw(c.node(),a,b)};m.prototype.showMessage=
function(a){this.testUI5()||f.showProgress(a,7E3)};m.prototype.saveCanvasAsFile=function(a){var b=this,c=a.indexOf(".");this.createImage(a.substr(c+1)).then(function(c){return b.sendWebsocket("SAVE:"+a+":"+c)})};m.prototype.sendSaveCommand=function(a){this.sendWebsocket("PRODUCE:"+a)};m.prototype.submitMenuRequest=function(a,b,c){var d=this;return new Promise(function(a){d._getmenu_callback=a;d.sendWebsocket("GETMENU:"+c)})};m.prototype.submitExec=function(a,b,c){!this._readonly&&a&&(c||(c=a.snapid),
c&&"string"==typeof c&&this.sendWebsocket("OBJEXEC:"+c+":"+b))};m.prototype.sendWebsocket=function(a){this._websocket&&(this._websocket.canSend()?this._websocket.send(a):console.warn("DROP SEND: "+a))};m.prototype.closeWebsocket=function(a){this._websocket&&(this._websocket.close(a),this._websocket.cleanup(),delete this._websocket)};m.prototype.openWebsocket=function(a){this.closeWebsocket();this._websocket=new JSROOT.WebWindowHandle(a);this._websocket.setReceiver(this);this._websocket.connect()};
m.prototype.useWebsocket=function(a){this.closeWebsocket();this._websocket=a;this._websocket.setReceiver(this);this._websocket.connect()};m.prototype.onWebsocketOpened=function(){};m.prototype.onWebsocketClosed=function(){this.embed_canvas||f.closeCurrentWindow()};m.prototype.onWebsocketMsg=function(a,b){var c=this;console.log("GET MSG len:"+b.length+" "+b.substr(0,60));if("CLOSE"==b)this.onWebsocketClosed(),this.closeWebsocket(!0);else if("SNAP6:"==b.substr(0,6)){var d=JSROOT.parse(b.substr(6));
this.syncDraw(!0).then(function(){return c.redrawPadSnap(d)}).then(function(){c.completeCanvasSnapDrawing();var b=c.getWebPadOptions();b&&(b=":"+b);a.send("READY6:"+d.fVersion+b);c.confirmDraw()})}else if("MENU:"==b.substr(0,5))b=JSROOT.parse(b.substr(5)),"function"==typeof this._getmenu_callback&&(this._getmenu_callback(b),delete this._getmenu_callback);else if("CMD:"==b.substr(0,4)){b=b.substr(4);var e=b.indexOf(":"),f=b.substr(0,e);b=b.substr(e+1);var h="REPLY:"+f+":";"SVG"==b||"PNG"==b||"JPEG"==
b?this.createImage(b.toLowerCase()).then(function(b){return a.send(h+b)}):(console.log("Unrecognized command "+b),a.send(h))}else if("DXPROJ:"==b.substr(0,7)||"DYPROJ:"==b.substr(0,7))f=b[1],b=JSROOT.parse(b.substr(7)),this.drawProjection(f,b);else if("SHOW:"==b.substr(0,5))b=b.substr(5),f="1"==b[b.length-1],this.showSection(b.substr(0,b.length-2),f);else if("EDIT:"==b.substr(0,5)){var k=this.findSnap(b.substr(5));console.log("GET EDIT "+b.substr(5)+" found "+!!k);k&&this.showSection("Editor",!0).then(function(){return c.producePadEvent("select",
k.getPadPainter(),k)})}else console.log("unrecognized msg "+b)};m.prototype.clickPadButton=function(a,b){if("ToggleGed"==a)return this.activateGed(this,null,"toggle");if("ToggleStatus"==a)return this.activateStatusBar("toggle");e.prototype.clickPadButton.call(this,a,b)};m.prototype.hasEventStatus=function(){return this.testUI5()?!1:this.brlayout?this.brlayout.hasStatus():!1};m.prototype.activateStatusBar=function(a){this.testUI5()||(this.brlayout&&this.brlayout.createStatusLine(23,a),this.processChanges("sbits",
this))};m.prototype.hasGed=function(){return this.testUI5()?!1:this.brlayout?this.brlayout.hasContent():!1};m.prototype.removeGed=function(){this.testUI5()||(this.registerForPadEvents(null),this.ged_view&&(this.ged_view.getController().cleanupGed(),this.ged_view.destroy(),delete this.ged_view),this.brlayout&&this.brlayout.deleteContent(),this.processChanges("sbits",this))};m.prototype.activateGed=function(a,b,c){var d=this;if(this.testUI5()||!this.brlayout)return Promise.resolve(!1);if(this.brlayout.hasContent())return"toggle"===
c||!1===c?this.removeGed():(b=a?a.getPadPainter():null)&&b.selectObjectPainter(a),Promise.resolve(!0);if(!1===c)return Promise.resolve(!1);var e=this.brlayout.createBrowserBtns();JSROOT.require("interactive").then(function(a){a.ToolbarIcons.createSVG(e,a.ToolbarIcons.diamand,15,"toggle fix-pos mode").style("margin","3px").on("click",function(){return d.brlayout.toggleKind("fix")});a.ToolbarIcons.createSVG(e,a.ToolbarIcons.circle,15,"toggle float mode").style("margin","3px").on("click",function(){return d.brlayout.toggleKind("float")});
a.ToolbarIcons.createSVG(e,a.ToolbarIcons.cross,15,"delete GED").style("margin","3px").on("click",function(){return d.removeGed()})});this.brlayout.setBrowserContent("<div class='jsroot_browser_hierarchy' id='ged_placeholder'>Loading GED ...</div>");this.brlayout.setBrowserTitle("GED");this.brlayout.toggleBrowserKind(b||"float");return new Promise(function(b){JSROOT.require("openui5").then(function(){h.select("#ged_placeholder").text("");sap.ui.define(["sap/ui/model/json/JSONModel","sap/ui/core/mvc/XMLView"],
function(c,e){var f=new c({handle:null});e.create({viewName:"rootui5.canv.view.Ged"}).then(function(c){c.setModel(f);c.placeAt("ged_placeholder");d.ged_view=c;d.registerForPadEvents(c.getController().padEventsReceiver.bind(c.getController()));(c=a?a.getPadPainter():null)&&c.selectObjectPainter(a);d.processChanges("sbits",d);b(!0)})})})})};m.prototype.showSection=function(a,b){if(this.testUI5())return Promise.resolve(!1);console.log("Show section "+a+" flag = "+b);switch(a){case "StatusBar":this.activateStatusBar(b);
break;case "Editor":return this.activateGed(this,null,!!b);case "ToolTips":this.setTooltipAllowed(b)}return Promise.resolve(!0)};m.prototype.completeCanvasSnapDrawing=function(){this.pad&&(document&&!this.embed_canvas&&this._websocket&&(document.title=this.pad.fTitle),this._all_sections_showed||(this._all_sections_showed=!0,this.showSection("Menu",this.pad.TestBit(B)),this.showSection("StatusBar",this.pad.TestBit(R)),this.showSection("ToolBar",this.pad.TestBit(U)),this.showSection("Editor",this.pad.TestBit(Q)),
this.showSection("ToolTips",this.pad.TestBit(K))))};m.prototype.processChanges=function(a,b,c){if(this._websocket&&!this._readonly&&this._websocket.canSend(2)&&"string"===typeof a){var d="";b||(b=this);switch(a){case "sbits":d="STATUSBITS:"+this.getStatusBits();break;case "frame":case "zoom":b.getWebPadOptions||(b=b.getPadPainter());"function"==typeof b.getWebPadOptions&&(d="OPTIONS6:"+b.getWebPadOptions("only_this"));break;case "pave_moved":b.fillWebObjectOptions&&(a=b.fillWebObjectOptions())&&(d=
"PRIMIT6:"+JSROOT.toJSON(a));break;default:"exec:"==a.substr(0,5)&&b&&b.snapid?(console.log("Call exec",b.snapid),d="PRIMIT6:"+JSROOT.toJSON({_typename:"TWebObjectOptions",snapid:b.snapid.toString()+(c?"#"+c:""),opt:a.substr(5),fcust:"exec",fopt:[]})):console.log("UNPROCESSED CHANGES",a)}d&&(console.log("Sending "+d.length+"  "+d.substr(0,40)),this._websocket.send(d))}};m.prototype.selectActivePad=function(a,b,c){if(void 0!==this.snapid&&a){var d=null,e=!1;void 0!==a.snapid&&this._websocket&&(d={_typename:"TWebPadClick",
padid:a.snapid.toString(),objid:"",x:-1,y:-1,dbl:!1});a.is_active_pad||(e=!0,this.forEachPainterInPad(function(b){return b.drawActiveBorder(null,b===a)},"pads"));b&&void 0!==b.snapid&&d&&(e=!0,d.objid=b.snapid.toString());c&&d&&(e=!0,d.x=Math.round(c.x||0),d.y=Math.round(c.y||0),c.dbl&&(d.dbl=!0));d&&e&&this.sendWebsocket("PADCLICKED:"+JSROOT.toJSON(d))}};m.prototype.getStatusBits=function(){var a=0;this.hasEventStatus()&&(a|=R);this.hasGed()&&(a|=Q);this.isTooltipAllowed()&&(a|=K);this.use_openui&&
(a|=B);return a};m.prototype.produceJSON=function(){var a=this.getObject(),b=0==a.fFillStyle;b&&(a.fFillStyle=1001);this.normal_canvas||this.forEachPainterInPad(function(b){if(!b.$secondary){var c=b.getObject();c&&c._typename&&a.fPrimitives.Add(c,b.getDrawOpt())}},"objects");var c=JSROOT.toJSON(a);b&&(a.fFillStyle=0);this.normal_canvas||a.fPrimitives.Clear();return c};m.prototype.directGeoDraw=function(){var a=this.pad?this.pad.fPrimitives:null;if(a&&1==a.arr.length&&a.arr[0]&&a.arr[0]._typename&&
0==a.arr[0]._typename.indexOf("TGeo"))return JSROOT.draw(this.getDom(),a.arr[0],a.opt[0])};var S=function(a,b,c){var d=!b;d&&(b=JSROOT.create("TCanvas"));var e=new m(a,b);e.checkSpecialsInPrimitives(b);if(!d&&b.fCw&&b.fCh&&!JSROOT.batch_mode){var h=e.selectDom().node().getBoundingClientRect();!h.height&&h.width>.1*b.fCw&&(e.selectDom().style("width",b.fCw+"px").style("height",b.fCh+"px"),e._fixed_size=!0)}if(b=e.directGeoDraw())return b;e.decodeOptions(c);e.normal_canvas=!d;e.createCanvasSvg(0);e.addPadButtons();
return(d&&0>c.indexOf("noframe")?P(a,null):Promise.resolve(!0)).then(function(){f.selectActivePad({pp:e,active:!0});return e.drawPrimitives()}).then(function(){e.showPadButtons();return e})};JSROOT.TAxisPainter=n;JSROOT.TFramePainter=k;JSROOT.TPadPainter=e;JSROOT.TCanvasPainter=m;f.drawGaxis=function(a,b,c){var d=new n(a,b,!1);d.disable_zooming=!0;return f.ensureTCanvas(d,!1).then(function(){c&&d.convertTo(c);return d.redraw()})};f.drawFrame=P;f.drawPad=function(a,b,c){var d=new e(a,b,!1);d.decodeOptions(c);
d.getCanvSvg().empty()?(d.has_canvas=!1,d.this_pad_name="",d.setTopPainter()):d.addToPadPrimitives(d.pad_name);d.createPadSvg();!d.matchObjectType("TPad")||d.has_canvas&&!d.hasObjectsToDraw()||d.addPadButtons();var g=d.has_canvas?d.selectCurrentPad(d.this_pad_name):void 0;f.selectActivePad({pp:d,active:!0});return d.drawPrimitives().then(function(){d.showPadButtons();d.selectCurrentPad(g);return d})};f.drawCanvas=S;f.ensureTCanvas=function(a,b){if(!a)return Promise.reject("Painter not provided in ensureTCanvas");
var c=a.getCanvSvg(),d=!1===b||"3d"==b?"noframe":"";return(c.empty()?S(a.getDom(),null,d):Promise.resolve(!0)).then(function(){if(!1!==b&&a.getFrameSvg().select(".main_layer").empty()&&!a.getFramePainter())return P(a.getDom(),null,"string"===typeof b?b:"")}).then(function(){a.addToPadPrimitives();return a})};f.drawPadSnapshot=function(a,b){var c=JSROOT.create("TCanvas"),d=new m(a,c);d.normal_canvas=!1;d.addPadButtons();return d.syncDraw(!0).then(function(){return d.redrawPadSnap(b)}).then(function(){d.confirmDraw();
d.showPadButtons();return d})};return JSROOT});
