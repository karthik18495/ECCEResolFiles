var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(m,b,l){m!=Array.prototype&&m!=Object.prototype&&(m[b]=l.value)};$jscomp.getGlobal=function(m){return"undefined"!=typeof window&&window===m?m:"undefined"!=typeof global&&null!=global?global:m};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(m,b,l,P){if(b){l=$jscomp.global;m=m.split(".");for(P=0;P<m.length-1;P++){var C=m[P];C in l||(l[C]={});l=l[C]}m=m[m.length-1];P=l[m];b=b(P);b!=P&&null!=b&&$jscomp.defineProperty(l,m,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Number.isFinite",function(m){return m?m:function(b){return"number"!==typeof b?!1:!isNaN(b)&&Infinity!==b&&-Infinity!==b}},"es6","es3");
$jscomp.polyfill("Number.isInteger",function(m){return m?m:function(b){return Number.isFinite(b)?b===Math.floor(b):!1}},"es6","es3");$jscomp.arrayIteratorImpl=function(m){var b=0;return function(){return b<m.length?{done:!1,value:m[b++]}:{done:!0}}};$jscomp.arrayIterator=function(m){return{next:$jscomp.arrayIteratorImpl(m)}};$jscomp.makeIterator=function(m){var b="undefined"!=typeof Symbol&&Symbol.iterator&&m[Symbol.iterator];return b?b.call(m):$jscomp.arrayIterator(m)};
$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(m){function b(){this.batch_=null}function l(b){return b instanceof C?b:new C(function(l,a){l(b)})}if(m&&!$jscomp.FORCE_POLYFILL_PROMISE)return m;b.prototype.asyncExecute=function(b){if(null==this.batch_){this.batch_=[];var l=this;this.asyncExecuteFunction(function(){l.executeBatch_()})}this.batch_.push(b)};var P=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(b){P(b,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var b=
this.batch_;this.batch_=[];for(var l=0;l<b.length;++l){var a=b[l];b[l]=null;try{a()}catch(f){this.asyncThrow_(f)}}}this.batch_=null};b.prototype.asyncThrow_=function(b){this.asyncExecuteFunction(function(){throw b;})};var C=function(b){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var l=this.createResolveAndReject_();try{b(l.resolve,l.reject)}catch(a){l.reject(a)}};C.prototype.createResolveAndReject_=function(){function b(b){return function(c){a||(a=!0,b.call(l,c))}}var l=this,a=!1;
return{resolve:b(this.resolveTo_),reject:b(this.reject_)}};C.prototype.resolveTo_=function(b){if(b===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(b instanceof C)this.settleSameAsPromise_(b);else{a:switch(typeof b){case "object":var l=null!=b;break a;case "function":l=!0;break a;default:l=!1}l?this.resolveToNonPromiseObj_(b):this.fulfill_(b)}};C.prototype.resolveToNonPromiseObj_=function(b){var l=void 0;try{l=b.then}catch(a){this.reject_(a);return}"function"==typeof l?
this.settleSameAsThenable_(l,b):this.fulfill_(b)};C.prototype.reject_=function(b){this.settle_(2,b)};C.prototype.fulfill_=function(b){this.settle_(1,b)};C.prototype.settle_=function(b,l){if(0!=this.state_)throw Error("Cannot settle("+b+", "+l+"): Promise already settled in state"+this.state_);this.state_=b;this.result_=l;this.executeOnSettledCallbacks_()};C.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var b=0;b<this.onSettledCallbacks_.length;++b)ia.asyncExecute(this.onSettledCallbacks_[b]);
this.onSettledCallbacks_=null}};var ia=new b;C.prototype.settleSameAsPromise_=function(b){var l=this.createResolveAndReject_();b.callWhenSettled_(l.resolve,l.reject)};C.prototype.settleSameAsThenable_=function(b,l){var a=this.createResolveAndReject_();try{b.call(l,a.resolve,a.reject)}catch(f){a.reject(f)}};C.prototype.then=function(b,l){function a(a,b){return"function"==typeof a?function(b){try{f(a(b))}catch(n){c(n)}}:b}var f,c,e=new C(function(a,b){f=a;c=b});this.callWhenSettled_(a(b,f),a(l,c));
return e};C.prototype.catch=function(b){return this.then(void 0,b)};C.prototype.callWhenSettled_=function(b,l){function a(){switch(f.state_){case 1:b(f.result_);break;case 2:l(f.result_);break;default:throw Error("Unexpected state: "+f.state_);}}var f=this;null==this.onSettledCallbacks_?ia.asyncExecute(a):this.onSettledCallbacks_.push(a)};C.resolve=l;C.reject=function(b){return new C(function(l,a){a(b)})};C.race=function(b){return new C(function(m,a){for(var f=$jscomp.makeIterator(b),c=f.next();!c.done;c=
f.next())l(c.value).callWhenSettled_(m,a)})};C.all=function(b){var m=$jscomp.makeIterator(b),a=m.next();return a.done?l([]):new C(function(b,c){function f(a){return function(c){L[a]=c;y--;0==y&&b(L)}}var L=[],y=0;do L.push(void 0),y++,l(a.value).callWhenSettled_(f(L.length-1),c),a=m.next();while(!a.done)})};return C},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(m,b){this.$jscomp$symbol$id_=m;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function m(l){if(this instanceof m)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(l||"")+"_"+b++,l)}var b=0;return m}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var m=$jscomp.global.Symbol.iterator;m||(m=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[m]&&$jscomp.defineProperty(Array.prototype,m,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var m=$jscomp.global.Symbol.asyncIterator;m||(m=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(m){$jscomp.initSymbolIterator();m={next:m};m[$jscomp.global.Symbol.iterator]=function(){return this};return m};
$jscomp.iteratorFromArray=function(m,b){$jscomp.initSymbolIterator();m instanceof String&&(m+="");var l=0,P={next:function(){if(l<m.length){var C=l++;return{value:b(C,m[C]),done:!1}}P.next=function(){return{done:!0,value:void 0}};return P.next()}};P[Symbol.iterator]=function(){return P};return P};$jscomp.polyfill("Array.prototype.entries",function(m){return m?m:function(){return $jscomp.iteratorFromArray(this,function(b,l){return[b,l]})}},"es6","es3");
JSROOT.define(["d3","base3d","painter","latex","v7hist"],function(m,b,l,P){function C(a,b,c,e){if(b&&b.children)for(var f=0;f<b.children.length;++f){var y=b.children[f];if(y.axis_draw)break;y=void 0}if(y)if(a){c=c?!0:!1;e=e?!0:!1;var u=1;a=a.position;0>a.x&&0<=a.y&&(u=2);0<=a.x&&0<=a.y&&(u=3);0<=a.x&&0>a.y&&(u=4);a=function(a,b){a<=u&&(a+=4);return a>u&&a<u+b};for(b=0;b<y.children.length;++b)if(f=y.children[b],f.grid)f.visible=e&&a(f.grid,3);else if(f.zid)f.visible=a(f.zid,2);else if(f.xyid)f.visible=
a(f.xyid,3);else if(f.xyboxid){var n=5,d=0;e&&!c?(n=3,d=-2):c&&!e?n=3:c||e||(n=f.bottom?3:0);f.visible=a(f.xyboxid+d,n);!f.visible&&f.bottom&&e&&(f.visible=a(f.xyboxid,3))}else f.zboxid&&(n=2,d=0,c&&e?n=5:e&&!c?n=4:!e&&c&&(d=-2,n=4),f.visible=a(f.zboxid+d,n))}else b.remove(y)}function ia(a){var b=Math.max(.75*a.size_x3d,a.size_z3d),c=Math.max(.75*a.size_y3d,a.size_z3d);b===c?a.camera.position.set(-1.6*b,-3.5*c,1.4*a.size_z3d):b>c?a.camera.position.set(-2*b,-3.5*c,1.4*a.size_z3d):a.camera.position.set(-3.5*
b,-2*c,1.4*a.size_z3d);a.camera.lookAt(a.lookat)}function ma(a,f){if(!a)return null;f||(f="line_");var c=a.v7EvalColor(f+"color","black"),e=a.v7EvalAttr(f+"style",0);a=a.v7EvalAttr(f+"width",1);c=(e=(e=e?l.root_line_styles[parseInt(e)]:"")?e.split(","):[])&&2<=e.length?new b.LineDashedMaterial({color:c,dashSize:parseInt(e[0]),gapSize:parseInt(e[1])}):new b.LineBasicMaterial({color:c});void 0!==a&&1<a&&(c.linewidth=parseInt(a));return c}function Q(a,b){JSROOT.v7.RHistPainter.call(this,a,b);this.mode3d=
!0}JSROOT.v7.RFramePainter.prototype.create3DScene=function(a){if(-1===a)this.mode3d&&(this.clear3dCanvas?(C(null,this.toplevel),this.clear3dCanvas(),l.disposeThreejsObject(this.scene),this.control&&this.control.cleanup(),l.cleanupRender3D(this.renderer),delete this.size_x3d,delete this.size_y3d,delete this.size_z3d,delete this.tooltip_mesh,delete this.scene,delete this.toplevel,delete this.camera,delete this.pointLight,delete this.renderer,delete this.control,this.render_tmout&&(clearTimeout(this.render_tmout),
delete this.render_tmout),this.mode3d=!1):console.error("Strange, why mode3d is configured!!!!",this.mode3d));else if(this.mode3d=!0,"toplevel"in this)this.scene.remove(this.toplevel),l.disposeThreejsObject(this.toplevel),delete this.tooltip_mesh,delete this.toplevel,this.control&&this.control.HideTooltip(),a=new b.Object3D,this.scene.add(a),this.toplevel=a,this.resize3D();else{l.assign3DHandler(this);a=l.getRender3DKind(a);var f=this.getSizeFor3d(void 0,a);this.size_z3d=100;this.size_x3d=this.size_y3d=
10<f.height&&10<f.width?Math.round(f.width/f.height*this.size_z3d):this.size_z3d;this.scene=new b.Scene;this.toplevel=new b.Object3D;this.scene.add(this.toplevel);this.scene_width=f.width;this.scene_height=f.height;this.camera=new b.PerspectiveCamera(45,this.scene_width/this.scene_height,1,40*this.size_z3d);this.camera_Theta=this.camera_Phi=30;this.pointLight=new b.PointLight(16777215,1);this.camera.add(this.pointLight);this.pointLight.position.set(this.size_x3d/2,this.size_y3d/2,this.size_z3d/2);
this.lookat=new b.Vector3(0,0,.8*this.size_z3d);this.camera.up=new b.Vector3(0,0,1);this.scene.add(this.camera);ia(this);this.renderer=l.createRender3D(this.scene_width,this.scene_height,a);this.webgl=a===JSROOT.constants.Render3D.WebGL;this.add3dCanvas(f,this.renderer.jsroot_dom,this.webgl);this.first_render_tm=0;this.enable_highlight=!1;if(!JSROOT.batch_mode&&this.webgl){this.control=l.createOrbitControl(this,this.camera,this.scene,this.renderer,this.lookat);var c=this,e=this.getMainPainter();this.control.ProcessMouseMove=
function(a){for(var b=null,f=null,e=null,d=0;d<a.length;++d)if(a[d].object.tooltip){if(b=a[d].object.tooltip(a[d])){f=a[d].object;break}}else a[d].object.zoom&&!e&&(e=a[d].object);if(b&&!b.use_itself){a=1E-4*c.size_x3d;d=1E-4*c.size_y3d;var l=1E-4*c.size_z3d;(b.x1>b.x2||b.y1>b.y2||b.z1>b.z2)&&console.warn("check 3D hints coordinates");b.x1-=a;b.x2+=a;b.y1-=d;b.y2+=d;b.z1-=l;b.z2+=l}c.highlightBin3D(b,f);return!b&&e&&c.get3dZoomCoord?(f=e.globalIntersect(this.raycaster),b=e.zoom,f=c.get3dZoomCoord(f,
b),"z"===b&&e.use_y_for_z&&(b="y"),e={name:b,title:"RAxis",line:"any info",only_status:!0},e.line=b+" : "+c.axisAsText(b,f),e):b&&b.lines?b:""};this.control.ProcessMouseLeave=function(){c.highlightBin3D(null)};this.control.contextMenu=function(a,b){var c="painter",f=e;if(b)for(var d=0;d<b.length;++d){var l=b[d].object;if(l.zoom){c=l.zoom;f=null;break}if(l.painter&&"function"===typeof l.painter.fillContextMenu){f=l.painter;break}}(b=e.getFramePainter())&&b.showContextMenu&&b.showContextMenu(c,a,f)}}}};
JSROOT.v7.RFramePainter.prototype.render3D=function(a){var f=this;if(-1111===a){var c=JSROOT._.get_document();a=b.CreateSVGRenderer(!1,0,c);a.setSize(this.scene_width,this.scene_height);a.render(this.scene,this.camera);return a.makeOuterHTML?(c=c.createElement("div"),c.innerHTML=a.makeOuterHTML(),c.childNodes[0]):a.domElement}void 0===a&&(a=5);0<a&&this.webgl&&JSROOT.batch_mode?this.render_tmout||(this.render_tmout=setTimeout(function(){return f.render3D(0)},a)):(this.render_tmout&&(clearTimeout(this.render_tmout),
delete this.render_tmout),this.renderer&&(l.beforeRender3D(this.renderer),a=new Date,this.opt3d||(this.opt3d={FrontBox:!0,BackBox:!0}),C(this.camera,this.toplevel,this.opt3d.FrontBox,this.opt3d.BackBox),this.renderer.render(this.scene,this.camera),l.afterRender3D(this.renderer),c=new Date,0===this.first_render_tm&&(this.first_render_tm=c.getTime()-a.getTime(),this.enable_highlight=1200>this.first_render_tm&&this.isTooltipAllowed(),console.log("three.js r"+b.REVISION+", first render tm = "+this.first_render_tm))))};
JSROOT.v7.RFramePainter.prototype.resize3D=function(){var a=this.getSizeFor3d(this.access3dKind());this.apply3dSize(a);if(this.scene_width===a.width&&this.scene_height===a.height||10>a.width||10>a.height)return!1;this.scene_width=a.width;this.scene_height=a.height;this.camera.aspect=this.scene_width/this.scene_height;this.camera.updateProjectionMatrix();this.renderer.setSize(this.scene_width,this.scene_height);this.renderer.setJSROOTSize&&this.renderer.setJSROOTSize(this.scene_width,this.scene_height);
return!0};JSROOT.v7.RFramePainter.prototype.highlightBin3D=function(a,f){var c=!1,e=null,L=!0,y=!a||void 0===a.x1||!this.enable_highlight,u=this.getMainPainter();!u||u.provideUserTooltip&&u.hasUserTooltip()||(u=null);this.tooltip_selfmesh&&(L=this.tooltip_selfmesh!==f,this.tooltip_selfmesh.material.color=this.tooltip_selfmesh.save_color,delete this.tooltip_selfmesh,c=!0);this.tooltip_mesh&&(e=this.tooltip_mesh,this.toplevel.remove(this.tooltip_mesh),delete this.tooltip_mesh,c=!0);if(y)c&&this.render3D(),
c&&u&&u.provideUserTooltip(null);else{if(a.use_itself)f.save_color=f.material.color,f.material.color=new b.Color(a.color),this.tooltip_selfmesh=f,c=L;else{c=!0;f=l.Box3D.Indexes;L=l.Box3D.Normals;y=l.Box3D.Vertices;var n=new b.Color(a.color?a.color:16711680),d=a.opacity||1;if(e){var K=e.geometry.attributes.position.array;e.geometry.attributes.position.needsUpdate=!0;e.material.color=n;e.material.opacity=d}else{K=new Float32Array(3*f.length);var q=new Float32Array(3*f.length);e=new b.BufferGeometry;
e.setAttribute("position",new b.BufferAttribute(K,3));e.setAttribute("normal",new b.BufferAttribute(q,3));n=new b.MeshBasicMaterial({color:n,opacity:d});e=new b.Mesh(e,n)}a.x1===a.x2&&console.warn("same tip X",a.x1,a.x2);a.y1===a.y2&&console.warn("same tip Y",a.y1,a.y2);a.z1===a.z2&&(a.z2=a.z1+1E-4);n=0;for(d=-3;n<f.length;++n){var p=y[f[n]];K[3*n]=a.x1+p.x*(a.x2-a.x1);K[3*n+1]=a.y1+p.y*(a.y2-a.y1);K[3*n+2]=a.z1+p.z*(a.z2-a.z1);q&&(0===n%6&&(d+=3),q[3*n]=L[d],q[3*n+1]=L[d+1],q[3*n+2]=L[d+2])}this.tooltip_mesh=
e;this.toplevel.add(e)}c&&this.render3D();c&&a.$painter&&"function"==typeof a.$painter.redrawProjection&&a.$painter.redrawProjection(a.ix-1,a.ix,a.iy-1,a.iy);c&&u&&u.getObject()&&u.provideUserTooltip({obj:u.getObject(),name:u.getObject().fName,bin:a.bin,cont:a.value,binx:a.ix,biny:a.iy,binz:a.iz,grx:(a.x1+a.x2)/2,gry:(a.y1+a.y2)/2,grz:(a.z1+a.z2)/2})}};JSROOT.v7.RFramePainter.prototype.set3DOptions=function(a){this.opt3d=a};JSROOT.v7.RFramePainter.prototype.drawXYZ=function(a,f){f||(f={});var c=-this.size_x3d,
e=this.size_x3d,L=-this.size_y3d,y=this.size_y3d,u=0,n=2*this.size_z3d,d=Math.round(.05*this.size_z3d),K=this.xmin,q=this.xmax,p=this.ymin,B=this.ymax,k=this.zmin,v=this.zmax,r=!1,t=!1;this.size_z3d||(c=this.xmin,e=this.xmax,L=this.ymin,y=this.ymax,u=this.zmin,n=this.zmax,d=.05*(n-u));"zoom_xmin"in this&&"zoom_xmax"in this&&this.zoom_xmin!==this.zoom_xmax&&(K=this.zoom_xmin,q=this.zoom_xmax);"zoom_ymin"in this&&"zoom_ymax"in this&&this.zoom_ymin!==this.zoom_ymax&&(p=this.zoom_ymin,B=this.zoom_ymax,
r=!0);"zoom_zmin"in this&&"zoom_zmax"in this&&this.zoom_zmin!==this.zoom_zmax&&(k=this.zoom_zmin,v=this.zoom_zmax,t=!0);f.use_y_for_z&&(this.zmin=this.ymin,this.zmax=this.ymax,k=p,v=B,t=r,p=0,B=1);this.lego_zmin=k;this.lego_zmax=v;void 0===f.zmult||t||(v*=f.zmult);this.x_handle=new JSROOT.v7.RAxisPainter(this.getDom(),this,this.xaxis,"x_");this.x_handle.setPadName(this.getPadName());this.x_handle.snapid=this.snapid;this.x_handle.configureAxis("xaxis",this.xmin,this.xmax,K,q,!1,[c,e]);this.x_handle.assignFrameMembers(this,
"x");this.y_handle=new JSROOT.v7.RAxisPainter(this.getDom(),this,this.yaxis,"y_");this.y_handle.setPadName(this.getPadName());this.y_handle.snapid=this.snapid;this.y_handle.configureAxis("yaxis",this.ymin,this.ymax,p,B,!1,[L,y]);this.y_handle.assignFrameMembers(this,"y");this.z_handle=new JSROOT.v7.RAxisPainter(this.getDom(),this,this.zaxis,"z_");this.z_handle.setPadName(this.getPadName());this.z_handle.snapid=this.snapid;this.z_handle.configureAxis("zaxis",this.zmin,this.zmax,k,v,!1,[u,n]);this.z_handle.assignFrameMembers(this,
"z");var h=new b.MeshBasicMaterial({color:0});K=new b.LineBasicMaterial({color:0});var g=.5*d;p=[];var z=1;B=this.x_handle.createTicks(!1,!0);v=this.y_handle.createTicks(!1,!0);k=this.z_handle.createTicks(!1,!0);q=new b.Object3D;q.axis_draw=!0;a.add(q);a=[];var x=0;for(r=this.xaxis;B.next();){t=B.grpos;var A=1===B.kind,w=this.x_handle.format(B.tick,2);B.last_major()?r&&r.fTitle||(w="x"):null===w&&(A=!1,w="");if(A&&w&&0<w.length){w=new b.TextGeometry(w,{font:JSROOT.threejs_font_helvetiker_regular,
size:d,height:0,curveSegments:5});w.computeBoundingBox();var D=w.boundingBox.max.x-w.boundingBox.min.x,m=w.boundingBox.max.y-w.boundingBox.min.y;w.center=!0;x=Math.max(x,m);w.grx=t;p.push(w);B.last_major()||(m=B.next_major_grpos()-t,0<D&&(z=Math.min(z,.9*m/D)),this.x_handle.isCenteredLabels()&&(w.grx+=m/2))}a.push(t,0,0,t,A?-g:.6*-g,0)}r&&r.fTitle&&(B=new b.TextGeometry(P.translateLaTeX(r.fTitle),{font:JSROOT.threejs_font_helvetiker_regular,size:d,height:0,curveSegments:5}),B.computeBoundingBox(),
B.center=!1,B.gry=2,B.grx=(c+e)/2,p.push(B));this.get3dZoomCoord=function(a,b){a=a[b];var c=this["scale_"+b+"min"],f=this["scale_"+b+"max"];switch(b){case "x":a=(a+this.size_x3d)/2/this.size_x3d;break;case "y":a=(a+this.size_y3d)/2/this.size_y3d;break;case "z":a=a/2/this.size_z3d}return a=this["log"+b]?Math.exp(Math.log(c)+a*(Math.log(f)-Math.log(c))):c+a*(f-c)};B=function(a,c,f){var d=new b.BufferGeometry;var e="z"===a?new Float32Array([0,0,0,4*g,0,2*c,4*g,0,0,0,0,0,0,0,2*c,4*g,0,2*c]):new Float32Array([-c,
0,0,c,4*-g,0,c,0,0,-c,0,0,-c,4*-g,0,c,4*-g,0]);d.setAttribute("position",new b.BufferAttribute(e,3));d.computeVertexNormals();var k=new b.MeshBasicMaterial({transparent:!0,vertexColors:b.NoColors,side:b.DoubleSide,opacity:0});d=new b.Mesh(d,k);d.zoom=a;d.size_3d=c;d.use_y_for_z=f;"y"==a&&d.rotateZ(Math.PI/2).rotateX(Math.PI);d.v1=new b.Vector3(e[0],e[1],e[2]);d.v2=new b.Vector3(e[6],e[7],e[8]);d.v3=new b.Vector3(e[3],e[4],e[5]);d.globalIntersect=function(a){if(this.v1&&this.v2&&this.v3){var c=new b.Plane;
c.setFromCoplanarPoints(this.v1,this.v2,this.v3);c.applyMatrix4(this.matrixWorld);var d=a.ray.origin.clone();a=d.clone().addScaledVector(a.ray.direction,1E10);if(c=c.intersectLine(new b.Line3(d,a),new b.Vector3))return d=-this.size_3d,a=this.size_3d,"z"===this.zoom&&(d=0,a=2*this.size_3d),c[this.zoom]<d?c[this.zoom]=d:c[this.zoom]>a&&(c[this.zoom]=a),c}};d.showSelection=function(a,c){var d=this.children?this.children[0]:null,f=this.zoom;if(!a||!c)return d&&(this.remove(d),l.disposeThreejsObject(d)),
d;if(!this.geometry)return!1;if(d)var e=d.geometry;else e=this.geometry.clone(),d=e.getAttribute("position").array,"z"===f?d[6]=d[3]=d[15]=g:d[4]=d[16]=d[13]=-g,d=new b.Mesh(e,new b.MeshBasicMaterial({color:65280,side:b.DoubleSide})),this.add(d);d=e.getAttribute("position").array;"z"==f?(d[2]=d[11]=d[8]=a[f],d[5]=d[17]=d[14]=c[f]):(d[0]=d[9]=d[12]=a[f],d[6]=d[3]=d[15]=c[f]);e.getAttribute("position").needsUpdate=!0;e.computeFaceNormals();return!0};return d};var I=new b.Object3D;I.position.set(0,L,
u);I.rotation.x=.25*Math.PI;I.xyid=2;a=l.createLineSegments(a,K);I.add(a);p.forEach(function(a){var c=a.boundingBox.max.x-a.boundingBox.min.x,d=a.center?a.grx-c/2:e-c;c=new b.Matrix4;c.set(z,0,0,d,0,z,0,(-x*z-1.5*g)*(a.gry||1),0,0,1,0,0,0,0,1);a=new b.Mesh(a,h);a.applyMatrix4(c);I.add(a)});f.zoom&&I.add(B("x",this.size_x3d));q.add(I);I=new b.Object3D;I.position.set(0,y,u);I.rotation.x=.75*Math.PI;I.add(new b.LineSegments(a.geometry,K));p.forEach(function(a){var c=a.boundingBox.max.x-a.boundingBox.min.x,
d=a.center?a.grx+c/2:e;c=new b.Matrix4;c.set(-z,0,0,d,0,z,0,(-x*z-1.5*g)*(a.gry||1),0,0,-1,0,0,0,0,1);a=new b.Mesh(a,h);a.applyMatrix4(c);I.add(a)});I.xyid=4;f.zoom&&I.add(B("x",this.size_x3d));q.add(I);p=[];z=1;x=0;a=[];for(r=this.yaxis;v.next();)t=v.grpos,A=1===v.kind,w=this.y_handle.format(v.tick,2),v.last_major()?r&&r.fTitle||(w="y"):null===w&&(A=!1,w=""),A&&(w=new b.TextGeometry(w,{font:JSROOT.threejs_font_helvetiker_regular,size:d,height:0,curveSegments:5}),w.computeBoundingBox(),D=w.boundingBox.max.x-
w.boundingBox.min.x,m=w.boundingBox.max.y-w.boundingBox.min.y,w.center=!0,x=Math.max(x,m),w.gry=t,p.push(w),v.last_major()||(m=v.next_major_grpos()-t,0<D&&(z=Math.min(z,.9*m/D)),this.y_handle.isCenteredLabels()&&(w.gry+=m/2))),a.push(0,t,0,A?-g:.6*-g,t,0);r&&r.fTitle&&(v=new b.TextGeometry(P.translateLaTeX(r.fTitle),{font:JSROOT.threejs_font_helvetiker_regular,size:d,height:0,curveSegments:5}),v.computeBoundingBox(),v.center=!1,v.grx=2,v.gry=(L+y)/2,p.push(v));if(!f.use_y_for_z){a=l.createLineSegments(a,
K);var J=new b.Object3D;J.position.set(c,0,u);J.rotation.y=-.25*Math.PI;J.add(a);p.forEach(function(a){var c=a.boundingBox.max.x-a.boundingBox.min.x,d=a.center?a.gry+c/2:y;c=new b.Matrix4;c.set(0,z,0,(-x*z-1.5*g)*(a.grx||1),-z,0,0,d,0,0,1,0,0,0,0,1);a=new b.Mesh(a,h);a.applyMatrix4(c);J.add(a)});J.xyid=3;f.zoom&&J.add(B("y",this.size_y3d));q.add(J);J=new b.Object3D;J.position.set(e,0,u);J.rotation.y=-.75*Math.PI;J.add(new b.LineSegments(a.geometry,K));p.forEach(function(a){var c=a.boundingBox.max.x-
a.boundingBox.min.x,d=a.center?a.gry-c/2:y-c;c=new b.Matrix4;c.set(0,z,0,(-x*z-1.5*g)*(a.grx||1),z,0,0,d,0,0,-1,0,0,0,0,1);a=new b.Mesh(a,h);a.applyMatrix4(c);J.add(a)});J.xyid=1;f.zoom&&J.add(B("y",this.size_y3d));q.add(J)}p=[];z=1;a=[];w=t=A=null;v=this.zaxis;r=0;this.size_z3d&&(A=[],t=[]);for(;k.next();){D=k.grpos;m=1==k.kind;var O=this.z_handle.format(k.tick,2);null===O&&(m=!1,O="");if(m&&O){O=new b.TextGeometry(O,{font:JSROOT.threejs_font_helvetiker_regular,size:d,height:0,curveSegments:5});
O.computeBoundingBox();var R=O.boundingBox.max.x-O.boundingBox.min.x,M=O.boundingBox.max.y-O.boundingBox.min.y;O.translate(-R,-M/2,0);O.grz=D;p.push(O);null!==w&&0<M&&(z=Math.min(z,.9*(D-w)/M));r=Math.max(r,R);w=D}A&&m&&A.push(c,0,D,e,0,D);t&&m&&t.push(0,L,D,0,y,D);a.push(0,0,D,m?g:.6*g,0,D)}A&&0<A.length&&(k=new b.LineDashedMaterial({color:0,dashSize:2,gapSize:2}),A=l.createLineSegments(A,k),A.position.set(0,y,0),A.grid=2,A.visible=!1,q.add(A),k=new b.LineSegments(A.geometry,k),k.position.set(0,
L,0),k.grid=4,k.visible=!1,q.add(k));t&&0<t.length&&(k=new b.LineDashedMaterial({color:0,dashSize:2,gapSize:2}),t=l.createLineSegments(t,k),t.position.set(e,0,0),t.grid=3,t.visible=!1,q.add(t),k=new b.LineSegments(t.geometry,k),k.position.set(c,0,0),k.grid=1,k.visible=!1,q.add(k));var G=[];a=l.createLineSegments(a,K);for(k={$jscomp$loop$prop$n$63:0};4>k.$jscomp$loop$prop$n$63;k={$jscomp$loop$prop$n$63:k.$jscomp$loop$prop$n$63},++k.$jscomp$loop$prop$n$63)G.push(new b.Object3D),p.forEach(function(a){return function(c){var d=
new b.Matrix4;d.set(-z,0,0,2*g,0,0,1,0,0,z,0,c.grz);c=new b.Mesh(c,h);c.applyMatrix4(d);G[a.$jscomp$loop$prop$n$63].add(c)}}(k)),v&&v.fTitle&&(A=new b.TextGeometry(P.translateLaTeX(v.fTitle),{font:JSROOT.threejs_font_helvetiker_regular,size:d,height:0,curveSegments:5}),A.computeBoundingBox(),w=n-(A.boundingBox.max.x-A.boundingBox.min.x),A.rotateZ(Math.PI/2),t=new b.Matrix4,t.set(-z,0,0,3*g+r,0,0,1,0,0,z,0,w),A=new b.Mesh(A,h),A.applyMatrix4(t),G[k.$jscomp$loop$prop$n$63].add(A)),G[k.$jscomp$loop$prop$n$63].add(0==
k.$jscomp$loop$prop$n$63?a:new b.LineSegments(a.geometry,K)),f.zoom&&G[k.$jscomp$loop$prop$n$63].add(B("z",this.size_z3d,f.use_y_for_z)),G[k.$jscomp$loop$prop$n$63].zid=k.$jscomp$loop$prop$n$63+2,q.add(G[k.$jscomp$loop$prop$n$63]);G[0].position.set(c,y,0);G[0].rotation.z=.75*Math.PI;G[1].position.set(e,y,0);G[1].rotation.z=.25*Math.PI;G[2].position.set(e,L,0);G[2].rotation.z=-.25*Math.PI;G[3].position.set(c,L,0);G[3].rotation.z=-.75*Math.PI;if(0!==this.size_z3d){f=l.createLineSegments([c,0,0,e,0,
0],K,null,!0);for(d=0;2>d;++d)p=new b.LineSegments(f,K),p.position.set(0,L,0===d?u:n),p.xyboxid=2,p.bottom=0==d,q.add(p),p=new b.LineSegments(f,K),p.position.set(0,y,0===d?u:n),p.xyboxid=4,p.bottom=0==d,q.add(p);L=l.createLineSegments([0,L,0,0,y,0],K,null,!0);for(f=0;2>f;++f)d=new b.LineSegments(L,K),d.position.set(c,0,0===f?u:n),d.xyboxid=3,d.bottom=0==f,q.add(d),d=new b.LineSegments(L,K),d.position.set(e,0,0===f?u:n),d.xyboxid=1,d.bottom=0==f,q.add(d);c=l.createLineSegments([0,0,u,0,0,n],K,null,
!0);for(u=0;4>u;++u)n=new b.LineSegments(c,K),n.zboxid=G[u].zid,n.position.copy(G[u].position),q.add(n)}};JSROOT.v7.RHistPainter.prototype.drawLego=function(){var a=this;if(this.draw_content){var f=l.Box3D.Vertices,c=l.Box3D.Indexes,e=l.Box3D.Normals,L=l.Box3D.Segments,y=[0,1,1,2,2,3,3,0],u=[new b.Vector3(0,0,0),new b.Vector3(0,1,0),new b.Vector3(1,1,0),new b.Vector3(1,0,0)],n=this.getFramePainter(),d=n.z_handle.getScaleMin(),K=n.z_handle.getScaleMax(),q=this.prepareDraw({rounding:!1,use3d:!0,extra:1}),
p=q.i1,B=q.i2,k=q.j1,v=q.j2,r=q.stepi,t=q.stepj,h,g,z,x,A,w,D,C=this.getHisto(),I=C?C.$baseh:null,J=11===this.options.Lego||13===this.options.Lego;if(!(p>=B||k>=v)){var O=function(b,c,f){w=C.getBinContent(b+1,c+1);A=I?I.getBinContent(b+1,c+1):!1!==a.options.BaseLine?a.options.BaseLine:a.options.Zero?d:0;w<A&&(b=A,A=w,w=b);if(A>=N||w<T)return!1;D=w===T||A>=w;return!D||0<f?!0:C.$baseh?!1:a.options.Zero||0<d?!0:a._show_empty_bins},R=65535>C.getBin(B,v),M=[d,K],G=null;if(12===this.options.Lego||14===
this.options.Lego)G=n.getHistPalette(),this.createContour(n,G,{full_z_range:!0}),M=G.getContour(),d=M[0],K=M[M.length-1];for(var H=0;H<M.length-1;++H){var T=M[H];var N=M[H+1];G&&H==M.length-2&&N<K&&(N=K);var U=0,F=0,E=x=0,P=n.grz(T),Q=n.grz(N);for(h=p;h<B;h+=r)for(g=k;g<v;g+=t)if(O(h,g,H)){var Y=!D&&0<H;var da=!D&&w>N&&H<M.length-2;x+=D?12:c.length;Y&&(x-=6);da&&(x-=6);J&&!D&&(x-=12,E+=12)}var aa=new Float32Array(3*x),ea=new Float32Array(3*x),Z=R?new Uint16Array(x/3):new Uint32Array(x/3),S=z=null,
V=null,X=0,W=0,ba=Y=void 0,fa=void 0;0<E&&(z=new Float32Array(3*E),S=new Float32Array(3*E),V=R?new Uint16Array(E/3):new Uint32Array(E/3));for(h=p;h<B;h+=r){x=q.grx[h]+q.xbar1*(q.grx[h+r]-q.grx[h]);var ca=q.grx[h]+q.xbar2*(q.grx[h+r]-q.grx[h]);for(g=k;g<v;g+=t)if(O(h,g,H)){Y=!D&&0<H;da=!D&&w>N&&H<M.length-2;var ha=q.gry[g]+q.ybar1*(q.gry[g+t]-q.gry[g]);var ja=q.gry[g]+q.ybar2*(q.gry[g+t]-q.gry[g]);U=A<=T?P:n.grz(A);F=w>N?Q:n.grz(w);ba=fa=0;D&&(fa+=12,ba+=24);var ka=c.length,la=C.getBin(h+1,g+1);for(Y&&
(ka-=6);ba<ka;)Y=f[c[ba]],J&&12>ba?(z[W]=x+Y.x*(ca-x),z[W+1]=ha+Y.y*(ja-ha),z[W+2]=U+Y.z*(F-U),S[W]=e[fa],S[W+1]=e[fa+1],S[W+2]=e[fa+2],0===W%9&&(V[W/9]=la),W+=3):(aa[X]=x+Y.x*(ca-x),aa[X+1]=ha+Y.y*(ja-ha),aa[X+2]=U+Y.z*(F-U),ea[X]=e[fa],ea[X+1]=e[fa+1],ea[X+2]=e[fa+2],0===X%9&&(Z[X/9]=la),X+=3),++ba,0===ba%6&&(fa+=3,da&&ba===c.length-12&&(ba+=6,fa+=3))}}h=new b.BufferGeometry;h.setAttribute("position",new b.BufferAttribute(aa,3));h.setAttribute("normal",new b.BufferAttribute(ea,3));g=3;x=this.getColor(g);
if(G)x=G.getColor(H);else if(1===this.options.Lego||2>g)g=1,x="white";ca=new b.MeshBasicMaterial({color:x});h=new b.Mesh(h,ca);h.face_to_bins_index=Z;h.painter=this;h.zmin=d;h.zmax=K;h.baseline=!1!==this.options.BaseLine?this.options.BaseLine:this.options.Zero?d:0;h.tip_color=3===g?16711680:65280;h.handle=q;h.tooltip=function(a){if(!Number.isInteger(a.faceIndex))return console.error("intersect.faceIndex not provided, three.js version "+b.REVISION+", expected 127"),null;if(0>a.faceIndex||a.faceIndex>=
this.face_to_bins_index.length)return null;var c=this.painter,d=this.handle,f=c.getFramePainter(),e=c.getHisto();a=c.get3DToolTip(this.face_to_bins_index[a.faceIndex]);var g=a.ix-1,k=g+d.stepi,h=a.iy-1,n=h+d.stepj;a.x1=Math.max(-f.size_x3d,d.grx[g]+d.xbar1*(d.grx[k]-d.grx[g]));a.x2=Math.min(f.size_x3d,d.grx[g]+d.xbar2*(d.grx[k]-d.grx[g]));a.y1=Math.max(-f.size_y3d,d.gry[h]+d.ybar1*(d.gry[n]-d.gry[h]));a.y2=Math.min(f.size_y3d,d.gry[h]+d.ybar2*(d.gry[n]-d.gry[h]));d=this.baseline;k=a.value;e.$baseh&&
(d=e.$baseh.getBinContent(g+1,h+1));k<d&&(e=d,d=k,k=e);a.z1=f.grz(Math.max(this.zmin,d));a.z2=f.grz(Math.min(this.zmax,k));a.color=this.tip_color;c.is_projection&&2==c.getDimension()&&(a.$painter=c);return a};n.toplevel.add(h);0<E&&(ca=new b.BufferGeometry,ca.setAttribute("position",new b.BufferAttribute(z,3)),ca.setAttribute("normal",new b.BufferAttribute(S,3)),g=2>g?new b.Color(16711680):new b.Color(m.rgb(x).darker(.5).toString()),g=new b.MeshBasicMaterial({color:g}),g=new b.Mesh(ca,g),g.face_to_bins_index=
V,g.painter=this,g.handle=h.handle,g.tooltip=h.tooltip,g.zmin=h.zmin,g.zmax=h.zmax,g.baseline=h.baseline,g.tip_color=h.tip_color,n.toplevel.add(g))}if(!(12<this.options.Lego)){x=ca=0;c=!0;N=K;T=d;for(h=p;h<B;h+=r)for(g=k;g<v;g+=t)O(h,g,0)&&(ca+=D?u.length:f.length,x+=D?y.length:L.length);65520<ca&&(c=!1);c||(ca=3*x);e=new Float32Array(3*ca);J=c?new Uint16Array(x):null;R=n.grz(d);M=n.grz(K);E=V=H=G=0;for(h=p;h<B;h+=r)for(x=q.grx[h]+q.xbar1*(q.grx[h+r]-q.grx[h]),ca=q.grx[h]+q.xbar2*(q.grx[h+r]-q.grx[h]),
g=k;g<v;g+=t)if(O(h,g,0))if(ha=q.gry[g]+q.ybar1*(q.gry[g+t]-q.gry[g]),ja=q.gry[g]+q.ybar2*(q.gry[g+t]-q.gry[g]),G=A<=d?R:n.grz(A),H=w>K?M:n.grz(w),S=D?y:L,Z=D?u:f,c){for(p=0;p<S.length;++p)J[E++]=V/3+S[p];for(p=0;p<Z.length;++p)z=Z[p],e[V]=x+z.x*(ca-x),e[V+1]=ha+z.y*(ja-ha),e[V+2]=G+z.z*(H-G),V+=3}else for(p=0;p<S.length;++p)z=Z[S[p]],e[V]=x+z.x*(ca-x),e[V+1]=ha+z.y*(ja-ha),e[V+2]=G+z.z*(H-G),V+=3;f=this.v7EvalColor("line_color","lightblue");f=new b.LineBasicMaterial({color:new b.Color(f),linewidth:this.v7EvalAttr("line_width",
1)});f=l.createLineSegments(e,f,c?J:null);n.toplevel.add(f)}}}};JSROOT.v7.RH1Painter.prototype.draw3D=function(a){var b=this;this.mode3d=!0;var c=this.getFramePainter(),e=this.isMainPainter();if("resize"==a)return e&&c.resize3D()&&c.render3D(),Promise.resolve(this);this.deleteAttr();this.scanContent(!0);e&&(c.create3DScene(this.options.Render3D),c.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,null,this.ymin,this.ymax,null,0,0),c.set3DOptions(this.options),c.drawXYZ(c.toplevel,{use_y_for_z:!0,
zmult:1.1,zoom:JSROOT.settings.Zooming,ndim:1}));return c.mode3d?this.drawingBins(a).then(function(){var a=b.getFramePainter();b.drawLego();b.updatePaletteDraw();a.render3D();a.addKeysHandler();return b}):Promise.resolve(this)};JSROOT.v7.RH2Painter.prototype.draw3D=function(a){var b=this;this.mode3d=!0;var c=this.getFramePainter(),e=this.isMainPainter();if("resize"==a)return e&&c.resize3D()&&c.render3D(),Promise.resolve(this);var l=1.1;this.zmin=c.logz?.3*this.gminposbin:this.gminbin;this.zmax=this.gmaxbin;
-1111!==this.options.minimum&&(this.zmin=this.options.minimum);-1111!==this.options.maximum&&(this.zmax=this.options.maximum,l=1);c.logz&&0>=this.zmin&&(this.zmin=1E-5*this.zmax);this.deleteAttr();e&&(c.create3DScene(this.options.Render3D),c.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,this.getAxis("y"),this.ymin,this.ymax,null,this.zmin,this.zmax),c.set3DOptions(this.options),c.drawXYZ(c.toplevel,{zmult:l,zoom:JSROOT.settings.Zooming,ndim:2}));return c.mode3d?this.drawingBins(a).then(function(){var a=
b.getFramePainter();b.draw3DBins();a.render3D();a.addKeysHandler();return b}):Promise.resolve(this)};JSROOT.v7.RH2Painter.prototype.draw3DBins=function(){if(this.draw_content){if(this.isRH2Poly())return this.drawPolyLego();if(this.options.Surf)return this.drawSurf();if(this.options.Error)return this.drawError();if(this.options.Contour)return this.drawContour3D(!0);this.drawLego();this.updatePaletteDraw()}};JSROOT.v7.RH2Painter.prototype.drawContour3D=function(a){var b=this.getFramePainter(),c=this.prepareDraw({rounding:!1,
use3d:!0,extra:100,middle:0}),e=b.getHistPalette(),L=2*b.size_z3d,y=[];this.createContour(b,e,{full_z_range:!0});var u=e.getContour();this.buildContour(c,u,e,function(c,d,f,e,l,m){if(!(3>l-e)){if(a&&(L=b.grz(u[m]),0>L||L>2*b.size_z3d))return;for(c=e;c<l;++c)y.push(d[c],f[c],L),y.push(d[c+1],f[c+1],L)}});c=l.createLineSegments(y,ma(this));b.toplevel.add(c)};JSROOT.v7.RH2Painter.prototype.drawSurf=function(){function a(a,b,c,d,f,e){if(z){var g=0>c?-1:c>2*n.size_z3d?1:0,k=0>e?-1:e>2*n.size_z3d?1:0;if(g!==
k||0===g){if(!C)return++R;if(0!==g){var h=e-c;c=0>g?0:2*n.size_z3d;a=d-(d-a)/h*(e-c);b=f-(f-b)/h*(e-c)}0!==k&&(g=c-e,e=0>k?0:2*n.size_z3d,d=a-(a-d)/g*(c-e),f=b-(b-f)/g*(c-e));M[G]=a;M[G+1]=b;M[G+2]=c;G+=3;M[G]=d;M[G+1]=f;M[G+2]=e;G+=3}}}function f(a,b,c,d,f,e,g,k){E>=F.length&&console.log("more than 6 points???");c=(g-c)/(e-c);e=3;0!==P&&Math.abs(c)<Math.abs(P)&&(F[E]=F[E-3],F[E+1]=F[E-2],F[E+2]=F[E-1],E-=3,e=6);F[E]=a+c*(d-a);F[E+1]=b+c*(f-b);F[E+2]=g;k&&T&&(Q[Y]=F[E],Q[Y+1]=F[E+1],Q[Y+2]=F[E+2],
Y+=3);E+=e;P=c}function c(a,b,c){b=8*((b-d.i1)/B*r+(c-d.j1)/k);if(0<=U[b])return console.error("More than 8 vertexes for the bin");c=b+8+U[b];U[b]--;U[c]=a}function e(a){for(var b=d.i1;b<d.i2;b+=B)for(var c=d.j1;c<d.j2;c+=k){var f=8*((b-d.i1)/B*r+(c-d.j1)/k);if(-1!==U[f]){var e=0<=U[f]?f:f+9+U[f];f+=8;for(var g=0,h=0,n=0,q=e;q<f;++q){var l=U[q];if(0>l)return console.error("FAILURE in NORMALS RECALCULATIONS");g+=a[l];h+=a[l+1];n+=a[l+2]}g/=f-e;h/=f-e;for(n/=f-e;e<f;++e)q=U[e],a[q]=g,a[q+1]=h,a[q+2]=
n}}}function L(a,b,d,e,h,n,l,r,u,v){for(var w=1;w<g.length;++w){var p=d<g[w-1]?-1:d>g[w]?1:0,t=n<g[w-1]?-1:n>g[w]?1:0,y=u<g[w-1]?-1:u>g[w]?1:0,x=p+t+y;if(3!==x){if(-3===x)break;if(C){if(E=Y=0,0===p&&(F[E]=a,F[E+1]=b,F[E+2]=d,E+=3),p!==t&&(P=0,(0>p||0>t)&&f(a,b,d,e,h,n,g[w-1]),(0<p||0<t)&&f(a,b,d,e,h,n,g[w],!0)),0===t&&(F[E]=e,F[E+1]=h,F[E+2]=n,E+=3),t!==y&&(P=0,(0>t||0>y)&&f(e,h,n,l,r,u,g[w-1]),(0<t||0<y)&&f(e,h,n,l,r,u,g[w],!0)),0===y&&(F[E]=l,F[E+1]=r,F[E+2]=u,E+=3),y!==p&&(P=0,(0>y||0>p)&&f(l,
r,u,a,b,d,g[w-1]),(0<y||0<p)&&f(l,r,u,a,b,d,g[w],!0)),0!==E)if(9>E)console.log("found less than 3 points",E/3);else{if(T&&6===Y){for(p=0;6>p;++p)T[N+p]=Q[p];N+=6}p=J[w];t=O[w];A&&9===E&&(c(t,m,q),c(t+3,m+1,v?q+k:q),c(t+6,v?m:m+B,q+k));for(y=3;y<E-3;y+=3)p[t]=F[0],p[t+1]=F[1],p[t+2]=F[2],t+=3,p[t]=F[y],p[t+1]=F[y+1],p[t+2]=F[y+2],t+=3,p[t]=F[y+3],p[t+1]=F[y+4],p[t+2]=F[y+5],t+=3;O[w]=t}}else x=Math.abs(t-p)+Math.abs(y-t)+Math.abs(p-y),0===p&&++x,0===t&&++x,0===y&&++x,1!==x&&2!==x||console.error("FOND npnts",
x),2<x&&(void 0===I[w]&&(I[w]=0),I[w]+=x-2),!(0<p||0<t||0<y)||p===t&&t===y&&y===p||++H}}}var y=this,u=this.getHisto(),n=this.getFramePainter(),d=this.prepareDraw({rounding:!1,use3d:!0,extra:1,middle:.5}),m,q,p,B=d.stepi,k=d.stepj;var v=d.i2-d.i1;var r=d.j2-d.j1,t=n.z_handle.getScaleMin();1<B&&(v=Math.round(v/B),v*B<d.i2-d.i1&&v++);1<k&&(r=Math.round(r/k),r*k<d.j2-d.j1&&r++);var h=n.logz?function(a){return a<t?-.1:n.grz(a)}:n.grz;if(!(2>d.i2-d.i1||2>d.j2-d.j1)){var g=p=null,z=!0,x=!1,A=!1,w=null;var D=
0;switch(this.options.Surf){case 11:D=2;break;case 12:case 15:case 17:D=2;z=!1;break;case 14:z=!1;A=!0;break;case 16:D=1;x=!0;z=!1;break;default:p=n.z_handle.createTicks(!0),x=!0}0<D&&(w=n.getHistPalette(),2==D&&this.createContour(n,w,{full_z_range:!0}),p=w.getContour());if(p)for(g=new Float32Array(p.length),D=0;D<p.length;++D)g[D]=h(p[D]);else g=[0,2*n.size_z3d];var C,I=[],J=[],O=[],R=0,M=null,G=0,H=0,T=null,N=0,U=[],F=new Float32Array(18),E=0,P=0,Q=new Float32Array(6),Y=0;if(A)for(U=new Int32Array(v*
r*8),v=0;v<U.length;++v)U[v]=-1;for(C=0;2>C;++C){if(C){for(v=1;v<g.length;++v)I[v]&&(J[v]=new Float32Array(9*I[v]),O[v]=0);z&&0<R&&(M=new Float32Array(6*R));x&&0<H&&(T=new Float32Array(6*H))}for(m=d.i1;m<d.i2-B;m+=B)for(v=d.grx[m],D=d.grx[m+B],q=d.j1;q<d.j2-k;q+=k){p=d.gry[q];var da=d.gry[q+k];var aa=h(u.getBinContent(m+1,q+1));var ea=h(u.getBinContent(m+1,q+1+k));var Z=h(u.getBinContent(m+1+k,q+1));var S=h(u.getBinContent(m+1+k,q+1+k));L(v,p,aa,D,da,S,v,da,ea,!0);L(v,p,aa,D,p,Z,D,da,S,!1);a(v,da,
ea,v,p,aa);a(v,p,aa,D,p,Z);m===d.i2-2&&a(D,p,Z,D,da,S);q===d.j2-2&&a(v,da,ea,D,da,S)}}for(u=1;u<g.length;++u)J[u]&&(O[u]!==9*I[u]&&console.error("SURF faces missmatch lvl",u,"faces",I[u],"index",O[u],"check",9*I[u]-O[u]),h=new b.BufferGeometry,h.setAttribute("position",new b.BufferAttribute(J[u],3)),h.computeVertexNormals(),A&&1===u&&e(h.getAttribute("normal").array),x=x=void 0,x=w?w.getColor(u-1):this.getColor(5),x=14===this.options.Surf?new b.MeshLambertMaterial({color:x,side:b.DoubleSide}):new b.MeshBasicMaterial({color:x,
side:b.DoubleSide}),h=new b.Mesh(h,x),n.toplevel.add(h),h.painter=this);M&&(6*R!==G&&console.error("SURF lines mismmatch nsegm",R," lindx",G,"difference",6*R-G),w=this.getColor(7),w=new b.LineBasicMaterial({color:new b.Color(w),linewidth:this.v7EvalAttr("line_width",1)}),w=l.createLineSegments(M,w),w.painter=this,n.toplevel.add(w));T&&(6*H!==N&&console.error("SURF grid draw mismatch ngridsegm",H,"gindx",N,"diff",6*H-N),w=1===this.options.Surf?new b.LineDashedMaterial({color:0,dashSize:2,gapSize:2}):
new b.LineBasicMaterial({color:new b.Color(this.v7EvalColor("line_color","lightblue"))}),w=l.createLineSegments(T,w),w.painter=this,n.toplevel.add(w));17===this.options.Surf&&this.drawContour3D();if(13===this.options.Surf){d=this.prepareDraw({rounding:!1,use3d:!0,extra:100,middle:0});w=this.getContour();var V=this.getHistPalette(),X=-1,W=2*n.size_z3d;this.buildContour(d,w,V,function(a,c,d,f,e){c[e]===c[f]&&d[e]===d[f]&&e--;if(!(3>e-f)){for(var g=[],h=f;h<=e;++h)h!==f&&c[h]===c[h-1]&&d[h]===d[h-1]||
g.push(new b.Vector2(c[h],d[h]));if(!(3>g.length)&&(f=b.ShapeUtils.triangulateShape(g,[]))&&0!==f.length){if(0>X||X!==a)X=a,W+=1E-4*n.size_z3d;c=new Float32Array(9*f.length);d=new Float32Array(9*f.length);for(h=e=0;h<f.length;++h)for(var k=f[h],w=0;3>w;++w){var p=g[k[w]];c[e]=p.x;c[e+1]=p.y;c[e+2]=W;d[e]=0;d[e+1]=0;d[e+2]=1;e+=3}g=new b.BufferGeometry;g.setAttribute("position",new b.BufferAttribute(c,3));g.setAttribute("normal",new b.BufferAttribute(d,3));a=V.getColor(a);a=new b.MeshBasicMaterial({color:a,
side:b.DoubleSide,opacity:.5});a=new b.Mesh(g,a);a.painter=y;n.toplevel.add(a)}}})}this.updatePaletteDraw()}};JSROOT.v7.RH2Painter.prototype.drawError=function(){for(var a=this.getFramePainter(),f=this.getHisto(),c=this.prepareDraw({rounding:!1,use3d:!0,extra:1}),e=a.z_handle.getScaleMin(),m=a.z_handle.getScaleMax(),y,u,n,d,K,q,p,B,k,v=0,r=null,t=null,h=0,g=c.stepi,z=c.stepj,x=0;2>x;++x){for(y=c.i1;y<c.i2;y+=g)for(K=c.grx[y],p=c.grx[y+g],u=c.j1;u<c.j2;u+=z)if(n=f.getBinContent(y+1,u+1),!(n<e||n>m)){if(q=
n===e)q=this.options.Zero||0<e?!1:!this._show_empty_bins;q||(0===x?v+=3:(d=f.getBinError(y+1,u+1),t[h/18]=f.getBin(y+1,u+1),q=c.gry[u],B=c.gry[u+z],k=a.grz(n-d<e?e:n-d),n=a.grz(n+d>m?m:n+d),r[h]=K,r[h+3]=p,r[h+1]=r[h+4]=(q+B)/2,r[h+2]=r[h+5]=(k+n)/2,h+=6,r[h]=r[h+3]=(K+p)/2,r[h+1]=q,r[h+4]=B,r[h+2]=r[h+5]=(k+n)/2,h+=6,r[h]=r[h+3]=(K+p)/2,r[h+1]=r[h+4]=(q+B)/2,r[h+2]=k,r[h+5]=n,h+=6))}if(0===x){if(0===v)return;r=new Float32Array(6*v);t=new Int32Array(v/3)}}f=new b.Color(this.v7EvalColor("line_color",
"lightblue"));y=new b.LineBasicMaterial({color:f,linewidth:this.v7EvalAttr("line_width",1)});r=l.createLineSegments(r,y);r.painter=this;r.intersect_index=t;r.zmin=e;r.zmax=m;r.tip_color=.5>f.g?65280:16711680;r.handle=c;r.tooltip=function(a){if(!Number.isInteger(a.index))return console.error("intersect.index not provided, three.js version "+b.REVISION+", expected 127"),null;var c=Math.floor(a.index/6);if(0>c||c>=this.intersect_index.length)return null;var d=this.painter;a=d.getFramePainter();c=d.get3DToolTip(this.intersect_index[c]);
d=this.handle;var e=c.ix-1,f=e+d.stepi,g=c.iy-1,h=g+d.stepj;c.x1=Math.max(-a.size_x3d,d.grx[e]);c.x2=Math.min(a.size_x3d,d.grx[f]);c.y1=Math.max(-a.size_y3d,d.gry[g]);c.y2=Math.min(a.size_y3d,d.gry[h]);c.z1=a.grz(c.value-c.error<this.zmin?this.zmin:c.value-c.error);c.z2=a.grz(c.value+c.error>this.zmax?this.zmax:c.value+c.error);c.color=this.tip_color;return c};a.toplevel.add(r)};JSROOT.v7.RH2Painter.prototype.drawPolyLego=function(){var a=this.getHisto(),f=this.getHistPalette(),c=this.getFramePainter(),
e=c.z_handle.getScaleMin(),l=c.z_handle.getScaleMax(),y,u=a.fBins.arr.length,n=c.grz(e);this.maxbin=this.gmaxbin;this.minbin=this.gminbin;this.minposbin=this.gminposbin;for(y=0;y<u;++y){var d=a.fBins.arr[y];if(!(d.fContent<e)){var m=f.getContourIndex(d.fContent);if(null!==m&&!(d.fXmin>c.scale_xmax||d.fXmax<c.scale_xmin||d.fYmin>c.scale_ymax||d.fYmax<c.scale_ymin)){var q=c.grz(d.fContent>l?l:d.fContent);var p=[],B=[],k=1,v=d.fPoly,r=0;"TMultiGraph"==v._typename&&(k=d.fPoly.fGraphs.arr.length,v=null);
for(var t=0;t<k;++t){if(!v||0<t)v=d.fPoly.fGraphs.arr[t];for(var h=v.fNpoints,g=v.fX,z=v.fY;2<h&&g[0]===g[h-1]&&z[0]===z[h-1];)--h;for(var x=void 0,A=void 0,w=0;2>w;++w){var D=void 0,C=void 0,I=void 0,J=void 0,O=c.size_x3d*c.size_z3d,R=0<w?0:O/1E6;x=[];A=null;for(var M=0;M<h;++M)I=c.grx(g[M]),J=c.gry(z[M]),0<M&&(O=(I-D)*(I-D)+(J-C)*(J-C)),O>R&&(x.push(new b.Vector2(I,J)),D=I,C=J);try{2<x.length&&(A=b.ShapeUtils.triangulateShape(x,[]))}catch(G){A=null}if(A&&A.length>x.length-3)break}A&&A.length&&x&&
(p.push(x),B.push(A),r+=2*A.length,q>n&&(r+=2*x.length))}d=new Float32Array(9*r);for(v=k=0;v<p.length;++v){r=p[v];t=B[v];for(h=0;2>h;++h)for(g=0;g<t.length;++g)A=t[g],z=r[A[0]],x=r[A[0===h?2:1]],A=r[A[0===h?1:2]],d[k]=z.x,d[k+1]=z.y,d[k+2]=h?q:n,k+=3,d[k]=x.x,d[k+1]=x.y,d[k+2]=h?q:n,k+=3,d[k]=A.x,d[k+1]=A.y,d[k+2]=h?q:n,k+=3;if(q>n)for(t=0;t<r.length;++t)h=r[t],g=r[0<t?t-1:r.length-1],d[k]=h.x,d[k+1]=h.y,d[k+2]=n,k+=3,d[k]=g.x,d[k+1]=g.y,d[k+2]=n,k+=3,d[k]=g.x,d[k+1]=g.y,d[k+2]=q,k+=3,d[k]=h.x,d[k+
1]=h.y,d[k+2]=n,k+=3,d[k]=g.x,d[k+1]=g.y,d[k+2]=q,k+=3,d[k]=h.x,d[k+1]=h.y,d[k+2]=q,k+=3}p=new b.BufferGeometry;p.setAttribute("position",new b.BufferAttribute(d,3));p.computeVertexNormals();m=this.fPalette.getColor(m);m=new b.MeshBasicMaterial({color:m});m=new b.Mesh(p,m);c.toplevel.add(m);m.painter=this;m.bins_index=y;m.draw_z0=n;m.draw_z1=q;m.tip_color=65280;m.tooltip=function(){var a=this.painter,b=a.getFramePainter(),c=a.getObject().fBins.arr[this.bins_index];return{use_itself:!0,x1:b.grx(c.fXmin),
x2:b.grx(c.fXmax),y1:b.gry(c.fYmin),y2:b.gry(c.fYmax),z1:this.draw_z0,z2:this.draw_z1,bin:this.bins_index,value:c.fContent,color:this.tip_color,lines:a.getPolyBinTooltips(this.bins_index)}}}}}};Q.prototype=Object.create(JSROOT.v7.RHistPainter.prototype);Q.prototype.getDimension=function(){return 3};Q.prototype.scanContent=function(a){if(!(a&&this.nbinsx&&this.nbinsy&&this.nbinsz)&&(a=this.getHisto())){this.extractAxesProperties(3);if(this.isDisplayItem())this.gminbin=a.fContMin,this.gminposbin=0<
a.fContMinPos?a.fContMinPos:null,this.gmaxbin=a.fContMax;else{this.gminbin=this.gmaxbin=a.getBinContent(1,1,1);for(var b=0;b<this.nbinsx;++b)for(var c=0;c<this.nbinsy;++c)for(var e=0;e<this.nbinsz;++e){var l=a.getBinContent(b+1,c+1,e+1);l<this.gminbin?this.gminbin=l:l>this.gmaxbin&&(this.gmaxbin=l)}}this.draw_content=0<this.gmaxbin}};Q.prototype.countStat=function(){var a=this.getHisto(),b=this.getAxis("x"),c=this.getAxis("y"),e=this.getAxis("z"),l=0,m=0,u=0,n=0,d=0,K=0,q=0,p=this.getSelectIndex("x",
"left"),B=this.getSelectIndex("x","right"),k=this.getSelectIndex("y","left"),v=this.getSelectIndex("y","right"),r=this.getSelectIndex("z","left"),t=this.getSelectIndex("z","right"),h=this.getFramePainter(),g={name:a.fName,entries:0,integral:0,meanx:0,meany:0,meanz:0,rmsx:0,rmsy:0,rmsz:0},z,x,A;for(z=1;z<=this.nbinsx;++z){var w=b.GetBinCoord(z-.5);var D=z<=p+1?0:z>B+1?2:1;for(x=1;x<=this.nbinsy;++x){var C=c.GetBinCoord(x-.5);var I=x<=k+1?0:x>v+1?2:1;for(A=1;A<=this.nbinsz;++A){var J=e.GetBinCoord(A-
.5);var O=A<=r+1?0:A>t+1?2:1;var R=a.getBinContent(z,x,A);g.entries+=R;1==D&&1==I&&1==O&&(l+=R,m+=w*R,u+=C*R,n+=J*R,d+=w*w*R,K+=C*C*R,q+=J*J*R)}}}0<a.fTsumw&&!h.isAxisZoomed("x")&&!h.isAxisZoomed("y")&&!h.isAxisZoomed("z")&&(l=a.fTsumw,m=a.fTsumwx,d=a.fTsumwx2,u=a.fTsumwy,K=a.fTsumwy2,n=a.fTsumwz,q=a.fTsumwz2);0<l&&(g.meanx=m/l,g.meany=u/l,g.meanz=n/l,g.rmsx=Math.sqrt(Math.abs(d/l-g.meanx*g.meanx)),g.rmsy=Math.sqrt(Math.abs(K/l-g.meany*g.meany)),g.rmsz=Math.sqrt(Math.abs(q/l-g.meanz*g.meanz)));g.integral=
l;1<a.fEntries&&(g.entries=a.fEntries);return g};Q.prototype.fillStatistic=function(a,b){var c=this.countStat(),e=b%10,f=Math.floor(b/10)%10,l=Math.floor(b/100)%10,m=Math.floor(b/1E3)%10;b=Math.floor(b/1E6)%10;a.clearStat();0<e&&a.addText(c.name);0<f&&a.addText("Entries = "+a.format(c.entries,"entries"));0<l&&(a.addText("Mean x = "+a.format(c.meanx)),a.addText("Mean y = "+a.format(c.meany)),a.addText("Mean z = "+a.format(c.meanz)));0<m&&(a.addText("Std Dev x = "+a.format(c.rmsx)),a.addText("Std Dev y = "+
a.format(c.rmsy)),a.addText("Std Dev z = "+a.format(c.rmsz)));0<b&&a.addText("Integral = "+a.format(c.integral,"entries"));return!0};Q.prototype.getBinTooltips=function(a,b,c){var e=[],f=this.getHisto(),m=1,u=1,n=1;this.isDisplayItem()&&(m=f.stepx||1,u=f.stepy||1,n=f.stepz||1);e.push(this.getObjectHint());e.push("x = "+this.getAxisBinTip("x",a,m)+"  xbin="+a);e.push("y = "+this.getAxisBinTip("y",b,u)+"  ybin="+b);e.push("z = "+this.getAxisBinTip("z",c,n)+"  zbin="+c);a=f.getBinContent(a+1,b+1,c+1);
m="entries = "+(1<m||1<u||1<n?"~":"");a===Math.round(a)?e.push(m+a):e.push(m+l.floatToString(a,JSROOT.gStyle.fStatFormat));return e};Q.prototype.draw3DScatter=function(a){var f=this,c=this.getHisto(),e=this.getFramePainter(),m=a.i1,y=a.i2,u=a.stepi,n=a.j1,d=a.j2,C=a.stepj,q=a.k1,p=a.k2,B=a.stepk,k,v;if(y<=m||d<=n||p<=q)return!0;var r=1E3<this.gmaxbin?1E3/this.gmaxbin:1,t=0,h=0,g=Math.max(0,this.gminbin);for(a=m;a<y;a+=u)for(k=n;k<d;k+=C)for(v=q;v<p;v+=B){var z=c.getBinContent(a+1,k+1,v+1);h+=z;z<=
g||(t+=Math.round(z*r))}if(t>(e.webgl?1E5:3E4))return!1;JSROOT.seed(h);h=new l.PointsCreator(t,e.webgl,e.size_x3d/200);var x=new Int32Array(t);t=0;var A=this.getAxis("x"),w=this.getAxis("y"),D=this.getAxis("z");for(a=m;a<y;a+=u)for(k=n;k<d;k+=C)for(v=q;v<p;v+=B)if(z=c.getBinContent(a+1,k+1,v+1),!(z<=g))for(m=Math.round(z*r),z=0;z<m;++z){var P=A.GetBinCoord(a+JSROOT.random()),I=w.GetBinCoord(k+JSROOT.random()),J=D.GetBinCoord(v+JSROOT.random());x[t++]=c.getBin(a+1,k+1,v+1);h.addPoint(e.grx(P),e.gry(I),
e.grz(J))}return h.createPoints({color:this.v7EvalColor("fill_color","red"),promise:!0}).then(function(a){e.toplevel.add(a);a.bins=x;a.painter=f;a.tip_color=65280;a.tooltip=function(a){if(!Number.isInteger(a.index))return console.error("intersect.index not provided, three.js version "+b.REVISION+", expected 127"),null;var c=Math.floor(a.index/this.nvertex);if(0>c||c>=this.bins.length)return null;a=this.painter;var d=a.getFramePainter();c=a.get3DToolTip(this.bins[c]);c.x1=d.grx(a.getAxis("x").GetBinLowEdge(c.ix));
c.x2=d.grx(a.getAxis("x").GetBinLowEdge(c.ix+u));c.y1=d.gry(a.getAxis("y").GetBinLowEdge(c.iy));c.y2=d.gry(a.getAxis("y").GetBinLowEdge(c.iy+C));c.z1=d.grz(a.getAxis("z").GetBinLowEdge(c.iz));c.z2=d.grz(a.getAxis("z").GetBinLowEdge(c.iz+B));c.color=this.tip_color;c.opacity=.3;return c};return!0})};Q.prototype.draw3DBins=function(){if(!this.draw_content)return!1;var a=this.prepareDraw({only_indexes:!0,extra:-.5,right_extra:-1});if(this.options.Scatter){var f=this.draw3DScatter(a);if(!1!==f)return f}f=
this.v7EvalColor("fill_color","red");var c=this.getFramePainter(),e=0,m=!1,y=!1,u=!1,n=1,d=!0,C=.5;if(this.options.Sphere){C=.4;m=!0;11===this.options.Sphere&&(u=!0);e=c.webgl?new b.SphereGeometry(.5,16,12):new b.SphereGeometry(.5,8,6);e.applyMatrix4((new b.Matrix4).makeRotationX(Math.PI/2));e.computeVertexNormals();var q=e.getIndex().array,p=e.getAttribute("position").array,B=e.getAttribute("normal").array;e=3*q.length;var k=new Float32Array(e);var v=new Float32Array(e);for(var r=0;r<q.length;++r){var t=
3*q[r];k[3*r]=p[t];k[3*r+1]=p[t+1];k[3*r+2]=p[t+2];v[3*r]=B[t];v[3*r+1]=B[t+1];v[3*r+2]=B[t+2]}}else{q=l.Box3D.Indexes;p=l.Box3D.Normals;B=l.Box3D.Vertices;e=3*q.length;k=new Float32Array(e);v=new Float32Array(e);r=0;for(t=-3;r<q.length;++r){var h=B[q[r]];k[3*r]=h.x-.5;k[3*r+1]=h.y-.5;k[3*r+2]=h.z-.5;0===r%6&&(t+=3);v[3*r]=p[t];v[3*r+1]=p[t+1];v[3*r+2]=p[t+2]}y=!0;11==this.options.Box?u=!0:12==this.options.Box?(u=!0,y=!1):this.options.Color&&(u=!0,n=.5,y=d=!1,m=!0)}d&&(d=this.gminbin||this.gmaxbin?
1/Math.max(Math.abs(this.gminbin),Math.abs(this.gmaxbin)):1);var g=this.getHisto(),z=a.i1,x=a.i2,A=a.stepi,w=a.j1,D=a.j2,P=a.stepj,I=a.k1,J=a.k2,O=a.stepk;a=null;u&&(a=c.getHistPalette(),this.createContour(c,a));if(x<=z||D<=w||J<=I)return!0;var R=this.getAxis("x"),M=this.getAxis("y"),G=this.getAxis("z");q=(c.grx(R.GetBinCoord(x))-c.grx(R.GetBinCoord(z)))/(x-z)*A;p=(c.gry(M.GetBinCoord(D))-c.gry(M.GetBinCoord(w)))/(D-w)*P;B=(c.grz(G.GetBinCoord(J))-c.grz(G.GetBinCoord(I)))/(J-I)*O;var H=0,T,N,U;r=
[];var F=0;t=[];for(T=z;T<x;T+=A)for(N=w;N<D;N+=P)for(U=I;U<J;U+=O){var E=g.getBinContent(T+1,N+1,U+1);if(this.options.Color||!(0===E||E<this.gminbin)){var Q=d?Math.pow(Math.abs(E*d),.3333):1;.001>Q||(H++,u&&(h=a.getContourIndex(E),0<=h?(void 0===r[h]&&(r[h]=0,t[h]=F++),r[h]+=1):console.error("not found color for",E)))}}u||(r.push(H),F=1,t=[0]);var ia=Array(F);h=Array(F);var Y=Array(F),da=Array(F),aa=Array(F),ea=Array(F);F=Array(F);for(T=0;T<r.length;++T)r[T]&&(H=r[T],N=t[T],ia[N]=0,aa[N]=0,y&&(aa[N]=
65520<H*e/3?2:1),h[N]=new Float32Array(H*e),Y[N]=new Float32Array(H*e),da[N]=new Int32Array(H),1===aa[N]&&(ea[N]=new Uint16Array(H*l.Box3D.MeshSegments.length)),2===aa[N]&&(F[N]=new Float32Array(H*l.Box3D.Segments.length*3)));R=this.getAxis("x");M=this.getAxis("y");G=this.getAxis("z");for(T=z;T<x;T+=A)for(H=R.GetBinCenter(T+1),y=c.grx(H),N=w;N<D;N+=P)for(H=M.GetBinCenter(N+1),z=c.gry(H),U=I;U<J;U+=O)if(E=g.getBinContent(T+1,N+1,U+1),this.options.Color||!(0===E||E<this.gminbin))if(Q=d?Math.pow(Math.abs(E*
d),.3333):1,!(.001>Q)){var Z=0;if(u){H=a.getContourIndex(E);if(0>H)continue;Z=t[H]}H=ia[Z];E=G.GetBinCenter(U+1);E=c.grz(E);da[Z][H]=g.getBin(T+1,N+1,U+1);for(var S=H*e,V=h[Z],X=Y[Z],W=0;W<e;W+=3,S+=3)V[S]=y+k[W]*q*Q,V[S+1]=z+k[W+1]*p*Q,V[S+2]=E+k[W+2]*B*Q,X[S]=v[W],X[S+1]=v[W+1],X[S+2]=v[W+2];if(1===aa[Z]){V=l.Box3D.MeshSegments;S=H*V.length;X=Math.round(H*e/3);W=ea[Z];for(var ba=0;ba<V.length;++ba)W[S+ba]=X+V[ba]}if(2===aa[Z])for(V=l.Box3D.Segments,X=F[Z],S=H*V.length*3,W=0;W<V.length;++W,S+=3)ba=
l.Box3D.Vertices[V[W]],X[S]=y+(ba.x-.5)*q*Q,X[S+1]=z+(ba.y-.5)*p*Q,X[S+2]=E+(ba.z-.5)*B*Q;ia[Z]=H+1}for(k=0;k<r.length;++k)r[k]&&(v=t[k],g=new b.BufferGeometry,g.setAttribute("position",new b.BufferAttribute(h[v],3)),g.setAttribute("normal",new b.BufferAttribute(Y[v],3)),u&&(f=a.getColor(k)),x=m?new b.MeshLambertMaterial({color:f,opacity:n,transparent:1>n}):new b.MeshBasicMaterial({color:f,opacity:n}),g=new b.Mesh(g,x),g.bins=da[v],g.bins_faces=e/9,g.painter=this,g.scalex=C*q,g.scaley=C*p,g.scalez=
C*B,g.tip_color=65280,g.use_scale=d,g.tooltip=function(a){if(!Number.isInteger(a.faceIndex))return console.error("intersect.faceIndex not provided, three.js version "+b.REVISION+", expected 127"),null;a=Math.floor(a.faceIndex/this.bins_faces);if(0>a||a>=this.bins.length)return null;var c=this.painter,d=c.getFramePainter();a=c.get3DToolTip(this.bins[a]);var e=d.grx(c.getAxis("x").GetBinCoord(a.ix-.5)),f=d.gry(c.getAxis("y").GetBinCoord(a.iy-.5));c=d.grz(c.getAxis("z").GetBinCoord(a.iz-.5));d=this.use_scale?
Math.pow(Math.abs(a.value*this.use_scale),.3333):1;a.x1=e-this.scalex*d;a.x2=e+this.scalex*d;a.y1=f-this.scaley*d;a.y2=f+this.scaley*d;a.z1=c-this.scalez*d;a.z2=c+this.scalez*d;a.color=this.tip_color;return a},c.toplevel.add(g),0<aa[v]&&(g=this.v7EvalColor("line_color","lightblue"),g=new b.LineBasicMaterial({color:g}),x=null,x=1===aa[v]?l.createLineSegments(h[v],g,ea[v]):l.createLineSegments(F[v],g),c.toplevel.add(x)));u&&this.updatePaletteDraw()};Q.prototype.redraw=function(a){var b=this,c=this.getFramePainter();
"resize"==a?c.resize3D()&&c.render3D():(c.create3DScene(this.options.Render3D),c.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,this.getAxis("y"),this.ymin,this.ymax,this.getAxis("z"),this.zmin,this.zmax),c.set3DOptions(this.options),c.drawXYZ(c.toplevel,{zoom:JSROOT.settings.Zooming,ndim:3}),this.drawingBins(a).then(function(){return b.draw3DBins()}).then(function(){c.render3D();c.addKeysHandler()}))};Q.prototype.fillToolbar=function(){var a=this.getPadPainter();a&&(a.addPadButton("auto_zoom",
"Unzoom all axes","ToggleZoom","Ctrl *"),this.draw_content&&a.addPadButton("statbox","Toggle stat box","ToggleStatBox"),a.showPadButtons())};Q.prototype.canZoomInside=function(a,b,c){var e=this.getHisto();e&&(e=e["f"+a.toUpperCase()+"axis"]);return!e||1<e.FindBin(c,.5)-e.FindBin(b,0)};Q.prototype.autoZoom=function(){var a=this.getSelectIndex("x","left"),b=this.getSelectIndex("x","right"),c=this.getSelectIndex("y","left"),e=this.getSelectIndex("y","right"),l=this.getSelectIndex("z","left"),m=this.getSelectIndex("z",
"right"),u,n,d,C=this.getHisto();if(a!==b&&c!==e&&l!==m){var q=C.getBinContent(a+1,c+1,l+1);for(u=a;u<b;++u)for(n=c;n<e;++n)for(d=l;d<m;++d)q=Math.min(q,C.getBinContent(u+1,n+1,d+1));if(!(0<q)){var p=b,B=a,k=e,v=c,r=m,t=l;for(u=a;u<b;++u)for(n=c;n<e;++n)for(d=l;d<m;++d)C.getBinContent(u+1,n+1,d+1)>q&&(u<p&&(p=u),u>=B&&(B=u+1),n<k&&(k=n),n>=v&&(v=n+1),d<r&&(r=d),d>=t&&(t=d+1));u=!1;p===B-1&&p>a+1&&B<b-1&&(p--,B++);k===v-1&&k>c+1&&v<e-1&&(k--,v++);r===t-1&&r>l+1&&t<m-1&&(r--,t++);if((p>a||B<b)&&p<B-
1){var h=this.getAxis("x").GetBinLowEdge(p+1);var g=this.getAxis("x").GetBinLowEdge(B+1);u=!0}if((k>c||v<e)&&k<v-1){var z=this.getAxis("y").GetBinLowEdge(k+1);var x=this.getAxis("y").GetBinLowEdge(v+1);u=!0}if((r>l||t<m)&&r<t-1){var A=this.getAxis("z").GetBinLowEdge(r+1);var w=this.getAxis("z").GetBinLowEdge(t+1);u=!0}u&&this.getFramePainter().zoom(h,g,z,x,A,w)}}};Q.prototype.fillHistContextMenu=function(a){var b=this,c=l.getDrawSettings("ROOT."+this.getObject()._typename,"nosame");a.addDrawMenu("Draw with",
c.opts,function(a){if("inspect"===a)return b.showInspector();b.decodeOptions(a);b.interactiveRedraw(!0,"drawopt")})};JSROOT.v7.RH3Painter=Q;JSROOT.v7.drawHist3=function(a,b){var c=new Q(a,b);return l.ensureRCanvas(c,"3d").then(function(){c.setAsMainPainter();c.options={Box:0,Scatter:!1,Sphere:0,Color:!1,minimum:-1111,maximum:-1111};var a=c.v7EvalAttr("kind",""),b=c.v7EvalAttr("sub",0),f=c.options;switch(a){case "box":f.Box=10+b;break;case "sphere":f.Sphere=10+b;break;case "col":f.Color=!0;break;case "scat":f.Scatter=
!0;break;default:f.Box=10}c.scanContent();c.redraw();return c})};return JSROOT});
