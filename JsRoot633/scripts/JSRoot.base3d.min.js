var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(g){var d=0;return function(){return d<g.length?{done:!1,value:g[d++]}:{done:!0}}};$jscomp.arrayIterator=function(g){return{next:$jscomp.arrayIteratorImpl(g)}};$jscomp.makeIterator=function(g){var d="undefined"!=typeof Symbol&&Symbol.iterator&&g[Symbol.iterator];return d?d.call(g):$jscomp.arrayIterator(g)};
$jscomp.getGlobal=function(g){return"undefined"!=typeof window&&window===g?g:"undefined"!=typeof global&&null!=global?global:g};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(g,d,f){g!=Array.prototype&&g!=Object.prototype&&(g[d]=f.value)};
$jscomp.polyfill=function(g,d,f,l){if(d){f=$jscomp.global;g=g.split(".");for(l=0;l<g.length-1;l++){var h=g[l];h in f||(f[h]={});f=f[h]}g=g[g.length-1];l=f[g];d=d(l);d!=l&&null!=d&&$jscomp.defineProperty(f,g,{configurable:!0,writable:!0,value:d})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(g){function d(){this.batch_=null}function f(d){return d instanceof h?d:new h(function(m,f){m(d)})}if(g&&!$jscomp.FORCE_POLYFILL_PROMISE)return g;d.prototype.asyncExecute=function(d){if(null==this.batch_){this.batch_=[];var m=this;this.asyncExecuteFunction(function(){m.executeBatch_()})}this.batch_.push(d)};var l=$jscomp.global.setTimeout;d.prototype.asyncExecuteFunction=function(d){l(d,0)};d.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var d=
this.batch_;this.batch_=[];for(var f=0;f<d.length;++f){var g=d[f];d[f]=null;try{g()}catch(a){this.asyncThrow_(a)}}}this.batch_=null};d.prototype.asyncThrow_=function(d){this.asyncExecuteFunction(function(){throw d;})};var h=function(d){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var m=this.createResolveAndReject_();try{d(m.resolve,m.reject)}catch(u){m.reject(u)}};h.prototype.createResolveAndReject_=function(){function d(a){return function(b){g||(g=!0,a.call(f,b))}}var f=this,g=!1;
return{resolve:d(this.resolveTo_),reject:d(this.reject_)}};h.prototype.resolveTo_=function(d){if(d===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(d instanceof h)this.settleSameAsPromise_(d);else{a:switch(typeof d){case "object":var f=null!=d;break a;case "function":f=!0;break a;default:f=!1}f?this.resolveToNonPromiseObj_(d):this.fulfill_(d)}};h.prototype.resolveToNonPromiseObj_=function(d){var f=void 0;try{f=d.then}catch(u){this.reject_(u);return}"function"==typeof f?
this.settleSameAsThenable_(f,d):this.fulfill_(d)};h.prototype.reject_=function(d){this.settle_(2,d)};h.prototype.fulfill_=function(d){this.settle_(1,d)};h.prototype.settle_=function(d,f){if(0!=this.state_)throw Error("Cannot settle("+d+", "+f+"): Promise already settled in state"+this.state_);this.state_=d;this.result_=f;this.executeOnSettledCallbacks_()};h.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var d=0;d<this.onSettledCallbacks_.length;++d)p.asyncExecute(this.onSettledCallbacks_[d]);
this.onSettledCallbacks_=null}};var p=new d;h.prototype.settleSameAsPromise_=function(d){var f=this.createResolveAndReject_();d.callWhenSettled_(f.resolve,f.reject)};h.prototype.settleSameAsThenable_=function(d,f){var g=this.createResolveAndReject_();try{d.call(f,g.resolve,g.reject)}catch(a){g.reject(a)}};h.prototype.then=function(d,f){function g(c,d){return"function"==typeof c?function(d){try{a(c(d))}catch(q){b(q)}}:d}var a,b,c=new h(function(c,d){a=c;b=d});this.callWhenSettled_(g(d,a),g(f,b));return c};
h.prototype.catch=function(d){return this.then(void 0,d)};h.prototype.callWhenSettled_=function(d,f){function g(){switch(a.state_){case 1:d(a.result_);break;case 2:f(a.result_);break;default:throw Error("Unexpected state: "+a.state_);}}var a=this;null==this.onSettledCallbacks_?p.asyncExecute(g):this.onSettledCallbacks_.push(g)};h.resolve=f;h.reject=function(d){return new h(function(f,g){g(d)})};h.race=function(d){return new h(function(g,h){for(var a=$jscomp.makeIterator(d),b=a.next();!b.done;b=a.next())f(b.value).callWhenSettled_(g,
h)})};h.all=function(d){var g=$jscomp.makeIterator(d),l=g.next();return l.done?f([]):new h(function(a,b){function c(b){return function(c){d[b]=c;t--;0==t&&a(d)}}var d=[],t=0;do d.push(void 0),t++,f(l.value).callWhenSettled_(c(d.length-1),b),l=g.next();while(!l.done)})};return h},"es6","es3");
JSROOT.define(["d3","threejs_jsroot","painter"],function(g,d,f){function l(a,b){this.cont=this.tt=null;this.lastlbl="";this.parent=a?a:document.body;this.canvas=b;this.abspos=!a}function h(){}function p(a){this.mesh=a}function m(a,b,c){this.webgl=void 0===b?!0:b;this.scale=c||1;this.pos=new Float32Array(3*a);this.geom=new d.BufferGeometry;this.geom.setAttribute("position",new d.BufferAttribute(this.pos,3));this.indx=0}function v(a,b){if(!a||!b)return null;a=a.getColor(b.fLineColor);var c=b.fLineStyle?
f.root_line_styles[b.fLineStyle]:"";a=(c=c?c.split(","):[])&&2<=c.length?new d.LineDashedMaterial({color:a,dashSize:parseInt(c[0]),gapSize:parseInt(c[1])}):new d.LineBasicMaterial({color:a});void 0!==b.fLineWidth&&1<b.fLineWidth&&(a.linewidth=b.fLineWidth);return a}f.getRender3DKind=function(a){a||(a=JSROOT.batch_mode?JSROOT.settings.Render3DBatch:JSROOT.settings.Render3D);var b=JSROOT.constants.Render3D;a==b.Default&&(a=JSROOT.batch_mode?b.WebGLImage:b.WebGL);JSROOT.batch_mode&&a==b.WebGL&&(a=b.WebGLImage);
return a};var u={access3dKind:function(a){var b=this.getPadSvg();if(b.empty())return-1;var c=b.property("can3d");void 0!==a&&b.property("can3d",a);return null===c||void 0===c?-1:c},getSizeFor3d:function(a,b){void 0===a&&(a=f.getRender3DKind(),a=a!==JSROOT.constants.Render3D.WebGL?JSROOT.constants.Embed3D.EmbedSVG:JSROOT.settings.Embed3D!=JSROOT.constants.Embed3D.Default?JSROOT.settings.Embed3D:JSROOT.browser.isFirefox?JSROOT.constants.Embed3D.Embed:JSROOT.constants.Embed3D.Overlay);b=this.getPadSvg();
var c="draw3d_"+(this.getPadName()||"canvas");if(b.empty())return a=f.getElementRect(this.selectDom()),10>a.height&&10<a.width&&(a.height=Math.round(.66*a.width),this.selectDom().style("height",a.height+"px")),a.x=0,a.y=0,a.clname=c,a.can3d=-1,a;var d=this.getFramePainter(),g=this.getPadPainter();if(d&&d.mode3d&&0<a)b=d.getFrameRect();else{var n=0<a?b:this.getCanvSvg();b={x:0,y:0,width:n.property("draw_width"),height:n.property("draw_height")};d&&!d.mode3d&&(n=this.getFrameSvg(),b.x=n.property("draw_x"),
b.y=n.property("draw_y"))}b.clname=c;b.can3d=a;if(c=g?g.getPadRect():null)d=Math.round(.07*b.width),g=Math.round(.05*b.height),b.x=Math.max(0,b.x-d),b.y=Math.max(0,b.y-g),b.width=Math.min(b.width+2*d,c.width-b.x),b.height=Math.min(b.height+2*g,c.height-b.y);1===a&&(b=f.getAbsPosInCanvas(this.getPadSvg(),b));return b},clear3dCanvas:function(){var a=this.access3dKind(null);if(0>a){var b=this.selectDom().node(),c=b?b.firstChild:null;c&&!c.$jsroot&&(c=c.nextSibling);c&&c.$jsroot&&(delete c.painter,b.removeChild(c));
return a}b=this.getSizeFor3d(a);if(0===b.can3d)g.select(this.getCanvSvg().node().nextSibling).remove(),this.getCanvSvg().style("display",null);else{if(this.getPadSvg().empty())return;this.apply3dSize(b).remove();this.getFrameSvg().style("display",null)}return a},add3dCanvas:function(a,b,c){!b||-1>a.can3d||(-1===a.can3d?(a=this.selectDom().node(),null!==a&&(a.appendChild(b),b.painter=this,b.$jsroot=!0)):(0<a.can3d&&!c&&(a.can3d=JSROOT.constants.Embed3D.EmbedSVG),this.access3dKind(a.can3d),0===a.can3d?
(this.getCanvSvg().style("display","none"),this.getCanvSvg().node().parentNode.appendChild(b)):this.getPadSvg().empty()||(this.getFrameSvg().style("display","none"),this.apply3dSize(a).attr("title","").node().appendChild(b))))},apply3dSize:function(a,b){if(0>a.can3d)return g.select(null);if(1<a.can3d){var c=this.getLayerSvg(a.clname);if(b)return c;b=this.getPadSvg();a.can3d===JSROOT.constants.Embed3D.EmbedSVG?(c.empty()&&(c=b.insert("g",".primitives_layer").attr("class",a.clname)),c.attr("transform",
"translate("+a.x+","+a.y+")")):(c.empty()&&(c=b.insert("foreignObject",".primitives_layer").attr("class",a.clname)),c.attr("x",a.x).attr("y",a.y).attr("width",a.width).attr("height",a.height).attr("viewBox","0 0 "+a.width+" "+a.height).attr("preserveAspectRatio","xMidYMid"))}else{var d=this.getCanvSvg().node().parentNode;c=g.select(d).select("."+a.clname);if(b)return c;this.getCanvSvg().property("redraw_by_resize",!0);c.empty()&&(c=g.select(d).append("div").attr("class",a.clname+" jsroot_noselect"));
for(b=d.getBoundingClientRect();d;){if(d===document){d=null;break}try{if("static"!==getComputedStyle(d).position)break}catch(n){break}d=d.parentNode}var f=d?d.getBoundingClientRect():{top:0,left:0};d=Math.round(b.left-f.left);b=Math.round(b.top-f.top);c.style("position","absolute").style("left",a.x+d+"px").style("top",a.y+b+"px").style("width",a.width+"px").style("height",a.height+"px")}return c}};f.assign3DHandler=function(a){JSROOT.extend(a,u)};f.createRender3D=function(a,b,c,k){var h=JSROOT.constants.Render3D;
c=f.getRender3DKind(c);k||(k={antialias:!0,alpha:!0});var n=!1,q=JSROOT._.get_document();c==h.WebGL?k=new d.WebGLRenderer(k):c==h.SVG?(k=d.CreateSVGRenderer(!1,0,q),JSROOT.batch_mode?n=!0:k.jsroot_dom=q.createElementNS("http://www.w3.org/2000/svg","svg")):JSROOT.nodejs?(n=require("canvas").createCanvas,k.canvas=n(a,b),k.canvas.addEventListener=function(){},k.canvas.removeEventListener=function(){},k.canvas.style={},(n=require("gl")(a,b,{preserveDrawingBuffer:!0}))?(k.context=n,n.canvas=k.canvas):
console.error("Fail to create headless-gl"),k=new d.WebGLRenderer(k),k.jsroot_output=new d.WebGLRenderTarget(a,b),k.setRenderTarget(k.jsroot_output),n=!0):(k=new d.WebGLRenderer(k),k.jsroot_dom=q.createElementNS("http://www.w3.org/2000/svg","image"),g.select(k.jsroot_dom).attr("width",a).attr("height",b));n?(JSROOT._.svg_3ds||(JSROOT._.svg_3ds=[]),k.workaround_id=JSROOT._.svg_3ds.length,JSROOT._.svg_3ds[k.workaround_id]="<svg></svg>",k.jsroot_dom=q.createElementNS("http://www.w3.org/2000/svg","path"),
k.jsroot_dom.setAttribute("jsroot_svg_workaround",k.workaround_id)):k.jsroot_dom||(k.jsroot_dom=k.domElement);k.setSize(a,b);k.jsroot_render3d=c;k.setJSROOTSize=function(a,b){if(this.jsroot_render3d===JSROOT.constants.Render3D.WebGLImage&&!JSROOT.batch_mode&&!JSROOT.nodejs)return g.select(this.jsroot_dom).attr("width",a).attr("height",b)};return k};f.cleanupRender3D=function(a){a&&(JSROOT.nodejs?(a=(a="function"==typeof a.getContext?a.getContext():null)?a.getExtension("STACKGL_destroy_context"):null)&&
a.destroy():(JSROOT.browser.isChrome&&"function"==typeof a.forceContextLoss&&a.forceContextLoss(),"function"==typeof a.dispose&&a.dispose()))};f.beforeRender3D=function(a){a.clearHTML&&a.clearHTML()};f.afterRender3D=function(a){var b=JSROOT.constants.Render3D;if(a.jsroot_render3d!=b.WebGL)if(a.jsroot_render3d==b.SVG)if(JSROOT.batch_mode)JSROOT._.svg_3ds[a.workaround_id]=a.makeOuterHTML();else{if(b=a.jsroot_dom.parentNode)b.innerHTML=a.makeOuterHTML(),a.jsroot_dom=b.firstChild}else if(JSROOT.nodejs){b=
a.domElement;var c=b.getContext("2d"),d=new Uint8Array(4*b.width*b.height);a.readRenderTargetPixels(a.jsroot_output,0,0,b.width,b.height,d);for(var f=0,h=4*(b.height-1)*b.width,q,l;f<h;){for(q=0;q<4*b.width;++q)l=d[f+q],d[f+q]=d[h+q],d[h+q]=l;f+=4*b.width;h-=4*b.width}f=c.createImageData(b.width,b.height);f.data.set(d);c.putImageData(f,0,0);c=b.toDataURL("image/png");JSROOT._.svg_3ds[a.workaround_id]='<image width="'+b.width+'" height="'+b.height+'" xlink:href="'+c+'"></image>'}else b=a.domElement.toDataURL("image/png"),
g.select(a.jsroot_dom).attr("xlink:href",b)};f.processSvgWorkarounds=function(a,b){if(!JSROOT._.svg_3ds)return a;for(var c=0;c<JSROOT._.svg_3ds.length;++c)a=a.replace('<path jsroot_svg_workaround="'+c+'"></path>',JSROOT._.svg_3ds[c]);b||(JSROOT._.svg_3ds=void 0);return a};l.prototype.checkParent=function(a){a&&this.parent!==a&&(this.hide(),this.parent=a)};l.prototype.extract_pos=function(a){if("object"==typeof a&&void 0!==a.u&&void 0!==a.l)return a;var b={u:0,l:0};this.abspos?(b.l=a.pageX,b.u=a.pageY):
(b.l=a.offsetX,b.u=a.offsetY);return b};l.prototype.pos=function(a){if(this.tt){a=this.extract_pos(a);if(!this.abspos){var b=this.parent.getBoundingClientRect(),c=this.canvas.getBoundingClientRect();void 0!==b.left&&void 0!==c.left&&(a.l+=c.left-b.left);void 0!==b.top&&void 0!==c.top&&(a.u+=c.top-b.top);a.l+this.tt.offsetWidth+3>=this.parent.offsetWidth&&(a.l=this.parent.offsetWidth-this.tt.offsetWidth-3);a.u+this.tt.offsetHeight+15>=this.parent.offsetHeight&&(a.u=this.parent.offsetHeight-this.tt.offsetHeight-
15);for(c=this.parent;c;){var d=getComputedStyle(c);if(!d||"static"!==d.position)break;if(!c.parentNode||1!=c.parentNode.nodeType)break;c=c.parentNode}c&&c!==this.parent&&(c=c.getBoundingClientRect(),a.l+=b.left-c.left,a.u+=b.top-c.top)}this.tt.style.top=a.u+15+"px";this.tt.style.left=a.l+3+"px"}};l.prototype.show=function(a){if(!a||""===a)return this.hide();if("object"==typeof a&&(a.lines||a.line)){if(a.only_status)return this.hide();if(a.line)a=a.line;else{for(var b=a.lines[0],c=1;c<a.lines.length;++c)b+=
"<br/>"+a.lines[c];a=b}}null===this.tt&&(this.tt=document.createElement("div"),this.tt.setAttribute("class","jsroot_tt3d_main"),this.cont=document.createElement("div"),this.cont.setAttribute("class","jsroot_tt3d_cont"),this.tt.appendChild(this.cont),this.parent.appendChild(this.tt));this.lastlbl!==a&&(this.lastlbl=this.cont.innerHTML=a,this.tt.style.width="auto")};l.prototype.hide=function(){null!==this.tt&&this.parent.removeChild(this.tt);this.tt=null;this.lastlbl=""};f.createOrbitControl=function(a,
b,c,f,g){function k(a){if(e)if(e.mouse_zoom_mesh)a.stopImmediatePropagation(),a.stopPropagation();else if(void 0===a.button||0===a.button)if(void 0===a.buttons||1===a.buttons){if(e.enable_zoom&&(e.mouse_zoom_mesh=e.detectZoomMesh(a),e.mouse_zoom_mesh)){a.stopImmediatePropagation();a.stopPropagation();return}e.enable_select&&(e.mouse_select_pnt=e.getMousePos(a,{}))}}function h(a){if(e){if(e.mouse_zoom_mesh&&e.mouse_zoom_mesh.point2&&e.painter.get3dZoomCoord){var b=e.mouse_zoom_mesh.object.zoom,c=e.painter.get3dZoomCoord(e.mouse_zoom_mesh.point,
b),d=e.painter.get3dZoomCoord(e.mouse_zoom_mesh.point2,b);if(c>d){var w=c;c=d;d=w}"z"===b&&e.mouse_zoom_mesh.object.use_y_for_z&&(b="y");"z"===b&&e.mouse_zoom_mesh.object.use_y_for_z&&(b="y");c<d&&e.painter.zoom(b,c,d)&&(e.mouse_zoom_mesh=null)}e.enable_zoom&&e.removeZoomMesh();e.enable_select&&e.mouse_select_pnt&&(b=e.getMousePos(a,{}),c=b.x==e.mouse_select_pnt.x&&b.y==e.mouse_select_pnt.y,delete e.mouse_select_pnt,c&&(c=e.getMouseIntersects(b),e.painter.processMouseClick(b,c,a)))}}function t(a){if(e){var b=
(b=e.painter)&&void 0!==b.renderer?void 0!==b.render_tmout:!1;if(b||e.mouse_zoom_mesh)a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation();else if(b=e.detectZoomMesh(a))if(a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),e.painter&&"function"==typeof e.painter.analyzeMouseWheelEvent){var c=b.object.zoom,d=b.point[c],f={name:c,ignore:!1};switch(c){case "x":d=(d+e.painter.size_x3d)/2/e.painter.size_x3d;break;case "y":d=(d+e.painter.size_y3d)/2/e.painter.size_y3d;break;
case "z":d=d/2/e.painter.size_z3d}e.painter.analyzeMouseWheelEvent(a,f,d,!1);"z"===c&&b.object.use_y_for_z&&(c="y");e.painter.zoom(c,f.min,f.max)}}}var e=null,r=JSROOT.settings.Zooming&&JSROOT.settings.ZoomMouse,m="function"==typeof a.processMouseClick;JSROOT.settings.Zooming&&JSROOT.settings.ZoomWheel&&f.domElement.addEventListener("wheel",t);if(r||m)f.domElement.addEventListener("pointerdown",k),f.domElement.addEventListener("pointerup",h);e=new d.OrbitControls(b,f.domElement);e.enableDamping=!1;
e.dampingFactor=1;e.enableZoom=!0;e.enableKeys=JSROOT.settings.HandleKeys;g&&(e.target.copy(g),e.target0.copy(g),e.update());e.tooltip=new l(a.selectDom().node(),f.domElement);e.painter=a;e.camera=b;e.scene=c;e.renderer=f;e.raycaster=new d.Raycaster;e.raycaster.params.Line.threshold=10;e.raycaster.params.Points.threshold=5;e.mouse_zoom_mesh=null;e.block_ctxt=!1;e.block_mousemove=!1;e.cursor_changed=!1;e.control_changed=!1;e.control_active=!1;e.mouse_ctxt={x:0,y:0,on:!1};e.enable_zoom=r;e.enable_select=
m;e.cleanup=function(){JSROOT.settings.Zooming&&JSROOT.settings.ZoomWheel&&this.domElement.removeEventListener("wheel",t);if(this.enable_zoom||this.enable_select)this.domElement.removeEventListener("pointerdown",k),this.domElement.removeEventListener("pointerup",h);this.domElement.removeEventListener("click",this.lstn_click);this.domElement.removeEventListener("dblclick",this.lstn_dblclick);this.domElement.removeEventListener("contextmenu",this.lstn_contextmenu);this.domElement.removeEventListener("mousemove",
this.lstn_mousemove);this.domElement.removeEventListener("mouseleave",this.lstn_mouseleave);this.dispose();this.tooltip.hide();delete this.tooltip;delete this.painter;delete this.camera;delete this.scene;delete this.renderer;delete this.raycaster;delete this.mouse_zoom_mesh};e.HideTooltip=function(){this.tooltip.hide()};e.getMousePos=function(a,b){b.x="offsetX"in a?a.offsetX:a.layerX;b.y="offsetY"in a?a.offsetY:a.layerY;b.clientX=a.clientX;b.clientY=a.clientY;return b};e.getOriginDirectionIntersects=
function(a,b){this.raycaster.set(a,b);a=this.raycaster.intersectObjects(this.scene.children,!0);"function"==typeof this.painter.filterIntersects&&(a=this.painter.filterIntersects(a));return a};e.getMouseIntersects=function(a){if(!this.renderer)return[];var b=this.renderer instanceof d.WebGLRenderer?this.renderer.getSize(new d.Vector2):this.renderer.domElement;a={x:a.x/b.width*2-1,y:-a.y/b.height*2+1};this.camera.updateMatrix();this.camera.updateMatrixWorld();this.raycaster.setFromCamera(a,this.camera);
a=this.raycaster.intersectObjects(this.scene.children,!0);"function"==typeof this.painter.filterIntersects&&(a=this.painter.filterIntersects(a));return a};e.detectZoomMesh=function(a){a=this.getMousePos(a,{});if(a=this.getMouseIntersects(a))for(var b=0;b<a.length;++b)if(a[b].object.zoom)return a[b];return null};e.getInfoAtMousePosition=function(a){a=this.getMouseIntersects(a);for(var b=null,c=null,d=0;d<a.length;++d)if(a[d].object.tooltip){b=a[d].object.tooltip(a[d]);c=a[d].object.painter;break}if(b&&
c)return{obj:c.getObject(),name:c.getObject().fName,bin:b.bin,cont:b.value,binx:b.ix,biny:b.iy,binz:b.iz,grx:(b.x1+b.x2)/2,gry:(b.y1+b.y2)/2,grz:(b.z1+b.z2)/2}};e.processDblClick=function(a){var b=this.detectZoomMesh(a);if(b&&this.painter)this.painter.unzoom(b.object.use_y_for_z?"y":b.object.zoom);else{if((b=this.painter?this.painter.getFramePainter():null)&&"function"==typeof b._dblclick_handler&&(a=this.getInfoAtMousePosition(this.getMousePos(a,{})))){b._dblclick_handler(a);return}this.reset()}};
e.changeEvent=function(){this.mouse_ctxt.on=!1;this.painter.render3D(0);this.control_changed=!0};e.startEvent=function(){this.control_active=!0;this.block_ctxt=!1;this.mouse_ctxt.on=!1;this.tooltip.hide()};e.endEvent=function(){this.control_active=!1;this.mouse_ctxt.on&&(this.mouse_ctxt.on=!1,this.contextMenu(this.mouse_ctxt,this.getMouseIntersects(this.mouse_ctxt)));this.control_changed=!1};e.mainProcessContextMenu=function(a){a.preventDefault();this.getMousePos(a,this.mouse_ctxt);this.control_active?
this.mouse_ctxt.on=!0:this.block_ctxt?this.block_ctxt=!1:this.contextMenu(this.mouse_ctxt,this.getMouseIntersects(this.mouse_ctxt))};e.contextMenu=function(){};e.setTooltipEnabled=function(a){this.block_mousemove=!a;!1===a&&(this.tooltip.hide(),this.removeZoomMesh())};e.removeZoomMesh=function(){this.mouse_zoom_mesh&&this.mouse_zoom_mesh.object.showSelection()&&this.painter.render3D();this.mouse_zoom_mesh=null};e.mainProcessMouseMove=function(a){var b=this;if(this.painter&&(this.control_active&&a.buttons&&
a.buttons&2&&(this.block_ctxt=!0),!this.control_active&&!this.block_mousemove&&this.ProcessMouseMove))if(this.mouse_zoom_mesh){a=this.detectZoomMesh(a);var c=null;if(c=a&&a.object===this.mouse_zoom_mesh.object?a.point:this.mouse_zoom_mesh.object.globalIntersect(this.raycaster))this.mouse_zoom_mesh.point2=c;c&&this.painter.enable_highlight&&this.mouse_zoom_mesh.object.showSelection(this.mouse_zoom_mesh.point,c)&&this.painter.render3D(0);this.tooltip.hide()}else a.preventDefault(),this.tmout_mouse=
this.getMousePos(a,{}),this.tmout_ttpos=this.tooltip?this.tooltip.extract_pos(a):null,this.tmout_handle&&(clearTimeout(this.tmout_handle),delete this.tmout_handle),this.mouse_tmout?this.tmout_handle=setTimeout(function(){return b.delayedProcessMouseMove()},this.mouse_tmout):this.delayedProcessMouseMove()};e.delayedProcessMouseMove=function(){delete this.tmout_handle;if(this.painter){var a=this.tmout_mouse,b=this.getMouseIntersects(a),c=this.ProcessMouseMove(b);if(c){var d="",e="",f="",g="";a&&(f=
a.x.toFixed(0)+","+a.y.toFixed(0));"string"==typeof c?g=c:(d=c.name,e=c.title,c.line?g=c.line:c.lines&&(g=c.lines.slice(1).join(" "),d=c.lines[0]));this.painter.showObjectStatus(d,e,g,f)}this.cursor_changed=!1;if(c&&this.painter&&this.painter.isTooltipAllowed())this.tooltip.checkParent(this.painter.selectDom().node()),this.tooltip.show(c,a),this.tooltip.pos(this.tmout_ttpos);else if(this.tooltip.hide(),b)for(a=0;a<b.length;++a)b[a].object.zoom&&(this.cursor_changed=!0);document.body.style.cursor=
this.cursor_changed?"pointer":"auto"}};e.mainProcessMouseLeave=function(){this.painter&&(this.tmout_handle&&(clearTimeout(this.tmout_handle),delete this.tmout_handle),this.tooltip.hide(),"function"===typeof this.ProcessMouseLeave&&this.ProcessMouseLeave(),this.cursor_changed&&(document.body.style.cursor="auto",this.cursor_changed=!1))};e.mainProcessDblClick=function(a){this.single_click_tm&&(clearTimeout(this.single_click_tm),delete this.single_click_tm);this.processDblClick(a)};e.processClick=function(a,
b){delete this.single_click_tm;if(1==b){var c=this.painter?this.painter.getFramePainter():null;if(c&&"function"==typeof c._click_handler){var d=this.getInfoAtMousePosition(a);if(d){c._click_handler(d);return}}}2==b&&"function"==typeof this.ProcessSingleClick&&(a=this.getMouseIntersects(a),this.ProcessSingleClick(a))};e.lstn_click=function(a){if(2!=a.detail){this.single_click_tm&&(clearTimeout(this.single_click_tm),delete this.single_click_tm);var b=0,c=this.painter?this.painter.getFramePainter():
null;c&&"function"==typeof c._click_handler?b=1:this.ProcessSingleClick&&this.painter&&this.painter.options&&this.painter.options.mouse_click&&(b=2);b&&(this.single_click_tm=setTimeout(this.processClick.bind(this,this.getMousePos(a,{}),b),300))}}.bind(e);e.addEventListener("change",function(){return e.changeEvent()});e.addEventListener("start",function(){return e.startEvent()});e.addEventListener("end",function(){return e.endEvent()});e.lstn_contextmenu=function(a){return e.mainProcessContextMenu(a)};
e.lstn_dblclick=function(a){return e.mainProcessDblClick(a)};e.lstn_mousemove=function(a){return e.mainProcessMouseMove(a)};e.lstn_mouseleave=function(){return e.mainProcessMouseLeave()};f.domElement.addEventListener("click",e.lstn_click);f.domElement.addEventListener("dblclick",e.lstn_dblclick);f.domElement.addEventListener("contextmenu",e.lstn_contextmenu);f.domElement.addEventListener("mousemove",e.lstn_mousemove);f.domElement.addEventListener("mouseleave",e.lstn_mouseleave);return e};f.disposeThreejsObject=
function(a,b){if(a){if(a.children)for(var c=0;c<a.children.length;c++)f.disposeThreejsObject(a.children[c]);b?a.children=[]:(a.children=void 0,a.geometry&&(a.geometry.dispose(),a.geometry=void 0),a.material&&(a.material.map&&(a.material.map.dispose(),a.material.map=void 0),a.material.dispose(),a.material=void 0),delete a.painter,delete a.bins_index,delete a.tooltip,delete a.stack,delete a.drawn_highlight)}};f.createLineSegments=function(a,b,c,f){var g=new d.BufferGeometry;g.setAttribute("position",
a instanceof Float32Array?new d.BufferAttribute(a,3):new d.Float32BufferAttribute(a,3));c&&g.setIndex(new d.BufferAttribute(c,1));if(b.isLineDashedMaterial){var k=new d.Vector3,h=new d.Vector3,l=0;if(c){var e=new Float32Array(c.length);for(var r=0;r<c.length;r+=2){var m=c[r],p=c[r+1];k.set(a[m],a[m+1],a[m+2]);h.set(a[p],a[p+1],a[p+2]);e[r]=l;l+=h.distanceTo(k);e[r+1]=l}}else for(e=new Float32Array(a.length/3),c=0;c<a.length;c+=6)k.set(a[c],a[c+1],a[c+2]),h.set(a[c+3],a[c+4],a[c+5]),e[c/3]=l,l+=h.distanceTo(k),
e[c/3+1]=l;g.setAttribute("lineDistance",new d.BufferAttribute(e,1))}return f?g:new d.LineSegments(g,b)};f.Box3D={Vertices:[new d.Vector3(1,1,1),new d.Vector3(1,1,0),new d.Vector3(1,0,1),new d.Vector3(1,0,0),new d.Vector3(0,1,0),new d.Vector3(0,1,1),new d.Vector3(0,0,0),new d.Vector3(0,0,1)],Indexes:[0,2,1,2,3,1,4,6,5,6,7,5,4,5,1,5,0,1,7,6,2,6,3,2,5,7,0,7,2,0,1,3,4,3,6,4],Normals:[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],Segments:[0,2,2,7,7,5,5,0,1,3,3,6,6,4,4,1,1,0,3,2,6,7,4,5]};f.Box3D.MeshSegments=
function(){for(var a=f.Box3D,b=new Int32Array(a.Segments.length),c=0;c<b.length;++c)for(var d=0;d<a.Indexes.length;++d)if(a.Segments[c]===a.Indexes[d]){b[c]=d;break}return b}();h.prototype.cleanup=function(){};h.prototype.extractIndex=function(){};h.prototype.setSelected=function(){};h.prototype.setHighlight=function(){};h.prototype.checkHighlightIndex=function(){};p.prototype=Object.create(h.prototype);p.prototype.cleanup=function(){this.mesh&&(delete this.mesh.is_selected,this.createSpecial(null),
delete this.mesh)};p.prototype.extractIndex=function(a){return a&&void 0!==a.index?a.index:void 0};p.prototype.setSelected=function(a,b){var c=this.mesh;c.select_col==a&&c.select_indx==b&&(a=null,b=void 0);c.select_col=a;c.select_indx=b;this.createSpecial(a,b);return!0};p.prototype.setHighlight=function(a,b){var c=this.mesh;c.h_index=b;a?this.createSpecial(a,b):this.createSpecial(c.select_col,c.select_indx);return!0};p.prototype.createSpecial=function(a,b){var c=this.mesh;if(a){if(!c.js_special){var g=
new d.BufferGeometry;g.setAttribute("position",c.geometry.getAttribute("position"));var h=new d.PointsMaterial({size:2*c.material.size,color:a});h.sizeAttenuation=c.material.sizeAttenuation;c.js_special=new d.Points(g,h);c.js_special.jsroot_special=!0;c.add(c.js_special)}c.js_special.material.color=new d.Color(a);void 0!==b&&c.js_special.geometry.setDrawRange(b,1)}else c.js_special&&(c.remove(c.js_special),f.disposeThreejsObject(c.js_special),delete c.js_special)};m.prototype.addPoint=function(a,
b,c){this.pos[this.indx]=a;this.pos[this.indx+1]=b;this.pos[this.indx+2]=c;this.indx+=3};m.prototype.createPoints=function(a){var b=this;"object"!==typeof a&&(a={color:a});a.color||(a.color="black");var c=1;a.style?1===a.style?c=.3:6===a.style?c=.5:7===a.style&&(c=.7):c=1.1;var f=function(c,f){c=new d.Points(b.geom,c);c.nvertex=1;return!a.promise||f?c:Promise.resolve(c)};if(1!==c||JSROOT.nodejs&&!a.promise)return f(new d.PointsMaterial({size:3*this.scale*c,color:a.color}));c=new JSROOT.TAttMarkerHandler({style:a.style,
color:a.color,size:7});var g=c.fill?1:7,h='data:image/svg+xml;utf8,<svg width="64" height="64" xmlns="http://www.w3.org/2000/svg"><path d="'+(c.create(32,32)+'" stroke="'+c.getStrokeColor()+'" stroke-width="'+g+'" fill="'+c.getFillColor()+'"/></svg>'),l=new d.TextureLoader;if(a.promise){if(JSROOT.nodejs){c=require("canvas");var m=c.createCanvas;c=c.loadImage;c=c(h).then(function(a){var b=m(64,64);b.getContext("2d").drawImage(a,0,0,64,64);return new d.CanvasTexture(b)})}else c=new Promise(function(a){l.load(h,
function(b){return a(b)})});return c.then(function(a){return f(new d.PointsMaterial({size:3*b.scale,map:a,transparent:!0}),!0)})}return f(new d.PointsMaterial({size:3*this.scale,map:l.load(h),transparent:!0}))};f.PointsCreator=m;f.InteractiveControl=h;f.PointsControl=p;f.drawPolyLine3D=function(){var a=this.getObject(),b=this.getFramePainter();if(!(b&&b.mode3d&&b.toplevel&&a))return null;var c=[];if(a._blob&&4==a._blob.length){var d=a._blob[1];var g=a._blob[2]}else d=a.fN,g=a.fP;for(var h=3;h<3*d;h+=
3)c.push(b.grx(g[h-3]),b.gry(g[h-2]),b.grz(g[h-1]),b.grx(g[h]),b.gry(g[h+1]),b.grz(g[h+2]));a=f.createLineSegments(c,v(this,a));b.toplevel.add(a);return!0};f.create3DLineMaterial=v;JSROOT.nodejs&&(module.exports=d);return d});
