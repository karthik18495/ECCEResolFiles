var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(l,g,u){l!=Array.prototype&&l!=Object.prototype&&(l[g]=u.value)};$jscomp.getGlobal=function(l){return"undefined"!=typeof window&&window===l?l:"undefined"!=typeof global&&null!=global?global:l};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(l,g,u,m){if(g){u=$jscomp.global;l=l.split(".");for(m=0;m<l.length-1;m++){var r=l[m];r in u||(u[r]={});u=u[r]}l=l[l.length-1];m=u[l];g=g(m);g!=m&&null!=g&&$jscomp.defineProperty(u,l,{configurable:!0,writable:!0,value:g})}};$jscomp.polyfill("Number.isFinite",function(l){return l?l:function(g){return"number"!==typeof g?!1:!isNaN(g)&&Infinity!==g&&-Infinity!==g}},"es6","es3");
$jscomp.arrayIteratorImpl=function(l){var g=0;return function(){return g<l.length?{done:!1,value:l[g++]}:{done:!0}}};$jscomp.arrayIterator=function(l){return{next:$jscomp.arrayIteratorImpl(l)}};$jscomp.makeIterator=function(l){var g="undefined"!=typeof Symbol&&Symbol.iterator&&l[Symbol.iterator];return g?g.call(l):$jscomp.arrayIterator(l)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(l){function g(){this.batch_=null}function u(t){return t instanceof r?t:new r(function(g,l){g(t)})}if(l&&!$jscomp.FORCE_POLYFILL_PROMISE)return l;g.prototype.asyncExecute=function(g){if(null==this.batch_){this.batch_=[];var t=this;this.asyncExecuteFunction(function(){t.executeBatch_()})}this.batch_.push(g)};var m=$jscomp.global.setTimeout;g.prototype.asyncExecuteFunction=function(g){m(g,0)};g.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var g=
this.batch_;this.batch_=[];for(var l=0;l<g.length;++l){var m=g[l];g[l]=null;try{m()}catch(x){this.asyncThrow_(x)}}}this.batch_=null};g.prototype.asyncThrow_=function(g){this.asyncExecuteFunction(function(){throw g;})};var r=function(g){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var t=this.createResolveAndReject_();try{g(t.resolve,t.reject)}catch(B){t.reject(B)}};r.prototype.createResolveAndReject_=function(){function g(g){return function(t){m||(m=!0,g.call(l,t))}}var l=this,m=!1;
return{resolve:g(this.resolveTo_),reject:g(this.reject_)}};r.prototype.resolveTo_=function(g){if(g===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(g instanceof r)this.settleSameAsPromise_(g);else{a:switch(typeof g){case "object":var l=null!=g;break a;case "function":l=!0;break a;default:l=!1}l?this.resolveToNonPromiseObj_(g):this.fulfill_(g)}};r.prototype.resolveToNonPromiseObj_=function(g){var l=void 0;try{l=g.then}catch(B){this.reject_(B);return}"function"==typeof l?
this.settleSameAsThenable_(l,g):this.fulfill_(g)};r.prototype.reject_=function(g){this.settle_(2,g)};r.prototype.fulfill_=function(g){this.settle_(1,g)};r.prototype.settle_=function(g,l){if(0!=this.state_)throw Error("Cannot settle("+g+", "+l+"): Promise already settled in state"+this.state_);this.state_=g;this.result_=l;this.executeOnSettledCallbacks_()};r.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var g=0;g<this.onSettledCallbacks_.length;++g)v.asyncExecute(this.onSettledCallbacks_[g]);
this.onSettledCallbacks_=null}};var v=new g;r.prototype.settleSameAsPromise_=function(g){var l=this.createResolveAndReject_();g.callWhenSettled_(l.resolve,l.reject)};r.prototype.settleSameAsThenable_=function(g,l){var m=this.createResolveAndReject_();try{g.call(l,m.resolve,m.reject)}catch(x){m.reject(x)}};r.prototype.then=function(g,l){function m(a,b){return"function"==typeof a?function(b){try{t(a(b))}catch(c){u(c)}}:b}var t,u,C=new r(function(a,b){t=a;u=b});this.callWhenSettled_(m(g,t),m(l,u));return C};
r.prototype.catch=function(g){return this.then(void 0,g)};r.prototype.callWhenSettled_=function(g,l){function m(){switch(r.state_){case 1:g(r.result_);break;case 2:l(r.result_);break;default:throw Error("Unexpected state: "+r.state_);}}var r=this;null==this.onSettledCallbacks_?v.asyncExecute(m):this.onSettledCallbacks_.push(m)};r.resolve=u;r.reject=function(g){return new r(function(l,m){m(g)})};r.race=function(g){return new r(function(l,m){for(var r=$jscomp.makeIterator(g),t=r.next();!t.done;t=r.next())u(t.value).callWhenSettled_(l,
m)})};r.all=function(g){var l=$jscomp.makeIterator(g),m=l.next();return m.done?u([]):new r(function(g,r){function t(d){return function(c){a[d]=c;b--;0==b&&g(a)}}var a=[],b=0;do a.push(void 0),b++,u(m.value).callWhenSettled_(t(a.length-1),r),m=l.next();while(!m.done)})};return r},"es6","es3");$jscomp.polyfill("Math.log10",function(l){return l?l:function(g){return Math.log(g)/Math.LN10}},"es6","es3");
JSROOT.define(["d3","painter","math","gpad"],function(l,g){function u(a,b){JSROOT.ObjectPainter.call(this,a,b);this.bins=null}function m(a,b){JSROOT.ObjectPainter.call(this,a,b);this.axes_draw=!1;this.bins=null;this.xmin=this.ymin=this.xmax=this.ymax=0;this.wheel_zoomy=!0;this.is_bent="TGraphBentErrors"==b._typename;this.has_errors="TGraphErrors"==b._typename||"TGraphAsymmErrors"==b._typename||this.is_bent||b._typename.match(/^RooHist/)}function r(a,b){JSROOT.ObjectPainter.call(this,a,b);this.$polargram=
!0;this.zoom_rmin=this.zoom_rmax=0}function v(a,b){JSROOT.ObjectPainter.call(this,a,b)}function t(a,b){JSROOT.ObjectPainter.call(this,a,b);this.bins=null}function C(a,b){JSROOT.ObjectPainter.call(this,a,b)}function B(a,b){JSROOT.ObjectPainter.call(this,a,b);this.fBoundary="Normal"}function x(a,b){JSROOT.ObjectPainter.call(this,a,b);this.firstpainter=null;this.autorange=!1;this.painters=[]}function A(a,b,d){JSROOT.ObjectPainter.call(this,a,b,d);this.wheel_zoomy=!0}function D(a,b,d){JSROOT.ObjectPainter.call(this,
a,b,d)}u.prototype=Object.create(JSROOT.ObjectPainter.prototype);u.prototype.createBins=function(a){var b=this.getFramePainter(),d=0,c=0,e=this.getObject();b&&!a&&(c=b.getGrFuncs(this.second_x,this.second_y),d=c.scale_xmin,c=c.scale_xmax);if(0<e.fSave.length&&!this.nosave){a=e.fSave.length-2;var k=e.fSave[a],f=e.fSave[a+1];b=e.$histo&&k===f;var h=0,p=0,g=[];b?(k=e.fSave[--a],h=e.$histo.fXaxis.FindBin(k,0)):p=(f-k)/(a-1);for(f=0;f<a;++f){var l=b?e.$histo.fXaxis.GetBinCenter(h+f+1):k+p*f;if(d===c||
!(l+2*p<d||l-2*p>c)){var q=e.fSave[f];Number.isFinite(q)&&g.push({x:l,y:q})}}return g}a=e.fXmin;h=e.fXmax;k=!1;d!==c&&(d>a&&(a=d),c<h&&(h=c));b&&b.logx&&0<a&&0<h&&(k=!0,a=Math.log(a),h=Math.log(h));d=Math.max(e.fNpx,101);c=(h-a)/(d-1);b=[];for(h=0;h<d;h++)p=a+h*c,k&&(p=Math.exp(p)),g=e.evalPar(p),Number.isFinite(g)&&b.push({x:p,y:g});return b};u.prototype.createDummyHisto=function(){var a=0,b=1,d=0,c=1,e=this.createBins(!0);e&&0<e.length&&(a=b=e[0].x,d=c=e[0].y,e.forEach(function(e){a=Math.min(e.x,
a);b=Math.max(e.x,b);d=Math.min(e.y,d);c=Math.max(e.y,c)}),0<c&&(c*=1.05),0>d&&(d*=1.05));e=JSROOT.create("TH1I");var k=this.getObject();e.fName=k.fName+"_hist";e.fTitle=k.fTitle;e.fXaxis.fXmin=a;e.fXaxis.fXmax=b;e.fYaxis.fXmin=d;e.fYaxis.fXmax=c;e.fMinimum=k.fMinimum;e.fMaximum=k.fMaximum;return e};u.prototype.processTooltipEvent=function(a){var b=!1;if(!a||null===this.bins||a.disabled)b=!0;else if(!this.bins.length||a.x<this.bins[0].grx||a.x>this.bins[this.bins.length-1].grx)b=!0;if(b)return this.draw_g&&
this.draw_g.select(".tooltip_bin").remove(),null;for(var d=1E5,c=-1,e=0;e<this.bins.length;++e)b=this.bins[e],b=Math.abs(b.grx-a.x),b<d&&(d=b,c=e);b=this.bins[c];e=this.draw_g.select(".tooltip_bin");d=this.lineatt.width+3;e.empty()&&(e=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",d).call(this.lineatt.func).call(this.fillatt.func));d={name:this.getObject().fName,title:this.getObject().fTitle,x:b.grx,y:b.gry,color1:this.lineatt.color,color2:this.fillatt.getFillColor(),
lines:[],exact:Math.abs(b.grx-a.x)<d&&Math.abs(b.gry-a.y)<d};d.changed=e.property("current_bin")!==c;d.menu=d.exact;d.menu_dist=Math.sqrt((b.grx-a.x)*(b.grx-a.x)+(b.gry-a.y)*(b.gry-a.y));d.changed&&e.attr("cx",b.grx).attr("cy",b.gry).property("current_bin",c);a=this.getObjectHint();0<a.length&&d.lines.push(a);(a=(a=this.getFramePainter())?a.getGrFuncs(this.second_x,this.second_y):null)&&d.lines.push("x = "+a.axisAsText("x",b.x)+" y = "+a.axisAsText("y",b.y));return d};u.prototype.redraw=function(){var a=
this.getObject(),b=this.getFramePainter(),d=b.getFrameHeight(),c=this.getMainPainter();this.createG(!0);this.bins=this.createBins(!1);this.createAttLine({attr:a});this.lineatt.used=!1;this.createAttFill({attr:a,kind:1});this.fillatt.used=!1;a=b.getGrFuncs(this.second_x,this.second_y);for(b=0;b<this.bins.length;++b){var e=this.bins[b];e.grx=a.grx(e.x);e.gry=a.gry(e.y)}2<this.bins.length&&(b=d,void 0!==c.hmin&&0<=c.hmin&&(b=Math.round(a.gry(0)),b>d||0>b)&&(b=d),d=g.buildSvgPath("bezier",this.bins,b,
2),this.lineatt.empty()||this.draw_g.append("svg:path").attr("class","line").attr("d",d.path).style("fill","none").call(this.lineatt.func),this.fillatt.empty()||this.draw_g.append("svg:path").attr("class","area").attr("d",d.path+d.close).style("stroke","none").call(this.fillatt.func))};u.prototype.canZoomInside=function(a,b,d){if("x"!==a)return!1;a=this.getObject();if(0<a.fSave.length){var c=a.fNpx;return Math.abs(a.fSave[c+1]-a.fSave[c+2])/c<Math.abs(b-d)}return!0};m.prototype=Object.create(JSROOT.ObjectPainter.prototype);
m.prototype.redraw=function(){var a=this,b=Promise.resolve(!0);if(this.$redraw_hist){delete this.$redraw_hist;var d=this.getMainPainter();d&&d.$secondary&&this.axes_draw&&(b=d.redraw())}return b.then(function(){return a.drawGraph()})};m.prototype.cleanup=function(){delete this.interactive_bin;delete this.bins;JSROOT.ObjectPainter.prototype.cleanup.call(this)};m.prototype.decodeOptions=function(a,b){"string"==typeof a&&0==a.indexOf("same ")&&(a=a.substr(5));var d=this.getObject(),c=new JSROOT.DrawOptions(a);
b=b?!!this.getMainPainter():!this.axes_draw;this.options||(this.options={});JSROOT.extend(this.options,{Line:0,Curve:0,Rect:0,Mark:0,Bar:0,OutRange:0,EF:0,Fill:0,NoOpt:0,MainError:1,Ends:1,Axis:"",PadStats:!1,original:a,second_x:!1,second_y:!1});a=this.options;a.PadStats=c.check("USE_PAD_STATS");var e="";"USE_PAD_TITLE LOGXY LOGX LOGY LOGZ GRIDXY GRIDX GRIDY TICKXY TICKX TICKY".split(" ").forEach(function(a){c.check(a)&&(e+=";"+a)});c.check("XAXIS_",!0)&&(e+=";XAXIS_"+c.part);c.check("YAXIS_",!0)&&
(e+=";YAXIS_"+c.part);c.empty()&&(a.original=b?"lp":"alp",c=new JSROOT.DrawOptions(a.original));a._pfc=c.check("PFC");a._plc=c.check("PLC");a._pmc=c.check("PMC");c.check("NOOPT")&&(a.NoOpt=1);c.check("L")&&(a.Line=1);c.check("F")&&(a.Fill=1);c.check("A")&&(a.Axis=c.check("I")?"A":"AXIS");c.check("X+")&&(a.Axis+="X+",a.second_x=b);c.check("Y+")&&(a.Axis+="Y+",a.second_y=b);c.check("RX")&&(a.Axis+="RX");c.check("RY")&&(a.Axis+="RY");c.check("CC")&&(a.Curve=2);c.check("C")&&(a.Curve=1);c.check("*")&&
(a.Mark=103);c.check("P0")&&(a.Mark=104);c.check("P")&&(a.Mark=1);c.check("B")&&(a.Bar=1,a.Errors=0);c.check("Z")&&(a.Errors=1,a.Ends=0);c.check("||")&&(a.Errors=1,a.MainError=0,a.Ends=1);c.check("[]")&&(a.Errors=1,a.MainError=0,a.Ends=2);c.check("|>")&&(a.Errors=1,a.Ends=3);c.check(">")&&(a.Errors=1,a.Ends=4);c.check("0")&&(a.Mark=1,a.Errors=1,a.OutRange=1);c.check("1")&&1==a.Bar&&(a.Bar=2);c.check("2")&&(a.Rect=1,a.Errors=0);c.check("3")&&(a.EF=1,a.Errors=0);c.check("4")&&(a.EF=2,a.Errors=0);c.check("5")&&
(a.Rect=2,a.Errors=0);c.check("X")&&(a.Errors=0);void 0===a.Errors&&(a.Errors=this.has_errors?1:0);1==a.Mark&&1==d.fMarkerStyle&&(a.Mark=101);0==a.Line+a.Fill+a.Curve+a.Mark+a.Bar+a.EF+a.Rect+a.Errors&&c.empty()&&(a.Line=1);"TGraphErrors"==d._typename&&1E-300>l.max(d.fEX)&&1E-300>l.max(d.fEY)&&(a.Errors=0);if(a.Axis)0>a.Axis.indexOf("A")&&(a.Axis="AXIS,"+a.Axis);else if(b=(b=this.getPadPainter())?b.getRootPad(!0):null,!b||b.fPrimitives&&b.fPrimitives.arr[0]===d)a.Axis="AXIS";a.Axis+=e};m.prototype.createBins=
function(){var a=this.getObject();if(a){var b=0,d=a.fNpoints;"TCutG"===a._typename&&3<d&&d--;if("TGraphErrors"==a._typename)b=1;else if("TGraphAsymmErrors"==a._typename||"TGraphBentErrors"==a._typename||a._typename.match(/^RooHist/))b=2;this.bins=Array(d);for(var c=0;c<d;++c){var e=this.bins[c]={x:a.fX[c],y:a.fY[c],indx:c};switch(b){case 1:e.exlow=e.exhigh=a.fEX[c];e.eylow=e.eyhigh=a.fEY[c];break;case 2:e.exlow=a.fEXlow[c],e.exhigh=a.fEXhigh[c],e.eylow=a.fEYlow[c],e.eyhigh=a.fEYhigh[c]}0===c&&(this.xmin=
this.xmax=e.x,this.ymin=this.ymax=e.y);0<b?(this.xmin=Math.min(this.xmin,e.x-e.exlow,e.x+e.exhigh),this.xmax=Math.max(this.xmax,e.x-e.exlow,e.x+e.exhigh),this.ymin=Math.min(this.ymin,e.y-e.eylow,e.y+e.eyhigh),this.ymax=Math.max(this.ymax,e.y-e.eylow,e.y+e.eyhigh)):(this.xmin=Math.min(this.xmin,e.x),this.xmax=Math.max(this.xmax,e.x),this.ymin=Math.min(this.ymin,e.y),this.ymax=Math.max(this.ymax,e.y))}}};m.prototype.createHistogram=function(a,b,d){var c=this.xmin,e=this.xmax;a=this.ymin;var k=this.ymax;
c>=e&&(e=c+1);a>=k&&(k=a+1);var f=.1*(e-c),h=.1*(k-a),p=c-f;f=e+f;var g=a-h;k+=h;0>p&&0<=c&&(p=.9*c);0<f&&0>=e&&(f=0);c=this.getObject();-1111!=c.fMinimum&&(g=a=c.fMinimum);-1111!=c.fMaximum&&(k=c.fMaximum);0>g&&0<=a&&(g=.9*a);a=c.fHistogram;b||d||(b=d=!0);a||(a=c.fHistogram=JSROOT.createHistogram("TH1F",100),a.fName=c.fName+"_h",e=JSROOT.BIT(9),a.fBits|=e,this._own_histogram=!0);a.fTitle=c.fTitle;b&&(a.fXaxis.fXmin=p,a.fXaxis.fXmax=f);d&&(a.fYaxis.fXmin=g,a.fYaxis.fXmax=k,a.fMinimum=g,a.fMaximum=
k);return a};m.prototype.unzoomUserRange=function(a,b){var d=this.getObject();if(this._own_histogram||!d)return!1;d=d.fHistogram;a=a&&d&&(d.fXaxis.fXmin>this.xmin||d.fXaxis.fXmax<this.xmax);b=b&&d&&(d.fYaxis.fXmin>this.ymin||d.fYaxis.fXmax<this.ymax);if(!a&&!b)return!1;this.createHistogram(null,a,b);(a=this.getMainPainter())&&a.extractAxesProperties(1);return!0};m.prototype.canOptimize=function(){return 0<JSROOT.settings.OptimizeDraw&&!this.options.NoOpt};m.prototype.optimizeBins=function(a,b){if(30>
this.bins.length&&!b)return this.bins;var d=null;if("function"==typeof b)for(var c=0;c<this.bins.length;++c)b(this.bins[c],c)?d||(d=0==c?[]:this.bins.slice(0,c)):d&&d.push(this.bins[c]);d||(d=this.bins);a||(a=5E5);if(d.length<a||!this.canOptimize())return d;a=Math.floor(d.length/a);2>a&&(a=2);b=[];for(c=0;c<d.length;c+=a)b.push(d[c]);return b};m.prototype.getTooltips=function(a){var b=this.getFramePainter(),d=[];b=b?b.getGrFuncs(this.options.second_x,this.options.second_y):null;d.push(this.getObjectHint());
a&&b&&(d.push("x = "+b.axisAsText("x",a.x)),d.push("y = "+b.axisAsText("y",a.y)),this.options.Errors&&"normal"==b.x_handle.kind&&"exlow"in a&&(0!=a.exlow||0!=a.exhigh)&&d.push("error x = -"+b.axisAsText("x",a.exlow)+"/+"+b.axisAsText("x",a.exhigh)),(this.options.Errors||0<this.options.EF)&&"normal"==b.y_handle.kind&&"eylow"in a&&(0!=a.eylow||0!=a.eyhigh)&&d.push("error y = -"+b.axisAsText("y",a.eylow)+"/+"+b.axisAsText("y",a.eyhigh)));return d};m.prototype.get_main=function(){var a=this.getFramePainter();
if(a&&a.grx&&a.gry)return a;var b=(a=this.getPadPainter())?a.getPadRect():{width:800,height:600};a={pad_layer:!0,pad:a.getRootPad(!0),pw:b.width,ph:b.height,getFrameWidth:function(){return this.pw},getFrameHeight:function(){return this.ph},grx:function(a){a=this.pad.fLogx?0<a?Math.log10(a):this.pad.fUxmin:(a-this.pad.fX1)/(this.pad.fX2-this.pad.fX1);return a*this.pw},gry:function(a){a=this.pad.fLogy?0<a?Math.log10(a):this.pad.fUymin:(a-this.pad.fY1)/(this.pad.fY2-this.pad.fY1);return(1-a)*this.ph},
getGrFuncs:function(){return this}};return a.pad?a:null};m.prototype.appendExclusion=function(a,b,d,c){for(var e=[],k=d.length-1;0<=k;--k){var f=d[k],h=Math.sqrt(f.dgrx*f.dgrx+f.dgry*f.dgry);f.grx+=c*f.dgry/h;f.gry-=c*f.dgrx/h;e.push(f)}a=g.buildSvgPath("L"+(a?"bezier":"line"),e);this.draw_g.append("svg:path").attr("d",b.path+a.path+"Z").style("stroke","none").call(this.fillatt.func).style("opacity",.75)};m.prototype.drawGraph=function(){var a=this,b=this.get_main();if(b){var d=b.getFrameWidth(),
c=b.getFrameHeight(),e=this.getObject(),k=0,f=b.getGrFuncs(this.options.second_x,this.options.second_y);this.createG(!b.pad_layer);(this.options._pfc||this.options._plc||this.options._pmc)&&(b=this.getMainPainter())&&b.createAutoColor&&(b=b.createAutoColor(),this.options._pfc&&(e.fFillColor=b,delete this.fillatt),this.options._plc&&(e.fLineColor=b,delete this.lineatt),this.options._pmc&&(e.fMarkerColor=b,delete this.markeratt),this.options._pfc=this.options._plc=this.options._pmc=!1);this.createAttLine({attr:e,
can_excl:!0});this.createAttFill({attr:e,kind:1});this.fillatt.used=!1;this.draw_kind="none";this.marker_size=0;0!=this.lineatt.excl_side&&(k=this.lineatt.excl_width,0<this.lineatt.width&&!this.options.Line&&!this.options.Curve&&(this.options.Line=1));b=null;if(this.options.EF){b=this.optimizeBins(1<this.options.EF?2E4:0);for(var h=0;h<b.length;++h){var p=b[h];p.grx=f.grx(p.x);p.gry=f.gry(p.y-p.eylow)}h=g.buildSvgPath(1<this.options.EF?"bezier":"line",b);p=[];for(var y=b.length-1;0<=y;--y){var l=
b[y];l.gry=f.gry(l.y+l.eyhigh);p.push(l)}p=g.buildSvgPath(1<this.options.EF?"Lbezier":"Lline",p);this.draw_g.append("svg:path").attr("d",h.path+p.path+"Z").style("stroke","none").call(this.fillatt.func);this.draw_kind="lines"}if(this.options.Line||this.options.Fill){h="";"TCutG"==e._typename&&(this.options.Fill=1);this.options.Fill&&(h="Z",k=0);b||(b=this.optimizeBins(0));for(p=0;p<b.length;++p)y=b[p],y.grx=f.grx(y.x),y.gry=f.gry(y.y);p="line";k&&(p+="calc");p=g.buildSvgPath(p,b);k&&this.appendExclusion(!1,
p,b,k);h=this.draw_g.append("svg:path").attr("d",p.path+h);this.options.Line?h.call(this.lineatt.func):h.style("stroke","none");this.options.Fill?h.call(this.fillatt.func):h.style("fill","none");this.draw_kind="lines"}if(this.options.Curve){h=b;if("lines"!=this.draw_kind||!h||1==this.options.Curve&&2E4<h.length)for(h=this.optimizeBins(1==this.options.Curve?2E4:0),p=0;p<h.length;++p)y=h[p],y.grx=f.grx(y.x),y.gry=f.gry(y.y);p="bezier";k&&(p+="calc");p=g.buildSvgPath(p,h);k&&this.appendExclusion(!0,
p,h,k);this.draw_g.append("svg:path").attr("d",p.path).call(this.lineatt.func).style("fill","none");this.draw_kind="lines"}k=null;if(this.options.Errors||this.options.Rect||this.options.Bar)b=this.optimizeBins(5E3,function(b,k){var h=f.grx(b.x);if(!a.options.Bar&&(0>h||h>d))return!0;var p=f.gry(b.y);if(!a.options.Bar&&!a.options.OutRange&&(0>p||p>c))return!0;b.grx1=Math.round(h);b.gry1=Math.round(p);a.has_errors&&(b.grx0=Math.round(f.grx(b.x-b.exlow)-h),b.grx2=Math.round(f.grx(b.x+b.exhigh)-h),b.gry0=
Math.round(f.gry(b.y-b.eylow)-p),b.gry2=Math.round(f.gry(b.y+b.eyhigh)-p),a.is_bent?(b.grdx0=Math.round(f.gry(b.y+e.fEXlowd[k])-p),b.grdx2=Math.round(f.gry(b.y+e.fEXhighd[k])-p),b.grdy0=Math.round(f.grx(b.x+e.fEYlowd[k])-h),b.grdy2=Math.round(f.grx(b.x+e.fEYhighd[k])-h)):b.grdx0=b.grdx2=b.grdy0=b.grdy2=0);return!1}),this.draw_kind="nodes",k=this.draw_g.selectAll(".grpoint").data(b).enter().append("svg:g").attr("class","grpoint").attr("transform",function(a){return"translate("+a.grx1+","+a.gry1+")"});
if(this.options.Bar){for(h=1;h<b.length-1;++h)b[h].width=Math.max(2,(b[h+1].grx1-b[h-1].grx1)/2-2);switch(b.length){case 0:break;case 1:b[0].width=d/4;break;case 2:b[0].width=b[1].width=(b[1].grx1-b[0].grx1)/2;break;default:b[0].width=b[1].width,b[b.length-1].width=b[b.length-2].width}var q=Math.round(f.gry(0));k.append("svg:path").attr("d",function(b){b.bar=!0;var d=Math.round(b.width);return"M"+Math.round(-b.width/2)+","+(1!==a.options.Bar?0:b.gry1>q?q-b.gry1:0)+"h"+d+"v"+(1!==a.options.Bar?c>b.gry1?
c-b.gry1:0:Math.abs(q-b.gry1))+"h"+-d+"z"}).call(this.fillatt.func)}this.options.Rect&&k.filter(function(a){return 0<a.exlow&&0<a.exhigh&&0<a.eylow&&0<a.eyhigh}).append("svg:path").attr("d",function(a){a.rect=!0;return"M"+a.grx0+","+a.gry0+"H"+a.grx2+"V"+a.gry2+"H"+a.grx0+"Z"}).call(this.fillatt.func).call(2===this.options.Rect?this.lineatt.func:function(){});this.error_size=0;if(this.options.Errors){var n=this.lineatt.width+JSROOT.gStyle.fEndErrorSize;h=0;h=this.options.Ends?"m0,"+n+"v-"+2*n:"";
p=this.options.Ends?"m"+n+",0h-"+2*n:"";var m=h,E=h,w=p,r=p,t=function(b,c){return a.options.MainError?b?"M0,0"+(c?"L"+b+","+c:"H"+b):c?"M0,0V"+c:"M0,0":"M"+b+","+c};switch(this.options.Ends){case 2:h=Math.max(this.lineatt.width+1,Math.round(.66*n));m="m"+h+","+n+"h-"+h+"v-"+2*n+"h"+h;E="m-"+h+","+n+"h"+h+"v-"+2*n+"h-"+h;w="m-"+n+","+h+"v-"+h+"h"+2*n+"v"+h;r="m-"+n+",-"+h+"v"+h+"h"+2*n+"v-"+h;break;case 3:n=Math.max(n,Math.round(5.28*e.fMarkerSize));h=Math.max(this.lineatt.width+1,Math.round(.66*
n));m="l"+h+","+n+"v-"+2*n+"l-"+h+","+n;E="l-"+h+","+n+"v-"+2*n+"l"+h+","+n;w="l-"+n+","+h+"h"+2*n+"l-"+n+",-"+h;r="l-"+n+",-"+h+"h"+2*n+"l-"+n+","+h;break;case 4:n=Math.max(n,Math.round(5.28*e.fMarkerSize)),h=Math.max(this.lineatt.width+1,Math.round(.66*n)),m="l"+h+","+n+"m0,-"+2*n+"l-"+h+","+n,E="l-"+h+","+n+"m0,-"+2*n+"l"+h+","+n,w="l-"+n+","+h+"m"+2*n+",0l-"+n+",-"+h,r="l-"+n+",-"+h+"m"+2*n+",0l-"+n+","+h}this.error_size=n;n=Math.floor((this.lineatt.width-1)/2);h=k.filter(function(a){return 0<
a.exlow||0<a.exhigh||0<a.eylow||0<a.eyhigh});!JSROOT.batch_mode&&JSROOT.settings.Tooltip&&h.append("svg:path").style("stroke","none").style("fill","none").style("pointer-events","visibleFill").attr("d",function(a){return"M"+a.grx0+","+a.gry0+"h"+(a.grx2-a.grx0)+"v"+(a.gry2-a.gry0)+"h"+(a.grx0-a.grx2)+"z"});h.append("svg:path").call(this.lineatt.func).style("fill","none").attr("d",function(a){a.error=!0;return(0<a.exlow?t(a.grx0+n,a.grdx0)+m:"")+(0<a.exhigh?t(a.grx2-n,a.grdx2)+E:"")+(0<a.eylow?t(a.grdy0,
a.gry0-n)+r:"")+(0<a.eyhigh?t(a.grdy2,a.gry2+n)+w:"")})}if(this.options.Mark){h="";this.createAttMarker({attr:e,style:this.options.Mark-100});this.marker_size=this.markeratt.getFullSize();this.markeratt.resetPos();p=!JSROOT.batch_mode&&JSROOT.settings.Tooltip&&(!this.markeratt.fill||7>this.marker_size)&&!k;y="";l=Math.max(5,Math.round(.7*this.marker_size));var u=1E6/(this.markeratt.getMarkerLength()+7);var F=1;b?this.canOptimize()&&b.length>1.5*u&&(F=Math.min(2,Math.round(b.length/u))):b=this.optimizeBins(u);
for(var x=0;x<b.length;x+=F){var v=b[x];u=f.grx(v.x);u>-this.marker_size&&u<d+this.marker_size&&(v=f.gry(v.y),v>-this.marker_size&&v<c+this.marker_size&&(h+=this.markeratt.create(u,v),p&&(y+="M"+(u-l)+","+(v-l)+"h"+2*l+"v"+2*l+"h"+-2*l+"z")))}0<h.length&&(this.draw_g.append("svg:path").attr("d",h).call(this.markeratt.func),null===k&&"none"==this.draw_kind&&(this.draw_kind=101==this.options.Mark?"path":"mark"));p&&y&&this.draw_g.append("svg:path").attr("d",y).attr("stroke","none").attr("fill","none").attr("pointer-events",
"visibleFill")}if(!JSROOT.batch_mode)return JSROOT.require(["interactive"]).then(function(b){return b.addMoveHandler(a,a.testEditable())})}};m.prototype.extractTooltip=function(a){if(!a)return null;if("lines"==this.draw_kind||"path"==this.draw_kind||"mark"==this.draw_kind)return this.extractTooltipForPath(a);if("nodes"!=this.draw_kind)return null;var b=this.getFramePainter(),d=this,c=b.getFrameHeight(),e=this.error_size,k=1===this.options.Bar,f=null,h=1E10,p=null,g=this.marker_size?Math.round(this.marker_size/
2+1.5):0;this.draw_g.selectAll(".grpoint").each(function(){var n=l.select(this).datum();if(void 0!==n){var y=Math.pow(a.x-n.grx1,2);1===a.nproc&&(y+=Math.pow(a.y-n.gry1,2));if(!(y>=h)){if(n.error||n.rect||n.marker)var q={x1:Math.min(-e,n.grx0,-g),x2:Math.max(e,n.grx2,g),y1:Math.min(-e,n.gry2,-g),y2:Math.max(e,n.gry0,g)};else if(n.bar){if(q={x1:-n.width/2,x2:n.width/2,y1:0,y2:c-n.gry1},k){var m=b.getGrFuncs(d.options.second_x,d.options.second_y).gry(0);q.y1=n.gry1>m?m-n.gry1:0;q.y2=n.gry1>m?0:m-n.gry1}}else q=
{x1:-5,x2:5,y1:-5,y2:5};m=a.y>=n.gry1+q.y1&&a.y<=n.gry1+q.y2;a.x>=n.grx1+q.x1&&a.x<=n.grx1+q.x2&&(m||1<a.nproc)&&(h=y,f=this,p=q,p.exact=m)}}});if(null===f)return null;var m=l.select(f).datum(),q={name:this.getObject().fName,title:this.getObject().fTitle,x:m.grx1,y:m.gry1,color1:this.lineatt.color,lines:this.getTooltips(m),rect:p,d3bin:f};this.fillatt&&this.fillatt.used&&!this.fillatt.empty()&&(q.color2=this.fillatt.getFillColor());p.exact&&(q.exact=!0);q.menu=q.exact;q.menu_dist=3;q.bin=m;q.binindx=
m.indx;return q};m.prototype.showTooltip=function(a){if(a){if(a.usepath)return this.showTooltipForPath(a);var b=l.select(a.d3bin).datum(),d=this.draw_g.select(".tooltip_bin");d.empty()&&(d=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none"));a.changed=d.property("current_bin")!==a.d3bin;a.changed&&d.attr("x",b.grx1+a.rect.x1).attr("width",a.rect.x2-a.rect.x1).attr("y",b.gry1+a.rect.y1).attr("height",a.rect.y2-a.rect.y1).style("opacity","0.3").property("current_bin",
a.d3bin)}else this.draw_g&&this.draw_g.select(".tooltip_bin").remove()};m.prototype.processTooltipEvent=function(a){var b=this.extractTooltip(a);a&&a.disabled||this.showTooltip(b);return b};m.prototype.findBestBin=function(a){if(!this.bins)return null;var b="lines"==this.draw_kind,d=-1,c=null,e=1E10,k=this.getFramePainter().getGrFuncs(this.options.second_x,this.options.second_y),f;for(f=0;f<this.bins.length;++f){var h=this.bins[f];var p=k.grx(h.x);var g=k.gry(h.y);g=(a.x-p)*(a.x-p)+(a.y-g)*(a.y-g);
g<e&&(e=g,c=h,d=f)}100<e&&b&&(c=null);var l=Math.max(this.lineatt.width+3,4);0<this.marker_size&&(l=Math.max(this.marker_size,l));c&&(e=Math.sqrt(Math.pow(a.x-k.grx(c.x),2)+Math.pow(a.y-k.gry(c.y),2)));!b&&e>l&&(c=null);c||(d=-1);d={bin:c,indx:d,dist:e,radius:Math.round(l)};if(!c&&b){e=1E10;b=function(a,b,c){return b>=a&&a>=c||b<=a&&a<=c};g=this.bins[0];var q=k.grx(g.x);c=0;for(f=1;f<this.bins.length;++f){h=this.bins[f];p=k.grx(h.x);if(b(a.x,q,p)){var n=k.gry(g.y);g=k.gry(h.y);1>Math.abs(p-q)?(c=
a.y,g=b(a.y,n,g)?0:Math.min(Math.abs(a.y-n),Math.abs(a.y-g))):(c=n+(a.x-q)/(p-q)*(g-n),g=Math.abs(c-a.y));g<e&&(e=g,d.linex=a.x,d.liney=c)}g=h;q=p}e<.5*l&&(d.linedist=e,d.closeline=!0)}return d};m.prototype.testEditable=function(a){var b=this.getObject(),d=JSROOT.BIT(18);if(!b)return!1;("toggle"==a||void 0!==a&&!a!=b.TestBit(d))&&b.InvertBit(d);return!b.TestBit(d)};m.prototype.extractTooltipForPath=function(a){if(null===this.bins)return null;var b=this.findBestBin(a);if(!b||!b.bin&&!b.closeline)return null;
var d="lines"==this.draw_kind,c="mark"==this.draw_kind,e=this.getFramePainter().getGrFuncs(this.options.second_x,this.options.second_y),k=this.getObject(),f={name:k.fName,title:k.fTitle,x:b.bin?e.grx(b.bin.x):b.linex,y:b.bin?e.gry(b.bin.y):b.liney,color1:this.lineatt.color,lines:this.getTooltips(b.bin),usepath:!0};f.ismark=c;f.islines=d;b.closeline?(f.menu=f.exact=!0,f.menu_dist=b.linedist):b.bin&&(this.options.EF&&d?(f.gry1=e.gry(b.bin.y-b.bin.eylow),f.gry2=e.gry(b.bin.y+b.bin.eyhigh)):f.gry1=f.gry2=
e.gry(b.bin.y),f.binindx=b.indx,f.bin=b.bin,f.radius=b.radius,f.exact=Math.abs(a.x-f.x)<=b.radius&&(Math.abs(a.y-f.gry1)<=b.radius||Math.abs(a.y-f.gry2)<=b.radius),f.menu=f.exact,f.menu_dist=Math.sqrt((a.x-f.x)*(a.x-f.x)+Math.pow(Math.min(Math.abs(a.y-f.gry1),Math.abs(a.y-f.gry2)),2)));this.fillatt&&this.fillatt.used&&!this.fillatt.empty()&&(f.color2=this.fillatt.getFillColor());d||(f.color1=this.getColor(k.fMarkerColor),f.color2||(f.color2=f.color1));return f};m.prototype.showTooltipForPath=function(a){var b=
this.draw_g.select(".tooltip_bin");a&&a.bin?(b.empty()&&(b=this.draw_g.append("svg:g").attr("class","tooltip_bin")),a.changed=b.property("current_bin")!==a.bin,a.changed&&(b.selectAll("*").remove(),b.property("current_bin",a.bin),a.ismark?b.append("svg:rect").attr("class","h1bin").style("pointer-events","none").style("opacity","0.3").attr("x",Math.round(a.x-a.radius)).attr("y",Math.round(a.y-a.radius)).attr("width",2*a.radius).attr("height",2*a.radius):(b.append("svg:circle").attr("cy",Math.round(a.gry1)),
1<Math.abs(a.gry1-a.gry2)&&b.append("svg:circle").attr("cy",Math.round(a.gry2)),b=b.selectAll("circle").attr("r",a.radius).attr("cx",Math.round(a.x)),a.islines?(this.options.Line||this.options.Curve?b.call(this.lineatt.func):b.style("stroke","black"),this.options.Fill?b.call(this.fillatt.func):b.style("fill","none")):b.style("stroke","black"==a.color1?"green":"black").style("fill","none")))):b.remove()};m.prototype.moveEnabled=function(){return this.testEditable()};m.prototype.moveStart=function(a,
b){this.pos_dx=this.pos_dy=0;var d=this.extractTooltip({x:a,y:b});d&&d.exact&&void 0!==d.binindx?(this.move_binindx=d.binindx,this.move_bin=d.bin,this.move_x0=(d=(d=this.getFramePainter())?d.getGrFuncs(this.options.second_x,this.options.second_y):null)?d.grx(this.move_bin.x):a,this.move_y0=d?d.gry(this.move_bin.y):b):delete this.move_binindx};m.prototype.moveDrag=function(a,b){this.pos_dx+=a;this.pos_dy+=b;void 0===this.move_binindx?this.draw_g.attr("transform","translate("+this.pos_dx+","+this.pos_dy+
")"):(a=(a=this.getFramePainter())?a.getGrFuncs(this.options.second_x,this.options.second_y):null)&&this.move_bin&&(this.move_bin.x=a.revertAxis("x",this.move_x0+this.pos_dx),this.move_bin.y=a.revertAxis("y",this.move_y0+this.pos_dy),this.drawGraph())};m.prototype.moveEnd=function(a){var b="";if(void 0===this.move_binindx){this.draw_g.attr("transform",null);var d=this.getFramePainter();if((d=d?d.getGrFuncs(this.options.second_x,this.options.second_y):null)&&this.bins&&!a){for(var c=0;c<this.bins.length;++c){var e=
this.bins[c];e.x=d.revertAxis("x",d.grx(e.x)+this.pos_dx);e.y=d.revertAxis("y",d.gry(e.y)+this.pos_dy);b+="SetPoint("+e.indx+","+e.x+","+e.y+");;";0==e.indx&&this.matchObjectType("TCutG")&&(b+="SetPoint("+(this.getObject().fNpoints-1)+","+e.x+","+e.y+");;")}this.drawGraph()}}else b="SetPoint("+this.move_bin.indx+","+this.move_bin.x+","+this.move_bin.y+")",0==this.move_bin.indx&&this.matchObjectType("TCutG")&&(b+=";;SetPoint("+(this.getObject().fNpoints-1)+","+this.move_bin.x+","+this.move_bin.y+")"),
delete this.move_binindx;b&&!a&&this.submitCanvExec(b)};m.prototype.fillContextMenu=function(a){var b=this;JSROOT.ObjectPainter.prototype.fillContextMenu.call(this,a);this.snapid||a.addchk(this.testEditable(),"Editable",function(){b.testEditable("toggle");b.drawGraph()});return 0<a.size()};m.prototype.executeMenuCommand=function(a,b){if(JSROOT.ObjectPainter.prototype.executeMenuCommand.call(this,a,b))return!0;b=this.getCanvPainter();var d=this.getFramePainter();if("RemovePoint"==a.fName||"InsertPoint"==
a.fName){var c=d?d.getLastEventPos():null;if(!b||b._readonly||!c)return!0;var e=this.extractTooltip(c);"InsertPoint"==a.fName?(a=(d=d?d.getGrFuncs(this.options.second_x,this.options.second_y):null)?d.revertAxis("x",c.x):0,c=d?d.revertAxis("y",c.y):0,b.showMessage("InsertPoint("+a.toFixed(3)+","+c.toFixed(3)+") not yet implemented")):this.args_menu_id&&e&&void 0!==e.binindx&&this.submitCanvExec("RemovePoint("+e.binindx+")",this.args_menu_id);return!0}return!1};m.prototype.updateObject=function(a,b){if(!this.matchObjectType(a))return!1;
b&&b!=this.options.original&&this.decodeOptions(b);b=this.getObject();b.fBits=a.fBits;b.fTitle=a.fTitle;b.fX=a.fX;b.fY=a.fY;b.fNpoints=a.fNpoints;b.fMinimum=a.fMinimum;b.fMaximum=a.fMaximum;this.createBins();delete this.$redraw_hist;this.axes_draw&&(a=this.createHistogram(a.fHistogram),a.fTitle=b.fTitle,(b=this.getMainPainter())&&b.$secondary&&(b.updateObject(a,this.options.Axis),this.$redraw_hist=!0));return!0};m.prototype.canZoomInside=function(a,b,d){var c=this.getObject();if(!c||"x"!==a)return!1;
for(a=0;a<c.fNpoints;++a)if(b<c.fX[a]&&c.fX[a]<d)return!0;return!1};m.prototype.clickButton=function(a){if("ToggleZoom"!==a)return!1;a=this.getFramePainter();if(!a||this.xmin===this.xmax&&this.ymin===this.ymax)return!1;a.zoom(this.xmin,this.xmax,this.ymin,this.ymax);return!0};m.prototype.findFunc=function(){var a=this.getObject();if(a&&a.fFunctions)for(var b=0;b<a.fFunctions.arr.length;++b){var d=a.fFunctions.arr[b];if("TF1"==d._typename||"TF2"==d._typename)return d}return null};m.prototype.findStat=
function(){var a=this.getObject();if(a&&a.fFunctions)for(var b=0;b<a.fFunctions.arr.length;++b){var d=a.fFunctions.arr[b];if("TPaveStats"==d._typename&&"stats"==d.fName)return d}return null};m.prototype.createStat=function(){var a=this.findFunc();if(!a)return null;var b=this.findStat();if(b)return b;if((b=this.getCanvPainter())&&b.normal_canvas||this.options.PadStats)return null;this.create_stats=!0;var d=JSROOT.gStyle;b=JSROOT.create("TPaveStats");JSROOT.extend(b,{fName:"stats",fOptStat:0,fOptFit:d.fOptFit||
111,fBorderSize:1});b.fX1NDC=d.fStatX-d.fStatW;b.fY1NDC=d.fStatY-d.fStatH;b.fX2NDC=d.fStatX;b.fY2NDC=d.fStatY;b.fFillColor=d.fStatColor;b.fFillStyle=d.fStatStyle;b.fTextAngle=0;b.fTextSize=d.fStatFontSize;b.fTextAlign=12;b.fTextColor=d.fStatTextColor;b.fTextFont=d.fStatFont;b.AddText(a.fName);this.getObject().fFunctions.Add(b);return b};m.prototype.fillStatistic=function(a,b,d){b=this.findFunc();if(!b||!d||!this.create_stats)return!1;a.clearPave();a.fillFunctionStat(b,d);return!0};m.prototype.drawNextFunction=
function(a){var b=this,d=this.getObject();if(!d.fFunctions||a>=d.fFunctions.arr.length)return Promise.resolve(this);var c=d.fFunctions.arr[a];d=d.fFunctions.opt[a];c.$main_painter=this;return JSROOT.draw(this.getDom(),c,d).then(function(){return b.drawNextFunction(a+1)})};r.prototype=Object.create(JSROOT.ObjectPainter.prototype);r.prototype.translate=function(a,b,d){b=this.r(b);var c=b/this.szx*this.szy;a={x:b*Math.cos(-a-this.angle),y:c*Math.sin(-a-this.angle),rx:b,ry:c};d||(a.x=Math.round(a.x),
a.y=Math.round(a.y),a.rx=Math.round(a.rx),a.ry=Math.round(a.ry));return a};r.prototype.format=function(a){return a===Math.round(a)?a.toString():10<this.ndig?a.toExponential(4):a.toFixed(0<this.ndig?this.ndig:0)};r.prototype.axisAsText=function(a,b){if("r"==a)return b===Math.round(b)?b.toString():10<this.ndig?b.toExponential(4):b.toFixed(this.ndig+2);b*=180/Math.PI;return b===Math.round(b)?b.toString():b.toFixed(1)};r.prototype.getFrameRect=function(){var a=this.getPadPainter(),b=a.getRootPad(!0),
d=a.getPadWidth();a=a.getPadHeight();var c={};b?(c.szx=Math.round(Math.max(.1,.5-Math.max(b.fLeftMargin,b.fRightMargin))*d),c.szy=Math.round(Math.max(.1,.5-Math.max(b.fBottomMargin,b.fTopMargin))*a)):(c.szx=Math.round(.5*d),c.szy=Math.round(.5*a));c.width=2*c.szx;c.height=2*c.szy;c.midx=Math.round(d/2);c.midy=Math.round(a/2);c.x=c.midx-c.szx;c.y=c.midy-c.szy;c.hint_delta_x=c.szx;c.hint_delta_y=c.szy;c.transform="translate("+c.x+","+c.y+")";return c};r.prototype.mouseEvent=function(a,b){var d=this.getLayerSvg("primitives_layer").select(".interactive_ellipse");
if(!d.empty()){var c=null;"leave"!==a&&(a=l.pointer(b,d.node()),c={x:a[0],y:a[1],touch:!1});this.processFrameTooltipEvent(c)}};r.prototype.mouseWheel=function(a){a.stopPropagation();a.preventDefault();this.processFrameTooltipEvent(null);var b=this.getObject();if(b&&(a=a.wheelDelta?-a.wheelDelta:a.deltaY||a.detail)){var d=this.scale_rmin,c=this.scale_rmax;c+=(0>a?-.2:.2)*(c-d);if(d<b.fRwrmin||c>b.fRwrmax)d=c=0;if(this.zoom_rmin!=d||this.zoom_rmax!=c)this.zoom_rmin=d,this.zoom_rmax=c,this.redrawPad()}};
r.prototype.redraw=function(){var a=this;if(this.isMainPainter()){var b=this.getObject(),d=this.getFrameRect();this.createG();this.draw_g.attr("transform","translate("+d.midx+","+d.midy+")");this.szx=d.szx;this.szy=d.szy;this.scale_rmin=b.fRwrmin;this.scale_rmax=b.fRwrmax;this.zoom_rmin!=this.zoom_rmax&&(this.scale_rmin=this.zoom_rmin,this.scale_rmax=this.zoom_rmax);this.r=l.scaleLinear().domain([this.scale_rmin,this.scale_rmax]).range([0,this.szx]);this.angle=b.fAxisAngle||0;var c=this.r.ticks(5);
d=Math.floor(b.fNdivRad%1E4/100);this.createAttLine({attr:b});this.gridatt||(this.gridatt=new JSROOT.TAttLineHandler({color:b.fLineColor,style:2,width:1}));var e=Math.abs(b.fRwrmax-b.fRwrmin);this.ndig=0>=e?-3:Math.round(Math.log10(c.length/e));e=[];for(var k=0;k<c.length;){var f=this.format(c[k]);if(0<=e.indexOf(f)){if(10<++this.ndig)break;e=[];k=0}else e.push(f),k++}e=!1;c[c.length-1]<b.fRwrmax&&this.zoom_rmin==this.zoom_rmax&&(c.push(b.fRwrmax),e=!0);this.startTextDrawing(b.fRadialLabelFont,Math.round(b.fRadialTextSize*
this.szy*2));for(k=0;k<c.length;++k){var h=this.r(c[k]),p=h/this.szx*this.szy;this.draw_g.append("ellipse").attr("cx",0).attr("cy",0).attr("rx",Math.round(h)).attr("ry",Math.round(p)).style("fill","none").call(this.lineatt.func);(k<c.length-1||!e)&&this.drawText({align:23,x:Math.round(h),y:Math.round(b.fRadialTextSize*this.szy*.5),text:this.format(c[k]),color:this.getColor(b.fRadialLabelColor),latex:0});if(1<d&&(k<c.length-1||!e)){f=(c[1]-c[0])/d;for(var g=1;g<d;++g){h=c[k]+f*g;if(h>this.scale_rmax)break;
h=this.r(h);p=h/this.szx*this.szy;this.draw_g.append("ellipse").attr("cx",0).attr("cy",0).attr("rx",Math.round(h)).attr("ry",Math.round(p)).style("fill","none").call(this.gridatt.func)}}}this.finishTextDrawing();d=Math.round(b.fPolarTextSize*this.szy*2);this.startTextDrawing(b.fPolarLabelFont,d);c=b.fNdivPol%100;8!==c&&3!==c&&(c=8);e=8==c?"0 #frac{#pi}{4} #frac{#pi}{2} #frac{3#pi}{4} #pi #frac{5#pi}{4} #frac{3#pi}{2} #frac{7#pi}{4}".split(" "):["0","#frac{2#pi}{3}","#frac{4#pi}{3}"];k=[12,11,21,31,
32,33,23,13];for(f=0;f<c;++f)g=2*-f*Math.PI/c-this.angle,this.draw_g.append("line").attr("x1",0).attr("y1",0).attr("x2",Math.round(this.szx*Math.cos(g))).attr("y2",Math.round(this.szy*Math.sin(g))).call(this.lineatt.func),this.drawText({align:k[Math.round(16-g/Math.PI*4)%8],x:Math.round((this.szx+d)*Math.cos(g)),y:Math.round((this.szy+d/this.szx*this.szy)*Math.sin(g)),text:e[f],color:this.getColor(b.fPolarLabelColor),latex:1});this.finishTextDrawing();d=Math.floor(b.fNdivPol%1E4/100);if(1<d)for(b=
0;b<c*d;++b)0!==b%d&&(e=2*-b*Math.PI/c/d-this.angle,this.draw_g.append("line").attr("x1",0).attr("y1",0).attr("x2",Math.round(this.szx*Math.cos(e))).attr("y2",Math.round(this.szy*Math.sin(e))).call(this.gridatt.func));JSROOT.batch_mode||JSROOT.require(["interactive"]).then(function(b){b.TooltipHandler.assign(a);b=a.getLayerSvg("primitives_layer");var c=b.select(".interactive_ellipse");c.empty()&&(c=b.append("g").classed("most_upper_primitives",!0).append("ellipse").classed("interactive_ellipse",!0).attr("cx",
0).attr("cy",0).style("fill","none").style("pointer-events","visibleFill").on("mouseenter",function(b){return a.mouseEvent("enter",b)}).on("mousemove",function(b){return a.mouseEvent("move",b)}).on("mouseleave",function(b){return a.mouseEvent("leave",b)}));c.attr("rx",a.szx).attr("ry",a.szy);l.select(c.node().parentNode).attr("transform",a.draw_g.attr("transform"));if(JSROOT.settings.Zooming&&JSROOT.settings.ZoomWheel)c.on("wheel",function(b){return a.mouseWheel(b)})})}};v.prototype=Object.create(JSROOT.ObjectPainter.prototype);
v.prototype.redraw=function(){this.drawGraphPolar()};v.prototype.decodeOptions=function(a){var b=new JSROOT.DrawOptions(a||"L");this.options||(this.options={});JSROOT.extend(this.options,{mark:b.check("P"),err:b.check("E"),fill:b.check("F"),line:b.check("L"),curve:b.check("C")});this.storeDrawOpt(a)};v.prototype.drawGraphPolar=function(){var a=this.getObject(),b=this.getMainPainter();if(a&&b&&b.$polargram){this.options.mark&&this.createAttMarker({attr:a});(this.options.err||this.options.line||this.options.curve)&&
this.createAttLine({attr:a});this.options.fill&&this.createAttFill({attr:a});this.createG();this.draw_g.attr("transform",b.draw_g.attr("transform"));for(var d="",c="",e="",k=[],f=0;f<a.fNpoints;++f)if(!(a.fY[f]>b.scale_rmax)){if(this.options.err){var h=b.translate(a.fX[f],a.fY[f]-a.fEY[f]),p=b.translate(a.fX[f],a.fY[f]+a.fEY[f]);c+="M"+h.x+","+h.y+"L"+p.x+","+p.y;h=b.translate(a.fX[f]+a.fEX[f],a.fY[f]);p=b.translate(a.fX[f]-a.fEX[f],a.fY[f]);c+="M"+h.x+","+h.y+"A"+p.rx+","+p.ry+",0,0,1,"+p.x+","+
p.y}h=b.translate(a.fX[f],a.fY[f]);this.options.mark&&(d+=this.markeratt.create(h.x,h.y));if(this.options.line||this.options.fill)e+=(e?"L":"M")+h.x+","+h.y;this.options.curve&&(h.grx=h.x,h.gry=h.y,k.push(h))}this.options.fill&&e&&this.draw_g.append("svg:path").attr("d",e+"Z").style("stroke","none").call(this.fillatt.func);this.options.line&&e&&this.draw_g.append("svg:path").attr("d",e).style("fill","none").call(this.lineatt.func);this.options.curve&&k.length&&this.draw_g.append("svg:path").attr("d",
g.buildSvgPath("bezier",k).path).style("fill","none").call(this.lineatt.func);c&&this.draw_g.append("svg:path").attr("d",c).style("fill","none").call(this.lineatt.func);d&&this.draw_g.append("svg:path").attr("d",d).call(this.markeratt.func)}};v.prototype.createPolargram=function(){for(var a=JSROOT.create("TGraphPolargram"),b=this.getObject(),d=b.fY[0]||0,c=d,e=0;e<b.fNpoints;++e)d=Math.min(d,b.fY[e]-b.fEY[e]),c=Math.max(c,b.fY[e]+b.fEY[e]);a.fRwrmin=d-.1*(c-d);a.fRwrmax=c+.1*(c-d);return a};v.prototype.extractTooltip=
function(a){if(!a)return null;for(var b=this.getObject(),d=this.getMainPainter(),c=1E10,e=-1,k=null,f=0;f<b.fNpoints;++f){var h=d.translate(b.fX[f],b.fY[f]),g=(h.x-a.x)*(h.x-a.x)+(h.y-a.y)*(h.y-a.y);g<c&&(c=g,e=f,k=h)}a=5;this.markeratt&&this.markeratt.used&&(a=this.markeratt.getFullSize());if(Math.sqrt(c)>a)return null;c={name:this.getObject().fName,title:this.getObject().fTitle,x:k.x,y:k.y,color1:this.markeratt&&this.markeratt.used?this.markeratt.color:this.lineatt.color,exact:4>Math.sqrt(c),lines:[this.getObjectHint()],
binindx:e,menu_dist:a,radius:a};c.lines.push("r = "+d.axisAsText("r",b.fY[e]));c.lines.push("phi = "+d.axisAsText("phi",b.fX[e]));b.fEY&&b.fEY[e]&&c.lines.push("error r = "+d.axisAsText("r",b.fEY[e]));b.fEX&&b.fEX[e]&&c.lines.push("error phi = "+d.axisAsText("phi",b.fEX[e]));return c};v.prototype.showTooltip=function(a){if(this.draw_g){var b=this.draw_g.select(".tooltip_bin");a?(b.empty()&&(b=this.draw_g.append("svg:ellipse").attr("class","tooltip_bin").style("pointer-events","none")),a.changed=b.property("current_bin")!==
a.binindx,a.changed&&b.attr("cx",a.x).attr("cy",a.y).attr("rx",Math.round(a.radius)).attr("ry",Math.round(a.radius)).style("fill","none").style("stroke",a.color1).property("current_bin",a.binindx)):b.remove()}};v.prototype.processTooltipEvent=function(a){var b=this.extractTooltip(a);a&&a.disabled||this.showTooltip(b);return b};t.prototype=Object.create(JSROOT.ObjectPainter.prototype);t.prototype.updateObject=function(a,b){var d=this.getObject();if(d._typename!=a._typename)return!1;d!==a&&JSROOT.extend(d,
a);void 0!==b&&this.decodeOptions(b);return!0};t.prototype.eval=function(a,b){b-=a.fX;return"TSplinePoly3"==a._typename?a.fY+b*(a.fB+b*(a.fC+b*a.fD)):"TSplinePoly5"==a._typename?a.fY+b*(a.fB+b*(a.fC+b*(a.fD+b*(a.fE+b*a.fF)))):a.fY+b};t.prototype.findX=function(a){var b=this.getObject(),d=0,c=b.fNp-1;if(a<=b.fXmin)return 0;if(a>=b.fXmax)return c;if(b.fKstep)d=Math.round((a-b.fXmin)/b.fDelta),a<b.fPoly[d].fX?d=Math.max(d-1,0):d<c&&a>b.fPoly[d+1].fX&&++d;else for(;1<c-d;){var e=Math.round((d+c)/2);a>
b.fPoly[e].fX?d=e:c=e}return d};t.prototype.createDummyHisto=function(){var a=0,b=1,d=0,c=1,e=this.getObject();e&&e.fPoly&&(a=b=e.fPoly[0].fX,d=c=e.fPoly[0].fY,e.fPoly.forEach(function(e){a=Math.min(e.fX,a);b=Math.max(e.fX,b);d=Math.min(e.fY,d);c=Math.max(e.fY,c)}),0<c&&(c*=1.05),0>d&&(d*=1.05));var k=JSROOT.create("TH1I");k.fName=e.fName+"_hist";k.fTitle=e.fTitle;k.fXaxis.fXmin=a;k.fXaxis.fXmax=b;k.fYaxis.fXmin=d;k.fYaxis.fXmax=c;return k};t.prototype.processTooltipEvent=function(a){var b=!1,d=this.getObject(),
c=this.getFramePainter();c=c?c.getGrFuncs(this.options.second_x,this.options.second_y):null;var e=null,k=0;if(null!==a&&d&&c){var f=c.revertAxis("x",a.x);k=this.findX(f);e=d.fPoly[k];var h=this.eval(e,f);k<d.fN-1&&Math.abs(d.fPoly[k+1].fX-f)<Math.abs(f-e.fX)&&(e=d.fPoly[++k]);if(Math.abs(c.grx(e.fX)-a.x)<.5*this.knot_size)f=e.fX,h=e.fY;else if(e=null,f<d.fXmin||f>d.fXmax)b=!0}else b=!0;if(b)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;b=this.draw_g.select(".tooltip_bin");d=
this.lineatt.width+3;b.empty()&&(b=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",d).style("fill","none").call(this.lineatt.func));d={name:this.getObject().fName,title:this.getObject().fTitle,x:c.grx(f),y:c.gry(h),color1:this.lineatt.color,lines:[],exact:null!==e||Math.abs(c.gry(h)-a.y)<d};d.changed=b.property("current_xx")!==f;d.menu=d.exact;d.menu_dist=Math.sqrt((d.x-a.x)*(d.x-a.x)+(d.y-a.y)*(d.y-a.y));d.changed&&b.attr("cx",Math.round(d.x)).attr("cy",
Math.round(d.y)).property("current_xx",f);a=this.getObjectHint();0<a.length&&d.lines.push(a);d.lines.push("x = "+c.axisAsText("x",f));d.lines.push("y = "+c.axisAsText("y",h));null!==e&&(d.lines.push("knot = "+k),d.lines.push("B = "+g.floatToString(e.fB,JSROOT.gStyle.fStatFormat)),d.lines.push("C = "+g.floatToString(e.fC,JSROOT.gStyle.fStatFormat)),d.lines.push("D = "+g.floatToString(e.fD,JSROOT.gStyle.fStatFormat)),void 0!==e.fE&&void 0!==e.fF&&(d.lines.push("E = "+g.floatToString(e.fE,JSROOT.gStyle.fStatFormat)),
d.lines.push("F = "+g.floatToString(e.fF,JSROOT.gStyle.fStatFormat))));return d};t.prototype.redraw=function(){var a=this.getObject(),b=this.getFramePainter(),d=b?b.getGrFuncs(this.options.second_x,this.options.second_y):null,c=b.getFrameWidth(),e=b.getFrameHeight();this.createG(!0);this.knot_size=5;this.createAttLine({attr:a});if(this.options.Line||this.options.Curve){var k=Math.max(10,a.fNpx),f=Math.max(b.scale_xmin,a.fXmin),h=Math.min(b.scale_xmax,a.fXmax),p=this.findX(f),l=[];b.logx&&(f=Math.log(f),
h=Math.log(h));for(var m=0;m<k;++m){var q=f+(h-f)/k*(m-1);for(b.logx&&(q=Math.exp(q));p<a.fNp-1&&q>a.fPoly[p+1].fX;)++p;var n=this.eval(a.fPoly[p],q);l.push({x:q,y:n,grx:d.grx(q),gry:d.gry(n)})}k=e;void 0!==b.hmin&&0<=b.hmin&&(k=Math.round(d.gry(0)),k>e||0>k)&&(k=e);b=g.buildSvgPath("bezier",l,k,2);this.draw_g.append("svg:path").attr("class","line").attr("d",b.path).style("fill","none").call(this.lineatt.func)}if(this.options.Mark){b="";this.createAttMarker({attr:a});this.markeratt.resetPos();this.knot_size=
this.markeratt.getFullSize();for(l=0;l<a.fPoly.length;l++)f=a.fPoly[l],k=d.grx(f.fX),k>-this.knot_size&&k<c+this.knot_size&&(f=d.gry(f.fY),f>-this.knot_size&&f<e+this.knot_size&&(b+=this.markeratt.create(k,f)));b&&this.draw_g.append("svg:path").attr("d",b).call(this.markeratt.func)}};t.prototype.canZoomInside=function(a){return"x"===a&&this.getObject()?!0:!1};t.prototype.decodeOptions=function(a){var b=new JSROOT.DrawOptions(a);this.options||(this.options={});var d=!!this.getMainPainter();JSROOT.extend(this.options,
{Same:b.check("SAME"),Line:b.check("L"),Curve:b.check("C"),Mark:b.check("P"),Hopt:"AXIS",second_x:!1,second_y:!1});this.options.Line||this.options.Curve||this.options.Mark||(this.options.Curve=!0);b.check("X+")&&(this.options.Hopt+="X+",this.options.second_x=d);b.check("Y+")&&(this.options.Hopt+="Y+",this.options.second_y=d);this.storeDrawOpt(a)};g.drawSpline=function(a,b,d){var c=new t(a,b);c.decodeOptions(d);b=Promise.resolve();if((d=!c.getMainPainter())||c.options.second_x||c.options.second_y){if(c.options.Same&&
d)return console.warn("TSpline painter requires histogram to be drawn"),null;b=c.createDummyHisto();b=JSROOT.draw(a,b,c.options.Hopt)}return b.then(function(){c.addToPadPrimitives();c.redraw();return c})};C.prototype=Object.create(JSROOT.ObjectPainter.prototype);C.prototype.redraw=function(){void 0===this.step&&this.startDrawing()};C.prototype.decodeOptions=function(a){var b=new JSROOT.DrawOptions(a||"REPEAT");this.options||(this.options={});JSROOT.extend(this.options,{once:b.check("ONCE"),repeat:b.check("REPEAT"),
first:b.check("FIRST")});this.storeDrawOpt(a)};C.prototype.drawPrimitives=function(a){var b=this;a||(a=0,this._doing_primitives=!0);var d=this.getObject().fSteps.arr[this.step];return!d||a>=d.arr.length?(delete this._doing_primitives,Promise.resolve()):JSROOT.draw(this.getDom(),d.arr[a],d.opt[a]).then(function(c){c&&(c.$grtimeid=b.selfid);return b.drawPrimitives(a+1)})};C.prototype.continueDrawing=function(){var a=this;if(this.options){var b=this.getObject();if(this.options.first)delete this.step;
else if(this.wait_animation_frame)delete this.wait_animation_frame,(b=this.getPadPainter())?(b.cleanPrimitives(function(b){return b.$grtimeid===a.selfid}),this.drawPrimitives().then(function(){return a.continueDrawing()})):delete this.step;else if(this.running_timeout)clearTimeout(this.running_timeout),delete this.running_timeout,this.wait_animation_frame=!0,requestAnimationFrame(function(){return a.continueDrawing()});else{var d=b.fSleepTime;if(!d||100>d)d=10;if(++this.step>b.fSteps.arr.length)if(this.options.repeat)this.step=
0,d=Math.max(5E3,5*d);else{delete this.step;return}this.running_timeout=setTimeout(function(){return a.continueDrawing()},d)}}};C.prototype.startDrawing=function(){var a=this;this.step=0;return this.drawPrimitives().then(function(){a.continueDrawing();return a})};B.prototype=Object.create(JSROOT.ObjectPainter.prototype);B.prototype.getEfficiency=function(a){var b=this.getObject(),d=b.fTotalHistogram.getBinContent(a);a=b.fPassedHistogram.getBinContent(a);return d?a/d:0};B.prototype.Normal=function(a,
b,d,c){if(0==a)return c?1:0;b/=a;a=JSROOT.Math.normal_quantile(1-(1-d)/2,Math.sqrt(b*(1-b)/a));return c?1<b+a?1:b+a:0>b-a?0:b-a};B.prototype.getEfficiencyErrorLow=function(a){var b=this.getObject(),d=b.fTotalHistogram.getBinContent(a),c=b.fPassedHistogram.getBinContent(a);return this.getEfficiency(a)-this[this.fBoundary](d,c,b.fConfLevel,!1)};B.prototype.getEfficiencyErrorUp=function(a){var b=this.getObject(),d=b.fTotalHistogram.getBinContent(a),c=b.fPassedHistogram.getBinContent(a);a=this.getEfficiency(a);
return this[this.fBoundary](d,c,b.fConfLevel,!0)-a};B.prototype.fillGraph=function(a,b){var d=this.getObject(),c=d.fTotalHistogram.fXaxis.fNbins,e=!1,k=0;0<=b.toLowerCase().indexOf("e0")&&(e=!0);for(b=0;b<c;++b)if(e||0!==d.fTotalHistogram.getBinContent(b+1))a.fX[k]=d.fTotalHistogram.fXaxis.GetBinCenter(b+1),a.fY[k]=this.getEfficiency(b+1),a.fEXlow[k]=d.fTotalHistogram.fXaxis.GetBinCenter(b+1)-d.fTotalHistogram.fXaxis.GetBinLowEdge(b+1),a.fEXhigh[k]=d.fTotalHistogram.fXaxis.GetBinLowEdge(b+2)-d.fTotalHistogram.fXaxis.GetBinCenter(b+
1),a.fEYlow[k]=this.getEfficiencyErrorLow(b+1),a.fEYhigh[k]=this.getEfficiencyErrorUp(b+1),++k;a.fNpoints=k};x.prototype=Object.create(JSROOT.ObjectPainter.prototype);x.prototype.cleanup=function(){this.painters=[];JSROOT.ObjectPainter.prototype.cleanup.call(this)};x.prototype.updateObject=function(a){if(!this.matchObjectType(a))return!1;var b=this.getObject(),d=a.fGraphs,c=this.getPadPainter();b.fTitle=a.fTitle;b=!1;if(this.firstpainter){var e=a.fHistogram;this.autorange&&!e&&(e=this.scanGraphsRange(d));
this.firstpainter.updateObject(e)&&(b=!0)}for(e=0;e<d.arr.length;++e)e<this.painters.length&&this.painters[e].updateObject(d.arr[e])&&(b=!0);if(a.fFunctions)for(d=0;d<a.fFunctions.arr.length;++d)if((e=a.fFunctions.arr[d])&&e._typename&&e.fName){var k=c?c.findPainterFor(null,e.fName,e._typename):null;k&&k.updateObject(e)}return b};x.prototype.scanGraphsRange=function(a,b,d){var c=this.getObject(),e=0;var k=0;var f=!1,h=!1,g=!1,l="",m=0,q=0,n=0,z=0,r=!0;d&&(f=d.fLogx,h=d.fLogy,m=d.fUxmin,q=d.fUxmax,
n=d.fUymin,z=d.fUymax,r=!1);if(b){a=b.fYaxis.fXmin;var w=b.fYaxis.fXmax;d&&(e=d.fLogx&&50>m?Math.exp(2.302585092994*m):m,k=d.fLogx&&50>q?Math.exp(2.302585092994*q):q)}else this.autorange=!0,a.arr.forEach(function(a){if(0!=a.fNpoints){r&&(m=q=a.fX[0],n=z=a.fY[0],r=!1);for(var b=0;b<a.fNpoints;++b)m=Math.min(m,a.fX[b]),q=Math.max(q,a.fX[b]),n=Math.min(n,a.fY[b]),z=Math.max(z,a.fY[b])}}),a.arr[0]&&a.arr[0].fHistogram&&a.arr[0].fHistogram.fXaxis.fTimeDisplay&&(g=!0,l=a.arr[0].fHistogram.fXaxis.fTimeFormat),
m==q&&(q+=1),n==z&&(z+=1),k=.05*(q-m),d=.05*(z-n),e=m-k,k=q+k,h?(0>=n&&(n=.001*z),a=n/(1+.5*Math.log10(z/n)),w=z*(1+.2*Math.log10(z/n))):(a=n-d,w=z+d),0>a&&0<=n&&(a=0),0<w&&0>=z&&(w=0);0>e&&0<=m&&(e=f?.9*m:0);0<k&&0>=q&&(k=f?1.1*q:0);-1111!=c.fMinimum&&(n=a=c.fMinimum);-1111!=c.fMaximum&&(z=w=c.fMaximum);0>a&&0<=n&&h&&(a=.9*n);0<w&&0>=z&&h&&(w=1.1*z);0>=a&&h&&(a=.001*w);!h&&0<a&&a<.05*w&&(a=0);0>=e&&f&&(e=1E3<k?1:.001*k);!b&&(b=JSROOT.create("TH1I"),b.fTitle=c.fTitle,b.fXaxis.fXmin=e,b.fXaxis.fXmax=
k,b.fXaxis.fTimeDisplay=g)&&(b.fXaxis.fTimeFormat=l);b.fYaxis.fXmin=a;b.fYaxis.fXmax=w;return b};x.prototype.drawAxis=function(a){var b=this.getObject(),d=this.getPadPainter();b=this.scanGraphsRange(b.fGraphs,b.fHistogram,d?d.getRootPad(!0):null);return JSROOT.draw(this.getDom(),b,"AXIS"+a)};x.prototype.drawNextFunction=function(a){var b=this,d=this.getObject();return!d.fFunctions||a>=d.fFunctions.arr.length?Promise.resolve(this):JSROOT.draw(this.getDom(),d.fFunctions.arr[a],d.fFunctions.opt[a]).then(function(){return b.drawNextFunction(a+
1)})};x.prototype.drawNextGraph=function(a,b){var d=this,c=this.getObject().fGraphs;if(a>=c.arr.length)return this._pfc=this._plc=this._pmc=!1,this.drawNextFunction(0);if(this._pfc||this._plc||this._pmc){var e=this.getMainPainter();e&&e.createAutoColor&&(e=e.createAutoColor(c.arr.length),this._pfc&&(c.arr[a].fFillColor=e),this._plc&&(c.arr[a].fLineColor=e),this._pmc&&(c.arr[a].fMarkerColor=e))}return JSROOT.draw(this.getDom(),c.arr[a],c.opt[a]||b).then(function(c){c&&d.painters.push(c);return d.drawNextGraph(a+
1,b)})};g.drawMultiGraph=function(a,b,d){var c=new x(a,b),e=new JSROOT.DrawOptions(d);e.check("3D");e.check("FB");c._pfc=e.check("PFC");c._plc=e.check("PLC");c._pmc=e.check("PMC");var k="";"USE_PAD_TITLE LOGXY LOGX LOGY LOGZ GRIDXY GRIDX GRIDY TICKXY TICKX TICKY".split(" ").forEach(function(a){e.check(a)&&(k+=";"+a)});a=Promise.resolve(c);if(e.check("A")||!c.getMainPainter())a=c.drawAxis(k).then(function(a){c.firstpainter=a;return c});return a.then(function(){c.addToPadPrimitives();return c.drawNextGraph(0,
e.remain())})};A.prototype=Object.create(JSROOT.ObjectPainter.prototype);A.prototype.decodeOptions=function(a){this.options={Zscale:!1};a&&0<=a.indexOf("z")&&(this.options.Zscale=!0)};A.prototype.createRGBA=function(a){var b=this.getObject();if(!b||!b.fPalette)return null;var d=Array(4*(a+1)),c=1;b=b.fPalette;for(var e=0;e<=a;++e){for(var k=1*e/a;b.fPoints[c]<k&&c<b.fPoints.length-1;)c++;var f=(b.fPoints[c]-k)/(b.fPoints[c]-b.fPoints[c-1]);k=(k-b.fPoints[c-1])/(b.fPoints[c]-b.fPoints[c-1]);d[4*e]=
Math.min(255,Math.round((b.fColorRed[c-1]*f+b.fColorRed[c]*k)/256));d[4*e+1]=Math.min(255,Math.round((b.fColorGreen[c-1]*f+b.fColorGreen[c]*k)/256));d[4*e+2]=Math.min(255,Math.round((b.fColorBlue[c-1]*f+b.fColorBlue[c]*k)/256));d[4*e+3]=Math.min(255,Math.round((b.fColorAlpha[c-1]*f+b.fColorAlpha[c]*k)/256))}return d};A.prototype.drawImage=function(){var a=this,b=this.getObject(),d=!1,c=this.getFramePainter(),e=c?c.getFrameRect():this.getPadPainter().getPadRect();if(b._blob){if(15!=b._blob.length||
b._blob[0])3==b._blob.length&&b._blob[0]?(b.fPngBuf=b._blob[2],b.fPngBuf&&b.fPngBuf.length==b._blob[1]||(console.error("TASImage with png buffer _blob error",b._blob[1],"!=",b.fPngBuf?b.fPngBuf.length:-1),delete b.fPngBuf)):console.error("TASImage _blob len",b._blob.length,"not recognized");else if(b.fImageQuality=b._blob[1],b.fImageCompression=b._blob[2],b.fConstRatio=b._blob[3],b.fPalette={_typename:"TImagePalette",fUniqueID:b._blob[4],fBits:b._blob[5],fNumPoints:b._blob[6],fPoints:b._blob[7],fColorRed:b._blob[8],
fColorGreen:b._blob[9],fColorBlue:b._blob[10],fColorAlpha:b._blob[11]},b.fWidth=b._blob[12],b.fHeight=b._blob[13],b.fImgBuf=b._blob[14],b.fWidth*b.fHeight!=b.fImgBuf.length||b.fPalette.fNumPoints!=b.fPalette.fPoints.length)console.error("TASImage _blob decoding error",b.fWidth*b.fHeight,"!=",b.fImgBuf.length,b.fPalette.fNumPoints,"!=",b.fPalette.fPoints.length),delete b.fImgBuf,delete b.fPalette;delete b._blob}var k=!0;if(b.fImgBuf&&b.fPalette){d=!0;this.rgba=this.createRGBA(1E3);k=b.fImgBuf[0];var f=
b.fImgBuf[0];for(var h=1;h<b.fImgBuf.length;++h){var g=b.fImgBuf[h];k=Math.min(g,k);f=Math.max(g,f)}this.fContour={arr:Array(200),rgba:this.rgba,getLevels:function(){return this.arr},getPaletteColor:function(a,b){if(!this.arr||!this.rgba)return"white";a=4*Math.round((b-this.arr[0])/(this.arr[this.arr.length-1]-this.arr[0])*(this.rgba.length-4)/4);return"rgba("+this.rgba[a]+","+this.rgba[a+1]+","+this.rgba[a+2]+","+this.rgba[a+3]+")"}};for(h=0;200>h;h++)this.fContour.arr[h]=k+(f-k)/199*h;k>=f&&(f=
k+1);h=0;g=b.fWidth;var l=0,m=b.fHeight;c&&c.zoom_xmin!=c.zoom_xmax&&(h=Math.round(c.zoom_xmin*b.fWidth),g=Math.round(c.zoom_xmax*b.fWidth));c&&c.zoom_ymin!=c.zoom_ymax&&(l=Math.round(c.zoom_ymin*b.fHeight),m=Math.round(c.zoom_ymax*b.fHeight));if(JSROOT.nodejs)try{var q=require("canvas").createCanvas;var n=q(g-h,m-l)}catch(F){console.log("canvas is not installed")}else n=document.createElement("canvas"),n.width=g-h,n.height=m-l;if(!n)return Promise.resolve(null);q=n.getContext("2d");for(var r=q.getImageData(0,
0,n.width,n.height),t=r.data;l<m;++l)for(var w=(m-l-1)*(g-h)*4,u=l*b.fWidth,v=h;v<g;++v){var x=4*Math.round((b.fImgBuf[u+v]-k)/(f-k)*1E3);t[w++]=this.rgba[x++];t[w++]=this.rgba[x++];t[w++]=this.rgba[x++];t[w++]=this.rgba[x++]}q.putImageData(r,0,0);f=n.toDataURL();k=b.fConstRatio}else if(b.fPngBuf){n="";if("string"==typeof b.fPngBuf)n=b.fPngBuf;else for(f=0;f<b.fPngBuf.length;++f)n+=String.fromCharCode(0>b.fPngBuf[f]?256+b.fPngBuf[f]:b.fPngBuf[f]);f="data:image/png;base64,"+(JSROOT.nodejs?require("btoa"):
window.btoa)(n)}f&&this.createG(c?!0:!1).append("image").attr("href",f).attr("width",e.width).attr("height",e.height).attr("preserveAspectRatio",k?null:"none");return f&&this.isMainPainter()&&d&&c?this.drawColorPalette(this.options.Zscale,!0).then(function(){c.setAxesRanges(JSROOT.create("TAxis"),0,1,JSROOT.create("TAxis"),0,1,null,0,0);c.createXY({ndim:2,check_pad_range:!1});c.addInteractivity();return a}):Promise.resolve(this)};A.prototype.canZoomInside=function(a,b,d){var c=this.getObject();return c&&
c.fImgBuf?"x"==a&&3<(d-b)*c.fWidth||"y"==a&&3<(d-b)*c.fHeight?!0:!1:!1};A.prototype.drawColorPalette=function(a,b){var d=this;if(!this.isMainPainter())return Promise.resolve(null);if(!this.draw_palette){var c=JSROOT.create("TPave");JSROOT.extend(c,{_typename:"TPaletteAxis",fName:"TPave",fH:null,fAxis:JSROOT.create("TGaxis"),fX1NDC:.91,fX2NDC:.95,fY1NDC:.1,fY2NDC:.9,fInit:1});c.fAxis.fChopt="+";this.draw_palette=c;this.fPalette=!0}c=this.getPadPainter().findPainterFor(this.draw_palette);if(!a)return c&&
(c.Enabled=!1,c.removeG()),Promise.resolve(null);a=this.getFramePainter();b&&a&&(b=this.draw_palette,b.fX2NDC=a.fX2NDC+.01+(b.fX2NDC-b.fX1NDC),b.fX1NDC=a.fX2NDC+.01,b.fY1NDC=a.fY1NDC,b.fY2NDC=a.fY2NDC);if(c)return c.Enabled=!0,c.drawPave("");var e=this.selectCurrentPad(this.getPadName());return JSROOT.draw(this.getDom(),this.draw_palette).then(function(a){d.selectCurrentPad(e);a.$secondary=!0;a.redraw=function(){};return d})};A.prototype.toggleColz=function(){var a=this.getObject();a&&a.fPalette&&
(this.options.Zscale=!this.options.Zscale,this.drawColorPalette(this.options.Zscale,!0))};A.prototype.redraw=function(a){var b=this.draw_g?this.draw_g.select("image"):null,d=this.getFramePainter();b&&!b.empty()&&"zoom"!==a&&d?b.attr("width",d.getFrameWidth()).attr("height",d.getFrameHeight()):this.drawImage()};A.prototype.clickButton=function(a){if(!this.isMainPainter())return!1;switch(a){case "ToggleColorZ":this.toggleColz();break;default:return!1}return!0};A.prototype.fillToolbar=function(){var a=
this.getPadPainter(),b=this.getObject();a&&b&&b.fPalette&&(a.addPadButton("th2colorz","Toggle color palette","ToggleColorZ"),a.showPadButtons())};g.drawJSImage=function(a,b,d){a=new JSROOT.BasePainter(a);var c=a.selectDom();b=c.append("img").attr("src",b.fName).attr("title",b.fTitle||b.fName);d&&0<=d.indexOf("scale")?b.style("width","100%").style("height","100%"):d&&0<=d.indexOf("center")&&(c.style("position","relative"),b.attr("style","margin: 0; position: absolute;  top: 50%; left: 50%; transform: translate(-50%, -50%);"));
a.setTopPainter();return Promise.resolve(a)};D.prototype=Object.create(JSROOT.ObjectPainter.prototype);D.prototype.setGridsRange=function(a,b){var d=this.getObject(),c=this.getPadPainter();if(a===b){c=(c=c.findPainterFor(d.fLowerPad,"lower_pad","TPad"))?c.getFramePainter():null;if(!c||!c.x_handle)return;a=c.x_handle.full_min;b=c.x_handle.full_max}d.fGridlines.forEach(function(c){c.fX1=a;c.fX2=b})};D.prototype.redraw=function(){var a=this,b=this.getObject(),d=this.getPadPainter(),c=d.findPainterFor(b.fTopPad,
"top_pad","TPad");c&&c.disablePadDrawing();var e=(c=d.findPainterFor(b.fUpperPad,"upper_pad","TPad"))?c.getMainPainter():null,k=c?c.getFramePainter():null,f=d.findPainterFor(b.fLowerPad,"lower_pad","TPad"),h=f?f.getMainPainter():null,g=f?f.getFramePainter():null,l=20;d=Promise.resolve(!0);c&&e&&k&&g&&!c._ratio_configured&&(c._ratio_configured=!0,e.options.Axis=0,l=e.getHisto().fYaxis.fLabelSize,1>l&&(l=Math.round(l*Math.min(c.getPadWidth(),c.getPadHeight()))),d=e.getHisto(),d.fXaxis.fLabelSize=0,
d.fXaxis.fTitle="",d.fYaxis.fLabelSize=l,d.fYaxis.fTitleSize=l,c.getRootPad().fTicky=1,d=c.redrawPad().then(function(){k.o_zoom=k.zoom;k._ratio_low_fp=g;k._ratio_painter=a;k.zoom=function(a,b,c,d,e,f){this._ratio_painter.setGridsRange(a,b);this._ratio_low_fp.o_zoom(a,b);return this.o_zoom(a,b,c,d,e,f)};k.o_sizeChanged=k.sizeChanged;k.sizeChanged=function(){this.o_sizeChanged();this._ratio_low_fp.fX1NDC=this.fX1NDC;this._ratio_low_fp.fX2NDC=this.fX2NDC;this._ratio_low_fp.o_sizeChanged()};return!0}));
return d.then(function(){if(!(f&&h&&g&&k)||f._ratio_configured)return a;f._ratio_configured=!0;h.options.Axis=0;var c=h.getHisto();c.fXaxis.fTitle="x";c.fXaxis.fLabelSize=l;c.fXaxis.fTitleSize=l;c.fYaxis.fLabelSize=l;c.fYaxis.fTitleSize=l;f.getRootPad().fTicky=1;f.forEachPainterInPad(function(a){"function"==typeof a.testEditable&&a.testEditable(!1)});var d=[],e;0<b.fGridlinePositions.length&&b.fGridlines.length<b.fGridlinePositions.length&&b.fGridlinePositions.forEach(function(c){var f=!1;b.fGridlines.forEach(function(a){a.fY1==
a.fY2&&1E-6>Math.abs(a.fY1-c)&&(f=!0)});if(!f){var h=JSROOT.create("TLine");h.fX1=k.scale_xmin;h.fX2=k.scale_xmax;h.fY1=h.fY2=c;h.fLineStyle=2;b.fGridlines.push(h);void 0===e&&(e=a.selectCurrentPad(b.fLowerPad.fName));d.push(JSROOT.draw(a.getDom(),h))}});return Promise.all(d).then(function(){return g.zoom(k.scale_xmin,k.scale_xmax)}).then(function(){g.o_zoom=g.zoom;g._ratio_up_fp=k;g._ratio_painter=a;g.zoom=function(a,b,c,d,e,f){this._ratio_painter.setGridsRange(a,b);this._ratio_up_fp.o_zoom(a,b);
return this.o_zoom(a,b,c,d,e,f)};g.o_sizeChanged=g.sizeChanged;g.sizeChanged=function(){this.o_sizeChanged();this._ratio_up_fp.fX1NDC=this.fX1NDC;this._ratio_up_fp.fX2NDC=this.fX2NDC;this._ratio_up_fp.o_sizeChanged()};return a})})};g.drawText=function(){var a=this,b=this.getObject(),d=this.getPadPainter(),c=d.getPadWidth(),e=d.getPadHeight(),k=b.fX,f=b.fY,h=this.getColor(b.fTextColor),g=!1,l=1,m=b.fTextSize||.05,q=this.getFramePainter();b.TestBit(JSROOT.BIT(14))?this.isndc=!0:q&&!q.mode3d?(c=q.getFrameWidth(),
e=q.getFrameHeight(),g="upper_layer"):d.getRootPad(!0)||(this.isndc=!0,k=f=.5,b.fTextAlign=22,h||(h="black"));this.createG(g);this.draw_g.attr("transform",null);this.pos_x=this.axisToSvg("x",k,this.isndc);this.pos_y=this.axisToSvg("y",f,this.isndc);d={align:b.fTextAlign,x:this.pos_x,y:this.pos_y,text:b.fTitle,color:h,latex:0};b.fTextAngle&&(d.rotate=-b.fTextAngle);"TLatex"==b._typename?(d.latex=1,l=.9):"TMathText"==b._typename&&(d.latex=2,l=.8);this.startTextDrawing(b.fTextFont,Math.round(1<m?m:m*
Math.min(c,e)*l));this.drawText(d);return this.finishTextDrawing().then(function(){return JSROOT.batch_mode?a:JSROOT.require(["interactive"]).then(function(b){a.pos_dx=a.pos_dy=0;a.moveDrag||(a.moveDrag=function(a,b){this.pos_dx+=a;this.pos_dy+=b;this.draw_g.attr("transform","translate("+this.pos_dx+","+this.pos_dy+")")});a.moveEnd||(a.moveEnd=function(a){a||(a=this.getObject(),a.fX=this.svgToAxis("x",this.pos_x+this.pos_dx,this.isndc),a.fY=this.svgToAxis("y",this.pos_y+this.pos_dy,this.isndc),this.submitCanvExec("SetX("+
a.fX+");;SetY("+a.fY+");;"))});b.addMoveHandler(a);return a})})};g.drawLine=function(){var a=this.getObject(),b=new JSROOT.TAttLineHandler(a),d=JSROOT.BIT(14);d=a.TestBit(d);this.createG();this.draw_g.append("svg:line").attr("x1",this.axisToSvg("x",a.fX1,d)).attr("y1",this.axisToSvg("y",a.fY1,d)).attr("x2",this.axisToSvg("x",a.fX2,d)).attr("y2",this.axisToSvg("y",a.fY2,d)).call(b.func)};g.drawPolyLine=function(){this.createG();var a=this.getObject(),b=new JSROOT.TAttLineHandler(a),d=this.createAttFill(a),
c=JSROOT.BIT(14),e=a.TestBit(c);c="";e=this.getAxisToSvgFunc(e);for(var k=0;k<=a.fLastPoint;++k)c+=(0<k?"L":"M")+e.x(a.fX[k])+","+e.y(a.fY[k]);"TPolyLine"!=a._typename&&d.setSolidColor("none");d.empty()||(c+="Z");this.draw_g.append("svg:path").attr("d",c).call(b.func).call(d.func)};g.drawArrow=function(){var a=this,b=this.getObject(),d=JSROOT.BIT(14),c=b.fOption,e=this.getPadPainter().getPadRect();this.wsize=Math.max(3,Math.round(Math.max(e.width,e.height)*b.fArrowSize*.8));this.isndc=b.TestBit(d);
this.angle2=b.fAngle/2/180*Math.PI;this.beg=this.mid=this.end=0;0==c.indexOf("<")&&(this.beg=0==c.indexOf("<|")?12:2);0<=c.indexOf("->-")?this.mid=1:0<=c.indexOf("-|>-")?this.mid=11:0<=c.indexOf("-<-")?this.mid=2:0<=c.indexOf("-<|-")&&(this.mid=12);d=c.lastIndexOf(">");e=c.lastIndexOf("|>");c=c.length;0<=d&&d==c-1&&(this.end=0<=e&&e==c-2?11:1);this.createAttLine({attr:b});this.createG();this.x1=this.axisToSvg("x",b.fX1,this.isndc,!0);this.y1=this.axisToSvg("y",b.fY1,this.isndc,!0);this.x2=this.axisToSvg("x",
b.fX2,this.isndc,!0);this.y2=this.axisToSvg("y",b.fY2,this.isndc,!0);this.rotate=function(a,b,c){var d=this.wsize*Math.cos(a);a=this.wsize*Math.sin(a);var e="";void 0!==b&&void 0!==c?e="M"+Math.round(b-d)+","+Math.round(c-a):(d=-d,a=-a);e+="l"+Math.round(d)+","+Math.round(a);b&&void 0===c&&(e+="z");return e};this.createPath=function(){var a=Math.atan2(this.y2-this.y1,this.x2-this.x1),b=this.wsize*Math.cos(this.angle2),c=b*Math.cos(a);b*=Math.sin(a);var d="";this.beg&&(d+=this.rotate(a-Math.PI-this.angle2,
this.x1,this.y1)+this.rotate(a-Math.PI+this.angle2,10<this.beg));2==this.mid%10&&(d+=this.rotate(a-Math.PI-this.angle2,(this.x1+this.x2-c)/2,(this.y1+this.y2-b)/2)+this.rotate(a-Math.PI+this.angle2,10<this.mid));1==this.mid%10&&(d+=this.rotate(a-this.angle2,(this.x1+this.x2+c)/2,(this.y1+this.y2+b)/2)+this.rotate(a+this.angle2,10<this.mid));this.end&&(d+=this.rotate(a-this.angle2,this.x2,this.y2)+this.rotate(a+this.angle2,10<this.end));return"M"+Math.round(this.x1+(10<this.beg?c:0))+","+Math.round(this.y1+
(10<this.beg?b:0))+"L"+Math.round(this.x2-(10<this.end?c:0))+","+Math.round(this.y2-(10<this.end?b:0))+d};c=this.draw_g.append("svg:path").attr("d",this.createPath()).call(this.lineatt.func);10<this.beg||10<this.end?(this.createAttFill({attr:b}),c.call(this.fillatt.func)):c.style("fill","none");JSROOT.batch_mode||JSROOT.require(["interactive"]).then(function(b){a.moveStart||(a.moveStart=function(a,b){var c=Math.sqrt(Math.pow(this.x1-this.x2,2)+Math.pow(this.y1-this.y2,2)),d=Math.sqrt(Math.pow(a-this.x2,
2)+Math.pow(b-this.y2,2))/c;this.side=.9<Math.sqrt(Math.pow(a-this.x1,2)+Math.pow(b-this.y1,2))/c?1:.9<d?-1:0});a.moveDrag||(a.moveDrag=function(a,b){1!=this.side&&(this.x1+=a,this.y1+=b);-1!=this.side&&(this.x2+=a,this.y2+=b);this.draw_g.select("path").attr("d",this.createPath())});a.moveEnd||(a.moveEnd=function(a){if(!a){a=this.getObject();var b="";a.fX1=this.svgToAxis("x",this.x1,this.isndc);a.fX2=this.svgToAxis("x",this.x2,this.isndc);a.fY1=this.svgToAxis("y",this.y1,this.isndc);a.fY2=this.svgToAxis("y",
this.y2,this.isndc);1!=this.side&&(b+="SetX1("+a.fX1+");;SetY1("+a.fY1+");;");-1!=this.side&&(b+="SetX2("+a.fX2+");;SetY2("+a.fY2+");;");this.submitCanvExec(b+"Notify();;")}});b.addMoveHandler(a)})};g.drawEllipse=function(){var a=this.getObject();this.createAttLine({attr:a});this.createAttFill({attr:a});this.createG();var b=this.axisToSvg("x",a.fX1),d=this.axisToSvg("y",a.fY1),c=this.axisToSvg("x",a.fX1+a.fR1)-b,e=d-this.axisToSvg("y",a.fY1+a.fR2);if("TCrown"==a._typename)if(0>=a.fR1)c=this.axisToSvg("x",
a.fX1+a.fR2)-b;else{var k=d-this.axisToSvg("y",a.fY1+a.fR1),f=this.axisToSvg("x",a.fX1+a.fR2)-b;b=this.draw_g.attr("transform","translate("+b+","+d+")").append("svg:path").call(this.lineatt.func).call(this.fillatt.func);if(0==a.fPhimin&&360==a.fPhimax)b.attr("d","M-"+c+",0A"+c+","+k+",0,1,0,"+c+",0A"+c+","+k+",0,1,0,-"+c+",0M-"+f+",0A"+f+","+e+",0,1,0,"+f+",0A"+f+","+e+",0,1,0,-"+f+",0");else{d=180<=a.fPhimax-a.fPhimin?1:0;var h=a.fPhimin*Math.PI/180;a=a.fPhimax*Math.PI/180;b.attr("d","M"+Math.round(c*
Math.cos(a))+","+Math.round(k*Math.sin(a))+"A"+c+","+k+",0,"+d+",0,"+Math.round(c*Math.cos(h))+","+Math.round(k*Math.sin(h))+"L"+Math.round(f*Math.cos(h))+","+Math.round(e*Math.sin(h))+"A"+f+","+e+",0,"+d+",1,"+Math.round(f*Math.cos(a))+","+Math.round(e*Math.sin(a))+"Z")}return}if(0==a.fPhimin&&360==a.fPhimax&&0==a.fTheta)this.draw_g.append("svg:ellipse").attr("cx",b).attr("cy",d).attr("rx",c).attr("ry",e).call(this.lineatt.func).call(this.fillatt.func);else{f=Math.cos(a.fTheta*Math.PI/180);h=Math.sin(a.fTheta*
Math.PI/180);var g=c*Math.cos(a.fPhimin*Math.PI/180),l=e*Math.sin(a.fPhimin*Math.PI/180);k=g*f-l*h;g=-g*h-l*f;var m=c*Math.cos(a.fPhimax*Math.PI/180),q=e*Math.sin(a.fPhimax*Math.PI/180);l=m*f-q*h;f=-m*h-q*f;this.draw_g.attr("transform","translate("+b+","+d+")").append("svg:path").attr("d","M0,0L"+Math.round(k)+","+Math.round(g)+"A"+c+","+e+","+Math.round(-a.fTheta)+",1,0,"+Math.round(l)+","+Math.round(f)+"Z").call(this.lineatt.func).call(this.fillatt.func)}};g.drawPie=function(){var a=this.getObject();
this.createG();var b=this.axisToSvg("x",a.fX),d=this.axisToSvg("y",a.fY),c=this.axisToSvg("x",a.fX+a.fRadius)-b,e=this.axisToSvg("y",a.fY+a.fRadius)-d;this.draw_g.attr("transform","translate("+b+","+d+")");b=a.fPieSlices.length;d=0;for(var k=a.fAngularOffset*Math.PI/180,f=Math.round(c*Math.cos(k)),h=Math.round(e*Math.sin(k)),g=0;g<b;g++)d+=a.fPieSlices[g].fValue;for(g=0;g<b;g++){var l=a.fPieSlices[g],m=new JSROOT.TAttLineHandler({attr:l}),q=this.createAttFill(l);k+=l.fValue/d*2*Math.PI;l=Math.round(c*
Math.cos(k));var n=Math.round(e*Math.sin(k));this.draw_g.append("svg:path").attr("d","M0,0L"+f+","+h+"A"+c+","+e+",0,0,0,"+l+","+n+"z").call(m.func).call(q.func);f=l;h=n}};g.drawBox=function(){var a=this.getObject(),b=0<=this.getDrawOpt().toUpperCase().indexOf("L"),d=this.createAttLine(a),c=this.createAttFill(a);this.createG();var e=this.axisToSvg("x",a.fX1),k=this.axisToSvg("x",a.fX2),f=this.axisToSvg("y",a.fY1),h=this.axisToSvg("y",a.fY2),g=Math.min(e,k),m=Math.min(f,h);e=Math.abs(k-e);f=Math.abs(f-
h);c.empty()||b||(d.color="none");this.draw_g.append("svg:path").attr("d","M"+g+","+m+"h"+e+"v"+f+"h"+-e+"z").call(d.func).call(c.func);a.fBorderMode&&a.fBorderSize&&c.hasColor()&&(h=d=a.fBorderSize,b="M"+g+","+m+"h"+e+"l"+-d+","+h+"h"+(2*d-e)+"v"+(f-2*h)+"l"+-d+","+h+"z",g="M"+(g+e)+","+(m+f)+"v"+-f+"l"+-d+","+h+"v"+(f-2*h)+"h"+(2*d-e)+"l"+-d+","+h+"z",0>a.fBorderMode&&(a=b,b=g,g=a),this.draw_g.append("svg:path").attr("d",b).style("stroke","none").call(c.func).style("fill",l.rgb(c.color).brighter(.5).toString()),
this.draw_g.append("svg:path").attr("d",g).style("stroke","none").call(c.func).style("fill",l.rgb(c.color).darker(.5).toString()))};g.drawMarker=function(){var a=this.getObject(),b=new JSROOT.TAttMarkerHandler(a),d=JSROOT.BIT(14),c=a.TestBit(d);this.createG();d=this.axisToSvg("x",a.fX,c);a=this.axisToSvg("y",a.fY,c);(a=b.create(d,a))&&this.draw_g.append("svg:path").attr("d",a).call(b.func)};g.drawPolyMarker=function(){this.createG();for(var a=this.getObject(),b=new JSROOT.TAttMarkerHandler(a),d="",
c=this.getAxisToSvgFunc(),e=0;e<a.fN;++e)d+=b.create(c.x(a.fX[e]),c.y(a.fY[e]));d&&this.draw_g.append("svg:path").attr("d",d).call(b.func)};g.drawWebPainting=function(a,b,d){a=new JSROOT.ObjectPainter(a,b,d);a.updateObject=function(a){if(!this.matchObjectType(a))return!1;this.draw_object=a;return!0};a.ReadAttr=function(a,b){for(var c=0,d={_typename:"any"},e=0;e<b.length;++e){var g=a.indexOf(":",c+1);d[b[e]]=parseInt(a.substr(c+1,g>c?g-c-1:void 0));c=g}return d};a.redraw=function(){function a(a,b){if(b!=
m&&(l&&(l.attr("d",r),r="",l=null,m="none"),b))switch(m=b,l=a.draw_g.append("svg:path"),b){case "f":l.call(a.fillatt.func).attr("stroke","none");break;case "l":l.call(a.lineatt.func).attr("fill","none");break;case "m":l.call(a.markeratt.func)}}var b=this.getObject(),d=this.getAxisToSvgFunc();if(b&&b.fOper&&d){var f=0,h={},l=null,m="none",r="",q,n=b.fOper.split(";");this.createG();for(q=0;q<n.length;++q){var t=n[q][0];switch(t){case "z":this.createAttLine({attr:this.ReadAttr(n[q],["fLineColor","fLineStyle",
"fLineWidth"]),force:!0});a();continue;case "y":this.createAttFill({attr:this.ReadAttr(n[q],["fFillColor","fFillStyle"]),force:!0});a();continue;case "x":this.createAttMarker({attr:this.ReadAttr(n[q],["fMarkerColor","fMarkerStyle","fMarkerSize"]),force:!0});a();continue;case "o":h=this.ReadAttr(n[q],["fTextColor","fTextFont","fTextSize","fTextAlign","fTextAngle"]);0>h.fTextSize&&(h.fTextSize*=-.001);a();continue;case "r":case "b":a(this,"b"==t?"f":"l");t=d.x(b.fBuf[f++]);var u=d.y(b.fBuf[f++]);var w=
d.x(b.fBuf[f++]);var v=d.y(b.fBuf[f++]);r+="M"+t+","+u+"h"+(w-t)+"v"+(v-u)+"h"+(t-w)+"z";continue;case "l":case "f":a(this,t);w=parseInt(n[q].substr(1));for(u=0;u<w;++u)r+=(0<u?"L":"M")+d.x(b.fBuf[f++])+","+d.y(b.fBuf[f++]);"f"==t&&(r+="Z");continue;case "m":a(this,t);w=parseInt(n[q].substr(1));this.markeratt.resetPos();for(u=0;u<w;++u)r+=this.markeratt.create(d.x(b.fBuf[f++]),d.y(b.fBuf[f++]));continue;case "h":case "t":if(h.fTextSize){a();u=1<h.fTextSize?h.fTextSize:this.getPadPainter().getPadHeight()*
h.fTextSize;w=this.draw_g.append("svg:g");this.startTextDrawing(h.fTextFont,u,w);v=h.fTextAngle;360<=v&&(v-=360*Math.floor(v/360));var x=n[q].substr(1);if("h"==t){t="";for(u=0;u<x.length;u+=2)t+=String.fromCharCode(parseInt(x.substr(u,2),16));x=t}this.drawText({align:h.fTextAlign,x:d.x(b.fBuf[f++]),y:d.y(b.fBuf[f++]),rotate:-v,text:x,color:g.getColor(h.fTextColor),latex:0,draw_g:w});this.finishTextDrawing(w)}continue;default:console.log("unsupported operation "+t)}}a()}};a.addToPadPrimitives();a.redraw();
return Promise.resolve(a)};g.drawRooPlot=function(a,b){function d(e){return e>=b._items.arr.length?c:JSROOT.draw(a,b._items.arr[e],b._items.opt[e]).then(function(){return d(e+1)})}var c;return JSROOT.draw(a,b._hist,"hist").then(function(a){c=a;return d(0)})};g.drawGraph=function(a,b,d){var c=new m(a,b);c.decodeOptions(d,!0);c.createBins();c.createStat();b=Promise.resolve();(!c.getMainPainter()||c.options.second_x||c.options.second_y)&&c.options.Axis&&(b=c.createHistogram(),b=JSROOT.draw(a,b,c.options.Axis).then(function(a){a&&
(c.axes_draw=!0,c._own_histogram||(c.$primary=!0),a.$secondary=!0)}));return b.then(function(){c.addToPadPrimitives();return c.drawGraph()}).then(function(){return c.drawNextFunction(0)})};g.drawFunction=function(a,b,d){var c=new u(a,b);b=new JSROOT.DrawOptions(d);var e=!!c.getMainPainter(),g="AXIS";b.check("SAME");c.nosave=b.check("NOSAVE");b.check("X+")&&(g+="X+",c.second_x=e);b.check("Y+")&&(g+="Y+",c.second_y=e);b.check("RX")&&(g+="RX");b.check("RY")&&(g+="RY");return JSROOT.require("math").then(function(){if(!e||
c.second_x||c.second_y)return JSROOT.draw(a,c.createDummyHisto(),g)}).then(function(){c.addToPadPrimitives();c.redraw();return c})};g.drawGraphTime=function(a,b,d){if(!b.fFrame)return console.error("Frame histogram not exists"),null;var c=new C(a,b);if(c.getMainPainter())return console.error("Cannot draw graph time on top of other histograms"),null;c.decodeOptions(d);!b.fFrame.fTitle&&b.fTitle&&(b.fFrame.fTitle=b.fTitle);c.selfid="grtime"+JSROOT._.id_counter++;return JSROOT.draw(a,b.fFrame,"AXIS").then(function(){c.addToPadPrimitives();
return c.startDrawing()})};g.drawGraphPolar=function(a,b,d){var c=new v(a,b);c.decodeOptions(d);if((d=c.getMainPainter())&&!d.$polargram)return console.error("Cannot superimpose TGraphPolar with plain histograms"),null;var e=Promise.resolve(d);d||(b.fPolargram||(b.fPolargram=c.createPolargram()),e=JSROOT.draw(a,b.fPolargram,""));return e.then(function(){c.addToPadPrimitives();c.drawGraphPolar();return c})};g.drawEfficiency=function(a,b,d){if(!b||!b.fTotalHistogram||0!=b.fTotalHistogram._typename.indexOf("TH1"))return null;
var c=new B(a,b);c.options=d;return JSROOT.require("math").then(function(){var e=JSROOT.create("TGraphAsymmErrors");e.fName="eff_graph";e.fTitle=b.fTitle;e.fLineColor=b.fLineColor;e.fLineStyle=b.fLineStyle;e.fLineWidth=b.fLineWidth;e.fFillColor=b.fFillColor;e.fFillStyle=b.fFillStyle;e.fMarkerColor=b.fMarkerColor;e.fMarkerStyle=b.fMarkerStyle;e.fMarkerSize=b.fMarkerSize;c.fillGraph(e,d);return JSROOT.draw(a,e,d)}).then(function(){c.addToPadPrimitives();return c})};g.drawGraphPolargram=function(a,b){var d=
g.getElementMainPainter(a);if(d)return d.getObject()===b?d:Promise.reject(Error("Cannot superimpose TGraphPolargram with any other drawings"));var c=new r(a,b);return g.ensureTCanvas(c,!1).then(function(){c.setAsMainPainter();c.redraw();return c})};g.drawASImage=function(a,b,d){var c=new A(a,b,d);c.decodeOptions(d);return g.ensureTCanvas(c,!1).then(function(){return c.drawImage()}).then(function(){c.fillToolbar();return c})};g.drawRatioPlot=function(a,b,d){var c=new D(a,b,d);return g.ensureTCanvas(c,
!1).then(function(){return c.redraw()})};JSROOT.TF1Painter=u;JSROOT.TGraphPainter=m;JSROOT.TGraphPolarPainter=v;JSROOT.TMultiGraphPainter=x;JSROOT.TSplinePainter=t;JSROOT.TASImagePainter=A;JSROOT.TRatioPlotPainter=D;return JSROOT});
